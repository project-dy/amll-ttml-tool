const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./kuroshiro-analyzer-kuromoji-fix-dict-6EI2KzNQ.js","./pixi-Cal6uEV8.js","./naive-ui-B1s3zDcz.js","./pixi-Cnq3xHD9.css"])))=>i.map(i=>d[i]);
import{f as pe,s as F,g as H,c as J,d as P,h as he,a as ve,j as I,__tla as ke}from"./index-Cf1-0K3Z.js";import{s as Te,a as _e}from"./vue-virtual-scroller.esm-BL7s1Wuc.js";import{d as z,r as E,f as G,C as U,l,n as h,p as _,L as x,V as p,a3 as $,I as d,F as j,_ as C,y as ge,c as ue,o as be,ag as We,aD as Le,E as Be,G as V,b as X,H as fe}from"./naive-ui-B1s3zDcz.js";import"./pixi-Cal6uEV8.js";let Ie,Me=Promise.all([(()=>{try{return ke}catch{}})()]).then(async()=>{let S,Y,q,K,N,Q,Z,ee,ne,te,ie,re,de,oe,se,O,le,ae,ce,me,we;S=pe("current-sync-word",{state:()=>({lineIndex:-1,wordIndex:-1,emptyBeat:0})}),Y={class:"lyric-line-item-inner"},q={key:0,class:"word-time"},K={class:"line"},N={key:0},Q={key:1},Z={key:1,class:"word-time"},ee=z({__name:"LyricSyncLine",props:{line:{}},setup(R){const t=E(),{currentTime:v}=F(H()),r=S(),W=J(),o=R;G(()=>[r.lineIndex,o.line.id],()=>{r.lineIndex===o.line.id&&U(()=>{var i;(i=t.value)==null||i.scrollIntoView({behavior:"smooth",block:"center",inline:"center"})})},{flush:"post"});function y(i){const k=i<0,u=Math.abs(i/1e3),g=u%60,a=Math.floor((u-g)/60),m=g.toFixed(3),w="0".repeat(6-m.length)+m;return`${k?"-":""}${a}:${w}`}return(i,k)=>(l(),h("div",{ref_key:"itemRef",ref:t,class:$({"lyric-line-item":!0,"lyric-line-item-selected":d(r).lineIndex===o.line.id}),onClick:k[0]||(k[0]=u=>{d(r).lineIndex=o.line.id,d(r).wordIndex=0,d(r).emptyBeat=0})},[_("div",Y,[_("div",null,x(y(i.line.startTime??0)),1),i.line.words.length>0?(l(),h("div",q,x(y(i.line.words[0].startTime??0)),1)):p("",!0),_("div",K,[_("div",{class:$({"hot-line":i.line.words.length>0&&i.line.words[0].startTime<=d(v)&&i.line.words[i.line.words.length-1].endTime>d(v)})},[(l(!0),h(j,null,C(i.line.words,u=>(l(),h("span",{key:u.id,class:$({"current-word":u.lineIndex===d(r).lineIndex&&u.id===d(r).wordIndex,"hot-word":u.startTime<=d(v)&&u.endTime>d(v),"lyric-line-word-warn":u.endTime-u.startTime<0})},x(u.word),3))),128))],2),d(W).showTranslateLine?(l(),h("div",N,x(i.line.translatedLyric),1)):p("",!0),d(W).showRomanLine?(l(),h("div",Q,x(i.line.romanLyric),1)):p("",!0)]),i.line.words.length>0?(l(),h("div",Z,x(y(i.line.words[i.line.words.length-1].endTime??0)),1)):p("",!0),_("div",null,x(y(i.line.endTime??0)),1)])],2))}}),ne=P(ee,[["__scopeId","data-v-1e4e6688"]]),te=["innerHTML"],ie={key:1},re={key:2},de={key:3},oe={key:4},se=z({__name:"LyricSyncWord",props:{word:{},notMain:{type:Boolean}},setup(R){const t=S(),v=H(),r=J(),{currentTimeMS:W}=F(v),o=R,y=ge({word:o.word.word,htmlWord:""}),i=E(),k=E(t.wordIndex);G(()=>[t.wordIndex,o.word.id,o.word.lineIndex],()=>{!o.notMain&&t.wordIndex===o.word.id&&(U(()=>{var a;(a=i.value)==null||a.scrollIntoView({behavior:Math.abs(t.wordIndex-k.value)<=1?"smooth":"instant",block:"center",inline:"center"})}),k.value=t.wordIndex)},{flush:"post"});const u=ue(()=>o.word.endTime-o.word.startTime<0);G(()=>[o.word,r.showJpnRomaji],async()=>{if(y.word=o.word.word,y.htmlWord="",r.showJpnRomaji){const{kuroshiro:a}=await he(async()=>{const{kuroshiro:m}=await import("./kuroshiro-analyzer-kuromoji-fix-dict-6EI2KzNQ.js").then(async w=>(await w.__tla,w));return{kuroshiro:m}},__vite__mapDeps([0,1,2,3]),import.meta.url);y.htmlWord=await a.convert(y.word,{to:"romaji",mode:"furigana"})}},{flush:"post"}),be(async()=>{if(r.showJpnRomaji){const{kuroshiro:a}=await he(async()=>{const{kuroshiro:m}=await import("./kuroshiro-analyzer-kuromoji-fix-dict-6EI2KzNQ.js").then(async w=>(await w.__tla,w));return{kuroshiro:m}},__vite__mapDeps([0,1,2,3]),import.meta.url);y.htmlWord=await a.convert(y.word,{to:"romaji",mode:"furigana"})}});function g(a){const m=a<0,w=Math.abs(a/1e3),T=w%60,b=Math.floor((w-T)/60),M=T.toFixed(3),D="0".repeat(6-M.length)+M;return`${m?"-":""}${b}:${D}`}return(a,m)=>We((l(),h("div",{ref_key:"elRef",ref:i,class:$({"lyric-sync-word":!0,"lyric-word-not-main":o.notMain,"lyric-word-warn":u.value}),onClick:m[0]||(m[0]=w=>{d(t).wordIndex=o.word.id,d(t).emptyBeat=0})},[y.htmlWord?(l(),h("div",{key:0,innerHTML:y.htmlWord},null,8,te)):(l(),h("div",ie,x(y.word),1)),_("div",null,x(g(o.word.startTime??0)),1),_("div",null,x(g(o.word.endTime??0)),1),o.word.id===d(t).wordIndex&&!o.notMain?(l(),h("div",re,x(g(d(W))),1)):p("",!0),o.word.id===d(t).wordIndex&&!o.notMain?(l(),h("div",de)):p("",!0),o.word.id===d(t).wordIndex&&!o.notMain&&(o.word.emptyBeat??0)>0?(l(),h("div",oe,x(d(t).emptyBeat)+" / "+x(o.word.emptyBeat),1)):p("",!0)],2)),[[Le,o.word.word.trim().length>0]])}}),O=P(se,[["__scopeId","data-v-628a6a63"]]),le={class:"lyric-sync-editor"},ae={key:1,class:"lyric-line-sync-editor-no-selected"},ce={style:{"white-space":"pre-line"}},me={class:"lyric-line-viewer"},we=z({__name:"LyricSyncEditor",setup(R){const t=S(),v=H(),r=J(),{setCurrentTime:W}=v,{currentTimeMS:o}=F(v),y=E(),i=ve(),k=ue(u);function u(){return r.showTranslateLine&&r.showRomanLine?95:r.showTranslateLine||r.showRomanLine?66:37}function g(e){var n;(n=y.value)==null||n.scrollBy({left:e.deltaX+e.deltaY,behavior:"auto"})}t.$subscribe(e=>{if((e.events instanceof Array?e.events[0]:e.events).key==="wordIndex"&&y.value){const n=y.value.children.item(t.wordIndex);U(()=>{n==null||n.scrollIntoView({behavior:"smooth",block:"center",inline:"center"})})}},{flush:"post"});function a(e=t.lineIndex,n=t.wordIndex){var s,c,f,L,B;return(((B=(L=(f=(c=(s=i.lineWithIds[e])==null?void 0:s.words)==null?void 0:c[n])==null?void 0:f.word)==null?void 0:L.trim())==null?void 0:B.length)??0)===0}function m(e=t.lineIndex,n=t.wordIndex){var s,c;return!!((c=(s=i.lyrics[e])==null?void 0:s.words)!=null&&c[n])}function w(){var e,n;return(n=(e=i.lyrics[t.lineIndex])==null?void 0:e.words)==null?void 0:n[t.wordIndex]}function T(){return i.lyrics[t.lineIndex]}function b(){var s;let e=t.lineIndex,n=t.wordIndex;if((((s=w())==null?void 0:s.emptyBeat)??0)>t.emptyBeat)return t.emptyBeat++,!1;do if(n<i.lineWithIds[e].words.length-1)n++;else if(e<i.lineWithIds.length-1)n=0,e++;else break;while(m(e,n)&&a(e,n));return m(e,n)&&!a(e,n)&&(t.wordIndex=n,t.lineIndex=e,t.emptyBeat=0),!0}function M(){var s;let e=t.lineIndex,n=t.wordIndex;if(t.emptyBeat>0)return t.emptyBeat--,!1;do if(n>0)n--;else if(e>0)n=i.lineWithIds[--e].words.length-1;else break;while(m(e,n)&&a(e,n));return m(e,n)&&!a(e,n)&&(t.wordIndex=n,t.lineIndex=e,t.emptyBeat=((s=w())==null?void 0:s.emptyBeat)??0),!0}function D(){let e=t.lineIndex,n=t.wordIndex;do if(e>0)e--,n=0;else break;while(m(e,n)&&a(e,n));m(e,n)&&!a(e,n)&&(t.wordIndex=n,t.lineIndex=e,t.emptyBeat=0)}function xe(){let e=t.lineIndex,n=t.wordIndex;do if(e<i.lineWithIds.length-1)e++,n=0;else break;while(m(e,n)&&a(e,n));m(e,n)&&!a(e,n)&&(t.wordIndex=n,t.lineIndex=e,t.emptyBeat=0)}I(r.keybindings.moveLeftWord,()=>{M()}),I(r.keybindings.moveRightWord,()=>{b()}),I(r.keybindings.moveUpLine,()=>{D()}),I(r.keybindings.moveDownLine,()=>{xe()}),I(r.keybindings.seekLeftWord,()=>{if(M()){const e=w();e&&W(e.startTime)}}),I(r.keybindings.seekRightWord,()=>{if(b()){const e=w();e&&W(e.startTime)}}),I(r.keybindings.setCurWordStartTime,e=>{const n=w();if(n){const s=o.value+r.timeOffset-Math.round(e.downTimeOffset);n.startTime=s,(n.emptyBeat??0)>0&&(t.emptyBeat=1);const c=T();t.wordIndex===0&&c&&(c.startTime=s),i.record()}});function A(e){const n=w(),s=T(),c=t.wordIndex;if(b()){const f=o.value+r.timeOffset-Math.round(e.downTimeOffset);let L=!1;n&&(n.endTime=f,L=!0,s&&c===s.words.length-1&&(s.endTime=n.endTime));const B=w();if(B){B.startTime=f,L=!0;const ye=T();ye&&t.wordIndex===0&&(ye.startTime=B.startTime)}L&&i.record()}}return I(r.keybindings.stepWordAndSetTime,e=>{A(e)}),I(r.keybindings.stepWordAndSetTimeAlias1,e=>{A(e)}),I(r.keybindings.stepWordAndSetTimeAlias2,e=>{A(e)}),I(r.keybindings.stepWordAndSetTimeAlias3,e=>{A(e)}),I(r.keybindings.stepWordAndSetEndTime,e=>{const n=w(),s=T(),c=t.wordIndex;b()&&n&&(n.endTime=o.value+r.timeOffset-Math.round(e.downTimeOffset),s&&c===s.words.length-1&&(s.endTime=n.endTime),i.record())}),I(r.keybindings.setLineStartTime,e=>{const n=T();b()&&n&&(n.startTime=o.value+r.timeOffset-Math.round(e.downTimeOffset),i.record())}),I(r.keybindings.setLineEndTime,e=>{const n=T();b()&&n&&(n.endTime=o.value+r.timeOffset-Math.round(e.downTimeOffset),i.record())}),(e,n)=>{const s=Be("i18n-t");return l(),h("div",le,[d(i).lyrics[d(t).lineIndex]?(l(),h("div",{key:0,ref_key:"syncEditor",ref:y,class:"lyric-line-sync-editor",onWheel:g},[d(i).lineWithIds[d(t).lineIndex-1]?(l(!0),h(j,{key:0},C(d(i).lineWithIds[d(t).lineIndex-1].words,(c,f)=>(l(),V(O,{key:f,word:c,"not-main":""},null,8,["word"]))),128)):p("",!0),(l(!0),h(j,null,C(d(i).lineWithIds[d(t).lineIndex].words,(c,f)=>(l(),V(O,{key:f,word:c},null,8,["word"]))),128)),d(i).lineWithIds[d(t).lineIndex+1]?(l(!0),h(j,{key:1},C(d(i).lineWithIds[d(t).lineIndex+1].words,(c,f)=>(l(),V(O,{key:f,word:c,"not-main":""},null,8,["word"]))),128)):p("",!0)],544)):(l(),h("div",ae,[_("div",ce,[X(s,{keypath:"lyricSyncEditor.unselectedTip"})])])),_("div",me,[X(d(_e),{items:d(i).lineWithIds,"min-item-size":k.value,"key-field":"id",style:{width:"100%",position:"relative","min-height":"fit-content",height:"100%"}},{default:fe(({item:c,active:f})=>[X(d(Te),{active:f,item:c,"watch-data":""},{default:fe(()=>[f?(l(),V(ne,{key:0,line:c},null,8,["line"])):p("",!0)]),_:2},1032,["active","item"])]),_:1},8,["items","min-item-size"])])])}}}),Ie=P(we,[["__scopeId","data-v-e747688d"]])});export{Me as __tla,Ie as default};
