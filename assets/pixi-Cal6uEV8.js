import{d as Uo,u as Go,r as jo,o as Ho,a as zo,w as ve,c as Vo,b as Bi,T as Xo,m as $o}from"./naive-ui-B1s3zDcz.js";var Tt=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Ui(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}function Gi(s){if(s.__esModule)return s;var e=s.default;if(typeof e=="function"){var t=function r(){return this instanceof r?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(s).forEach(function(r){var i=Object.getOwnPropertyDescriptor(s,r);Object.defineProperty(t,r,i.get?i:{enumerable:!0,get:function(){return s[r]}})}),t}var it=(s=>(s[s.WEBGL_LEGACY=0]="WEBGL_LEGACY",s[s.WEBGL=1]="WEBGL",s[s.WEBGL2=2]="WEBGL2",s))(it||{}),ji=(s=>(s[s.UNKNOWN=0]="UNKNOWN",s[s.WEBGL=1]="WEBGL",s[s.CANVAS=2]="CANVAS",s))(ji||{}),ds=(s=>(s[s.COLOR=16384]="COLOR",s[s.DEPTH=256]="DEPTH",s[s.STENCIL=1024]="STENCIL",s))(ds||{}),O=(s=>(s[s.NORMAL=0]="NORMAL",s[s.ADD=1]="ADD",s[s.MULTIPLY=2]="MULTIPLY",s[s.SCREEN=3]="SCREEN",s[s.OVERLAY=4]="OVERLAY",s[s.DARKEN=5]="DARKEN",s[s.LIGHTEN=6]="LIGHTEN",s[s.COLOR_DODGE=7]="COLOR_DODGE",s[s.COLOR_BURN=8]="COLOR_BURN",s[s.HARD_LIGHT=9]="HARD_LIGHT",s[s.SOFT_LIGHT=10]="SOFT_LIGHT",s[s.DIFFERENCE=11]="DIFFERENCE",s[s.EXCLUSION=12]="EXCLUSION",s[s.HUE=13]="HUE",s[s.SATURATION=14]="SATURATION",s[s.COLOR=15]="COLOR",s[s.LUMINOSITY=16]="LUMINOSITY",s[s.NORMAL_NPM=17]="NORMAL_NPM",s[s.ADD_NPM=18]="ADD_NPM",s[s.SCREEN_NPM=19]="SCREEN_NPM",s[s.NONE=20]="NONE",s[s.SRC_OVER=0]="SRC_OVER",s[s.SRC_IN=21]="SRC_IN",s[s.SRC_OUT=22]="SRC_OUT",s[s.SRC_ATOP=23]="SRC_ATOP",s[s.DST_OVER=24]="DST_OVER",s[s.DST_IN=25]="DST_IN",s[s.DST_OUT=26]="DST_OUT",s[s.DST_ATOP=27]="DST_ATOP",s[s.ERASE=26]="ERASE",s[s.SUBTRACT=28]="SUBTRACT",s[s.XOR=29]="XOR",s))(O||{}),gr=(s=>(s[s.POINTS=0]="POINTS",s[s.LINES=1]="LINES",s[s.LINE_LOOP=2]="LINE_LOOP",s[s.LINE_STRIP=3]="LINE_STRIP",s[s.TRIANGLES=4]="TRIANGLES",s[s.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",s[s.TRIANGLE_FAN=6]="TRIANGLE_FAN",s))(gr||{}),M=(s=>(s[s.RGBA=6408]="RGBA",s[s.RGB=6407]="RGB",s[s.RG=33319]="RG",s[s.RED=6403]="RED",s[s.RGBA_INTEGER=36249]="RGBA_INTEGER",s[s.RGB_INTEGER=36248]="RGB_INTEGER",s[s.RG_INTEGER=33320]="RG_INTEGER",s[s.RED_INTEGER=36244]="RED_INTEGER",s[s.ALPHA=6406]="ALPHA",s[s.LUMINANCE=6409]="LUMINANCE",s[s.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",s[s.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",s[s.DEPTH_STENCIL=34041]="DEPTH_STENCIL",s))(M||{}),Et=(s=>(s[s.TEXTURE_2D=3553]="TEXTURE_2D",s[s.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",s[s.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",s[s.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",s[s.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",s[s.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",s[s.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",s[s.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",s[s.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",s))(Et||{}),B=(s=>(s[s.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",s[s.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",s[s.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",s[s.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",s[s.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",s[s.UNSIGNED_INT=5125]="UNSIGNED_INT",s[s.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",s[s.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",s[s.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",s[s.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",s[s.BYTE=5120]="BYTE",s[s.SHORT=5122]="SHORT",s[s.INT=5124]="INT",s[s.FLOAT=5126]="FLOAT",s[s.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",s[s.HALF_FLOAT=36193]="HALF_FLOAT",s))(B||{}),R=(s=>(s[s.FLOAT=0]="FLOAT",s[s.INT=1]="INT",s[s.UINT=2]="UINT",s))(R||{}),He=(s=>(s[s.NEAREST=0]="NEAREST",s[s.LINEAR=1]="LINEAR",s))(He||{}),fs=(s=>(s[s.CLAMP=33071]="CLAMP",s[s.REPEAT=10497]="REPEAT",s[s.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",s))(fs||{}),nt=(s=>(s[s.OFF=0]="OFF",s[s.POW2=1]="POW2",s[s.ON=2]="ON",s[s.ON_MANUAL=3]="ON_MANUAL",s))(nt||{}),at=(s=>(s[s.NPM=0]="NPM",s[s.UNPACK=1]="UNPACK",s[s.PMA=2]="PMA",s[s.NO_PREMULTIPLIED_ALPHA=0]="NO_PREMULTIPLIED_ALPHA",s[s.PREMULTIPLY_ON_UPLOAD=1]="PREMULTIPLY_ON_UPLOAD",s[s.PREMULTIPLIED_ALPHA=2]="PREMULTIPLIED_ALPHA",s))(at||{}),ot=(s=>(s[s.NO=0]="NO",s[s.YES=1]="YES",s[s.AUTO=2]="AUTO",s[s.BLEND=0]="BLEND",s[s.CLEAR=1]="CLEAR",s[s.BLIT=2]="BLIT",s))(ot||{}),ps=(s=>(s[s.AUTO=0]="AUTO",s[s.MANUAL=1]="MANUAL",s))(ps||{}),Ae=(s=>(s.LOW="lowp",s.MEDIUM="mediump",s.HIGH="highp",s))(Ae||{}),oe=(s=>(s[s.NONE=0]="NONE",s[s.SCISSOR=1]="SCISSOR",s[s.STENCIL=2]="STENCIL",s[s.SPRITE=3]="SPRITE",s[s.COLOR=4]="COLOR",s))(oe||{}),ae=(s=>(s[s.NONE=0]="NONE",s[s.LOW=2]="LOW",s[s.MEDIUM=4]="MEDIUM",s[s.HIGH=8]="HIGH",s))(ae||{}),Ne=(s=>(s[s.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",s[s.ARRAY_BUFFER=34962]="ARRAY_BUFFER",s[s.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",s))(Ne||{});const qo={createCanvas:(s,e)=>{const t=document.createElement("canvas");return t.width=s,t.height=e,t},getCanvasRenderingContext2D:()=>CanvasRenderingContext2D,getWebGLRenderingContext:()=>WebGLRenderingContext,getNavigator:()=>navigator,getBaseUrl:()=>document.baseURI??window.location.href,getFontFaceSet:()=>document.fonts,fetch:(s,e)=>fetch(s,e),parseXML:s=>new DOMParser().parseFromString(s,"text/xml")},H={ADAPTER:qo,RESOLUTION:1,CREATE_IMAGE_BITMAP:!1,ROUND_PIXELS:!1};var ms=/iPhone/i,Hi=/iPod/i,zi=/iPad/i,Vi=/\biOS-universal(?:.+)Mac\b/i,ys=/\bAndroid(?:.+)Mobile\b/i,Xi=/Android/i,At=/(?:SD4930UR|\bSilk(?:.+)Mobile\b)/i,br=/Silk/i,ze=/Windows Phone/i,$i=/\bWindows(?:.+)ARM\b/i,qi=/BlackBerry/i,Wi=/BB10/i,Yi=/Opera Mini/i,Ki=/\b(CriOS|Chrome)(?:.+)Mobile/i,Zi=/Mobile(?:.+)Firefox\b/i,Qi=function(s){return typeof s<"u"&&s.platform==="MacIntel"&&typeof s.maxTouchPoints=="number"&&s.maxTouchPoints>1&&typeof MSStream>"u"};function Wo(s){return function(e){return e.test(s)}}function Ji(s){var e={userAgent:"",platform:"",maxTouchPoints:0};!s&&typeof navigator<"u"?e={userAgent:navigator.userAgent,platform:navigator.platform,maxTouchPoints:navigator.maxTouchPoints||0}:typeof s=="string"?e.userAgent=s:s&&s.userAgent&&(e={userAgent:s.userAgent,platform:s.platform,maxTouchPoints:s.maxTouchPoints||0});var t=e.userAgent,r=t.split("[FBAN");typeof r[1]<"u"&&(t=r[0]),r=t.split("Twitter"),typeof r[1]<"u"&&(t=r[0]);var i=Wo(t),n={apple:{phone:i(ms)&&!i(ze),ipod:i(Hi),tablet:!i(ms)&&(i(zi)||Qi(e))&&!i(ze),universal:i(Vi),device:(i(ms)||i(Hi)||i(zi)||i(Vi)||Qi(e))&&!i(ze)},amazon:{phone:i(At),tablet:!i(At)&&i(br),device:i(At)||i(br)},android:{phone:!i(ze)&&i(At)||!i(ze)&&i(ys),tablet:!i(ze)&&!i(At)&&!i(ys)&&(i(br)||i(Xi)),device:!i(ze)&&(i(At)||i(br)||i(ys)||i(Xi))||i(/\bokhttp\b/i)},windows:{phone:i(ze),tablet:i($i),device:i(ze)||i($i)},other:{blackberry:i(qi),blackberry10:i(Wi),opera:i(Yi),firefox:i(Zi),chrome:i(Ki),device:i(qi)||i(Wi)||i(Yi)||i(Zi)||i(Ki)},any:!1,phone:!1,tablet:!1};return n.any=n.apple.device||n.android.device||n.windows.device||n.other.device,n.phone=n.apple.phone||n.android.phone||n.windows.phone,n.tablet=n.apple.tablet||n.android.tablet||n.windows.tablet,n}const Yo=Ji.default??Ji,St=Yo(globalThis.navigator);H.RETINA_PREFIX=/@([0-9\.]+)x/,H.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT=!1;var en={exports:{}};(function(s){var e=Object.prototype.hasOwnProperty,t="~";function r(){}Object.create&&(r.prototype=Object.create(null),new r().__proto__||(t=!1));function i(h,l,u){this.fn=h,this.context=l,this.once=u||!1}function n(h,l,u,c,d){if(typeof u!="function")throw new TypeError("The listener must be a function");var f=new i(u,c||h,d),p=t?t+l:l;return h._events[p]?h._events[p].fn?h._events[p]=[h._events[p],f]:h._events[p].push(f):(h._events[p]=f,h._eventsCount++),h}function a(h,l){--h._eventsCount===0?h._events=new r:delete h._events[l]}function o(){this._events=new r,this._eventsCount=0}o.prototype.eventNames=function(){var h=[],l,u;if(this._eventsCount===0)return h;for(u in l=this._events)e.call(l,u)&&h.push(t?u.slice(1):u);return Object.getOwnPropertySymbols?h.concat(Object.getOwnPropertySymbols(l)):h},o.prototype.listeners=function(h){var l=t?t+h:h,u=this._events[l];if(!u)return[];if(u.fn)return[u.fn];for(var c=0,d=u.length,f=new Array(d);c<d;c++)f[c]=u[c].fn;return f},o.prototype.listenerCount=function(h){var l=t?t+h:h,u=this._events[l];return u?u.fn?1:u.length:0},o.prototype.emit=function(h,l,u,c,d,f){var p=t?t+h:h;if(!this._events[p])return!1;var m=this._events[p],y=arguments.length,x,b;if(m.fn){switch(m.once&&this.removeListener(h,m.fn,void 0,!0),y){case 1:return m.fn.call(m.context),!0;case 2:return m.fn.call(m.context,l),!0;case 3:return m.fn.call(m.context,l,u),!0;case 4:return m.fn.call(m.context,l,u,c),!0;case 5:return m.fn.call(m.context,l,u,c,d),!0;case 6:return m.fn.call(m.context,l,u,c,d,f),!0}for(b=1,x=new Array(y-1);b<y;b++)x[b-1]=arguments[b];m.fn.apply(m.context,x)}else{var g=m.length,v;for(b=0;b<g;b++)switch(m[b].once&&this.removeListener(h,m[b].fn,void 0,!0),y){case 1:m[b].fn.call(m[b].context);break;case 2:m[b].fn.call(m[b].context,l);break;case 3:m[b].fn.call(m[b].context,l,u);break;case 4:m[b].fn.call(m[b].context,l,u,c);break;default:if(!x)for(v=1,x=new Array(y-1);v<y;v++)x[v-1]=arguments[v];m[b].fn.apply(m[b].context,x)}}return!0},o.prototype.on=function(h,l,u){return n(this,h,l,u,!1)},o.prototype.once=function(h,l,u){return n(this,h,l,u,!0)},o.prototype.removeListener=function(h,l,u,c){var d=t?t+h:h;if(!this._events[d])return this;if(!l)return a(this,d),this;var f=this._events[d];if(f.fn)f.fn===l&&(!c||f.once)&&(!u||f.context===u)&&a(this,d);else{for(var p=0,m=[],y=f.length;p<y;p++)(f[p].fn!==l||c&&!f[p].once||u&&f[p].context!==u)&&m.push(f[p]);m.length?this._events[d]=m.length===1?m[0]:m:a(this,d)}return this},o.prototype.removeAllListeners=function(h){var l;return h?(l=t?t+h:h,this._events[l]&&a(this,l)):(this._events=new r,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=t,o.EventEmitter=o,s.exports=o})(en);var Ko=en.exports;const xr=Ui(Ko);var tn={exports:{}};tn.exports=vr,tn.exports.default=vr;function vr(s,e,t){t=t||2;var r=e&&e.length,i=r?e[0]*t:s.length,n=rn(s,0,i,t,!0),a=[];if(!n||n.next===n.prev)return a;var o,h,l,u,c,d,f;if(r&&(n=th(s,e,n,t)),s.length>80*t){o=l=s[0],h=u=s[1];for(var p=t;p<i;p+=t)c=s[p],d=s[p+1],c<o&&(o=c),d<h&&(h=d),c>l&&(l=c),d>u&&(u=d);f=Math.max(l-o,u-h),f=f!==0?32767/f:0}return Wt(n,a,t,o,h,f,0),a}function rn(s,e,t,r,i){var n,a;if(i===xs(s,e,t,r)>0)for(n=e;n<t;n+=r)a=an(n,s[n],s[n+1],a);else for(n=t-r;n>=e;n-=r)a=an(n,s[n],s[n+1],a);return a&&_r(a,a.next)&&(Kt(a),a=a.next),a}function ht(s,e){if(!s)return s;e||(e=s);var t=s,r;do if(r=!1,!t.steiner&&(_r(t,t.next)||te(t.prev,t,t.next)===0)){if(Kt(t),t=e=t.prev,t===t.next)break;r=!0}else t=t.next;while(r||t!==e);return e}function Wt(s,e,t,r,i,n,a){if(s){!a&&n&&ah(s,r,i,n);for(var o=s,h,l;s.prev!==s.next;){if(h=s.prev,l=s.next,n?Qo(s,r,i,n):Zo(s)){e.push(h.i/t|0),e.push(s.i/t|0),e.push(l.i/t|0),Kt(s),s=l.next,o=l.next;continue}if(s=l,s===o){a?a===1?(s=Jo(ht(s),e,t),Wt(s,e,t,r,i,n,2)):a===2&&eh(s,e,t,r,i,n):Wt(ht(s),e,t,r,i,n,1);break}}}}function Zo(s){var e=s.prev,t=s,r=s.next;if(te(e,t,r)>=0)return!1;for(var i=e.x,n=t.x,a=r.x,o=e.y,h=t.y,l=r.y,u=i<n?i<a?i:a:n<a?n:a,c=o<h?o<l?o:l:h<l?h:l,d=i>n?i>a?i:a:n>a?n:a,f=o>h?o>l?o:l:h>l?h:l,p=r.next;p!==e;){if(p.x>=u&&p.x<=d&&p.y>=c&&p.y<=f&&Mt(i,o,n,h,a,l,p.x,p.y)&&te(p.prev,p,p.next)>=0)return!1;p=p.next}return!0}function Qo(s,e,t,r){var i=s.prev,n=s,a=s.next;if(te(i,n,a)>=0)return!1;for(var o=i.x,h=n.x,l=a.x,u=i.y,c=n.y,d=a.y,f=o<h?o<l?o:l:h<l?h:l,p=u<c?u<d?u:d:c<d?c:d,m=o>h?o>l?o:l:h>l?h:l,y=u>c?u>d?u:d:c>d?c:d,x=gs(f,p,e,t,r),b=gs(m,y,e,t,r),g=s.prevZ,v=s.nextZ;g&&g.z>=x&&v&&v.z<=b;){if(g.x>=f&&g.x<=m&&g.y>=p&&g.y<=y&&g!==i&&g!==a&&Mt(o,u,h,c,l,d,g.x,g.y)&&te(g.prev,g,g.next)>=0||(g=g.prevZ,v.x>=f&&v.x<=m&&v.y>=p&&v.y<=y&&v!==i&&v!==a&&Mt(o,u,h,c,l,d,v.x,v.y)&&te(v.prev,v,v.next)>=0))return!1;v=v.nextZ}for(;g&&g.z>=x;){if(g.x>=f&&g.x<=m&&g.y>=p&&g.y<=y&&g!==i&&g!==a&&Mt(o,u,h,c,l,d,g.x,g.y)&&te(g.prev,g,g.next)>=0)return!1;g=g.prevZ}for(;v&&v.z<=b;){if(v.x>=f&&v.x<=m&&v.y>=p&&v.y<=y&&v!==i&&v!==a&&Mt(o,u,h,c,l,d,v.x,v.y)&&te(v.prev,v,v.next)>=0)return!1;v=v.nextZ}return!0}function Jo(s,e,t){var r=s;do{var i=r.prev,n=r.next.next;!_r(i,n)&&sn(i,r,r.next,n)&&Yt(i,n)&&Yt(n,i)&&(e.push(i.i/t|0),e.push(r.i/t|0),e.push(n.i/t|0),Kt(r),Kt(r.next),r=s=n),r=r.next}while(r!==s);return ht(r)}function eh(s,e,t,r,i,n){var a=s;do{for(var o=a.next.next;o!==a.prev;){if(a.i!==o.i&&lh(a,o)){var h=nn(a,o);a=ht(a,a.next),h=ht(h,h.next),Wt(a,e,t,r,i,n,0),Wt(h,e,t,r,i,n,0);return}o=o.next}a=a.next}while(a!==s)}function th(s,e,t,r){var i=[],n,a,o,h,l;for(n=0,a=e.length;n<a;n++)o=e[n]*r,h=n<a-1?e[n+1]*r:s.length,l=rn(s,o,h,r,!1),l===l.next&&(l.steiner=!0),i.push(hh(l));for(i.sort(rh),n=0;n<i.length;n++)t=sh(i[n],t);return t}function rh(s,e){return s.x-e.x}function sh(s,e){var t=ih(s,e);if(!t)return e;var r=nn(t,s);return ht(r,r.next),ht(t,t.next)}function ih(s,e){var t=e,r=s.x,i=s.y,n=-1/0,a;do{if(i<=t.y&&i>=t.next.y&&t.next.y!==t.y){var o=t.x+(i-t.y)*(t.next.x-t.x)/(t.next.y-t.y);if(o<=r&&o>n&&(n=o,a=t.x<t.next.x?t:t.next,o===r))return a}t=t.next}while(t!==e);if(!a)return null;var h=a,l=a.x,u=a.y,c=1/0,d;t=a;do r>=t.x&&t.x>=l&&r!==t.x&&Mt(i<u?r:n,i,l,u,i<u?n:r,i,t.x,t.y)&&(d=Math.abs(i-t.y)/(r-t.x),Yt(t,s)&&(d<c||d===c&&(t.x>a.x||t.x===a.x&&nh(a,t)))&&(a=t,c=d)),t=t.next;while(t!==h);return a}function nh(s,e){return te(s.prev,s,e.prev)<0&&te(e.next,s,s.next)<0}function ah(s,e,t,r){var i=s;do i.z===0&&(i.z=gs(i.x,i.y,e,t,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next;while(i!==s);i.prevZ.nextZ=null,i.prevZ=null,oh(i)}function oh(s){var e,t,r,i,n,a,o,h,l=1;do{for(t=s,s=null,n=null,a=0;t;){for(a++,r=t,o=0,e=0;e<l&&(o++,r=r.nextZ,!!r);e++);for(h=l;o>0||h>0&&r;)o!==0&&(h===0||!r||t.z<=r.z)?(i=t,t=t.nextZ,o--):(i=r,r=r.nextZ,h--),n?n.nextZ=i:s=i,i.prevZ=n,n=i;t=r}n.nextZ=null,l*=2}while(a>1);return s}function gs(s,e,t,r,i){return s=(s-t)*i|0,e=(e-r)*i|0,s=(s|s<<8)&16711935,s=(s|s<<4)&252645135,s=(s|s<<2)&858993459,s=(s|s<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,s|e<<1}function hh(s){var e=s,t=s;do(e.x<t.x||e.x===t.x&&e.y<t.y)&&(t=e),e=e.next;while(e!==s);return t}function Mt(s,e,t,r,i,n,a,o){return(i-a)*(e-o)>=(s-a)*(n-o)&&(s-a)*(r-o)>=(t-a)*(e-o)&&(t-a)*(n-o)>=(i-a)*(r-o)}function lh(s,e){return s.next.i!==e.i&&s.prev.i!==e.i&&!uh(s,e)&&(Yt(s,e)&&Yt(e,s)&&ch(s,e)&&(te(s.prev,s,e.prev)||te(s,e.prev,e))||_r(s,e)&&te(s.prev,s,s.next)>0&&te(e.prev,e,e.next)>0)}function te(s,e,t){return(e.y-s.y)*(t.x-e.x)-(e.x-s.x)*(t.y-e.y)}function _r(s,e){return s.x===e.x&&s.y===e.y}function sn(s,e,t,r){var i=Er(te(s,e,t)),n=Er(te(s,e,r)),a=Er(te(t,r,s)),o=Er(te(t,r,e));return!!(i!==n&&a!==o||i===0&&Tr(s,t,e)||n===0&&Tr(s,r,e)||a===0&&Tr(t,s,r)||o===0&&Tr(t,e,r))}function Tr(s,e,t){return e.x<=Math.max(s.x,t.x)&&e.x>=Math.min(s.x,t.x)&&e.y<=Math.max(s.y,t.y)&&e.y>=Math.min(s.y,t.y)}function Er(s){return s>0?1:s<0?-1:0}function uh(s,e){var t=s;do{if(t.i!==s.i&&t.next.i!==s.i&&t.i!==e.i&&t.next.i!==e.i&&sn(t,t.next,s,e))return!0;t=t.next}while(t!==s);return!1}function Yt(s,e){return te(s.prev,s,s.next)<0?te(s,e,s.next)>=0&&te(s,s.prev,e)>=0:te(s,e,s.prev)<0||te(s,s.next,e)<0}function ch(s,e){var t=s,r=!1,i=(s.x+e.x)/2,n=(s.y+e.y)/2;do t.y>n!=t.next.y>n&&t.next.y!==t.y&&i<(t.next.x-t.x)*(n-t.y)/(t.next.y-t.y)+t.x&&(r=!r),t=t.next;while(t!==s);return r}function nn(s,e){var t=new bs(s.i,s.x,s.y),r=new bs(e.i,e.x,e.y),i=s.next,n=e.prev;return s.next=e,e.prev=s,t.next=i,i.prev=t,r.next=t,t.prev=r,n.next=r,r.prev=n,r}function an(s,e,t,r){var i=new bs(s,e,t);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function Kt(s){s.next.prev=s.prev,s.prev.next=s.next,s.prevZ&&(s.prevZ.nextZ=s.nextZ),s.nextZ&&(s.nextZ.prevZ=s.prevZ)}function bs(s,e,t){this.i=s,this.x=e,this.y=t,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}vr.deviation=function(s,e,t,r){var i=e&&e.length,n=i?e[0]*t:s.length,a=Math.abs(xs(s,0,n,t));if(i)for(var o=0,h=e.length;o<h;o++){var l=e[o]*t,u=o<h-1?e[o+1]*t:s.length;a-=Math.abs(xs(s,l,u,t))}var c=0;for(o=0;o<r.length;o+=3){var d=r[o]*t,f=r[o+1]*t,p=r[o+2]*t;c+=Math.abs((s[d]-s[p])*(s[f+1]-s[d+1])-(s[d]-s[f])*(s[p+1]-s[d+1]))}return a===0&&c===0?0:Math.abs((c-a)/a)};function xs(s,e,t,r){for(var i=0,n=e,a=t-r;n<t;n+=r)i+=(s[a]-s[n])*(s[n+1]+s[a+1]),a=n;return i}vr.flatten=function(s){for(var e=s[0][0].length,t={vertices:[],holes:[],dimensions:e},r=0,i=0;i<s.length;i++){for(var n=0;n<s[i].length;n++)for(var a=0;a<e;a++)t.vertices.push(s[i][n][a]);i>0&&(r+=s[i-1].length,t.holes.push(r))}return t};var Ar={exports:{}};/*! https://mths.be/punycode v1.4.1 by @mathias */Ar.exports,function(s,e){(function(t){var r=e&&!e.nodeType&&e,i=s&&!s.nodeType&&s,n=typeof Tt=="object"&&Tt;(n.global===n||n.window===n||n.self===n)&&(t=n);var a,o=2147483647,h=36,l=1,u=26,c=38,d=700,f=72,p=128,m="-",y=/^xn--/,x=/[^\x20-\x7E]/,b=/[\x2E\u3002\uFF0E\uFF61]/g,g={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},v=h-l,_=Math.floor,T=String.fromCharCode,E;function w(P){throw new RangeError(g[P])}function S(P,D){for(var z=P.length,ee=[];z--;)ee[z]=D(P[z]);return ee}function L(P,D){var z=P.split("@"),ee="";z.length>1&&(ee=z[0]+"@",P=z[1]),P=P.replace(b,".");var ie=P.split("."),ye=S(ie,D).join(".");return ee+ye}function I(P){for(var D=[],z=0,ee=P.length,ie,ye;z<ee;)ie=P.charCodeAt(z++),ie>=55296&&ie<=56319&&z<ee?(ye=P.charCodeAt(z++),(ye&64512)==56320?D.push(((ie&1023)<<10)+(ye&1023)+65536):(D.push(ie),z--)):D.push(ie);return D}function k(P){return S(P,function(D){var z="";return D>65535&&(D-=65536,z+=T(D>>>10&1023|55296),D=56320|D&1023),z+=T(D),z}).join("")}function C(P){return P-48<10?P-22:P-65<26?P-65:P-97<26?P-97:h}function F(P,D){return P+22+75*(P<26)-((D!=0)<<5)}function N(P,D,z){var ee=0;for(P=z?_(P/d):P>>1,P+=_(P/D);P>v*u>>1;ee+=h)P=_(P/v);return _(ee+(v+1)*P/(P+c))}function J(P){var D=[],z=P.length,ee,ie=0,ye=p,fe=f,_e,Me,Le,je,pe,Ee,we,qe,st;for(_e=P.lastIndexOf(m),_e<0&&(_e=0),Me=0;Me<_e;++Me)P.charCodeAt(Me)>=128&&w("not-basic"),D.push(P.charCodeAt(Me));for(Le=_e>0?_e+1:0;Le<z;){for(je=ie,pe=1,Ee=h;Le>=z&&w("invalid-input"),we=C(P.charCodeAt(Le++)),(we>=h||we>_((o-ie)/pe))&&w("overflow"),ie+=we*pe,qe=Ee<=fe?l:Ee>=fe+u?u:Ee-fe,!(we<qe);Ee+=h)st=h-qe,pe>_(o/st)&&w("overflow"),pe*=st;ee=D.length+1,fe=N(ie-je,ee,je==0),_(ie/ee)>o-ye&&w("overflow"),ye+=_(ie/ee),ie%=ee,D.splice(ie++,0,ye)}return k(D)}function xe(P){var D,z,ee,ie,ye,fe,_e,Me,Le,je,pe,Ee=[],we,qe,st,cs;for(P=I(P),we=P.length,D=p,z=0,ye=f,fe=0;fe<we;++fe)pe=P[fe],pe<128&&Ee.push(T(pe));for(ee=ie=Ee.length,ie&&Ee.push(m);ee<we;){for(_e=o,fe=0;fe<we;++fe)pe=P[fe],pe>=D&&pe<_e&&(_e=pe);for(qe=ee+1,_e-D>_((o-z)/qe)&&w("overflow"),z+=(_e-D)*qe,D=_e,fe=0;fe<we;++fe)if(pe=P[fe],pe<D&&++z>o&&w("overflow"),pe==D){for(Me=z,Le=h;je=Le<=ye?l:Le>=ye+u?u:Le-ye,!(Me<je);Le+=h)cs=Me-je,st=h-je,Ee.push(T(F(je+cs%st,0))),Me=_(cs/st);Ee.push(T(F(Me,0))),ye=N(z,qe,ee==ie),z=0,++ee}++z,++D}return Ee.join("")}function Ge(P){return L(P,function(D){return y.test(D)?J(D.slice(4).toLowerCase()):D})}function rt(P){return L(P,function(D){return x.test(D)?"xn--"+xe(D):D})}if(a={version:"1.4.1",ucs2:{decode:I,encode:k},decode:J,encode:xe,toASCII:rt,toUnicode:Ge},r&&i)if(s.exports==r)i.exports=a;else for(E in a)a.hasOwnProperty(E)&&(r[E]=a[E]);else t.punycode=a})(Tt)}(Ar,Ar.exports);var dh=Ar.exports,fh=Error,ph=EvalError,mh=RangeError,yh=ReferenceError,on=SyntaxError,Zt=TypeError,gh=URIError,bh=function(){if(typeof Symbol!="function"||typeof Object.getOwnPropertySymbols!="function")return!1;if(typeof Symbol.iterator=="symbol")return!0;var s={},e=Symbol("test"),t=Object(e);if(typeof e=="string"||Object.prototype.toString.call(e)!=="[object Symbol]"||Object.prototype.toString.call(t)!=="[object Symbol]")return!1;var r=42;s[e]=r;for(e in s)return!1;if(typeof Object.keys=="function"&&Object.keys(s).length!==0||typeof Object.getOwnPropertyNames=="function"&&Object.getOwnPropertyNames(s).length!==0)return!1;var i=Object.getOwnPropertySymbols(s);if(i.length!==1||i[0]!==e||!Object.prototype.propertyIsEnumerable.call(s,e))return!1;if(typeof Object.getOwnPropertyDescriptor=="function"){var n=Object.getOwnPropertyDescriptor(s,e);if(n.value!==r||n.enumerable!==!0)return!1}return!0},hn=typeof Symbol<"u"&&Symbol,xh=bh,vh=function(){return typeof hn!="function"||typeof Symbol!="function"||typeof hn("foo")!="symbol"||typeof Symbol("bar")!="symbol"?!1:xh()},vs={__proto__:null,foo:{}},_h=Object,Th=function(){return{__proto__:vs}.foo===vs.foo&&!(vs instanceof _h)},Eh="Function.prototype.bind called on incompatible ",Ah=Object.prototype.toString,Sh=Math.max,Mh="[object Function]",ln=function(s,e){for(var t=[],r=0;r<s.length;r+=1)t[r]=s[r];for(var i=0;i<e.length;i+=1)t[i+s.length]=e[i];return t},wh=function(s,e){for(var t=[],r=e,i=0;r<s.length;r+=1,i+=1)t[i]=s[r];return t},Ih=function(s,e){for(var t="",r=0;r<s.length;r+=1)t+=s[r],r+1<s.length&&(t+=e);return t},Rh=function(s){var e=this;if(typeof e!="function"||Ah.apply(e)!==Mh)throw new TypeError(Eh+e);for(var t=wh(arguments,1),r,i=function(){if(this instanceof r){var l=e.apply(this,ln(t,arguments));return Object(l)===l?l:this}return e.apply(s,ln(t,arguments))},n=Sh(0,e.length-t.length),a=[],o=0;o<n;o++)a[o]="$"+o;if(r=Function("binder","return function ("+Ih(a,",")+"){ return binder.apply(this,arguments); }")(i),e.prototype){var h=function(){};h.prototype=e.prototype,r.prototype=new h,h.prototype=null}return r},Ph=Rh,_s=Function.prototype.bind||Ph,Lh=Function.prototype.call,Nh=Object.prototype.hasOwnProperty,Ch=_s,Oh=Ch.call(Lh,Nh),G,Fh=fh,Dh=ph,kh=mh,Bh=yh,wt=on,It=Zt,Uh=gh,un=Function,Ts=function(s){try{return un('"use strict"; return ('+s+").constructor;")()}catch{}},lt=Object.getOwnPropertyDescriptor;if(lt)try{lt({},"")}catch{lt=null}var Es=function(){throw new It},Gh=lt?function(){try{return arguments.callee,Es}catch{try{return lt(arguments,"callee").get}catch{return Es}}}():Es,Rt=vh(),jh=Th(),ce=Object.getPrototypeOf||(jh?function(s){return s.__proto__}:null),Pt={},Hh=typeof Uint8Array>"u"||!ce?G:ce(Uint8Array),ut={__proto__:null,"%AggregateError%":typeof AggregateError>"u"?G:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer>"u"?G:ArrayBuffer,"%ArrayIteratorPrototype%":Rt&&ce?ce([][Symbol.iterator]()):G,"%AsyncFromSyncIteratorPrototype%":G,"%AsyncFunction%":Pt,"%AsyncGenerator%":Pt,"%AsyncGeneratorFunction%":Pt,"%AsyncIteratorPrototype%":Pt,"%Atomics%":typeof Atomics>"u"?G:Atomics,"%BigInt%":typeof BigInt>"u"?G:BigInt,"%BigInt64Array%":typeof BigInt64Array>"u"?G:BigInt64Array,"%BigUint64Array%":typeof BigUint64Array>"u"?G:BigUint64Array,"%Boolean%":Boolean,"%DataView%":typeof DataView>"u"?G:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":Fh,"%eval%":eval,"%EvalError%":Dh,"%Float32Array%":typeof Float32Array>"u"?G:Float32Array,"%Float64Array%":typeof Float64Array>"u"?G:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry>"u"?G:FinalizationRegistry,"%Function%":un,"%GeneratorFunction%":Pt,"%Int8Array%":typeof Int8Array>"u"?G:Int8Array,"%Int16Array%":typeof Int16Array>"u"?G:Int16Array,"%Int32Array%":typeof Int32Array>"u"?G:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":Rt&&ce?ce(ce([][Symbol.iterator]())):G,"%JSON%":typeof JSON=="object"?JSON:G,"%Map%":typeof Map>"u"?G:Map,"%MapIteratorPrototype%":typeof Map>"u"||!Rt||!ce?G:ce(new Map()[Symbol.iterator]()),"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise>"u"?G:Promise,"%Proxy%":typeof Proxy>"u"?G:Proxy,"%RangeError%":kh,"%ReferenceError%":Bh,"%Reflect%":typeof Reflect>"u"?G:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set>"u"?G:Set,"%SetIteratorPrototype%":typeof Set>"u"||!Rt||!ce?G:ce(new Set()[Symbol.iterator]()),"%SharedArrayBuffer%":typeof SharedArrayBuffer>"u"?G:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":Rt&&ce?ce(""[Symbol.iterator]()):G,"%Symbol%":Rt?Symbol:G,"%SyntaxError%":wt,"%ThrowTypeError%":Gh,"%TypedArray%":Hh,"%TypeError%":It,"%Uint8Array%":typeof Uint8Array>"u"?G:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray>"u"?G:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array>"u"?G:Uint16Array,"%Uint32Array%":typeof Uint32Array>"u"?G:Uint32Array,"%URIError%":Uh,"%WeakMap%":typeof WeakMap>"u"?G:WeakMap,"%WeakRef%":typeof WeakRef>"u"?G:WeakRef,"%WeakSet%":typeof WeakSet>"u"?G:WeakSet};if(ce)try{null.error}catch(s){var zh=ce(ce(s));ut["%Error.prototype%"]=zh}var Vh=function s(e){var t;if(e==="%AsyncFunction%")t=Ts("async function () {}");else if(e==="%GeneratorFunction%")t=Ts("function* () {}");else if(e==="%AsyncGeneratorFunction%")t=Ts("async function* () {}");else if(e==="%AsyncGenerator%"){var r=s("%AsyncGeneratorFunction%");r&&(t=r.prototype)}else if(e==="%AsyncIteratorPrototype%"){var i=s("%AsyncGenerator%");i&&ce&&(t=ce(i.prototype))}return ut[e]=t,t},cn={__proto__:null,"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},Qt=_s,Sr=Oh,Xh=Qt.call(Function.call,Array.prototype.concat),$h=Qt.call(Function.apply,Array.prototype.splice),dn=Qt.call(Function.call,String.prototype.replace),Mr=Qt.call(Function.call,String.prototype.slice),qh=Qt.call(Function.call,RegExp.prototype.exec),Wh=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,Yh=/\\(\\)?/g,Kh=function(s){var e=Mr(s,0,1),t=Mr(s,-1);if(e==="%"&&t!=="%")throw new wt("invalid intrinsic syntax, expected closing `%`");if(t==="%"&&e!=="%")throw new wt("invalid intrinsic syntax, expected opening `%`");var r=[];return dn(s,Wh,function(i,n,a,o){r[r.length]=a?dn(o,Yh,"$1"):n||i}),r},Zh=function(s,e){var t=s,r;if(Sr(cn,t)&&(r=cn[t],t="%"+r[0]+"%"),Sr(ut,t)){var i=ut[t];if(i===Pt&&(i=Vh(t)),typeof i>"u"&&!e)throw new It("intrinsic "+s+" exists, but is not available. Please file an issue!");return{alias:r,name:t,value:i}}throw new wt("intrinsic "+s+" does not exist!")},Lt=function(s,e){if(typeof s!="string"||s.length===0)throw new It("intrinsic name must be a non-empty string");if(arguments.length>1&&typeof e!="boolean")throw new It('"allowMissing" argument must be a boolean');if(qh(/^%?[^%]*%?$/,s)===null)throw new wt("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var t=Kh(s),r=t.length>0?t[0]:"",i=Zh("%"+r+"%",e),n=i.name,a=i.value,o=!1,h=i.alias;h&&(r=h[0],$h(t,Xh([0,1],h)));for(var l=1,u=!0;l<t.length;l+=1){var c=t[l],d=Mr(c,0,1),f=Mr(c,-1);if((d==='"'||d==="'"||d==="`"||f==='"'||f==="'"||f==="`")&&d!==f)throw new wt("property names with quotes must have matching quotes");if((c==="constructor"||!u)&&(o=!0),r+="."+c,n="%"+r+"%",Sr(ut,n))a=ut[n];else if(a!=null){if(!(c in a)){if(!e)throw new It("base intrinsic for "+s+" exists, but the property is not available.");return}if(lt&&l+1>=t.length){var p=lt(a,c);u=!!p,u&&"get"in p&&!("originalValue"in p.get)?a=p.get:a=a[c]}else u=Sr(a,c),a=a[c];u&&!o&&(ut[n]=a)}}return a},fn={exports:{}},As,pn;function Ss(){if(pn)return As;pn=1;var s=Lt,e=s("%Object.defineProperty%",!0)||!1;if(e)try{e({},"a",{value:1})}catch{e=!1}return As=e,As}var Qh=Lt,wr=Qh("%Object.getOwnPropertyDescriptor%",!0);if(wr)try{wr([],"length")}catch{wr=null}var mn=wr,yn=Ss(),Jh=on,Nt=Zt,gn=mn,el=function(s,e,t){if(!s||typeof s!="object"&&typeof s!="function")throw new Nt("`obj` must be an object or a function`");if(typeof e!="string"&&typeof e!="symbol")throw new Nt("`property` must be a string or a symbol`");if(arguments.length>3&&typeof arguments[3]!="boolean"&&arguments[3]!==null)throw new Nt("`nonEnumerable`, if provided, must be a boolean or null");if(arguments.length>4&&typeof arguments[4]!="boolean"&&arguments[4]!==null)throw new Nt("`nonWritable`, if provided, must be a boolean or null");if(arguments.length>5&&typeof arguments[5]!="boolean"&&arguments[5]!==null)throw new Nt("`nonConfigurable`, if provided, must be a boolean or null");if(arguments.length>6&&typeof arguments[6]!="boolean")throw new Nt("`loose`, if provided, must be a boolean");var r=arguments.length>3?arguments[3]:null,i=arguments.length>4?arguments[4]:null,n=arguments.length>5?arguments[5]:null,a=arguments.length>6?arguments[6]:!1,o=!!gn&&gn(s,e);if(yn)yn(s,e,{configurable:n===null&&o?o.configurable:!n,enumerable:r===null&&o?o.enumerable:!r,value:t,writable:i===null&&o?o.writable:!i});else if(a||!r&&!i&&!n)s[e]=t;else throw new Jh("This environment does not support defining a property as non-configurable, non-writable, or non-enumerable.")},Ms=Ss(),bn=function(){return!!Ms};bn.hasArrayLengthDefineBug=function(){if(!Ms)return null;try{return Ms([],"length",{value:1}).length!==1}catch{return!0}};var tl=bn,rl=Lt,xn=el,sl=tl(),vn=mn,_n=Zt,il=rl("%Math.floor%"),nl=function(s,e){if(typeof s!="function")throw new _n("`fn` is not a function");if(typeof e!="number"||e<0||e>4294967295||il(e)!==e)throw new _n("`length` must be a positive 32-bit integer");var t=arguments.length>2&&!!arguments[2],r=!0,i=!0;if("length"in s&&vn){var n=vn(s,"length");n&&!n.configurable&&(r=!1),n&&!n.writable&&(i=!1)}return(r||i||!t)&&(sl?xn(s,"length",e,!0,!0):xn(s,"length",e)),s};(function(s){var e=_s,t=Lt,r=nl,i=Zt,n=t("%Function.prototype.apply%"),a=t("%Function.prototype.call%"),o=t("%Reflect.apply%",!0)||e.call(a,n),h=Ss(),l=t("%Math.max%");s.exports=function(c){if(typeof c!="function")throw new i("a function is required");var d=o(e,a,arguments);return r(d,1+l(0,c.length-(arguments.length-1)),!0)};var u=function(){return o(e,n,arguments)};h?h(s.exports,"apply",{value:u}):s.exports.apply=u})(fn);var al=fn.exports,Tn=Lt,En=al,ol=En(Tn("String.prototype.indexOf")),hl=function(s,e){var t=Tn(s,!!e);return typeof t=="function"&&ol(s,".prototype.")>-1?En(t):t};const ll={},ul=Object.freeze(Object.defineProperty({__proto__:null,default:ll},Symbol.toStringTag,{value:"Module"})),cl=Gi(ul);var ws=typeof Map=="function"&&Map.prototype,Is=Object.getOwnPropertyDescriptor&&ws?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,Ir=ws&&Is&&typeof Is.get=="function"?Is.get:null,An=ws&&Map.prototype.forEach,Rs=typeof Set=="function"&&Set.prototype,Ps=Object.getOwnPropertyDescriptor&&Rs?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,Rr=Rs&&Ps&&typeof Ps.get=="function"?Ps.get:null,Sn=Rs&&Set.prototype.forEach,dl=typeof WeakMap=="function"&&WeakMap.prototype,Jt=dl?WeakMap.prototype.has:null,fl=typeof WeakSet=="function"&&WeakSet.prototype,er=fl?WeakSet.prototype.has:null,pl=typeof WeakRef=="function"&&WeakRef.prototype,Mn=pl?WeakRef.prototype.deref:null,ml=Boolean.prototype.valueOf,yl=Object.prototype.toString,gl=Function.prototype.toString,bl=String.prototype.match,Ls=String.prototype.slice,We=String.prototype.replace,xl=String.prototype.toUpperCase,wn=String.prototype.toLowerCase,In=RegExp.prototype.test,Rn=Array.prototype.concat,Ce=Array.prototype.join,vl=Array.prototype.slice,Pn=Math.floor,Ns=typeof BigInt=="function"?BigInt.prototype.valueOf:null,Cs=Object.getOwnPropertySymbols,Os=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Symbol.prototype.toString:null,Ct=typeof Symbol=="function"&&typeof Symbol.iterator=="object",me=typeof Symbol=="function"&&Symbol.toStringTag&&(typeof Symbol.toStringTag===Ct||!0)?Symbol.toStringTag:null,Ln=Object.prototype.propertyIsEnumerable,Nn=(typeof Reflect=="function"?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(s){return s.__proto__}:null);function Cn(s,e){if(s===1/0||s===-1/0||s!==s||s&&s>-1e3&&s<1e3||In.call(/e/,e))return e;var t=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g;if(typeof s=="number"){var r=s<0?-Pn(-s):Pn(s);if(r!==s){var i=String(r),n=Ls.call(e,i.length+1);return We.call(i,t,"$&_")+"."+We.call(We.call(n,/([0-9]{3})/g,"$&_"),/_$/,"")}}return We.call(e,t,"$&_")}var Fs=cl,On=Fs.custom,Fn=Bn(On)?On:null,_l=function s(e,t,r,i){var n=t||{};if(Ye(n,"quoteStyle")&&n.quoteStyle!=="single"&&n.quoteStyle!=="double")throw new TypeError('option "quoteStyle" must be "single" or "double"');if(Ye(n,"maxStringLength")&&(typeof n.maxStringLength=="number"?n.maxStringLength<0&&n.maxStringLength!==1/0:n.maxStringLength!==null))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var a=Ye(n,"customInspect")?n.customInspect:!0;if(typeof a!="boolean"&&a!=="symbol")throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if(Ye(n,"indent")&&n.indent!==null&&n.indent!=="	"&&!(parseInt(n.indent,10)===n.indent&&n.indent>0))throw new TypeError('option "indent" must be "\\t", an integer > 0, or `null`');if(Ye(n,"numericSeparator")&&typeof n.numericSeparator!="boolean")throw new TypeError('option "numericSeparator", if provided, must be `true` or `false`');var o=n.numericSeparator;if(typeof e>"u")return"undefined";if(e===null)return"null";if(typeof e=="boolean")return e?"true":"false";if(typeof e=="string")return Gn(e,n);if(typeof e=="number"){if(e===0)return 1/0/e>0?"0":"-0";var h=String(e);return o?Cn(e,h):h}if(typeof e=="bigint"){var l=String(e)+"n";return o?Cn(e,l):l}var u=typeof n.depth>"u"?5:n.depth;if(typeof r>"u"&&(r=0),r>=u&&u>0&&typeof e=="object")return Ds(e)?"[Array]":"[Object]";var c=Ul(n,r);if(typeof i>"u")i=[];else if(Un(i,e)>=0)return"[Circular]";function d(C,F,N){if(F&&(i=vl.call(i),i.push(F)),N){var J={depth:n.depth};return Ye(n,"quoteStyle")&&(J.quoteStyle=n.quoteStyle),s(C,J,r+1,i)}return s(C,n,r+1,i)}if(typeof e=="function"&&!kn(e)){var f=Pl(e),p=Pr(e,d);return"[Function"+(f?": "+f:" (anonymous)")+"]"+(p.length>0?" { "+Ce.call(p,", ")+" }":"")}if(Bn(e)){var m=Ct?We.call(String(e),/^(Symbol\(.*\))_[^)]*$/,"$1"):Os.call(e);return typeof e=="object"&&!Ct?tr(m):m}if(Dl(e)){for(var y="<"+wn.call(String(e.nodeName)),x=e.attributes||[],b=0;b<x.length;b++)y+=" "+x[b].name+"="+Dn(Tl(x[b].value),"double",n);return y+=">",e.childNodes&&e.childNodes.length&&(y+="..."),y+="</"+wn.call(String(e.nodeName))+">",y}if(Ds(e)){if(e.length===0)return"[]";var g=Pr(e,d);return c&&!Bl(g)?"["+Bs(g,c)+"]":"[ "+Ce.call(g,", ")+" ]"}if(Al(e)){var v=Pr(e,d);return!("cause"in Error.prototype)&&"cause"in e&&!Ln.call(e,"cause")?"{ ["+String(e)+"] "+Ce.call(Rn.call("[cause]: "+d(e.cause),v),", ")+" }":v.length===0?"["+String(e)+"]":"{ ["+String(e)+"] "+Ce.call(v,", ")+" }"}if(typeof e=="object"&&a){if(Fn&&typeof e[Fn]=="function"&&Fs)return Fs(e,{depth:u-r});if(a!=="symbol"&&typeof e.inspect=="function")return e.inspect()}if(Ll(e)){var _=[];return An&&An.call(e,function(C,F){_.push(d(F,e,!0)+" => "+d(C,e))}),jn("Map",Ir.call(e),_,c)}if(Ol(e)){var T=[];return Sn&&Sn.call(e,function(C){T.push(d(C,e))}),jn("Set",Rr.call(e),T,c)}if(Nl(e))return ks("WeakMap");if(Fl(e))return ks("WeakSet");if(Cl(e))return ks("WeakRef");if(Ml(e))return tr(d(Number(e)));if(Il(e))return tr(d(Ns.call(e)));if(wl(e))return tr(ml.call(e));if(Sl(e))return tr(d(String(e)));if(typeof window<"u"&&e===window)return"{ [object Window] }";if(typeof globalThis<"u"&&e===globalThis||typeof Tt<"u"&&e===Tt)return"{ [object globalThis] }";if(!El(e)&&!kn(e)){var E=Pr(e,d),w=Nn?Nn(e)===Object.prototype:e instanceof Object||e.constructor===Object,S=e instanceof Object?"":"null prototype",L=!w&&me&&Object(e)===e&&me in e?Ls.call(Ke(e),8,-1):S?"Object":"",I=w||typeof e.constructor!="function"?"":e.constructor.name?e.constructor.name+" ":"",k=I+(L||S?"["+Ce.call(Rn.call([],L||[],S||[]),": ")+"] ":"");return E.length===0?k+"{}":c?k+"{"+Bs(E,c)+"}":k+"{ "+Ce.call(E,", ")+" }"}return String(e)};function Dn(s,e,t){var r=(t.quoteStyle||e)==="double"?'"':"'";return r+s+r}function Tl(s){return We.call(String(s),/"/g,"&quot;")}function Ds(s){return Ke(s)==="[object Array]"&&(!me||!(typeof s=="object"&&me in s))}function El(s){return Ke(s)==="[object Date]"&&(!me||!(typeof s=="object"&&me in s))}function kn(s){return Ke(s)==="[object RegExp]"&&(!me||!(typeof s=="object"&&me in s))}function Al(s){return Ke(s)==="[object Error]"&&(!me||!(typeof s=="object"&&me in s))}function Sl(s){return Ke(s)==="[object String]"&&(!me||!(typeof s=="object"&&me in s))}function Ml(s){return Ke(s)==="[object Number]"&&(!me||!(typeof s=="object"&&me in s))}function wl(s){return Ke(s)==="[object Boolean]"&&(!me||!(typeof s=="object"&&me in s))}function Bn(s){if(Ct)return s&&typeof s=="object"&&s instanceof Symbol;if(typeof s=="symbol")return!0;if(!s||typeof s!="object"||!Os)return!1;try{return Os.call(s),!0}catch{}return!1}function Il(s){if(!s||typeof s!="object"||!Ns)return!1;try{return Ns.call(s),!0}catch{}return!1}var Rl=Object.prototype.hasOwnProperty||function(s){return s in this};function Ye(s,e){return Rl.call(s,e)}function Ke(s){return yl.call(s)}function Pl(s){if(s.name)return s.name;var e=bl.call(gl.call(s),/^function\s*([\w$]+)/);return e?e[1]:null}function Un(s,e){if(s.indexOf)return s.indexOf(e);for(var t=0,r=s.length;t<r;t++)if(s[t]===e)return t;return-1}function Ll(s){if(!Ir||!s||typeof s!="object")return!1;try{Ir.call(s);try{Rr.call(s)}catch{return!0}return s instanceof Map}catch{}return!1}function Nl(s){if(!Jt||!s||typeof s!="object")return!1;try{Jt.call(s,Jt);try{er.call(s,er)}catch{return!0}return s instanceof WeakMap}catch{}return!1}function Cl(s){if(!Mn||!s||typeof s!="object")return!1;try{return Mn.call(s),!0}catch{}return!1}function Ol(s){if(!Rr||!s||typeof s!="object")return!1;try{Rr.call(s);try{Ir.call(s)}catch{return!0}return s instanceof Set}catch{}return!1}function Fl(s){if(!er||!s||typeof s!="object")return!1;try{er.call(s,er);try{Jt.call(s,Jt)}catch{return!0}return s instanceof WeakSet}catch{}return!1}function Dl(s){return!s||typeof s!="object"?!1:typeof HTMLElement<"u"&&s instanceof HTMLElement?!0:typeof s.nodeName=="string"&&typeof s.getAttribute=="function"}function Gn(s,e){if(s.length>e.maxStringLength){var t=s.length-e.maxStringLength,r="... "+t+" more character"+(t>1?"s":"");return Gn(Ls.call(s,0,e.maxStringLength),e)+r}var i=We.call(We.call(s,/(['\\])/g,"\\$1"),/[\x00-\x1f]/g,kl);return Dn(i,"single",e)}function kl(s){var e=s.charCodeAt(0),t={8:"b",9:"t",10:"n",12:"f",13:"r"}[e];return t?"\\"+t:"\\x"+(e<16?"0":"")+xl.call(e.toString(16))}function tr(s){return"Object("+s+")"}function ks(s){return s+" { ? }"}function jn(s,e,t,r){var i=r?Bs(t,r):Ce.call(t,", ");return s+" ("+e+") {"+i+"}"}function Bl(s){for(var e=0;e<s.length;e++)if(Un(s[e],`
`)>=0)return!1;return!0}function Ul(s,e){var t;if(s.indent==="	")t="	";else if(typeof s.indent=="number"&&s.indent>0)t=Ce.call(Array(s.indent+1)," ");else return null;return{base:t,prev:Ce.call(Array(e+1),t)}}function Bs(s,e){if(s.length===0)return"";var t=`
`+e.prev+e.base;return t+Ce.call(s,","+t)+`
`+e.prev}function Pr(s,e){var t=Ds(s),r=[];if(t){r.length=s.length;for(var i=0;i<s.length;i++)r[i]=Ye(s,i)?e(s[i],s):""}var n=typeof Cs=="function"?Cs(s):[],a;if(Ct){a={};for(var o=0;o<n.length;o++)a["$"+n[o]]=n[o]}for(var h in s)Ye(s,h)&&(t&&String(Number(h))===h&&h<s.length||Ct&&a["$"+h]instanceof Symbol||(In.call(/[^\w$]/,h)?r.push(e(h,s)+": "+e(s[h],s)):r.push(h+": "+e(s[h],s))));if(typeof Cs=="function")for(var l=0;l<n.length;l++)Ln.call(s,n[l])&&r.push("["+e(n[l])+"]: "+e(s[n[l]],s));return r}var Hn=Lt,Ot=hl,Gl=_l,jl=Zt,Lr=Hn("%WeakMap%",!0),Nr=Hn("%Map%",!0),Hl=Ot("WeakMap.prototype.get",!0),zl=Ot("WeakMap.prototype.set",!0),Vl=Ot("WeakMap.prototype.has",!0),Xl=Ot("Map.prototype.get",!0),$l=Ot("Map.prototype.set",!0),ql=Ot("Map.prototype.has",!0),Us=function(s,e){for(var t=s,r;(r=t.next)!==null;t=r)if(r.key===e)return t.next=r.next,r.next=s.next,s.next=r,r},Wl=function(s,e){var t=Us(s,e);return t&&t.value},Yl=function(s,e,t){var r=Us(s,e);r?r.value=t:s.next={key:e,next:s.next,value:t}},Kl=function(s,e){return!!Us(s,e)},Zl=function(){var s,e,t,r={assert:function(i){if(!r.has(i))throw new jl("Side channel does not contain "+Gl(i))},get:function(i){if(Lr&&i&&(typeof i=="object"||typeof i=="function")){if(s)return Hl(s,i)}else if(Nr){if(e)return Xl(e,i)}else if(t)return Wl(t,i)},has:function(i){if(Lr&&i&&(typeof i=="object"||typeof i=="function")){if(s)return Vl(s,i)}else if(Nr){if(e)return ql(e,i)}else if(t)return Kl(t,i);return!1},set:function(i,n){Lr&&i&&(typeof i=="object"||typeof i=="function")?(s||(s=new Lr),zl(s,i,n)):Nr?(e||(e=new Nr),$l(e,i,n)):(t||(t={key:{},next:null}),Yl(t,i,n))}};return r},Ql=String.prototype.replace,Jl=/%20/g,Gs={RFC1738:"RFC1738",RFC3986:"RFC3986"},js={default:Gs.RFC3986,formatters:{RFC1738:function(s){return Ql.call(s,Jl,"+")},RFC3986:function(s){return String(s)}},RFC1738:Gs.RFC1738,RFC3986:Gs.RFC3986},eu=js,Hs=Object.prototype.hasOwnProperty,ct=Array.isArray,Oe=function(){for(var s=[],e=0;e<256;++e)s.push("%"+((e<16?"0":"")+e.toString(16)).toUpperCase());return s}(),tu=function(s){for(;s.length>1;){var e=s.pop(),t=e.obj[e.prop];if(ct(t)){for(var r=[],i=0;i<t.length;++i)typeof t[i]<"u"&&r.push(t[i]);e.obj[e.prop]=r}}},zn=function(s,e){for(var t=e&&e.plainObjects?Object.create(null):{},r=0;r<s.length;++r)typeof s[r]<"u"&&(t[r]=s[r]);return t},ru=function s(e,t,r){if(!t)return e;if(typeof t!="object"){if(ct(e))e.push(t);else if(e&&typeof e=="object")(r&&(r.plainObjects||r.allowPrototypes)||!Hs.call(Object.prototype,t))&&(e[t]=!0);else return[e,t];return e}if(!e||typeof e!="object")return[e].concat(t);var i=e;return ct(e)&&!ct(t)&&(i=zn(e,r)),ct(e)&&ct(t)?(t.forEach(function(n,a){if(Hs.call(e,a)){var o=e[a];o&&typeof o=="object"&&n&&typeof n=="object"?e[a]=s(o,n,r):e.push(n)}else e[a]=n}),e):Object.keys(t).reduce(function(n,a){var o=t[a];return Hs.call(n,a)?n[a]=s(n[a],o,r):n[a]=o,n},i)},su=function(s,e){return Object.keys(e).reduce(function(t,r){return t[r]=e[r],t},s)},iu=function(s,e,t){var r=s.replace(/\+/g," ");if(t==="iso-8859-1")return r.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(r)}catch{return r}},zs=1024,nu=function(s,e,t,r,i){if(s.length===0)return s;var n=s;if(typeof s=="symbol"?n=Symbol.prototype.toString.call(s):typeof s!="string"&&(n=String(s)),t==="iso-8859-1")return escape(n).replace(/%u[0-9a-f]{4}/gi,function(d){return"%26%23"+parseInt(d.slice(2),16)+"%3B"});for(var a="",o=0;o<n.length;o+=zs){for(var h=n.length>=zs?n.slice(o,o+zs):n,l=[],u=0;u<h.length;++u){var c=h.charCodeAt(u);if(c===45||c===46||c===95||c===126||c>=48&&c<=57||c>=65&&c<=90||c>=97&&c<=122||i===eu.RFC1738&&(c===40||c===41)){l[l.length]=h.charAt(u);continue}if(c<128){l[l.length]=Oe[c];continue}if(c<2048){l[l.length]=Oe[192|c>>6]+Oe[128|c&63];continue}if(c<55296||c>=57344){l[l.length]=Oe[224|c>>12]+Oe[128|c>>6&63]+Oe[128|c&63];continue}u+=1,c=65536+((c&1023)<<10|h.charCodeAt(u)&1023),l[l.length]=Oe[240|c>>18]+Oe[128|c>>12&63]+Oe[128|c>>6&63]+Oe[128|c&63]}a+=l.join("")}return a},au=function(s){for(var e=[{obj:{o:s},prop:"o"}],t=[],r=0;r<e.length;++r)for(var i=e[r],n=i.obj[i.prop],a=Object.keys(n),o=0;o<a.length;++o){var h=a[o],l=n[h];typeof l=="object"&&l!==null&&t.indexOf(l)===-1&&(e.push({obj:n,prop:h}),t.push(l))}return tu(e),s},ou=function(s){return Object.prototype.toString.call(s)==="[object RegExp]"},hu=function(s){return!s||typeof s!="object"?!1:!!(s.constructor&&s.constructor.isBuffer&&s.constructor.isBuffer(s))},lu=function(s,e){return[].concat(s,e)},uu=function(s,e){if(ct(s)){for(var t=[],r=0;r<s.length;r+=1)t.push(e(s[r]));return t}return e(s)},Vn={arrayToObject:zn,assign:su,combine:lu,compact:au,decode:iu,encode:nu,isBuffer:hu,isRegExp:ou,maybeMap:uu,merge:ru},Xn=Zl,Cr=Vn,rr=js,cu=Object.prototype.hasOwnProperty,$n={brackets:function(s){return s+"[]"},comma:"comma",indices:function(s,e){return s+"["+e+"]"},repeat:function(s){return s}},Fe=Array.isArray,du=Array.prototype.push,qn=function(s,e){du.apply(s,Fe(e)?e:[e])},fu=Date.prototype.toISOString,Wn=rr.default,he={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:Cr.encode,encodeValuesOnly:!1,format:Wn,formatter:rr.formatters[Wn],indices:!1,serializeDate:function(s){return fu.call(s)},skipNulls:!1,strictNullHandling:!1},pu=function(s){return typeof s=="string"||typeof s=="number"||typeof s=="boolean"||typeof s=="symbol"||typeof s=="bigint"},Vs={},mu=function s(e,t,r,i,n,a,o,h,l,u,c,d,f,p,m,y,x,b){for(var g=e,v=b,_=0,T=!1;(v=v.get(Vs))!==void 0&&!T;){var E=v.get(e);if(_+=1,typeof E<"u"){if(E===_)throw new RangeError("Cyclic object value");T=!0}typeof v.get(Vs)>"u"&&(_=0)}if(typeof u=="function"?g=u(t,g):g instanceof Date?g=f(g):r==="comma"&&Fe(g)&&(g=Cr.maybeMap(g,function(P){return P instanceof Date?f(P):P})),g===null){if(a)return l&&!y?l(t,he.encoder,x,"key",p):t;g=""}if(pu(g)||Cr.isBuffer(g)){if(l){var w=y?t:l(t,he.encoder,x,"key",p);return[m(w)+"="+m(l(g,he.encoder,x,"value",p))]}return[m(t)+"="+m(String(g))]}var S=[];if(typeof g>"u")return S;var L;if(r==="comma"&&Fe(g))y&&l&&(g=Cr.maybeMap(g,l)),L=[{value:g.length>0?g.join(",")||null:void 0}];else if(Fe(u))L=u;else{var I=Object.keys(g);L=c?I.sort(c):I}var k=h?t.replace(/\./g,"%2E"):t,C=i&&Fe(g)&&g.length===1?k+"[]":k;if(n&&Fe(g)&&g.length===0)return C+"[]";for(var F=0;F<L.length;++F){var N=L[F],J=typeof N=="object"&&typeof N.value<"u"?N.value:g[N];if(!(o&&J===null)){var xe=d&&h?N.replace(/\./g,"%2E"):N,Ge=Fe(g)?typeof r=="function"?r(C,xe):C:C+(d?"."+xe:"["+xe+"]");b.set(e,_);var rt=Xn();rt.set(Vs,b),qn(S,s(J,Ge,r,i,n,a,o,h,r==="comma"&&y&&Fe(g)?null:l,u,c,d,f,p,m,y,x,rt))}}return S},yu=function(s){if(!s)return he;if(typeof s.allowEmptyArrays<"u"&&typeof s.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof s.encodeDotInKeys<"u"&&typeof s.encodeDotInKeys!="boolean")throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(s.encoder!==null&&typeof s.encoder<"u"&&typeof s.encoder!="function")throw new TypeError("Encoder has to be a function.");var e=s.charset||he.charset;if(typeof s.charset<"u"&&s.charset!=="utf-8"&&s.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var t=rr.default;if(typeof s.format<"u"){if(!cu.call(rr.formatters,s.format))throw new TypeError("Unknown format option provided.");t=s.format}var r=rr.formatters[t],i=he.filter;(typeof s.filter=="function"||Fe(s.filter))&&(i=s.filter);var n;if(s.arrayFormat in $n?n=s.arrayFormat:"indices"in s?n=s.indices?"indices":"repeat":n=he.arrayFormat,"commaRoundTrip"in s&&typeof s.commaRoundTrip!="boolean")throw new TypeError("`commaRoundTrip` must be a boolean, or absent");var a=typeof s.allowDots>"u"?s.encodeDotInKeys===!0?!0:he.allowDots:!!s.allowDots;return{addQueryPrefix:typeof s.addQueryPrefix=="boolean"?s.addQueryPrefix:he.addQueryPrefix,allowDots:a,allowEmptyArrays:typeof s.allowEmptyArrays=="boolean"?!!s.allowEmptyArrays:he.allowEmptyArrays,arrayFormat:n,charset:e,charsetSentinel:typeof s.charsetSentinel=="boolean"?s.charsetSentinel:he.charsetSentinel,commaRoundTrip:s.commaRoundTrip,delimiter:typeof s.delimiter>"u"?he.delimiter:s.delimiter,encode:typeof s.encode=="boolean"?s.encode:he.encode,encodeDotInKeys:typeof s.encodeDotInKeys=="boolean"?s.encodeDotInKeys:he.encodeDotInKeys,encoder:typeof s.encoder=="function"?s.encoder:he.encoder,encodeValuesOnly:typeof s.encodeValuesOnly=="boolean"?s.encodeValuesOnly:he.encodeValuesOnly,filter:i,format:t,formatter:r,serializeDate:typeof s.serializeDate=="function"?s.serializeDate:he.serializeDate,skipNulls:typeof s.skipNulls=="boolean"?s.skipNulls:he.skipNulls,sort:typeof s.sort=="function"?s.sort:null,strictNullHandling:typeof s.strictNullHandling=="boolean"?s.strictNullHandling:he.strictNullHandling}},gu=function(s,e){var t=s,r=yu(e),i,n;typeof r.filter=="function"?(n=r.filter,t=n("",t)):Fe(r.filter)&&(n=r.filter,i=n);var a=[];if(typeof t!="object"||t===null)return"";var o=$n[r.arrayFormat],h=o==="comma"&&r.commaRoundTrip;i||(i=Object.keys(t)),r.sort&&i.sort(r.sort);for(var l=Xn(),u=0;u<i.length;++u){var c=i[u];r.skipNulls&&t[c]===null||qn(a,mu(t[c],c,o,h,r.allowEmptyArrays,r.strictNullHandling,r.skipNulls,r.encodeDotInKeys,r.encode?r.encoder:null,r.filter,r.sort,r.allowDots,r.serializeDate,r.format,r.formatter,r.encodeValuesOnly,r.charset,l))}var d=a.join(r.delimiter),f=r.addQueryPrefix===!0?"?":"";return r.charsetSentinel&&(r.charset==="iso-8859-1"?f+="utf8=%26%2310003%3B&":f+="utf8=%E2%9C%93&"),d.length>0?f+d:""},Ft=Vn,Xs=Object.prototype.hasOwnProperty,bu=Array.isArray,se={allowDots:!1,allowEmptyArrays:!1,allowPrototypes:!1,allowSparse:!1,arrayLimit:20,charset:"utf-8",charsetSentinel:!1,comma:!1,decodeDotInKeys:!1,decoder:Ft.decode,delimiter:"&",depth:5,duplicates:"combine",ignoreQueryPrefix:!1,interpretNumericEntities:!1,parameterLimit:1e3,parseArrays:!0,plainObjects:!1,strictDepth:!1,strictNullHandling:!1},xu=function(s){return s.replace(/&#(\d+);/g,function(e,t){return String.fromCharCode(parseInt(t,10))})},Yn=function(s,e){return s&&typeof s=="string"&&e.comma&&s.indexOf(",")>-1?s.split(","):s},vu="utf8=%26%2310003%3B",_u="utf8=%E2%9C%93",Tu=function(s,e){var t={__proto__:null},r=e.ignoreQueryPrefix?s.replace(/^\?/,""):s;r=r.replace(/%5B/gi,"[").replace(/%5D/gi,"]");var i=e.parameterLimit===1/0?void 0:e.parameterLimit,n=r.split(e.delimiter,i),a=-1,o,h=e.charset;if(e.charsetSentinel)for(o=0;o<n.length;++o)n[o].indexOf("utf8=")===0&&(n[o]===_u?h="utf-8":n[o]===vu&&(h="iso-8859-1"),a=o,o=n.length);for(o=0;o<n.length;++o)if(o!==a){var l=n[o],u=l.indexOf("]="),c=u===-1?l.indexOf("="):u+1,d,f;c===-1?(d=e.decoder(l,se.decoder,h,"key"),f=e.strictNullHandling?null:""):(d=e.decoder(l.slice(0,c),se.decoder,h,"key"),f=Ft.maybeMap(Yn(l.slice(c+1),e),function(m){return e.decoder(m,se.decoder,h,"value")})),f&&e.interpretNumericEntities&&h==="iso-8859-1"&&(f=xu(f)),l.indexOf("[]=")>-1&&(f=bu(f)?[f]:f);var p=Xs.call(t,d);p&&e.duplicates==="combine"?t[d]=Ft.combine(t[d],f):(!p||e.duplicates==="last")&&(t[d]=f)}return t},Eu=function(s,e,t,r){for(var i=r?e:Yn(e,t),n=s.length-1;n>=0;--n){var a,o=s[n];if(o==="[]"&&t.parseArrays)a=t.allowEmptyArrays&&(i===""||t.strictNullHandling&&i===null)?[]:[].concat(i);else{a=t.plainObjects?Object.create(null):{};var h=o.charAt(0)==="["&&o.charAt(o.length-1)==="]"?o.slice(1,-1):o,l=t.decodeDotInKeys?h.replace(/%2E/g,"."):h,u=parseInt(l,10);!t.parseArrays&&l===""?a={0:i}:!isNaN(u)&&o!==l&&String(u)===l&&u>=0&&t.parseArrays&&u<=t.arrayLimit?(a=[],a[u]=i):l!=="__proto__"&&(a[l]=i)}i=a}return i},Au=function(s,e,t,r){if(s){var i=t.allowDots?s.replace(/\.([^.[]+)/g,"[$1]"):s,n=/(\[[^[\]]*])/,a=/(\[[^[\]]*])/g,o=t.depth>0&&n.exec(i),h=o?i.slice(0,o.index):i,l=[];if(h){if(!t.plainObjects&&Xs.call(Object.prototype,h)&&!t.allowPrototypes)return;l.push(h)}for(var u=0;t.depth>0&&(o=a.exec(i))!==null&&u<t.depth;){if(u+=1,!t.plainObjects&&Xs.call(Object.prototype,o[1].slice(1,-1))&&!t.allowPrototypes)return;l.push(o[1])}if(o){if(t.strictDepth===!0)throw new RangeError("Input depth exceeded depth option of "+t.depth+" and strictDepth is true");l.push("["+i.slice(o.index)+"]")}return Eu(l,e,t,r)}},Su=function(s){if(!s)return se;if(typeof s.allowEmptyArrays<"u"&&typeof s.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof s.decodeDotInKeys<"u"&&typeof s.decodeDotInKeys!="boolean")throw new TypeError("`decodeDotInKeys` option can only be `true` or `false`, when provided");if(s.decoder!==null&&typeof s.decoder<"u"&&typeof s.decoder!="function")throw new TypeError("Decoder has to be a function.");if(typeof s.charset<"u"&&s.charset!=="utf-8"&&s.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var e=typeof s.charset>"u"?se.charset:s.charset,t=typeof s.duplicates>"u"?se.duplicates:s.duplicates;if(t!=="combine"&&t!=="first"&&t!=="last")throw new TypeError("The duplicates option must be either combine, first, or last");var r=typeof s.allowDots>"u"?s.decodeDotInKeys===!0?!0:se.allowDots:!!s.allowDots;return{allowDots:r,allowEmptyArrays:typeof s.allowEmptyArrays=="boolean"?!!s.allowEmptyArrays:se.allowEmptyArrays,allowPrototypes:typeof s.allowPrototypes=="boolean"?s.allowPrototypes:se.allowPrototypes,allowSparse:typeof s.allowSparse=="boolean"?s.allowSparse:se.allowSparse,arrayLimit:typeof s.arrayLimit=="number"?s.arrayLimit:se.arrayLimit,charset:e,charsetSentinel:typeof s.charsetSentinel=="boolean"?s.charsetSentinel:se.charsetSentinel,comma:typeof s.comma=="boolean"?s.comma:se.comma,decodeDotInKeys:typeof s.decodeDotInKeys=="boolean"?s.decodeDotInKeys:se.decodeDotInKeys,decoder:typeof s.decoder=="function"?s.decoder:se.decoder,delimiter:typeof s.delimiter=="string"||Ft.isRegExp(s.delimiter)?s.delimiter:se.delimiter,depth:typeof s.depth=="number"||s.depth===!1?+s.depth:se.depth,duplicates:t,ignoreQueryPrefix:s.ignoreQueryPrefix===!0,interpretNumericEntities:typeof s.interpretNumericEntities=="boolean"?s.interpretNumericEntities:se.interpretNumericEntities,parameterLimit:typeof s.parameterLimit=="number"?s.parameterLimit:se.parameterLimit,parseArrays:s.parseArrays!==!1,plainObjects:typeof s.plainObjects=="boolean"?s.plainObjects:se.plainObjects,strictDepth:typeof s.strictDepth=="boolean"?!!s.strictDepth:se.strictDepth,strictNullHandling:typeof s.strictNullHandling=="boolean"?s.strictNullHandling:se.strictNullHandling}},Mu=function(s,e){var t=Su(e);if(s===""||s===null||typeof s>"u")return t.plainObjects?Object.create(null):{};for(var r=typeof s=="string"?Tu(s,t):s,i=t.plainObjects?Object.create(null):{},n=Object.keys(r),a=0;a<n.length;++a){var o=n[a],h=Au(o,r[o],t,typeof s=="string");i=Ft.merge(i,h,t)}return t.allowSparse===!0?i:Ft.compact(i)},wu=gu,Iu=Mu,Ru=js,Pu={formats:Ru,parse:Iu,stringify:wu},Lu=dh;function Ve(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}var Nu=/^([a-z0-9.+-]+:)/i,Cu=/:[0-9]*$/,Ou=/^(\/\/?(?!\/)[^?\s]*)(\?[^\s]*)?$/,Fu=["<",">",'"',"`"," ","\r",`
`,"	"],Du=["{","}","|","\\","^","`"].concat(Fu),$s=["'"].concat(Du),Kn=["%","/","?",";","#"].concat($s),Zn=["/","?","#"],ku=255,Qn=/^[+a-z0-9A-Z_-]{0,63}$/,Bu=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,Uu={javascript:!0,"javascript:":!0},qs={javascript:!0,"javascript:":!0},Dt={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},Ws=Pu;function Gu(s,e,t){if(s&&typeof s=="object"&&s instanceof Ve)return s;var r=new Ve;return r.parse(s,e,t),r}Ve.prototype.parse=function(s,e,t){if(typeof s!="string")throw new TypeError("Parameter 'url' must be a string, not "+typeof s);var r=s.indexOf("?"),i=r!==-1&&r<s.indexOf("#")?"?":"#",n=s.split(i),a=/\\/g;n[0]=n[0].replace(a,"/"),s=n.join(i);var o=s;if(o=o.trim(),!t&&s.split("#").length===1){var h=Ou.exec(o);if(h)return this.path=o,this.href=o,this.pathname=h[1],h[2]?(this.search=h[2],e?this.query=Ws.parse(this.search.substr(1)):this.query=this.search.substr(1)):e&&(this.search="",this.query={}),this}var l=Nu.exec(o);if(l){l=l[0];var u=l.toLowerCase();this.protocol=u,o=o.substr(l.length)}if(t||l||o.match(/^\/\/[^@/]+@[^@/]+/)){var c=o.substr(0,2)==="//";c&&!(l&&qs[l])&&(o=o.substr(2),this.slashes=!0)}if(!qs[l]&&(c||l&&!Dt[l])){for(var d=-1,f=0;f<Zn.length;f++){var p=o.indexOf(Zn[f]);p!==-1&&(d===-1||p<d)&&(d=p)}var m,y;d===-1?y=o.lastIndexOf("@"):y=o.lastIndexOf("@",d),y!==-1&&(m=o.slice(0,y),o=o.slice(y+1),this.auth=decodeURIComponent(m)),d=-1;for(var f=0;f<Kn.length;f++){var p=o.indexOf(Kn[f]);p!==-1&&(d===-1||p<d)&&(d=p)}d===-1&&(d=o.length),this.host=o.slice(0,d),o=o.slice(d),this.parseHost(),this.hostname=this.hostname||"";var x=this.hostname[0]==="["&&this.hostname[this.hostname.length-1]==="]";if(!x)for(var b=this.hostname.split(/\./),f=0,g=b.length;f<g;f++){var v=b[f];if(v&&!v.match(Qn)){for(var _="",T=0,E=v.length;T<E;T++)v.charCodeAt(T)>127?_+="x":_+=v[T];if(!_.match(Qn)){var w=b.slice(0,f),S=b.slice(f+1),L=v.match(Bu);L&&(w.push(L[1]),S.unshift(L[2])),S.length&&(o="/"+S.join(".")+o),this.hostname=w.join(".");break}}}this.hostname.length>ku?this.hostname="":this.hostname=this.hostname.toLowerCase(),x||(this.hostname=Lu.toASCII(this.hostname));var I=this.port?":"+this.port:"",k=this.hostname||"";this.host=k+I,this.href+=this.host,x&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),o[0]!=="/"&&(o="/"+o))}if(!Uu[u])for(var f=0,g=$s.length;f<g;f++){var C=$s[f];if(o.indexOf(C)!==-1){var F=encodeURIComponent(C);F===C&&(F=escape(C)),o=o.split(C).join(F)}}var N=o.indexOf("#");N!==-1&&(this.hash=o.substr(N),o=o.slice(0,N));var J=o.indexOf("?");if(J!==-1?(this.search=o.substr(J),this.query=o.substr(J+1),e&&(this.query=Ws.parse(this.query)),o=o.slice(0,J)):e&&(this.search="",this.query={}),o&&(this.pathname=o),Dt[u]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){var I=this.pathname||"",xe=this.search||"";this.path=I+xe}return this.href=this.format(),this},Ve.prototype.format=function(){var s=this.auth||"";s&&(s=encodeURIComponent(s),s=s.replace(/%3A/i,":"),s+="@");var e=this.protocol||"",t=this.pathname||"",r=this.hash||"",i=!1,n="";this.host?i=s+this.host:this.hostname&&(i=s+(this.hostname.indexOf(":")===-1?this.hostname:"["+this.hostname+"]"),this.port&&(i+=":"+this.port)),this.query&&typeof this.query=="object"&&Object.keys(this.query).length&&(n=Ws.stringify(this.query,{arrayFormat:"repeat",addQueryPrefix:!1}));var a=this.search||n&&"?"+n||"";return e&&e.substr(-1)!==":"&&(e+=":"),this.slashes||(!e||Dt[e])&&i!==!1?(i="//"+(i||""),t&&t.charAt(0)!=="/"&&(t="/"+t)):i||(i=""),r&&r.charAt(0)!=="#"&&(r="#"+r),a&&a.charAt(0)!=="?"&&(a="?"+a),t=t.replace(/[?#]/g,function(o){return encodeURIComponent(o)}),a=a.replace("#","%23"),e+i+t+a+r},Ve.prototype.resolve=function(s){return this.resolveObject(Gu(s,!1,!0)).format()},Ve.prototype.resolveObject=function(s){if(typeof s=="string"){var e=new Ve;e.parse(s,!1,!0),s=e}for(var t=new Ve,r=Object.keys(this),i=0;i<r.length;i++){var n=r[i];t[n]=this[n]}if(t.hash=s.hash,s.href==="")return t.href=t.format(),t;if(s.slashes&&!s.protocol){for(var a=Object.keys(s),o=0;o<a.length;o++){var h=a[o];h!=="protocol"&&(t[h]=s[h])}return Dt[t.protocol]&&t.hostname&&!t.pathname&&(t.pathname="/",t.path=t.pathname),t.href=t.format(),t}if(s.protocol&&s.protocol!==t.protocol){if(!Dt[s.protocol]){for(var l=Object.keys(s),u=0;u<l.length;u++){var c=l[u];t[c]=s[c]}return t.href=t.format(),t}if(t.protocol=s.protocol,!s.host&&!qs[s.protocol]){for(var g=(s.pathname||"").split("/");g.length&&!(s.host=g.shift()););s.host||(s.host=""),s.hostname||(s.hostname=""),g[0]!==""&&g.unshift(""),g.length<2&&g.unshift(""),t.pathname=g.join("/")}else t.pathname=s.pathname;if(t.search=s.search,t.query=s.query,t.host=s.host||"",t.auth=s.auth,t.hostname=s.hostname||s.host,t.port=s.port,t.pathname||t.search){var d=t.pathname||"",f=t.search||"";t.path=d+f}return t.slashes=t.slashes||s.slashes,t.href=t.format(),t}var p=t.pathname&&t.pathname.charAt(0)==="/",m=s.host||s.pathname&&s.pathname.charAt(0)==="/",y=m||p||t.host&&s.pathname,x=y,b=t.pathname&&t.pathname.split("/")||[],g=s.pathname&&s.pathname.split("/")||[],v=t.protocol&&!Dt[t.protocol];if(v&&(t.hostname="",t.port=null,t.host&&(b[0]===""?b[0]=t.host:b.unshift(t.host)),t.host="",s.protocol&&(s.hostname=null,s.port=null,s.host&&(g[0]===""?g[0]=s.host:g.unshift(s.host)),s.host=null),y=y&&(g[0]===""||b[0]==="")),m)t.host=s.host||s.host===""?s.host:t.host,t.hostname=s.hostname||s.hostname===""?s.hostname:t.hostname,t.search=s.search,t.query=s.query,b=g;else if(g.length)b||(b=[]),b.pop(),b=b.concat(g),t.search=s.search,t.query=s.query;else if(s.search!=null){if(v){t.host=b.shift(),t.hostname=t.host;var _=t.host&&t.host.indexOf("@")>0?t.host.split("@"):!1;_&&(t.auth=_.shift(),t.hostname=_.shift(),t.host=t.hostname)}return t.search=s.search,t.query=s.query,(t.pathname!==null||t.search!==null)&&(t.path=(t.pathname?t.pathname:"")+(t.search?t.search:"")),t.href=t.format(),t}if(!b.length)return t.pathname=null,t.search?t.path="/"+t.search:t.path=null,t.href=t.format(),t;for(var T=b.slice(-1)[0],E=(t.host||s.host||b.length>1)&&(T==="."||T==="..")||T==="",w=0,S=b.length;S>=0;S--)T=b[S],T==="."?b.splice(S,1):T===".."?(b.splice(S,1),w++):w&&(b.splice(S,1),w--);if(!y&&!x)for(;w--;w)b.unshift("..");y&&b[0]!==""&&(!b[0]||b[0].charAt(0)!=="/")&&b.unshift(""),E&&b.join("/").substr(-1)!=="/"&&b.push("");var L=b[0]===""||b[0]&&b[0].charAt(0)==="/";if(v){t.hostname=L?"":b.length?b.shift():"",t.host=t.hostname;var _=t.host&&t.host.indexOf("@")>0?t.host.split("@"):!1;_&&(t.auth=_.shift(),t.hostname=_.shift(),t.host=t.hostname)}return y=y||t.host&&b.length,y&&!L&&b.unshift(""),b.length>0?t.pathname=b.join("/"):(t.pathname=null,t.path=null),(t.pathname!==null||t.search!==null)&&(t.path=(t.pathname?t.pathname:"")+(t.search?t.search:"")),t.auth=s.auth||t.auth,t.slashes=t.slashes||s.slashes,t.href=t.format(),t},Ve.prototype.parseHost=function(){var s=this.host,e=Cu.exec(s);e&&(e=e[0],e!==":"&&(this.port=e.substr(1)),s=s.substr(0,s.length-e.length)),s&&(this.hostname=s)};const Jn={};function $(s,e,t=3){if(Jn[e])return;let r=new Error().stack;typeof r>"u"?console.warn("PixiJS Deprecation Warning: ",`${e}
Deprecated since v${s}`):(r=r.split(`
`).splice(t).join(`
`),console.groupCollapsed?(console.groupCollapsed("%cPixiJS Deprecation Warning: %c%s","color:#614108;background:#fffbe6","font-weight:normal;color:#614108;background:#fffbe6",`${e}
Deprecated since v${s}`),console.warn(r),console.groupEnd()):(console.warn("PixiJS Deprecation Warning: ",`${e}
Deprecated since v${s}`),console.warn(r))),Jn[e]=!0}let Ys;function ju(){return typeof Ys>"u"&&(Ys=function(){var e;const s={stencil:!0,failIfMajorPerformanceCaveat:H.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT};try{if(!H.ADAPTER.getWebGLRenderingContext())return!1;const t=H.ADAPTER.createCanvas();let r=t.getContext("webgl",s)||t.getContext("experimental-webgl",s);const i=!!((e=r==null?void 0:r.getContextAttributes())!=null&&e.stencil);if(r){const n=r.getExtension("WEBGL_lose_context");n&&n.loseContext()}return r=null,i}catch{return!1}}()),Ys}var Hu={grad:.9,turn:360,rad:360/(2*Math.PI)},Xe=function(s){return typeof s=="string"?s.length>0:typeof s=="number"},de=function(s,e,t){return e===void 0&&(e=0),t===void 0&&(t=Math.pow(10,e)),Math.round(t*s)/t+0},Se=function(s,e,t){return e===void 0&&(e=0),t===void 0&&(t=1),s>t?t:s>e?s:e},ea=function(s){return(s=isFinite(s)?s%360:0)>0?s:s+360},ta=function(s){return{r:Se(s.r,0,255),g:Se(s.g,0,255),b:Se(s.b,0,255),a:Se(s.a)}},Ks=function(s){return{r:de(s.r),g:de(s.g),b:de(s.b),a:de(s.a,3)}},zu=/^#([0-9a-f]{3,8})$/i,Or=function(s){var e=s.toString(16);return e.length<2?"0"+e:e},ra=function(s){var e=s.r,t=s.g,r=s.b,i=s.a,n=Math.max(e,t,r),a=n-Math.min(e,t,r),o=a?n===e?(t-r)/a:n===t?2+(r-e)/a:4+(e-t)/a:0;return{h:60*(o<0?o+6:o),s:n?a/n*100:0,v:n/255*100,a:i}},sa=function(s){var e=s.h,t=s.s,r=s.v,i=s.a;e=e/360*6,t/=100,r/=100;var n=Math.floor(e),a=r*(1-t),o=r*(1-(e-n)*t),h=r*(1-(1-e+n)*t),l=n%6;return{r:255*[r,o,a,a,h,r][l],g:255*[h,r,r,o,a,a][l],b:255*[a,a,h,r,r,o][l],a:i}},ia=function(s){return{h:ea(s.h),s:Se(s.s,0,100),l:Se(s.l,0,100),a:Se(s.a)}},na=function(s){return{h:de(s.h),s:de(s.s),l:de(s.l),a:de(s.a,3)}},aa=function(s){return sa((t=(e=s).s,{h:e.h,s:(t*=((r=e.l)<50?r:100-r)/100)>0?2*t/(r+t)*100:0,v:r+t,a:e.a}));var e,t,r},sr=function(s){return{h:(e=ra(s)).h,s:(i=(200-(t=e.s))*(r=e.v)/100)>0&&i<200?t*r/100/(i<=100?i:200-i)*100:0,l:i/2,a:e.a};var e,t,r,i},Vu=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s*,\s*([+-]?\d*\.?\d+)%\s*,\s*([+-]?\d*\.?\d+)%\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,Xu=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s+([+-]?\d*\.?\d+)%\s+([+-]?\d*\.?\d+)%\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,$u=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,qu=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,Zs={string:[[function(s){var e=zu.exec(s);return e?(s=e[1]).length<=4?{r:parseInt(s[0]+s[0],16),g:parseInt(s[1]+s[1],16),b:parseInt(s[2]+s[2],16),a:s.length===4?de(parseInt(s[3]+s[3],16)/255,2):1}:s.length===6||s.length===8?{r:parseInt(s.substr(0,2),16),g:parseInt(s.substr(2,2),16),b:parseInt(s.substr(4,2),16),a:s.length===8?de(parseInt(s.substr(6,2),16)/255,2):1}:null:null},"hex"],[function(s){var e=$u.exec(s)||qu.exec(s);return e?e[2]!==e[4]||e[4]!==e[6]?null:ta({r:Number(e[1])/(e[2]?100/255:1),g:Number(e[3])/(e[4]?100/255:1),b:Number(e[5])/(e[6]?100/255:1),a:e[7]===void 0?1:Number(e[7])/(e[8]?100:1)}):null},"rgb"],[function(s){var e=Vu.exec(s)||Xu.exec(s);if(!e)return null;var t,r,i=ia({h:(t=e[1],r=e[2],r===void 0&&(r="deg"),Number(t)*(Hu[r]||1)),s:Number(e[3]),l:Number(e[4]),a:e[5]===void 0?1:Number(e[5])/(e[6]?100:1)});return aa(i)},"hsl"]],object:[[function(s){var e=s.r,t=s.g,r=s.b,i=s.a,n=i===void 0?1:i;return Xe(e)&&Xe(t)&&Xe(r)?ta({r:Number(e),g:Number(t),b:Number(r),a:Number(n)}):null},"rgb"],[function(s){var e=s.h,t=s.s,r=s.l,i=s.a,n=i===void 0?1:i;if(!Xe(e)||!Xe(t)||!Xe(r))return null;var a=ia({h:Number(e),s:Number(t),l:Number(r),a:Number(n)});return aa(a)},"hsl"],[function(s){var e=s.h,t=s.s,r=s.v,i=s.a,n=i===void 0?1:i;if(!Xe(e)||!Xe(t)||!Xe(r))return null;var a=function(o){return{h:ea(o.h),s:Se(o.s,0,100),v:Se(o.v,0,100),a:Se(o.a)}}({h:Number(e),s:Number(t),v:Number(r),a:Number(n)});return sa(a)},"hsv"]]},oa=function(s,e){for(var t=0;t<e.length;t++){var r=e[t][0](s);if(r)return[r,e[t][1]]}return[null,void 0]},Wu=function(s){return typeof s=="string"?oa(s.trim(),Zs.string):typeof s=="object"&&s!==null?oa(s,Zs.object):[null,void 0]},Qs=function(s,e){var t=sr(s);return{h:t.h,s:Se(t.s+100*e,0,100),l:t.l,a:t.a}},Js=function(s){return(299*s.r+587*s.g+114*s.b)/1e3/255},ha=function(s,e){var t=sr(s);return{h:t.h,s:t.s,l:Se(t.l+100*e,0,100),a:t.a}},ei=function(){function s(e){this.parsed=Wu(e)[0],this.rgba=this.parsed||{r:0,g:0,b:0,a:1}}return s.prototype.isValid=function(){return this.parsed!==null},s.prototype.brightness=function(){return de(Js(this.rgba),2)},s.prototype.isDark=function(){return Js(this.rgba)<.5},s.prototype.isLight=function(){return Js(this.rgba)>=.5},s.prototype.toHex=function(){return e=Ks(this.rgba),t=e.r,r=e.g,i=e.b,a=(n=e.a)<1?Or(de(255*n)):"","#"+Or(t)+Or(r)+Or(i)+a;var e,t,r,i,n,a},s.prototype.toRgb=function(){return Ks(this.rgba)},s.prototype.toRgbString=function(){return e=Ks(this.rgba),t=e.r,r=e.g,i=e.b,(n=e.a)<1?"rgba("+t+", "+r+", "+i+", "+n+")":"rgb("+t+", "+r+", "+i+")";var e,t,r,i,n},s.prototype.toHsl=function(){return na(sr(this.rgba))},s.prototype.toHslString=function(){return e=na(sr(this.rgba)),t=e.h,r=e.s,i=e.l,(n=e.a)<1?"hsla("+t+", "+r+"%, "+i+"%, "+n+")":"hsl("+t+", "+r+"%, "+i+"%)";var e,t,r,i,n},s.prototype.toHsv=function(){return e=ra(this.rgba),{h:de(e.h),s:de(e.s),v:de(e.v),a:de(e.a,3)};var e},s.prototype.invert=function(){return De({r:255-(e=this.rgba).r,g:255-e.g,b:255-e.b,a:e.a});var e},s.prototype.saturate=function(e){return e===void 0&&(e=.1),De(Qs(this.rgba,e))},s.prototype.desaturate=function(e){return e===void 0&&(e=.1),De(Qs(this.rgba,-e))},s.prototype.grayscale=function(){return De(Qs(this.rgba,-1))},s.prototype.lighten=function(e){return e===void 0&&(e=.1),De(ha(this.rgba,e))},s.prototype.darken=function(e){return e===void 0&&(e=.1),De(ha(this.rgba,-e))},s.prototype.rotate=function(e){return e===void 0&&(e=15),this.hue(this.hue()+e)},s.prototype.alpha=function(e){return typeof e=="number"?De({r:(t=this.rgba).r,g:t.g,b:t.b,a:e}):de(this.rgba.a,3);var t},s.prototype.hue=function(e){var t=sr(this.rgba);return typeof e=="number"?De({h:e,s:t.s,l:t.l,a:t.a}):de(t.h)},s.prototype.isEqual=function(e){return this.toHex()===De(e).toHex()},s}(),De=function(s){return s instanceof ei?s:new ei(s)},la=[],Yu=function(s){s.forEach(function(e){la.indexOf(e)<0&&(e(ei,Zs),la.push(e))})};function Ku(s,e){var t={white:"#ffffff",bisque:"#ffe4c4",blue:"#0000ff",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",antiquewhite:"#faebd7",aqua:"#00ffff",azure:"#f0ffff",whitesmoke:"#f5f5f5",papayawhip:"#ffefd5",plum:"#dda0dd",blanchedalmond:"#ffebcd",black:"#000000",gold:"#ffd700",goldenrod:"#daa520",gainsboro:"#dcdcdc",cornsilk:"#fff8dc",cornflowerblue:"#6495ed",burlywood:"#deb887",aquamarine:"#7fffd4",beige:"#f5f5dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkkhaki:"#bdb76b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",peachpuff:"#ffdab9",darkmagenta:"#8b008b",darkred:"#8b0000",darkorchid:"#9932cc",darkorange:"#ff8c00",darkslateblue:"#483d8b",gray:"#808080",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",deeppink:"#ff1493",deepskyblue:"#00bfff",wheat:"#f5deb3",firebrick:"#b22222",floralwhite:"#fffaf0",ghostwhite:"#f8f8ff",darkviolet:"#9400d3",magenta:"#ff00ff",green:"#008000",dodgerblue:"#1e90ff",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",blueviolet:"#8a2be2",forestgreen:"#228b22",lawngreen:"#7cfc00",indianred:"#cd5c5c",indigo:"#4b0082",fuchsia:"#ff00ff",brown:"#a52a2a",maroon:"#800000",mediumblue:"#0000cd",lightcoral:"#f08080",darkturquoise:"#00ced1",lightcyan:"#e0ffff",ivory:"#fffff0",lightyellow:"#ffffe0",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",linen:"#faf0e6",mediumaquamarine:"#66cdaa",lemonchiffon:"#fffacd",lime:"#00ff00",khaki:"#f0e68c",mediumseagreen:"#3cb371",limegreen:"#32cd32",mediumspringgreen:"#00fa9a",lightskyblue:"#87cefa",lightblue:"#add8e6",midnightblue:"#191970",lightpink:"#ffb6c1",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",mintcream:"#f5fffa",lightslategray:"#778899",lightslategrey:"#778899",navajowhite:"#ffdead",navy:"#000080",mediumvioletred:"#c71585",powderblue:"#b0e0e6",palegoldenrod:"#eee8aa",oldlace:"#fdf5e6",paleturquoise:"#afeeee",mediumturquoise:"#48d1cc",mediumorchid:"#ba55d3",rebeccapurple:"#663399",lightsteelblue:"#b0c4de",mediumslateblue:"#7b68ee",thistle:"#d8bfd8",tan:"#d2b48c",orchid:"#da70d6",mediumpurple:"#9370db",purple:"#800080",pink:"#ffc0cb",skyblue:"#87ceeb",springgreen:"#00ff7f",palegreen:"#98fb98",red:"#ff0000",yellow:"#ffff00",slateblue:"#6a5acd",lavenderblush:"#fff0f5",peru:"#cd853f",palevioletred:"#db7093",violet:"#ee82ee",teal:"#008080",slategray:"#708090",slategrey:"#708090",aliceblue:"#f0f8ff",darkseagreen:"#8fbc8f",darkolivegreen:"#556b2f",greenyellow:"#adff2f",seagreen:"#2e8b57",seashell:"#fff5ee",tomato:"#ff6347",silver:"#c0c0c0",sienna:"#a0522d",lavender:"#e6e6fa",lightgreen:"#90ee90",orange:"#ffa500",orangered:"#ff4500",steelblue:"#4682b4",royalblue:"#4169e1",turquoise:"#40e0d0",yellowgreen:"#9acd32",salmon:"#fa8072",saddlebrown:"#8b4513",sandybrown:"#f4a460",rosybrown:"#bc8f8f",darksalmon:"#e9967a",lightgoldenrodyellow:"#fafad2",snow:"#fffafa",lightgrey:"#d3d3d3",lightgray:"#d3d3d3",dimgray:"#696969",dimgrey:"#696969",olivedrab:"#6b8e23",olive:"#808000"},r={};for(var i in t)r[t[i]]=i;var n={};s.prototype.toName=function(a){if(!(this.rgba.a||this.rgba.r||this.rgba.g||this.rgba.b))return"transparent";var o,h,l=r[this.toHex()];if(l)return l;if(a!=null&&a.closest){var u=this.toRgb(),c=1/0,d="black";if(!n.length)for(var f in t)n[f]=new s(t[f]).toRgb();for(var p in t){var m=(o=u,h=n[p],Math.pow(o.r-h.r,2)+Math.pow(o.g-h.g,2)+Math.pow(o.b-h.b,2));m<c&&(c=m,d=p)}return d}},e.string.push([function(a){var o=a.toLowerCase(),h=o==="transparent"?"#0000":t[o];return h?new s(h).toRgb():null},"name"])}Yu([Ku]);const kt=class is{constructor(e=16777215){this._value=null,this._components=new Float32Array(4),this._components.fill(1),this._int=16777215,this.value=e}get red(){return this._components[0]}get green(){return this._components[1]}get blue(){return this._components[2]}get alpha(){return this._components[3]}setValue(e){return this.value=e,this}set value(e){if(e instanceof is)this._value=this.cloneSource(e._value),this._int=e._int,this._components.set(e._components);else{if(e===null)throw new Error("Cannot set PIXI.Color#value to null");(this._value===null||!this.isSourceEqual(this._value,e))&&(this.normalize(e),this._value=this.cloneSource(e))}}get value(){return this._value}cloneSource(e){return typeof e=="string"||typeof e=="number"||e instanceof Number||e===null?e:Array.isArray(e)||ArrayBuffer.isView(e)?e.slice(0):typeof e=="object"&&e!==null?{...e}:e}isSourceEqual(e,t){const r=typeof e;if(r!==typeof t)return!1;if(r==="number"||r==="string"||e instanceof Number)return e===t;if(Array.isArray(e)&&Array.isArray(t)||ArrayBuffer.isView(e)&&ArrayBuffer.isView(t))return e.length!==t.length?!1:e.every((i,n)=>i===t[n]);if(e!==null&&t!==null){const i=Object.keys(e),n=Object.keys(t);return i.length!==n.length?!1:i.every(a=>e[a]===t[a])}return e===t}toRgba(){const[e,t,r,i]=this._components;return{r:e,g:t,b:r,a:i}}toRgb(){const[e,t,r]=this._components;return{r:e,g:t,b:r}}toRgbaString(){const[e,t,r]=this.toUint8RgbArray();return`rgba(${e},${t},${r},${this.alpha})`}toUint8RgbArray(e){const[t,r,i]=this._components;return e=e??[],e[0]=Math.round(t*255),e[1]=Math.round(r*255),e[2]=Math.round(i*255),e}toRgbArray(e){e=e??[];const[t,r,i]=this._components;return e[0]=t,e[1]=r,e[2]=i,e}toNumber(){return this._int}toLittleEndianNumber(){const e=this._int;return(e>>16)+(e&65280)+((e&255)<<16)}multiply(e){const[t,r,i,n]=is.temp.setValue(e)._components;return this._components[0]*=t,this._components[1]*=r,this._components[2]*=i,this._components[3]*=n,this.refreshInt(),this._value=null,this}premultiply(e,t=!0){return t&&(this._components[0]*=e,this._components[1]*=e,this._components[2]*=e),this._components[3]=e,this.refreshInt(),this._value=null,this}toPremultiplied(e,t=!0){if(e===1)return(255<<24)+this._int;if(e===0)return t?0:this._int;let r=this._int>>16&255,i=this._int>>8&255,n=this._int&255;return t&&(r=r*e+.5|0,i=i*e+.5|0,n=n*e+.5|0),(e*255<<24)+(r<<16)+(i<<8)+n}toHex(){const e=this._int.toString(16);return`#${"000000".substring(0,6-e.length)+e}`}toHexa(){const e=Math.round(this._components[3]*255).toString(16);return this.toHex()+"00".substring(0,2-e.length)+e}setAlpha(e){return this._components[3]=this._clamp(e),this}round(e){const[t,r,i]=this._components;return this._components[0]=Math.round(t*e)/e,this._components[1]=Math.round(r*e)/e,this._components[2]=Math.round(i*e)/e,this.refreshInt(),this._value=null,this}toArray(e){e=e??[];const[t,r,i,n]=this._components;return e[0]=t,e[1]=r,e[2]=i,e[3]=n,e}normalize(e){let t,r,i,n;if((typeof e=="number"||e instanceof Number)&&e>=0&&e<=16777215){const a=e;t=(a>>16&255)/255,r=(a>>8&255)/255,i=(a&255)/255,n=1}else if((Array.isArray(e)||e instanceof Float32Array)&&e.length>=3&&e.length<=4)e=this._clamp(e),[t,r,i,n=1]=e;else if((e instanceof Uint8Array||e instanceof Uint8ClampedArray)&&e.length>=3&&e.length<=4)e=this._clamp(e,0,255),[t,r,i,n=255]=e,t/=255,r/=255,i/=255,n/=255;else if(typeof e=="string"||typeof e=="object"){if(typeof e=="string"){const o=is.HEX_PATTERN.exec(e);o&&(e=`#${o[2]}`)}const a=De(e);a.isValid()&&({r:t,g:r,b:i,a:n}=a.rgba,t/=255,r/=255,i/=255)}if(t!==void 0)this._components[0]=t,this._components[1]=r,this._components[2]=i,this._components[3]=n,this.refreshInt();else throw new Error(`Unable to convert color ${e}`)}refreshInt(){this._clamp(this._components);const[e,t,r]=this._components;this._int=(e*255<<16)+(t*255<<8)+(r*255|0)}_clamp(e,t=0,r=1){return typeof e=="number"?Math.min(Math.max(e,t),r):(e.forEach((i,n)=>{e[n]=Math.min(Math.max(i,t),r)}),e)}};kt.shared=new kt,kt.temp=new kt,kt.HEX_PATTERN=/^(#|0x)?(([a-f0-9]{3}){1,2}([a-f0-9]{2})?)$/i;let Bt=kt;function Zu(){const s=[],e=[];for(let r=0;r<32;r++)s[r]=r,e[r]=r;s[O.NORMAL_NPM]=O.NORMAL,s[O.ADD_NPM]=O.ADD,s[O.SCREEN_NPM]=O.SCREEN,e[O.NORMAL]=O.NORMAL_NPM,e[O.ADD]=O.ADD_NPM,e[O.SCREEN]=O.SCREEN_NPM;const t=[];return t.push(e),t.push(s),t}const Qu=Zu();function ua(s){if(s.BYTES_PER_ELEMENT===4)return s instanceof Float32Array?"Float32Array":s instanceof Uint32Array?"Uint32Array":"Int32Array";if(s.BYTES_PER_ELEMENT===2){if(s instanceof Uint16Array)return"Uint16Array"}else if(s.BYTES_PER_ELEMENT===1&&s instanceof Uint8Array)return"Uint8Array";return null}function Fr(s){return s+=s===0?1:0,--s,s|=s>>>1,s|=s>>>2,s|=s>>>4,s|=s>>>8,s|=s>>>16,s+1}function ca(s){return!(s&s-1)&&!!s}function da(s){let e=(s>65535?1:0)<<4;s>>>=e;let t=(s>255?1:0)<<3;return s>>>=t,e|=t,t=(s>15?1:0)<<2,s>>>=t,e|=t,t=(s>3?1:0)<<1,s>>>=t,e|=t,e|s>>1}function Dr(s,e,t){const r=s.length;let i;if(e>=r||t===0)return;t=e+t>r?r-e:t;const n=r-t;for(i=e;i<n;++i)s[i]=s[i+t];s.length=n}let Ju=0;function ir(){return++Ju}const fa={},ke=Object.create(null),Ze=Object.create(null);function ec(s,e=globalThis.location){if(s.startsWith("data:"))return"";e=e||globalThis.location;const t=new URL(s,document.baseURI);return t.hostname!==e.hostname||t.port!==e.port||t.protocol!==e.protocol?"anonymous":""}function pa(s,e=1){var r;const t=(r=H.RETINA_PREFIX)==null?void 0:r.exec(s);return t?parseFloat(t[1]):e}var U=(s=>(s.Renderer="renderer",s.Application="application",s.RendererSystem="renderer-webgl-system",s.RendererPlugin="renderer-webgl-plugin",s.CanvasRendererSystem="renderer-canvas-system",s.CanvasRendererPlugin="renderer-canvas-plugin",s.Asset="asset",s.LoadParser="load-parser",s.ResolveParser="resolve-parser",s.CacheParser="cache-parser",s.DetectionParser="detection-parser",s))(U||{});const ti=s=>{if(typeof s=="function"||typeof s=="object"&&s.extension){if(!s.extension)throw new Error("Extension class must have an extension object");s={...typeof s.extension!="object"?{type:s.extension}:s.extension,ref:s}}if(typeof s=="object")s={...s};else throw new Error("Invalid extension type");return typeof s.type=="string"&&(s.type=[s.type]),s},ma=(s,e)=>ti(s).priority??e,V={_addHandlers:{},_removeHandlers:{},_queue:{},remove(...s){return s.map(ti).forEach(e=>{e.type.forEach(t=>{var r,i;return(i=(r=this._removeHandlers)[t])==null?void 0:i.call(r,e)})}),this},add(...s){return s.map(ti).forEach(e=>{e.type.forEach(t=>{var n,a;const r=this._addHandlers,i=this._queue;r[t]?(n=r[t])==null||n.call(r,e):(i[t]=i[t]||[],(a=i[t])==null||a.push(e))})}),this},handle(s,e,t){var a;const r=this._addHandlers,i=this._removeHandlers;if(r[s]||i[s])throw new Error(`Extension type ${s} already has a handler`);r[s]=e,i[s]=t;const n=this._queue;return n[s]&&((a=n[s])==null||a.forEach(o=>e(o)),delete n[s]),this},handleByMap(s,e){return this.handle(s,t=>{t.name&&(e[t.name]=t.ref)},t=>{t.name&&delete e[t.name]})},handleByList(s,e,t=-1){return this.handle(s,r=>{e.includes(r.ref)||(e.push(r.ref),e.sort((i,n)=>ma(n,t)-ma(i,t)))},r=>{const i=e.indexOf(r.ref);i!==-1&&e.splice(i,1)})}};class tc{constructor(e){typeof e=="number"?this.rawBinaryData=new ArrayBuffer(e):e instanceof Uint8Array?this.rawBinaryData=e.buffer:this.rawBinaryData=e,this.uint32View=new Uint32Array(this.rawBinaryData),this.float32View=new Float32Array(this.rawBinaryData)}get int8View(){return this._int8View||(this._int8View=new Int8Array(this.rawBinaryData)),this._int8View}get uint8View(){return this._uint8View||(this._uint8View=new Uint8Array(this.rawBinaryData)),this._uint8View}get int16View(){return this._int16View||(this._int16View=new Int16Array(this.rawBinaryData)),this._int16View}get uint16View(){return this._uint16View||(this._uint16View=new Uint16Array(this.rawBinaryData)),this._uint16View}get int32View(){return this._int32View||(this._int32View=new Int32Array(this.rawBinaryData)),this._int32View}view(e){return this[`${e}View`]}destroy(){this.rawBinaryData=null,this._int8View=null,this._uint8View=null,this._int16View=null,this._uint16View=null,this._int32View=null,this.uint32View=null,this.float32View=null}static sizeOf(e){switch(e){case"int8":case"uint8":return 1;case"int16":case"uint16":return 2;case"int32":case"uint32":case"float32":return 4;default:throw new Error(`${e} isn't a valid view type`)}}}const rc=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join(`
`);function sc(s){let e="";for(let t=0;t<s;++t)t>0&&(e+=`
else `),t<s-1&&(e+=`if(test == ${t}.0){}`);return e}function ic(s,e){if(s===0)throw new Error("Invalid value of `0` passed to `checkMaxIfStatementsInShader`");const t=e.createShader(e.FRAGMENT_SHADER);for(;;){const r=rc.replace(/%forloop%/gi,sc(s));if(e.shaderSource(t,r),e.compileShader(t),!e.getShaderParameter(t,e.COMPILE_STATUS))s=s/2|0;else break}return s}const ri=0,si=1,ii=2,ni=3,ai=4,oi=5;class Vt{constructor(){this.data=0,this.blendMode=O.NORMAL,this.polygonOffset=0,this.blend=!0,this.depthMask=!0}get blend(){return!!(this.data&1<<ri)}set blend(e){!!(this.data&1<<ri)!==e&&(this.data^=1<<ri)}get offsets(){return!!(this.data&1<<si)}set offsets(e){!!(this.data&1<<si)!==e&&(this.data^=1<<si)}get culling(){return!!(this.data&1<<ii)}set culling(e){!!(this.data&1<<ii)!==e&&(this.data^=1<<ii)}get depthTest(){return!!(this.data&1<<ni)}set depthTest(e){!!(this.data&1<<ni)!==e&&(this.data^=1<<ni)}get depthMask(){return!!(this.data&1<<oi)}set depthMask(e){!!(this.data&1<<oi)!==e&&(this.data^=1<<oi)}get clockwiseFrontFace(){return!!(this.data&1<<ai)}set clockwiseFrontFace(e){!!(this.data&1<<ai)!==e&&(this.data^=1<<ai)}get blendMode(){return this._blendMode}set blendMode(e){this.blend=e!==O.NONE,this._blendMode=e}get polygonOffset(){return this._polygonOffset}set polygonOffset(e){this.offsets=!!e,this._polygonOffset=e}static for2d(){const e=new Vt;return e.depthTest=!1,e.blend=!0,e}}Vt.prototype.toString=function(){return`[@pixi/core:State blendMode=${this.blendMode} clockwiseFrontFace=${this.clockwiseFrontFace} culling=${this.culling} depthMask=${this.depthMask} polygonOffset=${this.polygonOffset}]`};const hi=[];function ya(s,e){if(!s)return null;let t="";if(typeof s=="string"){const r=/\.(\w{3,4})(?:$|\?|#)/i.exec(s);r&&(t=r[1].toLowerCase())}for(let r=hi.length-1;r>=0;--r){const i=hi[r];if(i.test&&i.test(s,t))return new i(s,e)}throw new Error("Unrecognized source type to auto-detect Resource")}class Ie{constructor(e){this.items=[],this._name=e,this._aliasCount=0}emit(e,t,r,i,n,a,o,h){if(arguments.length>8)throw new Error("max arguments reached");const{name:l,items:u}=this;this._aliasCount++;for(let c=0,d=u.length;c<d;c++)u[c][l](e,t,r,i,n,a,o,h);return u===this.items&&this._aliasCount--,this}ensureNonAliasedItems(){this._aliasCount>0&&this.items.length>1&&(this._aliasCount=0,this.items=this.items.slice(0))}add(e){return e[this._name]&&(this.ensureNonAliasedItems(),this.remove(e),this.items.push(e)),this}remove(e){const t=this.items.indexOf(e);return t!==-1&&(this.ensureNonAliasedItems(),this.items.splice(t,1)),this}contains(e){return this.items.includes(e)}removeAll(){return this.ensureNonAliasedItems(),this.items.length=0,this}destroy(){this.removeAll(),this.items.length=0,this._name=""}get empty(){return this.items.length===0}get name(){return this._name}}Object.defineProperties(Ie.prototype,{dispatch:{value:Ie.prototype.emit},run:{value:Ie.prototype.emit}});class nr{constructor(e=0,t=0){this._width=e,this._height=t,this.destroyed=!1,this.internal=!1,this.onResize=new Ie("setRealSize"),this.onUpdate=new Ie("update"),this.onError=new Ie("onError")}bind(e){this.onResize.add(e),this.onUpdate.add(e),this.onError.add(e),(this._width||this._height)&&this.onResize.emit(this._width,this._height)}unbind(e){this.onResize.remove(e),this.onUpdate.remove(e),this.onError.remove(e)}resize(e,t){(e!==this._width||t!==this._height)&&(this._width=e,this._height=t,this.onResize.emit(e,t))}get valid(){return!!this._width&&!!this._height}update(){this.destroyed||this.onUpdate.emit()}load(){return Promise.resolve(this)}get width(){return this._width}get height(){return this._height}style(e,t,r){return!1}dispose(){}destroy(){this.destroyed||(this.destroyed=!0,this.dispose(),this.onError.removeAll(),this.onError=null,this.onResize.removeAll(),this.onResize=null,this.onUpdate.removeAll(),this.onUpdate=null)}static test(e,t){return!1}}class ga extends nr{constructor(e,t){const{width:r,height:i}=t||{};if(!r||!i)throw new Error("BufferResource width or height invalid");super(r,i),this.data=e,this.unpackAlignment=t.unpackAlignment??4}upload(e,t,r){const i=e.gl;i.pixelStorei(i.UNPACK_ALIGNMENT,this.unpackAlignment),i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.alphaMode===at.UNPACK);const n=t.realWidth,a=t.realHeight;return r.width===n&&r.height===a?i.texSubImage2D(t.target,0,0,0,n,a,t.format,r.type,this.data):(r.width=n,r.height=a,i.texImage2D(t.target,0,r.internalFormat,n,a,0,t.format,r.type,this.data)),!0}dispose(){this.data=null}static test(e){return e===null||e instanceof Int8Array||e instanceof Uint8Array||e instanceof Uint8ClampedArray||e instanceof Int16Array||e instanceof Uint16Array||e instanceof Int32Array||e instanceof Uint32Array||e instanceof Float32Array}}const nc={scaleMode:He.NEAREST,alphaMode:at.NPM},li=class Ht extends xr{constructor(e=null,t=null){super(),t=Object.assign({},Ht.defaultOptions,t);const{alphaMode:r,mipmap:i,anisotropicLevel:n,scaleMode:a,width:o,height:h,wrapMode:l,format:u,type:c,target:d,resolution:f,resourceOptions:p}=t;e&&!(e instanceof nr)&&(e=ya(e,p),e.internal=!0),this.resolution=f||H.RESOLUTION,this.width=Math.round((o||0)*this.resolution)/this.resolution,this.height=Math.round((h||0)*this.resolution)/this.resolution,this._mipmap=i,this.anisotropicLevel=n,this._wrapMode=l,this._scaleMode=a,this.format=u,this.type=c,this.target=d,this.alphaMode=r,this.uid=ir(),this.touched=0,this.isPowerOfTwo=!1,this._refreshPOT(),this._glTextures={},this.dirtyId=0,this.dirtyStyleId=0,this.cacheId=null,this.valid=o>0&&h>0,this.textureCacheIds=[],this.destroyed=!1,this.resource=null,this._batchEnabled=0,this._batchLocation=0,this.parentTextureArray=null,this.setResource(e)}get realWidth(){return Math.round(this.width*this.resolution)}get realHeight(){return Math.round(this.height*this.resolution)}get mipmap(){return this._mipmap}set mipmap(e){this._mipmap!==e&&(this._mipmap=e,this.dirtyStyleId++)}get scaleMode(){return this._scaleMode}set scaleMode(e){this._scaleMode!==e&&(this._scaleMode=e,this.dirtyStyleId++)}get wrapMode(){return this._wrapMode}set wrapMode(e){this._wrapMode!==e&&(this._wrapMode=e,this.dirtyStyleId++)}setStyle(e,t){let r;return e!==void 0&&e!==this.scaleMode&&(this.scaleMode=e,r=!0),t!==void 0&&t!==this.mipmap&&(this.mipmap=t,r=!0),r&&this.dirtyStyleId++,this}setSize(e,t,r){return r=r||this.resolution,this.setRealSize(e*r,t*r,r)}setRealSize(e,t,r){return this.resolution=r||this.resolution,this.width=Math.round(e)/this.resolution,this.height=Math.round(t)/this.resolution,this._refreshPOT(),this.update(),this}_refreshPOT(){this.isPowerOfTwo=ca(this.realWidth)&&ca(this.realHeight)}setResolution(e){const t=this.resolution;return t===e?this:(this.resolution=e,this.valid&&(this.width=Math.round(this.width*t)/e,this.height=Math.round(this.height*t)/e,this.emit("update",this)),this._refreshPOT(),this)}setResource(e){if(this.resource===e)return this;if(this.resource)throw new Error("Resource can be set only once");return e.bind(this),this.resource=e,this}update(){this.valid?(this.dirtyId++,this.dirtyStyleId++,this.emit("update",this)):this.width>0&&this.height>0&&(this.valid=!0,this.emit("loaded",this),this.emit("update",this))}onError(e){this.emit("error",this,e)}destroy(){this.resource&&(this.resource.unbind(this),this.resource.internal&&this.resource.destroy(),this.resource=null),this.cacheId&&(delete Ze[this.cacheId],delete ke[this.cacheId],this.cacheId=null),this.valid=!1,this.dispose(),Ht.removeFromCache(this),this.textureCacheIds=null,this.destroyed=!0,this.emit("destroyed",this),this.removeAllListeners()}dispose(){this.emit("dispose",this)}castToBaseTexture(){return this}static from(e,t,r=H.STRICT_TEXTURE_CACHE){const i=typeof e=="string";let n=null;if(i)n=e;else{if(!e._pixiId){const o=(t==null?void 0:t.pixiIdPrefix)||"pixiid";e._pixiId=`${o}_${ir()}`}n=e._pixiId}let a=Ze[n];if(i&&r&&!a)throw new Error(`The cacheId "${n}" does not exist in BaseTextureCache.`);return a||(a=new Ht(e,t),a.cacheId=n,Ht.addToCache(a,n)),a}static fromBuffer(e,t,r,i){e=e||new Float32Array(t*r*4);const n=new ga(e,{width:t,height:r,...i==null?void 0:i.resourceOptions});let a,o;return e instanceof Float32Array?(a=M.RGBA,o=B.FLOAT):e instanceof Int32Array?(a=M.RGBA_INTEGER,o=B.INT):e instanceof Uint32Array?(a=M.RGBA_INTEGER,o=B.UNSIGNED_INT):e instanceof Int16Array?(a=M.RGBA_INTEGER,o=B.SHORT):e instanceof Uint16Array?(a=M.RGBA_INTEGER,o=B.UNSIGNED_SHORT):e instanceof Int8Array?(a=M.RGBA,o=B.BYTE):(a=M.RGBA,o=B.UNSIGNED_BYTE),n.internal=!0,new Ht(n,Object.assign({},nc,{type:o,format:a},i))}static addToCache(e,t){t&&(e.textureCacheIds.includes(t)||e.textureCacheIds.push(t),Ze[t]&&Ze[t]!==e&&console.warn(`BaseTexture added to the cache with an id [${t}] that already had an entry`),Ze[t]=e)}static removeFromCache(e){if(typeof e=="string"){const t=Ze[e];if(t){const r=t.textureCacheIds.indexOf(e);return r>-1&&t.textureCacheIds.splice(r,1),delete Ze[e],t}}else if(e!=null&&e.textureCacheIds){for(let t=0;t<e.textureCacheIds.length;++t)delete Ze[e.textureCacheIds[t]];return e.textureCacheIds.length=0,e}return null}};li.defaultOptions={mipmap:nt.POW2,anisotropicLevel:0,scaleMode:He.LINEAR,wrapMode:fs.CLAMP,alphaMode:at.UNPACK,target:Et.TEXTURE_2D,format:M.RGBA,type:B.UNSIGNED_BYTE},li._globalBatch=0;let W=li;class ac{constructor(){this.texArray=null,this.blend=0,this.type=gr.TRIANGLES,this.start=0,this.size=0,this.data=null}}let oc=0;class ge{constructor(e,t=!0,r=!1){this.data=e||new Float32Array(1),this._glBuffers={},this._updateID=0,this.index=r,this.static=t,this.id=oc++,this.disposeRunner=new Ie("disposeBuffer")}update(e){e instanceof Array&&(e=new Float32Array(e)),this.data=e||this.data,this._updateID++}dispose(){this.disposeRunner.emit(this,!1)}destroy(){this.dispose(),this.data=null}set index(e){this.type=e?Ne.ELEMENT_ARRAY_BUFFER:Ne.ARRAY_BUFFER}get index(){return this.type===Ne.ELEMENT_ARRAY_BUFFER}static from(e){return e instanceof Array&&(e=new Float32Array(e)),new ge(e)}}class hs{constructor(e,t=0,r=!1,i=B.FLOAT,n,a,o,h=1){this.buffer=e,this.size=t,this.normalized=r,this.type=i,this.stride=n,this.start=a,this.instance=o,this.divisor=h}destroy(){this.buffer=null}static from(e,t,r,i,n){return new hs(e,t,r,i,n)}}const hc={Float32Array,Uint32Array,Int32Array,Uint8Array};function lc(s,e){let t=0,r=0;const i={};for(let h=0;h<s.length;h++)r+=e[h],t+=s[h].length;const n=new ArrayBuffer(t*4);let a=null,o=0;for(let h=0;h<s.length;h++){const l=e[h],u=s[h],c=ua(u);i[c]||(i[c]=new hc[c](n)),a=i[c];for(let d=0;d<u.length;d++){const f=(d/l|0)*r+o,p=d%l;a[f+p]=u[d]}o+=l}return new Float32Array(n)}const ba={5126:4,5123:2,5121:1};let uc=0;const cc={Float32Array,Uint32Array,Int32Array,Uint8Array,Uint16Array};class qt{constructor(e=[],t={}){this.buffers=e,this.indexBuffer=null,this.attributes=t,this.glVertexArrayObjects={},this.id=uc++,this.instanced=!1,this.instanceCount=1,this.disposeRunner=new Ie("disposeGeometry"),this.refCount=0}addAttribute(e,t,r=0,i=!1,n,a,o,h=!1){if(!t)throw new Error("You must pass a buffer when creating an attribute");t instanceof ge||(t instanceof Array&&(t=new Float32Array(t)),t=new ge(t));const l=e.split("|");if(l.length>1){for(let c=0;c<l.length;c++)this.addAttribute(l[c],t,r,i,n);return this}let u=this.buffers.indexOf(t);return u===-1&&(this.buffers.push(t),u=this.buffers.length-1),this.attributes[e]=new hs(u,r,i,n,a,o,h),this.instanced=this.instanced||h,this}getAttribute(e){return this.attributes[e]}getBuffer(e){return this.buffers[this.getAttribute(e).buffer]}addIndex(e){return e instanceof ge||(e instanceof Array&&(e=new Uint16Array(e)),e=new ge(e)),e.type=Ne.ELEMENT_ARRAY_BUFFER,this.indexBuffer=e,this.buffers.includes(e)||this.buffers.push(e),this}getIndex(){return this.indexBuffer}interleave(){if(this.buffers.length===1||this.buffers.length===2&&this.indexBuffer)return this;const e=[],t=[],r=new ge;let i;for(i in this.attributes){const n=this.attributes[i],a=this.buffers[n.buffer];e.push(a.data),t.push(n.size*ba[n.type]/4),n.buffer=0}for(r.data=lc(e,t),i=0;i<this.buffers.length;i++)this.buffers[i]!==this.indexBuffer&&this.buffers[i].destroy();return this.buffers=[r],this.indexBuffer&&this.buffers.push(this.indexBuffer),this}getSize(){for(const e in this.attributes){const t=this.attributes[e];return this.buffers[t.buffer].data.length/(t.stride/4||t.size)}return 0}dispose(){this.disposeRunner.emit(this,!1)}destroy(){this.dispose(),this.buffers=null,this.indexBuffer=null,this.attributes=null}clone(){const e=new qt;for(let t=0;t<this.buffers.length;t++)e.buffers[t]=new ge(this.buffers[t].data.slice(0));for(const t in this.attributes){const r=this.attributes[t];e.attributes[t]=new hs(r.buffer,r.size,r.normalized,r.type,r.stride,r.start,r.instance)}return this.indexBuffer&&(e.indexBuffer=e.buffers[this.buffers.indexOf(this.indexBuffer)],e.indexBuffer.type=Ne.ELEMENT_ARRAY_BUFFER),e}static merge(e){const t=new qt,r=[],i=[],n=[];let a;for(let o=0;o<e.length;o++){a=e[o];for(let h=0;h<a.buffers.length;h++)i[h]=i[h]||0,i[h]+=a.buffers[h].data.length,n[h]=0}for(let o=0;o<a.buffers.length;o++)r[o]=new cc[ua(a.buffers[o].data)](i[o]),t.buffers[o]=new ge(r[o]);for(let o=0;o<e.length;o++){a=e[o];for(let h=0;h<a.buffers.length;h++)r[h].set(a.buffers[h].data,n[h]),n[h]+=a.buffers[h].data.length}if(t.attributes=a.attributes,a.indexBuffer){t.indexBuffer=t.buffers[a.buffers.indexOf(a.indexBuffer)],t.indexBuffer.type=Ne.ELEMENT_ARRAY_BUFFER;let o=0,h=0,l=0,u=0;for(let c=0;c<a.buffers.length;c++)if(a.buffers[c]!==a.indexBuffer){u=c;break}for(const c in a.attributes){const d=a.attributes[c];(d.buffer|0)===u&&(h+=d.size*ba[d.type]/4)}for(let c=0;c<e.length;c++){const d=e[c].indexBuffer.data;for(let f=0;f<d.length;f++)t.indexBuffer.data[f+l]+=o;o+=e[c].buffers[u].data.length/h,l+=d.length}}return t}}class dc extends qt{constructor(e=!1){super(),this._buffer=new ge(null,e,!1),this._indexBuffer=new ge(null,e,!0),this.addAttribute("aVertexPosition",this._buffer,2,!1,B.FLOAT).addAttribute("aTextureCoord",this._buffer,2,!1,B.FLOAT).addAttribute("aColor",this._buffer,4,!0,B.UNSIGNED_BYTE).addAttribute("aTextureId",this._buffer,1,!0,B.FLOAT).addIndex(this._indexBuffer)}}const fc=Math.PI*2,pc=180/Math.PI,mc=Math.PI/180;var xa=(s=>(s[s.POLY=0]="POLY",s[s.RECT=1]="RECT",s[s.CIRC=2]="CIRC",s[s.ELIP=3]="ELIP",s[s.RREC=4]="RREC",s))(xa||{});class be{constructor(e=0,t=0){this.x=0,this.y=0,this.x=e,this.y=t}clone(){return new be(this.x,this.y)}copyFrom(e){return this.set(e.x,e.y),this}copyTo(e){return e.set(this.x,this.y),e}equals(e){return e.x===this.x&&e.y===this.y}set(e=0,t=e){return this.x=e,this.y=t,this}}be.prototype.toString=function(){return`[@pixi/math:Point x=${this.x} y=${this.y}]`};const kr=[new be,new be,new be,new be];class Q{constructor(e=0,t=0,r=0,i=0){this.x=Number(e),this.y=Number(t),this.width=Number(r),this.height=Number(i),this.type=xa.RECT}get left(){return this.x}get right(){return this.x+this.width}get top(){return this.y}get bottom(){return this.y+this.height}static get EMPTY(){return new Q(0,0,0,0)}clone(){return new Q(this.x,this.y,this.width,this.height)}copyFrom(e){return this.x=e.x,this.y=e.y,this.width=e.width,this.height=e.height,this}copyTo(e){return e.x=this.x,e.y=this.y,e.width=this.width,e.height=this.height,e}contains(e,t){return this.width<=0||this.height<=0?!1:e>=this.x&&e<this.x+this.width&&t>=this.y&&t<this.y+this.height}intersects(e,t){if(!t){const w=this.x<e.x?e.x:this.x;if((this.right>e.right?e.right:this.right)<=w)return!1;const S=this.y<e.y?e.y:this.y;return(this.bottom>e.bottom?e.bottom:this.bottom)>S}const r=this.left,i=this.right,n=this.top,a=this.bottom;if(i<=r||a<=n)return!1;const o=kr[0].set(e.left,e.top),h=kr[1].set(e.left,e.bottom),l=kr[2].set(e.right,e.top),u=kr[3].set(e.right,e.bottom);if(l.x<=o.x||h.y<=o.y)return!1;const c=Math.sign(t.a*t.d-t.b*t.c);if(c===0||(t.apply(o,o),t.apply(h,h),t.apply(l,l),t.apply(u,u),Math.max(o.x,h.x,l.x,u.x)<=r||Math.min(o.x,h.x,l.x,u.x)>=i||Math.max(o.y,h.y,l.y,u.y)<=n||Math.min(o.y,h.y,l.y,u.y)>=a))return!1;const d=c*(h.y-o.y),f=c*(o.x-h.x),p=d*r+f*n,m=d*i+f*n,y=d*r+f*a,x=d*i+f*a;if(Math.max(p,m,y,x)<=d*o.x+f*o.y||Math.min(p,m,y,x)>=d*u.x+f*u.y)return!1;const b=c*(o.y-l.y),g=c*(l.x-o.x),v=b*r+g*n,_=b*i+g*n,T=b*r+g*a,E=b*i+g*a;return!(Math.max(v,_,T,E)<=b*o.x+g*o.y||Math.min(v,_,T,E)>=b*u.x+g*u.y)}pad(e=0,t=e){return this.x-=e,this.y-=t,this.width+=e*2,this.height+=t*2,this}fit(e){const t=Math.max(this.x,e.x),r=Math.min(this.x+this.width,e.x+e.width),i=Math.max(this.y,e.y),n=Math.min(this.y+this.height,e.y+e.height);return this.x=t,this.width=Math.max(r-t,0),this.y=i,this.height=Math.max(n-i,0),this}ceil(e=1,t=.001){const r=Math.ceil((this.x+this.width-t)*e)/e,i=Math.ceil((this.y+this.height-t)*e)/e;return this.x=Math.floor((this.x+t)*e)/e,this.y=Math.floor((this.y+t)*e)/e,this.width=r-this.x,this.height=i-this.y,this}enlarge(e){const t=Math.min(this.x,e.x),r=Math.max(this.x+this.width,e.x+e.width),i=Math.min(this.y,e.y),n=Math.max(this.y+this.height,e.y+e.height);return this.x=t,this.width=r-t,this.y=i,this.height=n-i,this}}Q.prototype.toString=function(){return`[@pixi/math:Rectangle x=${this.x} y=${this.y} width=${this.width} height=${this.height}]`};class ue{constructor(e=1,t=0,r=0,i=1,n=0,a=0){this.array=null,this.a=e,this.b=t,this.c=r,this.d=i,this.tx=n,this.ty=a}fromArray(e){this.a=e[0],this.b=e[1],this.c=e[3],this.d=e[4],this.tx=e[2],this.ty=e[5]}set(e,t,r,i,n,a){return this.a=e,this.b=t,this.c=r,this.d=i,this.tx=n,this.ty=a,this}toArray(e,t){this.array||(this.array=new Float32Array(9));const r=t||this.array;return e?(r[0]=this.a,r[1]=this.b,r[2]=0,r[3]=this.c,r[4]=this.d,r[5]=0,r[6]=this.tx,r[7]=this.ty,r[8]=1):(r[0]=this.a,r[1]=this.c,r[2]=this.tx,r[3]=this.b,r[4]=this.d,r[5]=this.ty,r[6]=0,r[7]=0,r[8]=1),r}apply(e,t){t=t||new be;const r=e.x,i=e.y;return t.x=this.a*r+this.c*i+this.tx,t.y=this.b*r+this.d*i+this.ty,t}applyInverse(e,t){t=t||new be;const r=1/(this.a*this.d+this.c*-this.b),i=e.x,n=e.y;return t.x=this.d*r*i+-this.c*r*n+(this.ty*this.c-this.tx*this.d)*r,t.y=this.a*r*n+-this.b*r*i+(-this.ty*this.a+this.tx*this.b)*r,t}translate(e,t){return this.tx+=e,this.ty+=t,this}scale(e,t){return this.a*=e,this.d*=t,this.c*=e,this.b*=t,this.tx*=e,this.ty*=t,this}rotate(e){const t=Math.cos(e),r=Math.sin(e),i=this.a,n=this.c,a=this.tx;return this.a=i*t-this.b*r,this.b=i*r+this.b*t,this.c=n*t-this.d*r,this.d=n*r+this.d*t,this.tx=a*t-this.ty*r,this.ty=a*r+this.ty*t,this}append(e){const t=this.a,r=this.b,i=this.c,n=this.d;return this.a=e.a*t+e.b*i,this.b=e.a*r+e.b*n,this.c=e.c*t+e.d*i,this.d=e.c*r+e.d*n,this.tx=e.tx*t+e.ty*i+this.tx,this.ty=e.tx*r+e.ty*n+this.ty,this}setTransform(e,t,r,i,n,a,o,h,l){return this.a=Math.cos(o+l)*n,this.b=Math.sin(o+l)*n,this.c=-Math.sin(o-h)*a,this.d=Math.cos(o-h)*a,this.tx=e-(r*this.a+i*this.c),this.ty=t-(r*this.b+i*this.d),this}prepend(e){const t=this.tx;if(e.a!==1||e.b!==0||e.c!==0||e.d!==1){const r=this.a,i=this.c;this.a=r*e.a+this.b*e.c,this.b=r*e.b+this.b*e.d,this.c=i*e.a+this.d*e.c,this.d=i*e.b+this.d*e.d}return this.tx=t*e.a+this.ty*e.c+e.tx,this.ty=t*e.b+this.ty*e.d+e.ty,this}decompose(e){const t=this.a,r=this.b,i=this.c,n=this.d,a=e.pivot,o=-Math.atan2(-i,n),h=Math.atan2(r,t),l=Math.abs(o+h);return l<1e-5||Math.abs(fc-l)<1e-5?(e.rotation=h,e.skew.x=e.skew.y=0):(e.rotation=0,e.skew.x=o,e.skew.y=h),e.scale.x=Math.sqrt(t*t+r*r),e.scale.y=Math.sqrt(i*i+n*n),e.position.x=this.tx+(a.x*t+a.y*i),e.position.y=this.ty+(a.x*r+a.y*n),e}invert(){const e=this.a,t=this.b,r=this.c,i=this.d,n=this.tx,a=e*i-t*r;return this.a=i/a,this.b=-t/a,this.c=-r/a,this.d=e/a,this.tx=(r*this.ty-i*n)/a,this.ty=-(e*this.ty-t*n)/a,this}identity(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this}clone(){const e=new ue;return e.a=this.a,e.b=this.b,e.c=this.c,e.d=this.d,e.tx=this.tx,e.ty=this.ty,e}copyTo(e){return e.a=this.a,e.b=this.b,e.c=this.c,e.d=this.d,e.tx=this.tx,e.ty=this.ty,e}copyFrom(e){return this.a=e.a,this.b=e.b,this.c=e.c,this.d=e.d,this.tx=e.tx,this.ty=e.ty,this}static get IDENTITY(){return new ue}static get TEMP_MATRIX(){return new ue}}ue.prototype.toString=function(){return`[@pixi/math:Matrix a=${this.a} b=${this.b} c=${this.c} d=${this.d} tx=${this.tx} ty=${this.ty}]`};const dt=[1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1,0,1],ft=[0,1,1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1],pt=[0,-1,-1,-1,0,1,1,1,0,1,1,1,0,-1,-1,-1],mt=[1,1,0,-1,-1,-1,0,1,-1,-1,0,1,1,1,0,-1],ui=[],va=[],Br=Math.sign;function yc(){for(let s=0;s<16;s++){const e=[];ui.push(e);for(let t=0;t<16;t++){const r=Br(dt[s]*dt[t]+pt[s]*ft[t]),i=Br(ft[s]*dt[t]+mt[s]*ft[t]),n=Br(dt[s]*pt[t]+pt[s]*mt[t]),a=Br(ft[s]*pt[t]+mt[s]*mt[t]);for(let o=0;o<16;o++)if(dt[o]===r&&ft[o]===i&&pt[o]===n&&mt[o]===a){e.push(o);break}}}for(let s=0;s<16;s++){const e=new ue;e.set(dt[s],ft[s],pt[s],mt[s],0,0),va.push(e)}}yc();const re={E:0,SE:1,S:2,SW:3,W:4,NW:5,N:6,NE:7,MIRROR_VERTICAL:8,MAIN_DIAGONAL:10,MIRROR_HORIZONTAL:12,REVERSE_DIAGONAL:14,uX:s=>dt[s],uY:s=>ft[s],vX:s=>pt[s],vY:s=>mt[s],inv:s=>s&8?s&15:-s&7,add:(s,e)=>ui[s][e],sub:(s,e)=>ui[s][re.inv(e)],rotate180:s=>s^4,isVertical:s=>(s&3)===2,byDirection:(s,e)=>Math.abs(s)*2<=Math.abs(e)?e>=0?re.S:re.N:Math.abs(e)*2<=Math.abs(s)?s>0?re.E:re.W:e>0?s>0?re.SE:re.SW:s>0?re.NE:re.NW,matrixAppendRotationInv:(s,e,t=0,r=0)=>{const i=va[re.inv(e)];i.tx=t,i.ty=r,s.append(i)}};class _t{constructor(e,t,r=0,i=0){this._x=r,this._y=i,this.cb=e,this.scope=t}clone(e=this.cb,t=this.scope){return new _t(e,t,this._x,this._y)}set(e=0,t=e){return(this._x!==e||this._y!==t)&&(this._x=e,this._y=t,this.cb.call(this.scope)),this}copyFrom(e){return(this._x!==e.x||this._y!==e.y)&&(this._x=e.x,this._y=e.y,this.cb.call(this.scope)),this}copyTo(e){return e.set(this._x,this._y),e}equals(e){return e.x===this._x&&e.y===this._y}get x(){return this._x}set x(e){this._x!==e&&(this._x=e,this.cb.call(this.scope))}get y(){return this._y}set y(e){this._y!==e&&(this._y=e,this.cb.call(this.scope))}}_t.prototype.toString=function(){return`[@pixi/math:ObservablePoint x=${this.x} y=${this.y} scope=${this.scope}]`};const ci=class{constructor(){this.worldTransform=new ue,this.localTransform=new ue,this.position=new _t(this.onChange,this,0,0),this.scale=new _t(this.onChange,this,1,1),this.pivot=new _t(this.onChange,this,0,0),this.skew=new _t(this.updateSkew,this,0,0),this._rotation=0,this._cx=1,this._sx=0,this._cy=0,this._sy=1,this._localID=0,this._currentLocalID=0,this._worldID=0,this._parentID=0}onChange(){this._localID++}updateSkew(){this._cx=Math.cos(this._rotation+this.skew.y),this._sx=Math.sin(this._rotation+this.skew.y),this._cy=-Math.sin(this._rotation-this.skew.x),this._sy=Math.cos(this._rotation-this.skew.x),this._localID++}updateLocalTransform(){const s=this.localTransform;this._localID!==this._currentLocalID&&(s.a=this._cx*this.scale.x,s.b=this._sx*this.scale.x,s.c=this._cy*this.scale.y,s.d=this._sy*this.scale.y,s.tx=this.position.x-(this.pivot.x*s.a+this.pivot.y*s.c),s.ty=this.position.y-(this.pivot.x*s.b+this.pivot.y*s.d),this._currentLocalID=this._localID,this._parentID=-1)}updateTransform(s){const e=this.localTransform;if(this._localID!==this._currentLocalID&&(e.a=this._cx*this.scale.x,e.b=this._sx*this.scale.x,e.c=this._cy*this.scale.y,e.d=this._sy*this.scale.y,e.tx=this.position.x-(this.pivot.x*e.a+this.pivot.y*e.c),e.ty=this.position.y-(this.pivot.x*e.b+this.pivot.y*e.d),this._currentLocalID=this._localID,this._parentID=-1),this._parentID!==s._worldID){const t=s.worldTransform,r=this.worldTransform;r.a=e.a*t.a+e.b*t.c,r.b=e.a*t.b+e.b*t.d,r.c=e.c*t.a+e.d*t.c,r.d=e.c*t.b+e.d*t.d,r.tx=e.tx*t.a+e.ty*t.c+t.tx,r.ty=e.tx*t.b+e.ty*t.d+t.ty,this._parentID=s._worldID,this._worldID++}}setFromMatrix(s){s.decompose(this),this._localID++}get rotation(){return this._rotation}set rotation(s){this._rotation!==s&&(this._rotation=s,this.updateSkew())}};ci.IDENTITY=new ci;let di=ci;di.prototype.toString=function(){return`[@pixi/math:Transform position=(${this.position.x}, ${this.position.y}) rotation=${this.rotation} scale=(${this.scale.x}, ${this.scale.y}) skew=(${this.skew.x}, ${this.skew.y}) ]`};var gc=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;

void main(void){
   gl_FragColor *= texture2D(uSampler, vTextureCoord);
}`,bc=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void){
   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
   vTextureCoord = aTextureCoord;
}
`;function _a(s,e,t){const r=s.createShader(e);return s.shaderSource(r,t),s.compileShader(r),r}function fi(s){const e=new Array(s);for(let t=0;t<e.length;t++)e[t]=!1;return e}function Ta(s,e){switch(s){case"float":return 0;case"vec2":return new Float32Array(2*e);case"vec3":return new Float32Array(3*e);case"vec4":return new Float32Array(4*e);case"int":case"uint":case"sampler2D":case"sampler2DArray":return 0;case"ivec2":return new Int32Array(2*e);case"ivec3":return new Int32Array(3*e);case"ivec4":return new Int32Array(4*e);case"uvec2":return new Uint32Array(2*e);case"uvec3":return new Uint32Array(3*e);case"uvec4":return new Uint32Array(4*e);case"bool":return!1;case"bvec2":return fi(2*e);case"bvec3":return fi(3*e);case"bvec4":return fi(4*e);case"mat2":return new Float32Array([1,0,0,1]);case"mat3":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return null}const Ut=[{test:s=>s.type==="float"&&s.size===1&&!s.isArray,code:s=>`
            if(uv["${s}"] !== ud["${s}"].value)
            {
                ud["${s}"].value = uv["${s}"]
                gl.uniform1f(ud["${s}"].location, uv["${s}"])
            }
            `},{test:(s,e)=>(s.type==="sampler2D"||s.type==="samplerCube"||s.type==="sampler2DArray")&&s.size===1&&!s.isArray&&(e==null||e.castToBaseTexture!==void 0),code:s=>`t = syncData.textureCount++;

            renderer.texture.bind(uv["${s}"], t);

            if(ud["${s}"].value !== t)
            {
                ud["${s}"].value = t;
                gl.uniform1i(ud["${s}"].location, t);
; // eslint-disable-line max-len
            }`},{test:(s,e)=>s.type==="mat3"&&s.size===1&&!s.isArray&&e.a!==void 0,code:s=>`
            gl.uniformMatrix3fv(ud["${s}"].location, false, uv["${s}"].toArray(true));
            `,codeUbo:s=>`
                var ${s}_matrix = uv.${s}.toArray(true);

                data[offset] = ${s}_matrix[0];
                data[offset+1] = ${s}_matrix[1];
                data[offset+2] = ${s}_matrix[2];
        
                data[offset + 4] = ${s}_matrix[3];
                data[offset + 5] = ${s}_matrix[4];
                data[offset + 6] = ${s}_matrix[5];
        
                data[offset + 8] = ${s}_matrix[6];
                data[offset + 9] = ${s}_matrix[7];
                data[offset + 10] = ${s}_matrix[8];
            `},{test:(s,e)=>s.type==="vec2"&&s.size===1&&!s.isArray&&e.x!==void 0,code:s=>`
                cv = ud["${s}"].value;
                v = uv["${s}"];

                if(cv[0] !== v.x || cv[1] !== v.y)
                {
                    cv[0] = v.x;
                    cv[1] = v.y;
                    gl.uniform2f(ud["${s}"].location, v.x, v.y);
                }`,codeUbo:s=>`
                v = uv.${s};

                data[offset] = v.x;
                data[offset+1] = v.y;
            `},{test:s=>s.type==="vec2"&&s.size===1&&!s.isArray,code:s=>`
                cv = ud["${s}"].value;
                v = uv["${s}"];

                if(cv[0] !== v[0] || cv[1] !== v[1])
                {
                    cv[0] = v[0];
                    cv[1] = v[1];
                    gl.uniform2f(ud["${s}"].location, v[0], v[1]);
                }
            `},{test:(s,e)=>s.type==="vec4"&&s.size===1&&!s.isArray&&e.width!==void 0,code:s=>`
                cv = ud["${s}"].value;
                v = uv["${s}"];

                if(cv[0] !== v.x || cv[1] !== v.y || cv[2] !== v.width || cv[3] !== v.height)
                {
                    cv[0] = v.x;
                    cv[1] = v.y;
                    cv[2] = v.width;
                    cv[3] = v.height;
                    gl.uniform4f(ud["${s}"].location, v.x, v.y, v.width, v.height)
                }`,codeUbo:s=>`
                    v = uv.${s};

                    data[offset] = v.x;
                    data[offset+1] = v.y;
                    data[offset+2] = v.width;
                    data[offset+3] = v.height;
                `},{test:(s,e)=>s.type==="vec4"&&s.size===1&&!s.isArray&&e.red!==void 0,code:s=>`
                cv = ud["${s}"].value;
                v = uv["${s}"];

                if(cv[0] !== v.red || cv[1] !== v.green || cv[2] !== v.blue || cv[3] !== v.alpha)
                {
                    cv[0] = v.red;
                    cv[1] = v.green;
                    cv[2] = v.blue;
                    cv[3] = v.alpha;
                    gl.uniform4f(ud["${s}"].location, v.red, v.green, v.blue, v.alpha)
                }`,codeUbo:s=>`
                    v = uv.${s};

                    data[offset] = v.red;
                    data[offset+1] = v.green;
                    data[offset+2] = v.blue;
                    data[offset+3] = v.alpha;
                `},{test:(s,e)=>s.type==="vec3"&&s.size===1&&!s.isArray&&e.red!==void 0,code:s=>`
                cv = ud["${s}"].value;
                v = uv["${s}"];

                if(cv[0] !== v.red || cv[1] !== v.green || cv[2] !== v.blue || cv[3] !== v.a)
                {
                    cv[0] = v.red;
                    cv[1] = v.green;
                    cv[2] = v.blue;
    
                    gl.uniform3f(ud["${s}"].location, v.red, v.green, v.blue)
                }`,codeUbo:s=>`
                    v = uv.${s};

                    data[offset] = v.red;
                    data[offset+1] = v.green;
                    data[offset+2] = v.blue;
                `},{test:s=>s.type==="vec4"&&s.size===1&&!s.isArray,code:s=>`
                cv = ud["${s}"].value;
                v = uv["${s}"];

                if(cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
                {
                    cv[0] = v[0];
                    cv[1] = v[1];
                    cv[2] = v[2];
                    cv[3] = v[3];

                    gl.uniform4f(ud["${s}"].location, v[0], v[1], v[2], v[3])
                }`}],xc={float:`
    if (cv !== v)
    {
        cu.value = v;
        gl.uniform1f(location, v);
    }`,vec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2f(location, v[0], v[1])
    }`,vec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3f(location, v[0], v[1], v[2])
    }`,vec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4f(location, v[0], v[1], v[2], v[3]);
    }`,int:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,ivec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2i(location, v[0], v[1]);
    }`,ivec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3i(location, v[0], v[1], v[2]);
    }`,ivec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4i(location, v[0], v[1], v[2], v[3]);
    }`,uint:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1ui(location, v);
    }`,uvec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2ui(location, v[0], v[1]);
    }`,uvec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3ui(location, v[0], v[1], v[2]);
    }`,uvec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4ui(location, v[0], v[1], v[2], v[3]);
    }`,bool:`
    if (cv !== v)
    {
        cu.value = v;
        gl.uniform1i(location, v);
    }`,bvec2:`
    if (cv[0] != v[0] || cv[1] != v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2i(location, v[0], v[1]);
    }`,bvec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3i(location, v[0], v[1], v[2]);
    }`,bvec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4i(location, v[0], v[1], v[2], v[3]);
    }`,mat2:"gl.uniformMatrix2fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",sampler2D:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,samplerCube:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,sampler2DArray:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`},vc={float:"gl.uniform1fv(location, v)",vec2:"gl.uniform2fv(location, v)",vec3:"gl.uniform3fv(location, v)",vec4:"gl.uniform4fv(location, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat2:"gl.uniformMatrix2fv(location, false, v)",int:"gl.uniform1iv(location, v)",ivec2:"gl.uniform2iv(location, v)",ivec3:"gl.uniform3iv(location, v)",ivec4:"gl.uniform4iv(location, v)",uint:"gl.uniform1uiv(location, v)",uvec2:"gl.uniform2uiv(location, v)",uvec3:"gl.uniform3uiv(location, v)",uvec4:"gl.uniform4uiv(location, v)",bool:"gl.uniform1iv(location, v)",bvec2:"gl.uniform2iv(location, v)",bvec3:"gl.uniform3iv(location, v)",bvec4:"gl.uniform4iv(location, v)",sampler2D:"gl.uniform1iv(location, v)",samplerCube:"gl.uniform1iv(location, v)",sampler2DArray:"gl.uniform1iv(location, v)"};function _c(s,e){var r;const t=[`
        var v = null;
        var cv = null;
        var cu = null;
        var t = 0;
        var gl = renderer.gl;
    `];for(const i in s.uniforms){const n=e[i];if(!n){((r=s.uniforms[i])==null?void 0:r.group)===!0&&(s.uniforms[i].ubo?t.push(`
                        renderer.shader.syncUniformBufferGroup(uv.${i}, '${i}');
                    `):t.push(`
                        renderer.shader.syncUniformGroup(uv.${i}, syncData);
                    `));continue}const a=s.uniforms[i];let o=!1;for(let h=0;h<Ut.length;h++)if(Ut[h].test(n,a)){t.push(Ut[h].code(i,a)),o=!0;break}if(!o){const h=(n.size===1&&!n.isArray?xc:vc)[n.type].replace("location",`ud["${i}"].location`);t.push(`
            cu = ud["${i}"];
            cv = cu.value;
            v = uv["${i}"];
            ${h};`)}}return new Function("ud","uv","renderer","syncData",t.join(`
`))}const Ea={};let Gt=Ea;function Tc(){if(Gt===Ea||Gt!=null&&Gt.isContextLost()){const s=H.ADAPTER.createCanvas();let e;H.PREFER_ENV>=it.WEBGL2&&(e=s.getContext("webgl2",{})),e||(e=s.getContext("webgl",{})||s.getContext("experimental-webgl",{}),e?e.getExtension("WEBGL_draw_buffers"):e=null),Gt=e}return Gt}let Ur;function Ec(){if(!Ur){Ur=Ae.MEDIUM;const s=Tc();if(s&&s.getShaderPrecisionFormat){const e=s.getShaderPrecisionFormat(s.FRAGMENT_SHADER,s.HIGH_FLOAT);e&&(Ur=e.precision?Ae.HIGH:Ae.MEDIUM)}}return Ur}function Aa(s,e){const t=s.getShaderSource(e).split(`
`).map((l,u)=>`${u}: ${l}`),r=s.getShaderInfoLog(e),i=r.split(`
`),n={},a=i.map(l=>parseFloat(l.replace(/^ERROR\: 0\:([\d]+)\:.*$/,"$1"))).filter(l=>l&&!n[l]?(n[l]=!0,!0):!1),o=[""];a.forEach(l=>{t[l-1]=`%c${t[l-1]}%c`,o.push("background: #FF0000; color:#FFFFFF; font-size: 10px","font-size: 10px")});const h=t.join(`
`);o[0]=h,console.error(r),console.groupCollapsed("click to view full shader code"),console.warn(...o),console.groupEnd()}function Ac(s,e,t,r){s.getProgramParameter(e,s.LINK_STATUS)||(s.getShaderParameter(t,s.COMPILE_STATUS)||Aa(s,t),s.getShaderParameter(r,s.COMPILE_STATUS)||Aa(s,r),console.error("PixiJS Error: Could not initialize shader."),s.getProgramInfoLog(e)!==""&&console.warn("PixiJS Warning: gl.getProgramInfoLog()",s.getProgramInfoLog(e)))}const Sc={float:1,vec2:2,vec3:3,vec4:4,int:1,ivec2:2,ivec3:3,ivec4:4,uint:1,uvec2:2,uvec3:3,uvec4:4,bool:1,bvec2:2,bvec3:3,bvec4:4,mat2:4,mat3:9,mat4:16,sampler2D:1};function Sa(s){return Sc[s]}let Gr=null;const Ma={FLOAT:"float",FLOAT_VEC2:"vec2",FLOAT_VEC3:"vec3",FLOAT_VEC4:"vec4",INT:"int",INT_VEC2:"ivec2",INT_VEC3:"ivec3",INT_VEC4:"ivec4",UNSIGNED_INT:"uint",UNSIGNED_INT_VEC2:"uvec2",UNSIGNED_INT_VEC3:"uvec3",UNSIGNED_INT_VEC4:"uvec4",BOOL:"bool",BOOL_VEC2:"bvec2",BOOL_VEC3:"bvec3",BOOL_VEC4:"bvec4",FLOAT_MAT2:"mat2",FLOAT_MAT3:"mat3",FLOAT_MAT4:"mat4",SAMPLER_2D:"sampler2D",INT_SAMPLER_2D:"sampler2D",UNSIGNED_INT_SAMPLER_2D:"sampler2D",SAMPLER_CUBE:"samplerCube",INT_SAMPLER_CUBE:"samplerCube",UNSIGNED_INT_SAMPLER_CUBE:"samplerCube",SAMPLER_2D_ARRAY:"sampler2DArray",INT_SAMPLER_2D_ARRAY:"sampler2DArray",UNSIGNED_INT_SAMPLER_2D_ARRAY:"sampler2DArray"};function wa(s,e){if(!Gr){const t=Object.keys(Ma);Gr={};for(let r=0;r<t.length;++r){const i=t[r];Gr[s[i]]=Ma[i]}}return Gr[e]}function Ia(s,e,t){if(s.substring(0,9)!=="precision"){let r=e;return e===Ae.HIGH&&t!==Ae.HIGH&&(r=Ae.MEDIUM),`precision ${r} float;
${s}`}else if(t!==Ae.HIGH&&s.substring(0,15)==="precision highp")return s.replace("precision highp","precision mediump");return s}let ar;function Mc(){if(typeof ar=="boolean")return ar;try{ar=new Function("param1","param2","param3","return param1[param2] === param3;")({a:"b"},"a","b")===!0}catch{ar=!1}return ar}let wc=0;const jr={},pi=class zt{constructor(e,t,r="pixi-shader",i={}){this.extra={},this.id=wc++,this.vertexSrc=e||zt.defaultVertexSrc,this.fragmentSrc=t||zt.defaultFragmentSrc,this.vertexSrc=this.vertexSrc.trim(),this.fragmentSrc=this.fragmentSrc.trim(),this.extra=i,this.vertexSrc.substring(0,8)!=="#version"&&(r=r.replace(/\s+/g,"-"),jr[r]?(jr[r]++,r+=`-${jr[r]}`):jr[r]=1,this.vertexSrc=`#define SHADER_NAME ${r}
${this.vertexSrc}`,this.fragmentSrc=`#define SHADER_NAME ${r}
${this.fragmentSrc}`,this.vertexSrc=Ia(this.vertexSrc,zt.defaultVertexPrecision,Ae.HIGH),this.fragmentSrc=Ia(this.fragmentSrc,zt.defaultFragmentPrecision,Ec())),this.glPrograms={},this.syncUniforms=null}static get defaultVertexSrc(){return bc}static get defaultFragmentSrc(){return gc}static from(e,t,r){const i=e+t;let n=fa[i];return n||(fa[i]=n=new zt(e,t,r)),n}};pi.defaultVertexPrecision=Ae.HIGH,pi.defaultFragmentPrecision=St.apple.device?Ae.HIGH:Ae.MEDIUM;let yt=pi,Ic=0;class Ue{constructor(e,t,r){this.group=!0,this.syncUniforms={},this.dirtyId=0,this.id=Ic++,this.static=!!t,this.ubo=!!r,e instanceof ge?(this.buffer=e,this.buffer.type=Ne.UNIFORM_BUFFER,this.autoManage=!1,this.ubo=!0):(this.uniforms=e,this.ubo&&(this.buffer=new ge(new Float32Array(1)),this.buffer.type=Ne.UNIFORM_BUFFER,this.autoManage=!0))}update(){this.dirtyId++,!this.autoManage&&this.buffer&&this.buffer.update()}add(e,t,r){if(!this.ubo)this.uniforms[e]=new Ue(t,r);else throw new Error("[UniformGroup] uniform groups in ubo mode cannot be modified, or have uniform groups nested in them")}static from(e,t,r){return new Ue(e,t,r)}static uboFrom(e,t){return new Ue(e,t??!0,!0)}}class ls{constructor(e,t){this.uniformBindCount=0,this.program=e,t?t instanceof Ue?this.uniformGroup=t:this.uniformGroup=new Ue(t):this.uniformGroup=new Ue({}),this.disposeRunner=new Ie("disposeShader")}checkUniformExists(e,t){if(t.uniforms[e])return!0;for(const r in t.uniforms){const i=t.uniforms[r];if(i.group===!0&&this.checkUniformExists(e,i))return!0}return!1}destroy(){this.uniformGroup=null,this.disposeRunner.emit(this),this.disposeRunner.destroy()}get uniforms(){return this.uniformGroup.uniforms}static from(e,t,r){const i=yt.from(e,t);return new ls(i,r)}}class Rc{constructor(e,t){if(this.vertexSrc=e,this.fragTemplate=t,this.programCache={},this.defaultGroupCache={},!t.includes("%count%"))throw new Error('Fragment template must contain "%count%".');if(!t.includes("%forloop%"))throw new Error('Fragment template must contain "%forloop%".')}generateShader(e){if(!this.programCache[e]){const r=new Int32Array(e);for(let n=0;n<e;n++)r[n]=n;this.defaultGroupCache[e]=Ue.from({uSamplers:r},!0);let i=this.fragTemplate;i=i.replace(/%count%/gi,`${e}`),i=i.replace(/%forloop%/gi,this.generateSampleSrc(e)),this.programCache[e]=new yt(this.vertexSrc,i)}const t={tint:new Float32Array([1,1,1,1]),translationMatrix:new ue,default:this.defaultGroupCache[e]};return new ls(this.programCache[e],t)}generateSampleSrc(e){let t="";t+=`
`,t+=`
`;for(let r=0;r<e;r++)r>0&&(t+=`
else `),r<e-1&&(t+=`if(vTextureId < ${r}.5)`),t+=`
{`,t+=`
	color = texture2D(uSamplers[${r}], vTextureCoord);`,t+=`
}`;return t+=`
`,t+=`
`,t}}class Pc{constructor(){this.elements=[],this.ids=[],this.count=0}clear(){for(let e=0;e<this.count;e++)this.elements[e]=null;this.count=0}}function Lc(){return!St.apple.device}function Nc(s){let e=!0;const t=H.ADAPTER.getNavigator();if(St.tablet||St.phone){if(St.apple.device){const r=t.userAgent.match(/OS (\d+)_(\d+)?/);r&&parseInt(r[1],10)<11&&(e=!1)}if(St.android.device){const r=t.userAgent.match(/Android\s([0-9.]*)/);r&&parseInt(r[1],10)<7&&(e=!1)}}return e?s:4}class Ra{constructor(e){this.renderer=e}flush(){}destroy(){this.renderer=null}start(){}stop(){this.flush()}render(e){}}var Cc=`varying vec2 vTextureCoord;
varying vec4 vColor;
varying float vTextureId;
uniform sampler2D uSamplers[%count%];

void main(void){
    vec4 color;
    %forloop%
    gl_FragColor = color * vColor;
}
`,Oc=`precision highp float;
attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;
attribute vec4 aColor;
attribute float aTextureId;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform vec4 tint;

varying vec2 vTextureCoord;
varying vec4 vColor;
varying float vTextureId;

void main(void){
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vTextureId = aTextureId;
    vColor = aColor * tint;
}
`;const or=class Pe extends Ra{constructor(e){super(e),this.setShaderGenerator(),this.geometryClass=dc,this.vertexSize=6,this.state=Vt.for2d(),this.size=Pe.defaultBatchSize*4,this._vertexCount=0,this._indexCount=0,this._bufferedElements=[],this._bufferedTextures=[],this._bufferSize=0,this._shader=null,this._packedGeometries=[],this._packedGeometryPoolSize=2,this._flushId=0,this._aBuffers={},this._iBuffers={},this.maxTextures=1,this.renderer.on("prerender",this.onPrerender,this),e.runners.contextChange.add(this),this._dcIndex=0,this._aIndex=0,this._iIndex=0,this._attributeBuffer=null,this._indexBuffer=null,this._tempBoundTextures=[]}static get defaultMaxTextures(){return this._defaultMaxTextures=this._defaultMaxTextures??Nc(32),this._defaultMaxTextures}static set defaultMaxTextures(e){this._defaultMaxTextures=e}static get canUploadSameBuffer(){return this._canUploadSameBuffer=this._canUploadSameBuffer??Lc(),this._canUploadSameBuffer}static set canUploadSameBuffer(e){this._canUploadSameBuffer=e}get MAX_TEXTURES(){return $("7.1.0","BatchRenderer#MAX_TEXTURES renamed to BatchRenderer#maxTextures"),this.maxTextures}static get defaultVertexSrc(){return Oc}static get defaultFragmentTemplate(){return Cc}setShaderGenerator({vertex:e=Pe.defaultVertexSrc,fragment:t=Pe.defaultFragmentTemplate}={}){this.shaderGenerator=new Rc(e,t)}contextChange(){const e=this.renderer.gl;H.PREFER_ENV===it.WEBGL_LEGACY?this.maxTextures=1:(this.maxTextures=Math.min(e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),Pe.defaultMaxTextures),this.maxTextures=ic(this.maxTextures,e)),this._shader=this.shaderGenerator.generateShader(this.maxTextures);for(let t=0;t<this._packedGeometryPoolSize;t++)this._packedGeometries[t]=new this.geometryClass;this.initFlushBuffers()}initFlushBuffers(){const{_drawCallPool:e,_textureArrayPool:t}=Pe,r=this.size/4,i=Math.floor(r/this.maxTextures)+1;for(;e.length<r;)e.push(new ac);for(;t.length<i;)t.push(new Pc);for(let n=0;n<this.maxTextures;n++)this._tempBoundTextures[n]=null}onPrerender(){this._flushId=0}render(e){e._texture.valid&&(this._vertexCount+e.vertexData.length/2>this.size&&this.flush(),this._vertexCount+=e.vertexData.length/2,this._indexCount+=e.indices.length,this._bufferedTextures[this._bufferSize]=e._texture.baseTexture,this._bufferedElements[this._bufferSize++]=e)}buildTexturesAndDrawCalls(){const{_bufferedTextures:e,maxTextures:t}=this,r=Pe._textureArrayPool,i=this.renderer.batch,n=this._tempBoundTextures,a=this.renderer.textureGC.count;let o=++W._globalBatch,h=0,l=r[0],u=0;i.copyBoundTextures(n,t);for(let c=0;c<this._bufferSize;++c){const d=e[c];e[c]=null,d._batchEnabled!==o&&(l.count>=t&&(i.boundArray(l,n,o,t),this.buildDrawCalls(l,u,c),u=c,l=r[++h],++o),d._batchEnabled=o,d.touched=a,l.elements[l.count++]=d)}l.count>0&&(i.boundArray(l,n,o,t),this.buildDrawCalls(l,u,this._bufferSize),++h,++o);for(let c=0;c<n.length;c++)n[c]=null;W._globalBatch=o}buildDrawCalls(e,t,r){const{_bufferedElements:i,_attributeBuffer:n,_indexBuffer:a,vertexSize:o}=this,h=Pe._drawCallPool;let l=this._dcIndex,u=this._aIndex,c=this._iIndex,d=h[l];d.start=this._iIndex,d.texArray=e;for(let f=t;f<r;++f){const p=i[f],m=p._texture.baseTexture,y=Qu[m.alphaMode?1:0][p.blendMode];i[f]=null,t<f&&d.blend!==y&&(d.size=c-d.start,t=f,d=h[++l],d.texArray=e,d.start=c),this.packInterleavedGeometry(p,n,a,u,c),u+=p.vertexData.length/2*o,c+=p.indices.length,d.blend=y}t<r&&(d.size=c-d.start,++l),this._dcIndex=l,this._aIndex=u,this._iIndex=c}bindAndClearTexArray(e){const t=this.renderer.texture;for(let r=0;r<e.count;r++)t.bind(e.elements[r],e.ids[r]),e.elements[r]=null;e.count=0}updateGeometry(){const{_packedGeometries:e,_attributeBuffer:t,_indexBuffer:r}=this;Pe.canUploadSameBuffer?(e[this._flushId]._buffer.update(t.rawBinaryData),e[this._flushId]._indexBuffer.update(r),this.renderer.geometry.updateBuffers()):(this._packedGeometryPoolSize<=this._flushId&&(this._packedGeometryPoolSize++,e[this._flushId]=new this.geometryClass),e[this._flushId]._buffer.update(t.rawBinaryData),e[this._flushId]._indexBuffer.update(r),this.renderer.geometry.bind(e[this._flushId]),this.renderer.geometry.updateBuffers(),this._flushId++)}drawBatches(){const e=this._dcIndex,{gl:t,state:r}=this.renderer,i=Pe._drawCallPool;let n=null;for(let a=0;a<e;a++){const{texArray:o,type:h,size:l,start:u,blend:c}=i[a];n!==o&&(n=o,this.bindAndClearTexArray(o)),this.state.blendMode=c,r.set(this.state),t.drawElements(h,l,t.UNSIGNED_SHORT,u*2)}}flush(){this._vertexCount!==0&&(this._attributeBuffer=this.getAttributeBuffer(this._vertexCount),this._indexBuffer=this.getIndexBuffer(this._indexCount),this._aIndex=0,this._iIndex=0,this._dcIndex=0,this.buildTexturesAndDrawCalls(),this.updateGeometry(),this.drawBatches(),this._bufferSize=0,this._vertexCount=0,this._indexCount=0)}start(){this.renderer.state.set(this.state),this.renderer.texture.ensureSamplerType(this.maxTextures),this.renderer.shader.bind(this._shader),Pe.canUploadSameBuffer&&this.renderer.geometry.bind(this._packedGeometries[this._flushId])}stop(){this.flush()}destroy(){for(let e=0;e<this._packedGeometryPoolSize;e++)this._packedGeometries[e]&&this._packedGeometries[e].destroy();this.renderer.off("prerender",this.onPrerender,this),this._aBuffers=null,this._iBuffers=null,this._packedGeometries=null,this._attributeBuffer=null,this._indexBuffer=null,this._shader&&(this._shader.destroy(),this._shader=null),super.destroy()}getAttributeBuffer(e){const t=Fr(Math.ceil(e/8)),r=da(t),i=t*8;this._aBuffers.length<=r&&(this._iBuffers.length=r+1);let n=this._aBuffers[i];return n||(this._aBuffers[i]=n=new tc(i*this.vertexSize*4)),n}getIndexBuffer(e){const t=Fr(Math.ceil(e/12)),r=da(t),i=t*12;this._iBuffers.length<=r&&(this._iBuffers.length=r+1);let n=this._iBuffers[r];return n||(this._iBuffers[r]=n=new Uint16Array(i)),n}packInterleavedGeometry(e,t,r,i,n){const{uint32View:a,float32View:o}=t,h=i/this.vertexSize,l=e.uvs,u=e.indices,c=e.vertexData,d=e._texture.baseTexture._batchLocation,f=Math.min(e.worldAlpha,1),p=Bt.shared.setValue(e._tintRGB).toPremultiplied(f,e._texture.baseTexture.alphaMode>0);for(let m=0;m<c.length;m+=2)o[i++]=c[m],o[i++]=c[m+1],o[i++]=l[m],o[i++]=l[m+1],a[i++]=p,o[i++]=d;for(let m=0;m<u.length;m++)r[n++]=h+u[m]}};or.defaultBatchSize=4096,or.extension={name:"batch",type:U.RendererPlugin},or._drawCallPool=[],or._textureArrayPool=[];let gt=or;V.add(gt);var Fc=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;

void main(void){
   gl_FragColor = texture2D(uSampler, vTextureCoord);
}
`,Dc=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
}
`;const mi=class mr extends ls{constructor(e,t,r){const i=yt.from(e||mr.defaultVertexSrc,t||mr.defaultFragmentSrc);super(i,r),this.padding=0,this.resolution=mr.defaultResolution,this.multisample=mr.defaultMultisample,this.enabled=!0,this.autoFit=!0,this.state=new Vt}apply(e,t,r,i,n){e.applyFilter(this,t,r,i)}get blendMode(){return this.state.blendMode}set blendMode(e){this.state.blendMode=e}get resolution(){return this._resolution}set resolution(e){this._resolution=e}static get defaultVertexSrc(){return Dc}static get defaultFragmentSrc(){return Fc}};mi.defaultResolution=1,mi.defaultMultisample=ae.NONE;let Qe=mi;class Hr{constructor(){this.clearBeforeRender=!0,this._backgroundColor=new Bt(0),this.alpha=1}init(e){this.clearBeforeRender=e.clearBeforeRender;const{backgroundColor:t,background:r,backgroundAlpha:i}=e,n=r??t;n!==void 0&&(this.color=n),this.alpha=i}get color(){return this._backgroundColor.value}set color(e){this._backgroundColor.setValue(e)}get alpha(){return this._backgroundColor.alpha}set alpha(e){this._backgroundColor.setAlpha(e)}get backgroundColor(){return this._backgroundColor}destroy(){}}Hr.defaultOptions={backgroundAlpha:1,backgroundColor:0,clearBeforeRender:!0},Hr.extension={type:[U.RendererSystem,U.CanvasRendererSystem],name:"background"},V.add(Hr);class Pa{constructor(e){this.renderer=e,this.emptyRenderer=new Ra(e),this.currentRenderer=this.emptyRenderer}setObjectRenderer(e){this.currentRenderer!==e&&(this.currentRenderer.stop(),this.currentRenderer=e,this.currentRenderer.start())}flush(){this.setObjectRenderer(this.emptyRenderer)}reset(){this.setObjectRenderer(this.emptyRenderer)}copyBoundTextures(e,t){const{boundTextures:r}=this.renderer.texture;for(let i=t-1;i>=0;--i)e[i]=r[i]||null,e[i]&&(e[i]._batchLocation=i)}boundArray(e,t,r,i){const{elements:n,ids:a,count:o}=e;let h=0;for(let l=0;l<o;l++){const u=n[l],c=u._batchLocation;if(c>=0&&c<i&&t[c]===u){a[l]=c;continue}for(;h<i;){const d=t[h];if(d&&d._batchEnabled===r&&d._batchLocation===h){h++;continue}a[l]=h,u._batchLocation=h,t[h]=u;break}}}destroy(){this.renderer=null}}Pa.extension={type:U.RendererSystem,name:"batch"},V.add(Pa);let La=0;class zr{constructor(e){this.renderer=e,this.webGLVersion=1,this.extensions={},this.supports={uint32Indices:!1},this.handleContextLost=this.handleContextLost.bind(this),this.handleContextRestored=this.handleContextRestored.bind(this)}get isLost(){return!this.gl||this.gl.isContextLost()}contextChange(e){this.gl=e,this.renderer.gl=e,this.renderer.CONTEXT_UID=La++}init(e){if(e.context)this.initFromContext(e.context);else{const t=this.renderer.background.alpha<1,r=e.premultipliedAlpha;this.preserveDrawingBuffer=e.preserveDrawingBuffer,this.useContextAlpha=e.useContextAlpha,this.powerPreference=e.powerPreference,this.initFromOptions({alpha:t,premultipliedAlpha:r,antialias:e.antialias,stencil:!0,preserveDrawingBuffer:e.preserveDrawingBuffer,powerPreference:e.powerPreference})}}initFromContext(e){this.gl=e,this.validateContext(e),this.renderer.gl=e,this.renderer.CONTEXT_UID=La++,this.renderer.runners.contextChange.emit(e);const t=this.renderer.view;t.addEventListener!==void 0&&(t.addEventListener("webglcontextlost",this.handleContextLost,!1),t.addEventListener("webglcontextrestored",this.handleContextRestored,!1))}initFromOptions(e){const t=this.createContext(this.renderer.view,e);this.initFromContext(t)}createContext(e,t){let r;if(H.PREFER_ENV>=it.WEBGL2&&(r=e.getContext("webgl2",t)),r)this.webGLVersion=2;else if(this.webGLVersion=1,r=e.getContext("webgl",t)||e.getContext("experimental-webgl",t),!r)throw new Error("This browser does not support WebGL. Try using the canvas renderer");return this.gl=r,this.getExtensions(),this.gl}getExtensions(){const{gl:e}=this,t={loseContext:e.getExtension("WEBGL_lose_context"),anisotropicFiltering:e.getExtension("EXT_texture_filter_anisotropic"),floatTextureLinear:e.getExtension("OES_texture_float_linear"),s3tc:e.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:e.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:e.getExtension("WEBGL_compressed_texture_etc"),etc1:e.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:e.getExtension("WEBGL_compressed_texture_atc"),astc:e.getExtension("WEBGL_compressed_texture_astc"),bptc:e.getExtension("EXT_texture_compression_bptc")};this.webGLVersion===1?Object.assign(this.extensions,t,{drawBuffers:e.getExtension("WEBGL_draw_buffers"),depthTexture:e.getExtension("WEBGL_depth_texture"),vertexArrayObject:e.getExtension("OES_vertex_array_object")||e.getExtension("MOZ_OES_vertex_array_object")||e.getExtension("WEBKIT_OES_vertex_array_object"),uint32ElementIndex:e.getExtension("OES_element_index_uint"),floatTexture:e.getExtension("OES_texture_float"),floatTextureLinear:e.getExtension("OES_texture_float_linear"),textureHalfFloat:e.getExtension("OES_texture_half_float"),textureHalfFloatLinear:e.getExtension("OES_texture_half_float_linear")}):this.webGLVersion===2&&Object.assign(this.extensions,t,{colorBufferFloat:e.getExtension("EXT_color_buffer_float")})}handleContextLost(e){e.preventDefault(),setTimeout(()=>{this.gl.isContextLost()&&this.extensions.loseContext&&this.extensions.loseContext.restoreContext()},0)}handleContextRestored(){this.renderer.runners.contextChange.emit(this.gl)}destroy(){const e=this.renderer.view;this.renderer=null,e.removeEventListener!==void 0&&(e.removeEventListener("webglcontextlost",this.handleContextLost),e.removeEventListener("webglcontextrestored",this.handleContextRestored)),this.gl.useProgram(null),this.extensions.loseContext&&this.extensions.loseContext.loseContext()}postrender(){this.renderer.objectRenderer.renderingToScreen&&this.gl.flush()}validateContext(e){const t=e.getContextAttributes(),r="WebGL2RenderingContext"in globalThis&&e instanceof globalThis.WebGL2RenderingContext;r&&(this.webGLVersion=2),t&&!t.stencil&&console.warn("Provided WebGL context does not have a stencil buffer, masks may not render correctly");const i=r||!!e.getExtension("OES_element_index_uint");this.supports.uint32Indices=i,i||console.warn("Provided WebGL context does not support 32 index buffer, complex graphics may not render correctly")}}zr.defaultOptions={context:null,antialias:!1,premultipliedAlpha:!0,preserveDrawingBuffer:!1,powerPreference:"default"},zr.extension={type:U.RendererSystem,name:"context"},V.add(zr);class yi{constructor(e,t){if(this.width=Math.round(e),this.height=Math.round(t),!this.width||!this.height)throw new Error("Framebuffer width or height is zero");this.stencil=!1,this.depth=!1,this.dirtyId=0,this.dirtyFormat=0,this.dirtySize=0,this.depthTexture=null,this.colorTextures=[],this.glFramebuffers={},this.disposeRunner=new Ie("disposeFramebuffer"),this.multisample=ae.NONE}get colorTexture(){return this.colorTextures[0]}addColorTexture(e=0,t){return this.colorTextures[e]=t||new W(null,{scaleMode:He.NEAREST,resolution:1,mipmap:nt.OFF,width:this.width,height:this.height}),this.dirtyId++,this.dirtyFormat++,this}addDepthTexture(e){return this.depthTexture=e||new W(null,{scaleMode:He.NEAREST,resolution:1,width:this.width,height:this.height,mipmap:nt.OFF,format:M.DEPTH_COMPONENT,type:B.UNSIGNED_SHORT}),this.dirtyId++,this.dirtyFormat++,this}enableDepth(){return this.depth=!0,this.dirtyId++,this.dirtyFormat++,this}enableStencil(){return this.stencil=!0,this.dirtyId++,this.dirtyFormat++,this}resize(e,t){if(e=Math.round(e),t=Math.round(t),!e||!t)throw new Error("Framebuffer width and height must not be zero");if(!(e===this.width&&t===this.height)){this.width=e,this.height=t,this.dirtyId++,this.dirtySize++;for(let r=0;r<this.colorTextures.length;r++){const i=this.colorTextures[r],n=i.resolution;i.setSize(e/n,t/n)}if(this.depthTexture){const r=this.depthTexture.resolution;this.depthTexture.setSize(e/r,t/r)}}}dispose(){this.disposeRunner.emit(this,!1)}destroyDepthTexture(){this.depthTexture&&(this.depthTexture.destroy(),this.depthTexture=null,++this.dirtyId,++this.dirtyFormat)}}class Na extends W{constructor(e={}){if(typeof e=="number"){const t=arguments[0],r=arguments[1],i=arguments[2],n=arguments[3];e={width:t,height:r,scaleMode:i,resolution:n}}e.width=e.width??100,e.height=e.height??100,e.multisample??(e.multisample=ae.NONE),super(null,e),this.mipmap=nt.OFF,this.valid=!0,this._clear=new Bt([0,0,0,0]),this.framebuffer=new yi(this.realWidth,this.realHeight).addColorTexture(0,this),this.framebuffer.multisample=e.multisample,this.maskStack=[],this.filterStack=[{}]}set clearColor(e){this._clear.setValue(e)}get clearColor(){return this._clear.value}get clear(){return this._clear}get multisample(){return this.framebuffer.multisample}set multisample(e){this.framebuffer.multisample=e}resize(e,t){this.framebuffer.resize(e*this.resolution,t*this.resolution),this.setRealSize(this.framebuffer.width,this.framebuffer.height)}dispose(){this.framebuffer.dispose(),super.dispose()}destroy(){super.destroy(),this.framebuffer.destroyDepthTexture(),this.framebuffer=null}}class $e extends nr{constructor(e){const t=e,r=t.naturalWidth||t.videoWidth||t.displayWidth||t.width,i=t.naturalHeight||t.videoHeight||t.displayHeight||t.height;super(r,i),this.source=e,this.noSubImage=!1}static crossOrigin(e,t,r){r===void 0&&!t.startsWith("data:")?e.crossOrigin=ec(t):r!==!1&&(e.crossOrigin=typeof r=="string"?r:"anonymous")}upload(e,t,r,i){const n=e.gl,a=t.realWidth,o=t.realHeight;if(i=i||this.source,typeof HTMLImageElement<"u"&&i instanceof HTMLImageElement){if(!i.complete||i.naturalWidth===0)return!1}else if(typeof HTMLVideoElement<"u"&&i instanceof HTMLVideoElement&&i.readyState<=1)return!1;return n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.alphaMode===at.UNPACK),!this.noSubImage&&t.target===n.TEXTURE_2D&&r.width===a&&r.height===o?n.texSubImage2D(n.TEXTURE_2D,0,0,0,t.format,r.type,i):(r.width=a,r.height=o,n.texImage2D(t.target,0,r.internalFormat,t.format,r.type,i)),!0}update(){if(this.destroyed)return;const e=this.source,t=e.naturalWidth||e.videoWidth||e.width,r=e.naturalHeight||e.videoHeight||e.height;this.resize(t,r),super.update()}dispose(){this.source=null}}class Ca extends $e{constructor(e,t){if(t=t||{},typeof e=="string"){const r=new Image;$e.crossOrigin(r,e,t.crossorigin),r.src=e,e=r}super(e),!e.complete&&this._width&&this._height&&(this._width=0,this._height=0),this.url=e.src,this._process=null,this.preserveBitmap=!1,this.createBitmap=(t.createBitmap??H.CREATE_IMAGE_BITMAP)&&!!globalThis.createImageBitmap,this.alphaMode=typeof t.alphaMode=="number"?t.alphaMode:null,this.bitmap=null,this._load=null,t.autoLoad!==!1&&this.load()}load(e){return this._load?this._load:(e!==void 0&&(this.createBitmap=e),this._load=new Promise((t,r)=>{const i=this.source;this.url=i.src;const n=()=>{this.destroyed||(i.onload=null,i.onerror=null,this.update(),this._load=null,this.createBitmap?t(this.process()):t(this))};i.complete&&i.src?n():(i.onload=n,i.onerror=a=>{r(a),this.onError.emit(a)})}),this._load)}process(){const e=this.source;if(this._process!==null)return this._process;if(this.bitmap!==null||!globalThis.createImageBitmap)return Promise.resolve(this);const t=globalThis.createImageBitmap,r=!e.crossOrigin||e.crossOrigin==="anonymous";return this._process=fetch(e.src,{mode:r?"cors":"no-cors"}).then(i=>i.blob()).then(i=>t(i,0,0,e.width,e.height,{premultiplyAlpha:this.alphaMode===null||this.alphaMode===at.UNPACK?"premultiply":"none"})).then(i=>this.destroyed?Promise.reject():(this.bitmap=i,this.update(),this._process=null,Promise.resolve(this))),this._process}upload(e,t,r){if(typeof this.alphaMode=="number"&&(t.alphaMode=this.alphaMode),!this.createBitmap)return super.upload(e,t,r);if(!this.bitmap&&(this.process(),!this.bitmap))return!1;if(super.upload(e,t,r,this.bitmap),!this.preserveBitmap){let i=!0;const n=t._glTextures;for(const a in n){const o=n[a];if(o!==r&&o.dirtyId!==t.dirtyId){i=!1;break}}i&&(this.bitmap.close&&this.bitmap.close(),this.bitmap=null)}return!0}dispose(){this.source.onload=null,this.source.onerror=null,super.dispose(),this.bitmap&&(this.bitmap.close(),this.bitmap=null),this._process=null,this._load=null}static test(e){return typeof HTMLImageElement<"u"&&(typeof e=="string"||e instanceof HTMLImageElement)}}class gi{constructor(){this.x0=0,this.y0=0,this.x1=1,this.y1=0,this.x2=1,this.y2=1,this.x3=0,this.y3=1,this.uvsFloat32=new Float32Array(8)}set(e,t,r){const i=t.width,n=t.height;if(r){const a=e.width/2/i,o=e.height/2/n,h=e.x/i+a,l=e.y/n+o;r=re.add(r,re.NW),this.x0=h+a*re.uX(r),this.y0=l+o*re.uY(r),r=re.add(r,2),this.x1=h+a*re.uX(r),this.y1=l+o*re.uY(r),r=re.add(r,2),this.x2=h+a*re.uX(r),this.y2=l+o*re.uY(r),r=re.add(r,2),this.x3=h+a*re.uX(r),this.y3=l+o*re.uY(r)}else this.x0=e.x/i,this.y0=e.y/n,this.x1=(e.x+e.width)/i,this.y1=e.y/n,this.x2=(e.x+e.width)/i,this.y2=(e.y+e.height)/n,this.x3=e.x/i,this.y3=(e.y+e.height)/n;this.uvsFloat32[0]=this.x0,this.uvsFloat32[1]=this.y0,this.uvsFloat32[2]=this.x1,this.uvsFloat32[3]=this.y1,this.uvsFloat32[4]=this.x2,this.uvsFloat32[5]=this.y2,this.uvsFloat32[6]=this.x3,this.uvsFloat32[7]=this.y3}}gi.prototype.toString=function(){return`[@pixi/core:TextureUvs x0=${this.x0} y0=${this.y0} x1=${this.x1} y1=${this.y1} x2=${this.x2} y2=${this.y2} x3=${this.x3} y3=${this.y3}]`};const Oa=new gi;function Vr(s){s.destroy=function(){},s.on=function(){},s.once=function(){},s.emit=function(){}}class K extends xr{constructor(e,t,r,i,n,a,o){if(super(),this.noFrame=!1,t||(this.noFrame=!0,t=new Q(0,0,1,1)),e instanceof K&&(e=e.baseTexture),this.baseTexture=e,this._frame=t,this.trim=i,this.valid=!1,this.destroyed=!1,this._uvs=Oa,this.uvMatrix=null,this.orig=r||t,this._rotate=Number(n||0),n===!0)this._rotate=2;else if(this._rotate%2!==0)throw new Error("attempt to use diamond-shaped UVs. If you are sure, set rotation manually");this.defaultAnchor=a?new be(a.x,a.y):new be(0,0),this.defaultBorders=o,this._updateID=0,this.textureCacheIds=[],e.valid?this.noFrame?e.valid&&this.onBaseTextureUpdated(e):this.frame=t:e.once("loaded",this.onBaseTextureUpdated,this),this.noFrame&&e.on("update",this.onBaseTextureUpdated,this)}update(){this.baseTexture.resource&&this.baseTexture.resource.update()}onBaseTextureUpdated(e){if(this.noFrame){if(!this.baseTexture.valid)return;this._frame.width=e.width,this._frame.height=e.height,this.valid=!0,this.updateUvs()}else this.frame=this._frame;this.emit("update",this)}destroy(e){if(this.baseTexture){if(e){const{resource:t}=this.baseTexture;t!=null&&t.url&&ke[t.url]&&K.removeFromCache(t.url),this.baseTexture.destroy()}this.baseTexture.off("loaded",this.onBaseTextureUpdated,this),this.baseTexture.off("update",this.onBaseTextureUpdated,this),this.baseTexture=null}this._frame=null,this._uvs=null,this.trim=null,this.orig=null,this.valid=!1,K.removeFromCache(this),this.textureCacheIds=null,this.destroyed=!0,this.emit("destroyed",this),this.removeAllListeners()}clone(){var i;const e=this._frame.clone(),t=this._frame===this.orig?e:this.orig.clone(),r=new K(this.baseTexture,!this.noFrame&&e,t,(i=this.trim)==null?void 0:i.clone(),this.rotate,this.defaultAnchor,this.defaultBorders);return this.noFrame&&(r._frame=e),r}updateUvs(){this._uvs===Oa&&(this._uvs=new gi),this._uvs.set(this._frame,this.baseTexture,this.rotate),this._updateID++}static from(e,t={},r=H.STRICT_TEXTURE_CACHE){const i=typeof e=="string";let n=null;if(i)n=e;else if(e instanceof W){if(!e.cacheId){const o=(t==null?void 0:t.pixiIdPrefix)||"pixiid";e.cacheId=`${o}-${ir()}`,W.addToCache(e,e.cacheId)}n=e.cacheId}else{if(!e._pixiId){const o=(t==null?void 0:t.pixiIdPrefix)||"pixiid";e._pixiId=`${o}_${ir()}`}n=e._pixiId}let a=ke[n];if(i&&r&&!a)throw new Error(`The cacheId "${n}" does not exist in TextureCache.`);return!a&&!(e instanceof W)?(t.resolution||(t.resolution=pa(e)),a=new K(new W(e,t)),a.baseTexture.cacheId=n,W.addToCache(a.baseTexture,n),K.addToCache(a,n)):!a&&e instanceof W&&(a=new K(e),K.addToCache(a,n)),a}static fromURL(e,t){const r=Object.assign({autoLoad:!1},t==null?void 0:t.resourceOptions),i=K.from(e,Object.assign({resourceOptions:r},t),!1),n=i.baseTexture.resource;return i.baseTexture.valid?Promise.resolve(i):n.load().then(()=>Promise.resolve(i))}static fromBuffer(e,t,r,i){return new K(W.fromBuffer(e,t,r,i))}static fromLoader(e,t,r,i){const n=new W(e,Object.assign({scaleMode:W.defaultOptions.scaleMode,resolution:pa(t)},i)),{resource:a}=n;a instanceof Ca&&(a.url=t);const o=new K(n);return r||(r=t),W.addToCache(o.baseTexture,r),K.addToCache(o,r),r!==t&&(W.addToCache(o.baseTexture,t),K.addToCache(o,t)),o.baseTexture.valid?Promise.resolve(o):new Promise(h=>{o.baseTexture.once("loaded",()=>h(o))})}static addToCache(e,t){t&&(e.textureCacheIds.includes(t)||e.textureCacheIds.push(t),ke[t]&&ke[t]!==e&&console.warn(`Texture added to the cache with an id [${t}] that already had an entry`),ke[t]=e)}static removeFromCache(e){if(typeof e=="string"){const t=ke[e];if(t){const r=t.textureCacheIds.indexOf(e);return r>-1&&t.textureCacheIds.splice(r,1),delete ke[e],t}}else if(e!=null&&e.textureCacheIds){for(let t=0;t<e.textureCacheIds.length;++t)ke[e.textureCacheIds[t]]===e&&delete ke[e.textureCacheIds[t]];return e.textureCacheIds.length=0,e}return null}get resolution(){return this.baseTexture.resolution}get frame(){return this._frame}set frame(e){this._frame=e,this.noFrame=!1;const{x:t,y:r,width:i,height:n}=e,a=t+i>this.baseTexture.width,o=r+n>this.baseTexture.height;if(a||o){const h=a&&o?"and":"or",l=`X: ${t} + ${i} = ${t+i} > ${this.baseTexture.width}`,u=`Y: ${r} + ${n} = ${r+n} > ${this.baseTexture.height}`;throw new Error(`Texture Error: frame does not fit inside the base Texture dimensions: ${l} ${h} ${u}`)}this.valid=i&&n&&this.baseTexture.valid,!this.trim&&!this.rotate&&(this.orig=e),this.valid&&this.updateUvs()}get rotate(){return this._rotate}set rotate(e){this._rotate=e,this.valid&&this.updateUvs()}get width(){return this.orig.width}get height(){return this.orig.height}castToBaseTexture(){return this.baseTexture}static get EMPTY(){return K._EMPTY||(K._EMPTY=new K(new W),Vr(K._EMPTY),Vr(K._EMPTY.baseTexture)),K._EMPTY}static get WHITE(){if(!K._WHITE){const e=H.ADAPTER.createCanvas(16,16),t=e.getContext("2d");e.width=16,e.height=16,t.fillStyle="white",t.fillRect(0,0,16,16),K._WHITE=new K(W.from(e)),Vr(K._WHITE),Vr(K._WHITE.baseTexture)}return K._WHITE}}class us extends K{constructor(e,t){super(e,t),this.valid=!0,this.filterFrame=null,this.filterPoolKey=null,this.updateUvs()}get framebuffer(){return this.baseTexture.framebuffer}get multisample(){return this.framebuffer.multisample}set multisample(e){this.framebuffer.multisample=e}resize(e,t,r=!0){const i=this.baseTexture.resolution,n=Math.round(e*i)/i,a=Math.round(t*i)/i;this.valid=n>0&&a>0,this._frame.width=this.orig.width=n,this._frame.height=this.orig.height=a,r&&this.baseTexture.resize(n,a),this.updateUvs()}setResolution(e){const{baseTexture:t}=this;t.resolution!==e&&(t.setResolution(e),this.resize(t.width,t.height,!1))}static create(e){return new us(new Na(e))}}class Fa{constructor(e){this.texturePool={},this.textureOptions=e||{},this.enableFullScreen=!1,this._pixelsWidth=0,this._pixelsHeight=0}createTexture(e,t,r=ae.NONE){const i=new Na(Object.assign({width:e,height:t,resolution:1,multisample:r},this.textureOptions));return new us(i)}getOptimalTexture(e,t,r=1,i=ae.NONE){let n;e=Math.max(Math.ceil(e*r-1e-6),1),t=Math.max(Math.ceil(t*r-1e-6),1),!this.enableFullScreen||e!==this._pixelsWidth||t!==this._pixelsHeight?(e=Fr(e),t=Fr(t),n=((e&65535)<<16|t&65535)>>>0,i>1&&(n+=i*4294967296)):n=i>1?-i:-1,this.texturePool[n]||(this.texturePool[n]=[]);let a=this.texturePool[n].pop();return a||(a=this.createTexture(e,t,i)),a.filterPoolKey=n,a.setResolution(r),a}getFilterTexture(e,t,r){const i=this.getOptimalTexture(e.width,e.height,t||e.resolution,r||ae.NONE);return i.filterFrame=e.filterFrame,i}returnTexture(e){const t=e.filterPoolKey;e.filterFrame=null,this.texturePool[t].push(e)}returnFilterTexture(e){this.returnTexture(e)}clear(e){if(e=e!==!1,e)for(const t in this.texturePool){const r=this.texturePool[t];if(r)for(let i=0;i<r.length;i++)r[i].destroy(!0)}this.texturePool={}}setScreenSize(e){if(!(e.width===this._pixelsWidth&&e.height===this._pixelsHeight)){this.enableFullScreen=e.width>0&&e.height>0;for(const t in this.texturePool){if(!(Number(t)<0))continue;const r=this.texturePool[t];if(r)for(let i=0;i<r.length;i++)r[i].destroy(!0);this.texturePool[t]=[]}this._pixelsWidth=e.width,this._pixelsHeight=e.height}}}Fa.SCREEN_KEY=-1;class kc extends qt{constructor(){super(),this.addAttribute("aVertexPosition",new Float32Array([0,0,1,0,1,1,0,1])).addIndex([0,1,3,2])}}class Bc extends qt{constructor(){super(),this.vertices=new Float32Array([-1,-1,1,-1,1,1,-1,1]),this.uvs=new Float32Array([0,0,1,0,1,1,0,1]),this.vertexBuffer=new ge(this.vertices),this.uvBuffer=new ge(this.uvs),this.addAttribute("aVertexPosition",this.vertexBuffer).addAttribute("aTextureCoord",this.uvBuffer).addIndex([0,1,2,0,2,3])}map(e,t){let r=0,i=0;return this.uvs[0]=r,this.uvs[1]=i,this.uvs[2]=r+t.width/e.width,this.uvs[3]=i,this.uvs[4]=r+t.width/e.width,this.uvs[5]=i+t.height/e.height,this.uvs[6]=r,this.uvs[7]=i+t.height/e.height,r=t.x,i=t.y,this.vertices[0]=r,this.vertices[1]=i,this.vertices[2]=r+t.width,this.vertices[3]=i,this.vertices[4]=r+t.width,this.vertices[5]=i+t.height,this.vertices[6]=r,this.vertices[7]=i+t.height,this.invalidate(),this}invalidate(){return this.vertexBuffer._updateID++,this.uvBuffer._updateID++,this}}class Uc{constructor(){this.renderTexture=null,this.target=null,this.legacy=!1,this.resolution=1,this.multisample=ae.NONE,this.sourceFrame=new Q,this.destinationFrame=new Q,this.bindingSourceFrame=new Q,this.bindingDestinationFrame=new Q,this.filters=[],this.transform=null}clear(){this.target=null,this.filters=null,this.renderTexture=null}}const Xr=[new be,new be,new be,new be],bi=new ue;class Da{constructor(e){this.renderer=e,this.defaultFilterStack=[{}],this.texturePool=new Fa,this.statePool=[],this.quad=new kc,this.quadUv=new Bc,this.tempRect=new Q,this.activeState={},this.globalUniforms=new Ue({outputFrame:new Q,inputSize:new Float32Array(4),inputPixel:new Float32Array(4),inputClamp:new Float32Array(4),resolution:1,filterArea:new Float32Array(4),filterClamp:new Float32Array(4)},!0),this.forceClear=!1,this.useMaxPadding=!1}init(){this.texturePool.setScreenSize(this.renderer.view)}push(e,t){const r=this.renderer,i=this.defaultFilterStack,n=this.statePool.pop()||new Uc,a=r.renderTexture;let o,h;if(a.current){const y=a.current;o=y.resolution,h=y.multisample}else o=r.resolution,h=r.multisample;let l=t[0].resolution||o,u=t[0].multisample??h,c=t[0].padding,d=t[0].autoFit,f=t[0].legacy??!0;for(let y=1;y<t.length;y++){const x=t[y];l=Math.min(l,x.resolution||o),u=Math.min(u,x.multisample??h),c=this.useMaxPadding?Math.max(c,x.padding):c+x.padding,d=d&&x.autoFit,f=f||(x.legacy??!0)}i.length===1&&(this.defaultFilterStack[0].renderTexture=a.current),i.push(n),n.resolution=l,n.multisample=u,n.legacy=f,n.target=e,n.sourceFrame.copyFrom(e.filterArea||e.getBounds(!0)),n.sourceFrame.pad(c);const p=this.tempRect.copyFrom(a.sourceFrame);r.projection.transform&&this.transformAABB(bi.copyFrom(r.projection.transform).invert(),p),d?(n.sourceFrame.fit(p),(n.sourceFrame.width<=0||n.sourceFrame.height<=0)&&(n.sourceFrame.width=0,n.sourceFrame.height=0)):n.sourceFrame.intersects(p)||(n.sourceFrame.width=0,n.sourceFrame.height=0),this.roundFrame(n.sourceFrame,a.current?a.current.resolution:r.resolution,a.sourceFrame,a.destinationFrame,r.projection.transform),n.renderTexture=this.getOptimalFilterTexture(n.sourceFrame.width,n.sourceFrame.height,l,u),n.filters=t,n.destinationFrame.width=n.renderTexture.width,n.destinationFrame.height=n.renderTexture.height;const m=this.tempRect;m.x=0,m.y=0,m.width=n.sourceFrame.width,m.height=n.sourceFrame.height,n.renderTexture.filterFrame=n.sourceFrame,n.bindingSourceFrame.copyFrom(a.sourceFrame),n.bindingDestinationFrame.copyFrom(a.destinationFrame),n.transform=r.projection.transform,r.projection.transform=null,a.bind(n.renderTexture,n.sourceFrame,m),r.framebuffer.clear(0,0,0,0)}pop(){const e=this.defaultFilterStack,t=e.pop(),r=t.filters;this.activeState=t;const i=this.globalUniforms.uniforms;i.outputFrame=t.sourceFrame,i.resolution=t.resolution;const n=i.inputSize,a=i.inputPixel,o=i.inputClamp;if(n[0]=t.destinationFrame.width,n[1]=t.destinationFrame.height,n[2]=1/n[0],n[3]=1/n[1],a[0]=Math.round(n[0]*t.resolution),a[1]=Math.round(n[1]*t.resolution),a[2]=1/a[0],a[3]=1/a[1],o[0]=.5*a[2],o[1]=.5*a[3],o[2]=t.sourceFrame.width*n[2]-.5*a[2],o[3]=t.sourceFrame.height*n[3]-.5*a[3],t.legacy){const l=i.filterArea;l[0]=t.destinationFrame.width,l[1]=t.destinationFrame.height,l[2]=t.sourceFrame.x,l[3]=t.sourceFrame.y,i.filterClamp=i.inputClamp}this.globalUniforms.update();const h=e[e.length-1];if(this.renderer.framebuffer.blit(),r.length===1)r[0].apply(this,t.renderTexture,h.renderTexture,ot.BLEND,t),this.returnFilterTexture(t.renderTexture);else{let l=t.renderTexture,u=this.getOptimalFilterTexture(l.width,l.height,t.resolution);u.filterFrame=l.filterFrame;let c=0;for(c=0;c<r.length-1;++c){c===1&&t.multisample>1&&(u=this.getOptimalFilterTexture(l.width,l.height,t.resolution),u.filterFrame=l.filterFrame),r[c].apply(this,l,u,ot.CLEAR,t);const d=l;l=u,u=d}r[c].apply(this,l,h.renderTexture,ot.BLEND,t),c>1&&t.multisample>1&&this.returnFilterTexture(t.renderTexture),this.returnFilterTexture(l),this.returnFilterTexture(u)}t.clear(),this.statePool.push(t)}bindAndClear(e,t=ot.CLEAR){const{renderTexture:r,state:i}=this.renderer;if(e===this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?this.renderer.projection.transform=this.activeState.transform:this.renderer.projection.transform=null,e==null?void 0:e.filterFrame){const a=this.tempRect;a.x=0,a.y=0,a.width=e.filterFrame.width,a.height=e.filterFrame.height,r.bind(e,e.filterFrame,a)}else e!==this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?r.bind(e):this.renderer.renderTexture.bind(e,this.activeState.bindingSourceFrame,this.activeState.bindingDestinationFrame);const n=i.stateId&1||this.forceClear;(t===ot.CLEAR||t===ot.BLIT&&n)&&this.renderer.framebuffer.clear(0,0,0,0)}applyFilter(e,t,r,i){const n=this.renderer;n.state.set(e.state),this.bindAndClear(r,i),e.uniforms.uSampler=t,e.uniforms.filterGlobals=this.globalUniforms,n.shader.bind(e),e.legacy=!!e.program.attributeData.aTextureCoord,e.legacy?(this.quadUv.map(t._frame,t.filterFrame),n.geometry.bind(this.quadUv),n.geometry.draw(gr.TRIANGLES)):(n.geometry.bind(this.quad),n.geometry.draw(gr.TRIANGLE_STRIP))}calculateSpriteMatrix(e,t){const{sourceFrame:r,destinationFrame:i}=this.activeState,{orig:n}=t._texture,a=e.set(i.width,0,0,i.height,r.x,r.y),o=t.worldTransform.copyTo(ue.TEMP_MATRIX);return o.invert(),a.prepend(o),a.scale(1/n.width,1/n.height),a.translate(t.anchor.x,t.anchor.y),a}destroy(){this.renderer=null,this.texturePool.clear(!1)}getOptimalFilterTexture(e,t,r=1,i=ae.NONE){return this.texturePool.getOptimalTexture(e,t,r,i)}getFilterTexture(e,t,r){if(typeof e=="number"){const n=e;e=t,t=n}e=e||this.activeState.renderTexture;const i=this.texturePool.getOptimalTexture(e.width,e.height,t||e.resolution,r||ae.NONE);return i.filterFrame=e.filterFrame,i}returnFilterTexture(e){this.texturePool.returnTexture(e)}emptyPool(){this.texturePool.clear(!0)}resize(){this.texturePool.setScreenSize(this.renderer.view)}transformAABB(e,t){const r=Xr[0],i=Xr[1],n=Xr[2],a=Xr[3];r.set(t.left,t.top),i.set(t.left,t.bottom),n.set(t.right,t.top),a.set(t.right,t.bottom),e.apply(r,r),e.apply(i,i),e.apply(n,n),e.apply(a,a);const o=Math.min(r.x,i.x,n.x,a.x),h=Math.min(r.y,i.y,n.y,a.y),l=Math.max(r.x,i.x,n.x,a.x),u=Math.max(r.y,i.y,n.y,a.y);t.x=o,t.y=h,t.width=l-o,t.height=u-h}roundFrame(e,t,r,i,n){if(!(e.width<=0||e.height<=0||r.width<=0||r.height<=0)){if(n){const{a,b:o,c:h,d:l}=n;if((Math.abs(o)>1e-4||Math.abs(h)>1e-4)&&(Math.abs(a)>1e-4||Math.abs(l)>1e-4))return}n=n?bi.copyFrom(n):bi.identity(),n.translate(-r.x,-r.y).scale(i.width/r.width,i.height/r.height).translate(i.x,i.y),this.transformAABB(n,e),e.ceil(t),this.transformAABB(n.invert(),e)}}}Da.extension={type:U.RendererSystem,name:"filter"},V.add(Da);class Gc{constructor(e){this.framebuffer=e,this.stencil=null,this.dirtyId=-1,this.dirtyFormat=-1,this.dirtySize=-1,this.multisample=ae.NONE,this.msaaBuffer=null,this.blitFramebuffer=null,this.mipLevel=0}}const jc=new Q;class ka{constructor(e){this.renderer=e,this.managedFramebuffers=[],this.unknownFramebuffer=new yi(10,10),this.msaaSamples=null}contextChange(){this.disposeAll(!0);const e=this.gl=this.renderer.gl;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.current=this.unknownFramebuffer,this.viewport=new Q,this.hasMRT=!0,this.writeDepthTexture=!0,this.renderer.context.webGLVersion===1){let t=this.renderer.context.extensions.drawBuffers,r=this.renderer.context.extensions.depthTexture;H.PREFER_ENV===it.WEBGL_LEGACY&&(t=null,r=null),t?e.drawBuffers=i=>t.drawBuffersWEBGL(i):(this.hasMRT=!1,e.drawBuffers=()=>{}),r||(this.writeDepthTexture=!1)}else this.msaaSamples=e.getInternalformatParameter(e.RENDERBUFFER,e.RGBA8,e.SAMPLES)}bind(e,t,r=0){const{gl:i}=this;if(e){const n=e.glFramebuffers[this.CONTEXT_UID]||this.initFramebuffer(e);this.current!==e&&(this.current=e,i.bindFramebuffer(i.FRAMEBUFFER,n.framebuffer)),n.mipLevel!==r&&(e.dirtyId++,e.dirtyFormat++,n.mipLevel=r),n.dirtyId!==e.dirtyId&&(n.dirtyId=e.dirtyId,n.dirtyFormat!==e.dirtyFormat?(n.dirtyFormat=e.dirtyFormat,n.dirtySize=e.dirtySize,this.updateFramebuffer(e,r)):n.dirtySize!==e.dirtySize&&(n.dirtySize=e.dirtySize,this.resizeFramebuffer(e)));for(let a=0;a<e.colorTextures.length;a++){const o=e.colorTextures[a];this.renderer.texture.unbind(o.parentTextureArray||o)}if(e.depthTexture&&this.renderer.texture.unbind(e.depthTexture),t){const a=t.width>>r,o=t.height>>r,h=a/t.width;this.setViewport(t.x*h,t.y*h,a,o)}else{const a=e.width>>r,o=e.height>>r;this.setViewport(0,0,a,o)}}else this.current&&(this.current=null,i.bindFramebuffer(i.FRAMEBUFFER,null)),t?this.setViewport(t.x,t.y,t.width,t.height):this.setViewport(0,0,this.renderer.width,this.renderer.height)}setViewport(e,t,r,i){const n=this.viewport;e=Math.round(e),t=Math.round(t),r=Math.round(r),i=Math.round(i),(n.width!==r||n.height!==i||n.x!==e||n.y!==t)&&(n.x=e,n.y=t,n.width=r,n.height=i,this.gl.viewport(e,t,r,i))}get size(){return this.current?{x:0,y:0,width:this.current.width,height:this.current.height}:{x:0,y:0,width:this.renderer.width,height:this.renderer.height}}clear(e,t,r,i,n=ds.COLOR|ds.DEPTH){const{gl:a}=this;a.clearColor(e,t,r,i),a.clear(n)}initFramebuffer(e){const{gl:t}=this,r=new Gc(t.createFramebuffer());return r.multisample=this.detectSamples(e.multisample),e.glFramebuffers[this.CONTEXT_UID]=r,this.managedFramebuffers.push(e),e.disposeRunner.add(this),r}resizeFramebuffer(e){const{gl:t}=this,r=e.glFramebuffers[this.CONTEXT_UID];if(r.stencil){t.bindRenderbuffer(t.RENDERBUFFER,r.stencil);let a;this.renderer.context.webGLVersion===1?a=t.DEPTH_STENCIL:e.depth&&e.stencil?a=t.DEPTH24_STENCIL8:e.depth?a=t.DEPTH_COMPONENT24:a=t.STENCIL_INDEX8,r.msaaBuffer?t.renderbufferStorageMultisample(t.RENDERBUFFER,r.multisample,a,e.width,e.height):t.renderbufferStorage(t.RENDERBUFFER,a,e.width,e.height)}const i=e.colorTextures;let n=i.length;t.drawBuffers||(n=Math.min(n,1));for(let a=0;a<n;a++){const o=i[a],h=o.parentTextureArray||o;this.renderer.texture.bind(h,0),a===0&&r.msaaBuffer&&(t.bindRenderbuffer(t.RENDERBUFFER,r.msaaBuffer),t.renderbufferStorageMultisample(t.RENDERBUFFER,r.multisample,h._glTextures[this.CONTEXT_UID].internalFormat,e.width,e.height))}e.depthTexture&&this.writeDepthTexture&&this.renderer.texture.bind(e.depthTexture,0)}updateFramebuffer(e,t){const{gl:r}=this,i=e.glFramebuffers[this.CONTEXT_UID],n=e.colorTextures;let a=n.length;r.drawBuffers||(a=Math.min(a,1)),i.multisample>1&&this.canMultisampleFramebuffer(e)?i.msaaBuffer=i.msaaBuffer||r.createRenderbuffer():i.msaaBuffer&&(r.deleteRenderbuffer(i.msaaBuffer),i.msaaBuffer=null,i.blitFramebuffer&&(i.blitFramebuffer.dispose(),i.blitFramebuffer=null));const o=[];for(let h=0;h<a;h++){const l=n[h],u=l.parentTextureArray||l;this.renderer.texture.bind(u,0),h===0&&i.msaaBuffer?(r.bindRenderbuffer(r.RENDERBUFFER,i.msaaBuffer),r.renderbufferStorageMultisample(r.RENDERBUFFER,i.multisample,u._glTextures[this.CONTEXT_UID].internalFormat,e.width,e.height),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.RENDERBUFFER,i.msaaBuffer)):(r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0+h,l.target,u._glTextures[this.CONTEXT_UID].texture,t),o.push(r.COLOR_ATTACHMENT0+h))}if(o.length>1&&r.drawBuffers(o),e.depthTexture&&this.writeDepthTexture){const h=e.depthTexture;this.renderer.texture.bind(h,0),r.framebufferTexture2D(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.TEXTURE_2D,h._glTextures[this.CONTEXT_UID].texture,t)}if((e.stencil||e.depth)&&!(e.depthTexture&&this.writeDepthTexture)){i.stencil=i.stencil||r.createRenderbuffer();let h,l;this.renderer.context.webGLVersion===1?(h=r.DEPTH_STENCIL_ATTACHMENT,l=r.DEPTH_STENCIL):e.depth&&e.stencil?(h=r.DEPTH_STENCIL_ATTACHMENT,l=r.DEPTH24_STENCIL8):e.depth?(h=r.DEPTH_ATTACHMENT,l=r.DEPTH_COMPONENT24):(h=r.STENCIL_ATTACHMENT,l=r.STENCIL_INDEX8),r.bindRenderbuffer(r.RENDERBUFFER,i.stencil),i.msaaBuffer?r.renderbufferStorageMultisample(r.RENDERBUFFER,i.multisample,l,e.width,e.height):r.renderbufferStorage(r.RENDERBUFFER,l,e.width,e.height),r.framebufferRenderbuffer(r.FRAMEBUFFER,h,r.RENDERBUFFER,i.stencil)}else i.stencil&&(r.deleteRenderbuffer(i.stencil),i.stencil=null)}canMultisampleFramebuffer(e){return this.renderer.context.webGLVersion!==1&&e.colorTextures.length<=1&&!e.depthTexture}detectSamples(e){const{msaaSamples:t}=this;let r=ae.NONE;if(e<=1||t===null)return r;for(let i=0;i<t.length;i++)if(t[i]<=e){r=t[i];break}return r===1&&(r=ae.NONE),r}blit(e,t,r){const{current:i,renderer:n,gl:a,CONTEXT_UID:o}=this;if(n.context.webGLVersion!==2||!i)return;const h=i.glFramebuffers[o];if(!h)return;if(!e){if(!h.msaaBuffer)return;const u=i.colorTextures[0];if(!u)return;h.blitFramebuffer||(h.blitFramebuffer=new yi(i.width,i.height),h.blitFramebuffer.addColorTexture(0,u)),e=h.blitFramebuffer,e.colorTextures[0]!==u&&(e.colorTextures[0]=u,e.dirtyId++,e.dirtyFormat++),(e.width!==i.width||e.height!==i.height)&&(e.width=i.width,e.height=i.height,e.dirtyId++,e.dirtySize++)}t||(t=jc,t.width=i.width,t.height=i.height),r||(r=t);const l=t.width===r.width&&t.height===r.height;this.bind(e),a.bindFramebuffer(a.READ_FRAMEBUFFER,h.framebuffer),a.blitFramebuffer(t.left,t.top,t.right,t.bottom,r.left,r.top,r.right,r.bottom,a.COLOR_BUFFER_BIT,l?a.NEAREST:a.LINEAR),a.bindFramebuffer(a.READ_FRAMEBUFFER,e.glFramebuffers[this.CONTEXT_UID].framebuffer)}disposeFramebuffer(e,t){const r=e.glFramebuffers[this.CONTEXT_UID],i=this.gl;if(!r)return;delete e.glFramebuffers[this.CONTEXT_UID];const n=this.managedFramebuffers.indexOf(e);n>=0&&this.managedFramebuffers.splice(n,1),e.disposeRunner.remove(this),t||(i.deleteFramebuffer(r.framebuffer),r.msaaBuffer&&i.deleteRenderbuffer(r.msaaBuffer),r.stencil&&i.deleteRenderbuffer(r.stencil)),r.blitFramebuffer&&this.disposeFramebuffer(r.blitFramebuffer,t)}disposeAll(e){const t=this.managedFramebuffers;this.managedFramebuffers=[];for(let r=0;r<t.length;r++)this.disposeFramebuffer(t[r],e)}forceStencil(){const e=this.current;if(!e)return;const t=e.glFramebuffers[this.CONTEXT_UID];if(!t||t.stencil&&e.stencil)return;e.stencil=!0;const r=e.width,i=e.height,n=this.gl,a=t.stencil=n.createRenderbuffer();n.bindRenderbuffer(n.RENDERBUFFER,a);let o,h;this.renderer.context.webGLVersion===1?(o=n.DEPTH_STENCIL_ATTACHMENT,h=n.DEPTH_STENCIL):e.depth?(o=n.DEPTH_STENCIL_ATTACHMENT,h=n.DEPTH24_STENCIL8):(o=n.STENCIL_ATTACHMENT,h=n.STENCIL_INDEX8),t.msaaBuffer?n.renderbufferStorageMultisample(n.RENDERBUFFER,t.multisample,h,r,i):n.renderbufferStorage(n.RENDERBUFFER,h,r,i),n.framebufferRenderbuffer(n.FRAMEBUFFER,o,n.RENDERBUFFER,a)}reset(){this.current=this.unknownFramebuffer,this.viewport=new Q}destroy(){this.renderer=null}}ka.extension={type:U.RendererSystem,name:"framebuffer"},V.add(ka);const xi={5126:4,5123:2,5121:1};class Ba{constructor(e){this.renderer=e,this._activeGeometry=null,this._activeVao=null,this.hasVao=!0,this.hasInstance=!0,this.canUseUInt32ElementIndex=!1,this.managedGeometries={}}contextChange(){this.disposeAll(!0);const e=this.gl=this.renderer.gl,t=this.renderer.context;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,t.webGLVersion!==2){let r=this.renderer.context.extensions.vertexArrayObject;H.PREFER_ENV===it.WEBGL_LEGACY&&(r=null),r?(e.createVertexArray=()=>r.createVertexArrayOES(),e.bindVertexArray=i=>r.bindVertexArrayOES(i),e.deleteVertexArray=i=>r.deleteVertexArrayOES(i)):(this.hasVao=!1,e.createVertexArray=()=>null,e.bindVertexArray=()=>null,e.deleteVertexArray=()=>null)}if(t.webGLVersion!==2){const r=e.getExtension("ANGLE_instanced_arrays");r?(e.vertexAttribDivisor=(i,n)=>r.vertexAttribDivisorANGLE(i,n),e.drawElementsInstanced=(i,n,a,o,h)=>r.drawElementsInstancedANGLE(i,n,a,o,h),e.drawArraysInstanced=(i,n,a,o)=>r.drawArraysInstancedANGLE(i,n,a,o)):this.hasInstance=!1}this.canUseUInt32ElementIndex=t.webGLVersion===2||!!t.extensions.uint32ElementIndex}bind(e,t){t=t||this.renderer.shader.shader;const{gl:r}=this;let i=e.glVertexArrayObjects[this.CONTEXT_UID],n=!1;i||(this.managedGeometries[e.id]=e,e.disposeRunner.add(this),e.glVertexArrayObjects[this.CONTEXT_UID]=i={},n=!0);const a=i[t.program.id]||this.initGeometryVao(e,t,n);this._activeGeometry=e,this._activeVao!==a&&(this._activeVao=a,this.hasVao?r.bindVertexArray(a):this.activateVao(e,t.program)),this.updateBuffers()}reset(){this.unbind()}updateBuffers(){const e=this._activeGeometry,t=this.renderer.buffer;for(let r=0;r<e.buffers.length;r++){const i=e.buffers[r];t.update(i)}}checkCompatibility(e,t){const r=e.attributes,i=t.attributeData;for(const n in i)if(!r[n])throw new Error(`shader and geometry incompatible, geometry missing the "${n}" attribute`)}getSignature(e,t){const r=e.attributes,i=t.attributeData,n=["g",e.id];for(const a in r)i[a]&&n.push(a,i[a].location);return n.join("-")}initGeometryVao(e,t,r=!0){const i=this.gl,n=this.CONTEXT_UID,a=this.renderer.buffer,o=t.program;o.glPrograms[n]||this.renderer.shader.generateProgram(t),this.checkCompatibility(e,o);const h=this.getSignature(e,o),l=e.glVertexArrayObjects[this.CONTEXT_UID];let u=l[h];if(u)return l[o.id]=u,u;const c=e.buffers,d=e.attributes,f={},p={};for(const m in c)f[m]=0,p[m]=0;for(const m in d)!d[m].size&&o.attributeData[m]?d[m].size=o.attributeData[m].size:d[m].size||console.warn(`PIXI Geometry attribute '${m}' size cannot be determined (likely the bound shader does not have the attribute)`),f[d[m].buffer]+=d[m].size*xi[d[m].type];for(const m in d){const y=d[m],x=y.size;y.stride===void 0&&(f[y.buffer]===x*xi[y.type]?y.stride=0:y.stride=f[y.buffer]),y.start===void 0&&(y.start=p[y.buffer],p[y.buffer]+=x*xi[y.type])}u=i.createVertexArray(),i.bindVertexArray(u);for(let m=0;m<c.length;m++){const y=c[m];a.bind(y),r&&y._glBuffers[n].refCount++}return this.activateVao(e,o),l[o.id]=u,l[h]=u,i.bindVertexArray(null),a.unbind(Ne.ARRAY_BUFFER),u}disposeGeometry(e,t){var o;if(!this.managedGeometries[e.id])return;delete this.managedGeometries[e.id];const r=e.glVertexArrayObjects[this.CONTEXT_UID],i=this.gl,n=e.buffers,a=(o=this.renderer)==null?void 0:o.buffer;if(e.disposeRunner.remove(this),!!r){if(a)for(let h=0;h<n.length;h++){const l=n[h]._glBuffers[this.CONTEXT_UID];l&&(l.refCount--,l.refCount===0&&!t&&a.dispose(n[h],t))}if(!t){for(const h in r)if(h[0]==="g"){const l=r[h];this._activeVao===l&&this.unbind(),i.deleteVertexArray(l)}}delete e.glVertexArrayObjects[this.CONTEXT_UID]}}disposeAll(e){const t=Object.keys(this.managedGeometries);for(let r=0;r<t.length;r++)this.disposeGeometry(this.managedGeometries[t[r]],e)}activateVao(e,t){const r=this.gl,i=this.CONTEXT_UID,n=this.renderer.buffer,a=e.buffers,o=e.attributes;e.indexBuffer&&n.bind(e.indexBuffer);let h=null;for(const l in o){const u=o[l],c=a[u.buffer],d=c._glBuffers[i];if(t.attributeData[l]){h!==d&&(n.bind(c),h=d);const f=t.attributeData[l].location;if(r.enableVertexAttribArray(f),r.vertexAttribPointer(f,u.size,u.type||r.FLOAT,u.normalized,u.stride,u.start),u.instance)if(this.hasInstance)r.vertexAttribDivisor(f,u.divisor);else throw new Error("geometry error, GPU Instancing is not supported on this device")}}}draw(e,t,r,i){const{gl:n}=this,a=this._activeGeometry;if(a.indexBuffer){const o=a.indexBuffer.data.BYTES_PER_ELEMENT,h=o===2?n.UNSIGNED_SHORT:n.UNSIGNED_INT;o===2||o===4&&this.canUseUInt32ElementIndex?a.instanced?n.drawElementsInstanced(e,t||a.indexBuffer.data.length,h,(r||0)*o,i||1):n.drawElements(e,t||a.indexBuffer.data.length,h,(r||0)*o):console.warn("unsupported index buffer type: uint32")}else a.instanced?n.drawArraysInstanced(e,r,t||a.getSize(),i||1):n.drawArrays(e,r,t||a.getSize());return this}unbind(){this.gl.bindVertexArray(null),this._activeVao=null,this._activeGeometry=null}destroy(){this.renderer=null}}Ba.extension={type:U.RendererSystem,name:"geometry"},V.add(Ba);const Ua=new ue;class Hc{constructor(e,t){this._texture=e,this.mapCoord=new ue,this.uClampFrame=new Float32Array(4),this.uClampOffset=new Float32Array(2),this._textureID=-1,this._updateID=0,this.clampOffset=0,this.clampMargin=typeof t>"u"?.5:t,this.isSimple=!1}get texture(){return this._texture}set texture(e){this._texture=e,this._textureID=-1}multiplyUvs(e,t){t===void 0&&(t=e);const r=this.mapCoord;for(let i=0;i<e.length;i+=2){const n=e[i],a=e[i+1];t[i]=n*r.a+a*r.c+r.tx,t[i+1]=n*r.b+a*r.d+r.ty}return t}update(e){const t=this._texture;if(!t||!t.valid||!e&&this._textureID===t._updateID)return!1;this._textureID=t._updateID,this._updateID++;const r=t._uvs;this.mapCoord.set(r.x1-r.x0,r.y1-r.y0,r.x3-r.x0,r.y3-r.y0,r.x0,r.y0);const i=t.orig,n=t.trim;n&&(Ua.set(i.width/n.width,0,0,i.height/n.height,-n.x/n.width,-n.y/n.height),this.mapCoord.append(Ua));const a=t.baseTexture,o=this.uClampFrame,h=this.clampMargin/a.resolution,l=this.clampOffset;return o[0]=(t._frame.x+h+l)/a.width,o[1]=(t._frame.y+h+l)/a.height,o[2]=(t._frame.x+t._frame.width-h+l)/a.width,o[3]=(t._frame.y+t._frame.height-h+l)/a.height,this.uClampOffset[0]=l/a.realWidth,this.uClampOffset[1]=l/a.realHeight,this.isSimple=t._frame.width===a.width&&t._frame.height===a.height&&t.rotate===0,!0}}var zc=`varying vec2 vMaskCoord;
varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform sampler2D mask;
uniform float alpha;
uniform float npmAlpha;
uniform vec4 maskClamp;

void main(void)
{
    float clip = step(3.5,
        step(maskClamp.x, vMaskCoord.x) +
        step(maskClamp.y, vMaskCoord.y) +
        step(vMaskCoord.x, maskClamp.z) +
        step(vMaskCoord.y, maskClamp.w));

    vec4 original = texture2D(uSampler, vTextureCoord);
    vec4 masky = texture2D(mask, vMaskCoord);
    float alphaMul = 1.0 - npmAlpha * (1.0 - masky.a);

    original *= (alphaMul * masky.r * alpha * clip);

    gl_FragColor = original;
}
`,Vc=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 otherMatrix;

varying vec2 vMaskCoord;
varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vMaskCoord = ( otherMatrix * vec3( aTextureCoord, 1.0)  ).xy;
}
`;class Xc extends Qe{constructor(e,t,r){let i=null;typeof e!="string"&&t===void 0&&r===void 0&&(i=e,e=void 0,t=void 0,r=void 0),super(e||Vc,t||zc,r),this.maskSprite=i,this.maskMatrix=new ue}get maskSprite(){return this._maskSprite}set maskSprite(e){this._maskSprite=e,this._maskSprite&&(this._maskSprite.renderable=!1)}apply(e,t,r,i){const n=this._maskSprite,a=n._texture;a.valid&&(a.uvMatrix||(a.uvMatrix=new Hc(a,0)),a.uvMatrix.update(),this.uniforms.npmAlpha=a.baseTexture.alphaMode?0:1,this.uniforms.mask=a,this.uniforms.otherMatrix=e.calculateSpriteMatrix(this.maskMatrix,n).prepend(a.uvMatrix.mapCoord),this.uniforms.alpha=n.worldAlpha,this.uniforms.maskClamp=a.uvMatrix.uClampFrame,e.applyFilter(this,t,r,i))}}class $c{constructor(e=null){this.type=oe.NONE,this.autoDetect=!0,this.maskObject=e||null,this.pooled=!1,this.isMaskData=!0,this.resolution=null,this.multisample=Qe.defaultMultisample,this.enabled=!0,this.colorMask=15,this._filters=null,this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null,this._scissorRectLocal=null,this._colorMask=15,this._target=null}get filter(){return this._filters?this._filters[0]:null}set filter(e){e?this._filters?this._filters[0]=e:this._filters=[e]:this._filters=null}reset(){this.pooled&&(this.maskObject=null,this.type=oe.NONE,this.autoDetect=!0),this._target=null,this._scissorRectLocal=null}copyCountersOrReset(e){e?(this._stencilCounter=e._stencilCounter,this._scissorCounter=e._scissorCounter,this._scissorRect=e._scissorRect):(this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null)}}class Ga{constructor(e){this.renderer=e,this.enableScissor=!0,this.alphaMaskPool=[],this.maskDataPool=[],this.maskStack=[],this.alphaMaskIndex=0}setMaskStack(e){this.maskStack=e,this.renderer.scissor.setMaskStack(e),this.renderer.stencil.setMaskStack(e)}push(e,t){let r=t;if(!r.isMaskData){const n=this.maskDataPool.pop()||new $c;n.pooled=!0,n.maskObject=t,r=n}const i=this.maskStack.length!==0?this.maskStack[this.maskStack.length-1]:null;if(r.copyCountersOrReset(i),r._colorMask=i?i._colorMask:15,r.autoDetect&&this.detect(r),r._target=e,r.type!==oe.SPRITE&&this.maskStack.push(r),r.enabled)switch(r.type){case oe.SCISSOR:this.renderer.scissor.push(r);break;case oe.STENCIL:this.renderer.stencil.push(r);break;case oe.SPRITE:r.copyCountersOrReset(null),this.pushSpriteMask(r);break;case oe.COLOR:this.pushColorMask(r);break}r.type===oe.SPRITE&&this.maskStack.push(r)}pop(e){const t=this.maskStack.pop();if(!(!t||t._target!==e)){if(t.enabled)switch(t.type){case oe.SCISSOR:this.renderer.scissor.pop(t);break;case oe.STENCIL:this.renderer.stencil.pop(t.maskObject);break;case oe.SPRITE:this.popSpriteMask(t);break;case oe.COLOR:this.popColorMask(t);break}if(t.reset(),t.pooled&&this.maskDataPool.push(t),this.maskStack.length!==0){const r=this.maskStack[this.maskStack.length-1];r.type===oe.SPRITE&&r._filters&&(r._filters[0].maskSprite=r.maskObject)}}}detect(e){const t=e.maskObject;t?t.isSprite?e.type=oe.SPRITE:this.enableScissor&&this.renderer.scissor.testScissor(e)?e.type=oe.SCISSOR:e.type=oe.STENCIL:e.type=oe.COLOR}pushSpriteMask(e){const{maskObject:t}=e,r=e._target;let i=e._filters;i||(i=this.alphaMaskPool[this.alphaMaskIndex],i||(i=this.alphaMaskPool[this.alphaMaskIndex]=[new Xc])),i[0].resolution=e.resolution,i[0].multisample=e.multisample,i[0].maskSprite=t;const n=r.filterArea;r.filterArea=t.getBounds(!0),this.renderer.filter.push(r,i),r.filterArea=n,e._filters||this.alphaMaskIndex++}popSpriteMask(e){this.renderer.filter.pop(),e._filters?e._filters[0].maskSprite=null:(this.alphaMaskIndex--,this.alphaMaskPool[this.alphaMaskIndex][0].maskSprite=null)}pushColorMask(e){const t=e._colorMask,r=e._colorMask=t&e.colorMask;r!==t&&this.renderer.gl.colorMask((r&1)!==0,(r&2)!==0,(r&4)!==0,(r&8)!==0)}popColorMask(e){const t=e._colorMask,r=this.maskStack.length>0?this.maskStack[this.maskStack.length-1]._colorMask:15;r!==t&&this.renderer.gl.colorMask((r&1)!==0,(r&2)!==0,(r&4)!==0,(r&8)!==0)}destroy(){this.renderer=null}}Ga.extension={type:U.RendererSystem,name:"mask"},V.add(Ga);class ja{constructor(e){this.renderer=e,this.maskStack=[],this.glConst=0}getStackLength(){return this.maskStack.length}setMaskStack(e){const{gl:t}=this.renderer,r=this.getStackLength();this.maskStack=e;const i=this.getStackLength();i!==r&&(i===0?t.disable(this.glConst):(t.enable(this.glConst),this._useCurrent()))}_useCurrent(){}destroy(){this.renderer=null,this.maskStack=null}}const Ha=new ue,za=[],Va=class ns extends ja{constructor(e){super(e),this.glConst=H.ADAPTER.getWebGLRenderingContext().SCISSOR_TEST}getStackLength(){const e=this.maskStack[this.maskStack.length-1];return e?e._scissorCounter:0}calcScissorRect(e){if(e._scissorRectLocal)return;const t=e._scissorRect,{maskObject:r}=e,{renderer:i}=this,n=i.renderTexture,a=r.getBounds(!0,za.pop()??new Q);this.roundFrameToPixels(a,n.current?n.current.resolution:i.resolution,n.sourceFrame,n.destinationFrame,i.projection.transform),t&&a.fit(t),e._scissorRectLocal=a}static isMatrixRotated(e){if(!e)return!1;const{a:t,b:r,c:i,d:n}=e;return(Math.abs(r)>1e-4||Math.abs(i)>1e-4)&&(Math.abs(t)>1e-4||Math.abs(n)>1e-4)}testScissor(e){const{maskObject:t}=e;if(!t.isFastRect||!t.isFastRect()||ns.isMatrixRotated(t.worldTransform)||ns.isMatrixRotated(this.renderer.projection.transform))return!1;this.calcScissorRect(e);const r=e._scissorRectLocal;return r.width>0&&r.height>0}roundFrameToPixels(e,t,r,i,n){ns.isMatrixRotated(n)||(n=n?Ha.copyFrom(n):Ha.identity(),n.translate(-r.x,-r.y).scale(i.width/r.width,i.height/r.height).translate(i.x,i.y),this.renderer.filter.transformAABB(n,e),e.fit(i),e.x=Math.round(e.x*t),e.y=Math.round(e.y*t),e.width=Math.round(e.width*t),e.height=Math.round(e.height*t))}push(e){e._scissorRectLocal||this.calcScissorRect(e);const{gl:t}=this.renderer;e._scissorRect||t.enable(t.SCISSOR_TEST),e._scissorCounter++,e._scissorRect=e._scissorRectLocal,this._useCurrent()}pop(e){const{gl:t}=this.renderer;e&&za.push(e._scissorRectLocal),this.getStackLength()>0?this._useCurrent():t.disable(t.SCISSOR_TEST)}_useCurrent(){const e=this.maskStack[this.maskStack.length-1]._scissorRect;let t;this.renderer.renderTexture.current?t=e.y:t=this.renderer.height-e.height-e.y,this.renderer.gl.scissor(e.x,t,e.width,e.height)}};Va.extension={type:U.RendererSystem,name:"scissor"};let qc=Va;V.add(qc);class Xa extends ja{constructor(e){super(e),this.glConst=H.ADAPTER.getWebGLRenderingContext().STENCIL_TEST}getStackLength(){const e=this.maskStack[this.maskStack.length-1];return e?e._stencilCounter:0}push(e){const t=e.maskObject,{gl:r}=this.renderer,i=e._stencilCounter;i===0&&(this.renderer.framebuffer.forceStencil(),r.clearStencil(0),r.clear(r.STENCIL_BUFFER_BIT),r.enable(r.STENCIL_TEST)),e._stencilCounter++;const n=e._colorMask;n!==0&&(e._colorMask=0,r.colorMask(!1,!1,!1,!1)),r.stencilFunc(r.EQUAL,i,4294967295),r.stencilOp(r.KEEP,r.KEEP,r.INCR),t.renderable=!0,t.render(this.renderer),this.renderer.batch.flush(),t.renderable=!1,n!==0&&(e._colorMask=n,r.colorMask((n&1)!==0,(n&2)!==0,(n&4)!==0,(n&8)!==0)),this._useCurrent()}pop(e){const t=this.renderer.gl;if(this.getStackLength()===0)t.disable(t.STENCIL_TEST);else{const r=this.maskStack.length!==0?this.maskStack[this.maskStack.length-1]:null,i=r?r._colorMask:15;i!==0&&(r._colorMask=0,t.colorMask(!1,!1,!1,!1)),t.stencilOp(t.KEEP,t.KEEP,t.DECR),e.renderable=!0,e.render(this.renderer),this.renderer.batch.flush(),e.renderable=!1,i!==0&&(r._colorMask=i,t.colorMask((i&1)!==0,(i&2)!==0,(i&4)!==0,(i&8)!==0)),this._useCurrent()}}_useCurrent(){const e=this.renderer.gl;e.stencilFunc(e.EQUAL,this.getStackLength(),4294967295),e.stencilOp(e.KEEP,e.KEEP,e.KEEP)}}Xa.extension={type:U.RendererSystem,name:"stencil"},V.add(Xa);class $a{constructor(e){this.renderer=e,this.plugins={},Object.defineProperties(this.plugins,{extract:{enumerable:!1,get(){return $("7.0.0","renderer.plugins.extract has moved to renderer.extract"),e.extract}},prepare:{enumerable:!1,get(){return $("7.0.0","renderer.plugins.prepare has moved to renderer.prepare"),e.prepare}},interaction:{enumerable:!1,get(){return $("7.0.0","renderer.plugins.interaction has been deprecated, use renderer.events"),e.events}}})}init(){const e=this.rendererPlugins;for(const t in e)this.plugins[t]=new e[t](this.renderer)}destroy(){for(const e in this.plugins)this.plugins[e].destroy(),this.plugins[e]=null}}$a.extension={type:[U.RendererSystem,U.CanvasRendererSystem],name:"_plugin"},V.add($a);class qa{constructor(e){this.renderer=e,this.destinationFrame=null,this.sourceFrame=null,this.defaultFrame=null,this.projectionMatrix=new ue,this.transform=null}update(e,t,r,i){this.destinationFrame=e||this.destinationFrame||this.defaultFrame,this.sourceFrame=t||this.sourceFrame||e,this.calculateProjection(this.destinationFrame,this.sourceFrame,r,i),this.transform&&this.projectionMatrix.append(this.transform);const n=this.renderer;n.globalUniforms.uniforms.projectionMatrix=this.projectionMatrix,n.globalUniforms.update(),n.shader.shader&&n.shader.syncUniformGroup(n.shader.shader.uniforms.globals)}calculateProjection(e,t,r,i){const n=this.projectionMatrix,a=i?-1:1;n.identity(),n.a=1/t.width*2,n.d=a*(1/t.height*2),n.tx=-1-t.x*n.a,n.ty=-a-t.y*n.d}setTransform(e){}destroy(){this.renderer=null}}qa.extension={type:U.RendererSystem,name:"projection"},V.add(qa);const Wc=new di,Wa=new Q;class Ya{constructor(e){this.renderer=e,this._tempMatrix=new ue}generateTexture(e,t){const{region:r,...i}=t||{},n=(r==null?void 0:r.copyTo(Wa))||e.getLocalBounds(Wa,!0),a=i.resolution||this.renderer.resolution;n.width=Math.max(n.width,1/a),n.height=Math.max(n.height,1/a),i.width=n.width,i.height=n.height,i.resolution=a,i.multisample??(i.multisample=this.renderer.multisample);const o=us.create(i);this._tempMatrix.tx=-n.x,this._tempMatrix.ty=-n.y;const h=e.transform;return e.transform=Wc,this.renderer.render(e,{renderTexture:o,transform:this._tempMatrix,skipUpdateTransform:!!e.parent,blit:!0}),e.transform=h,o}destroy(){}}Ya.extension={type:[U.RendererSystem,U.CanvasRendererSystem],name:"textureGenerator"},V.add(Ya);const bt=new Q,hr=new Q;class Ka{constructor(e){this.renderer=e,this.defaultMaskStack=[],this.current=null,this.sourceFrame=new Q,this.destinationFrame=new Q,this.viewportFrame=new Q}contextChange(){var t;const e=(t=this.renderer)==null?void 0:t.gl.getContextAttributes();this._rendererPremultipliedAlpha=!!(e&&e.alpha&&e.premultipliedAlpha)}bind(e=null,t,r){const i=this.renderer;this.current=e;let n,a,o;e?(n=e.baseTexture,o=n.resolution,t||(bt.width=e.frame.width,bt.height=e.frame.height,t=bt),r||(hr.x=e.frame.x,hr.y=e.frame.y,hr.width=t.width,hr.height=t.height,r=hr),a=n.framebuffer):(o=i.resolution,t||(bt.width=i._view.screen.width,bt.height=i._view.screen.height,t=bt),r||(r=bt,r.width=t.width,r.height=t.height));const h=this.viewportFrame;h.x=r.x*o,h.y=r.y*o,h.width=r.width*o,h.height=r.height*o,e||(h.y=i.view.height-(h.y+h.height)),h.ceil(),this.renderer.framebuffer.bind(a,h),this.renderer.projection.update(r,t,o,!a),e?this.renderer.mask.setMaskStack(n.maskStack):this.renderer.mask.setMaskStack(this.defaultMaskStack),this.sourceFrame.copyFrom(t),this.destinationFrame.copyFrom(r)}clear(e,t){const r=this.current?this.current.baseTexture.clear:this.renderer.background.backgroundColor,i=Bt.shared.setValue(e||r);(this.current&&this.current.baseTexture.alphaMode>0||!this.current&&this._rendererPremultipliedAlpha)&&i.premultiply(i.alpha);const n=this.destinationFrame,a=this.current?this.current.baseTexture:this.renderer._view.screen,o=n.width!==a.width||n.height!==a.height;if(o){let{x:h,y:l,width:u,height:c}=this.viewportFrame;h=Math.round(h),l=Math.round(l),u=Math.round(u),c=Math.round(c),this.renderer.gl.enable(this.renderer.gl.SCISSOR_TEST),this.renderer.gl.scissor(h,l,u,c)}this.renderer.framebuffer.clear(i.red,i.green,i.blue,i.alpha,t),o&&this.renderer.scissor.pop()}resize(){this.bind(null)}reset(){this.bind(null)}destroy(){this.renderer=null}}Ka.extension={type:U.RendererSystem,name:"renderTexture"},V.add(Ka);class Yc{constructor(e,t){this.program=e,this.uniformData=t,this.uniformGroups={},this.uniformDirtyGroups={},this.uniformBufferBindings={}}destroy(){this.uniformData=null,this.uniformGroups=null,this.uniformDirtyGroups=null,this.uniformBufferBindings=null,this.program=null}}function Kc(s,e){const t={},r=e.getProgramParameter(s,e.ACTIVE_ATTRIBUTES);for(let i=0;i<r;i++){const n=e.getActiveAttrib(s,i);if(n.name.startsWith("gl_"))continue;const a=wa(e,n.type),o={type:a,name:n.name,size:Sa(a),location:e.getAttribLocation(s,n.name)};t[n.name]=o}return t}function Zc(s,e){const t={},r=e.getProgramParameter(s,e.ACTIVE_UNIFORMS);for(let i=0;i<r;i++){const n=e.getActiveUniform(s,i),a=n.name.replace(/\[.*?\]$/,""),o=!!n.name.match(/\[.*?\]$/),h=wa(e,n.type);t[a]={name:a,index:i,type:h,size:n.size,isArray:o,value:Ta(h,n.size)}}return t}function Qc(s,e){var o;const t=_a(s,s.VERTEX_SHADER,e.vertexSrc),r=_a(s,s.FRAGMENT_SHADER,e.fragmentSrc),i=s.createProgram();s.attachShader(i,t),s.attachShader(i,r);const n=(o=e.extra)==null?void 0:o.transformFeedbackVaryings;if(n&&(typeof s.transformFeedbackVaryings!="function"?console.warn("TransformFeedback is not supported but TransformFeedbackVaryings are given."):s.transformFeedbackVaryings(i,n.names,n.bufferMode==="separate"?s.SEPARATE_ATTRIBS:s.INTERLEAVED_ATTRIBS)),s.linkProgram(i),s.getProgramParameter(i,s.LINK_STATUS)||Ac(s,i,t,r),e.attributeData=Kc(i,s),e.uniformData=Zc(i,s),!/^[ \t]*#[ \t]*version[ \t]+300[ \t]+es[ \t]*$/m.test(e.vertexSrc)){const h=Object.keys(e.attributeData);h.sort((l,u)=>l>u?1:-1);for(let l=0;l<h.length;l++)e.attributeData[h[l]].location=l,s.bindAttribLocation(i,l,h[l]);s.linkProgram(i)}s.deleteShader(t),s.deleteShader(r);const a={};for(const h in e.uniformData){const l=e.uniformData[h];a[h]={location:s.getUniformLocation(i,h),value:Ta(l.type,l.size)}}return new Yc(i,a)}function Jc(s,e,t,r,i){t.buffer.update(i)}const ed={float:`
        data[offset] = v;
    `,vec2:`
        data[offset] = v[0];
        data[offset+1] = v[1];
    `,vec3:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];

    `,vec4:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];
        data[offset+3] = v[3];
    `,mat2:`
        data[offset] = v[0];
        data[offset+1] = v[1];

        data[offset+4] = v[2];
        data[offset+5] = v[3];
    `,mat3:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];

        data[offset + 4] = v[3];
        data[offset + 5] = v[4];
        data[offset + 6] = v[5];

        data[offset + 8] = v[6];
        data[offset + 9] = v[7];
        data[offset + 10] = v[8];
    `,mat4:`
        for(var i = 0; i < 16; i++)
        {
            data[offset + i] = v[i];
        }
    `},Za={float:4,vec2:8,vec3:12,vec4:16,int:4,ivec2:8,ivec3:12,ivec4:16,uint:4,uvec2:8,uvec3:12,uvec4:16,bool:4,bvec2:8,bvec3:12,bvec4:16,mat2:16*2,mat3:16*3,mat4:16*4};function td(s){const e=s.map(n=>({data:n,offset:0,dataLen:0,dirty:0}));let t=0,r=0,i=0;for(let n=0;n<e.length;n++){const a=e[n];if(t=Za[a.data.type],a.data.size>1&&(t=Math.max(t,16)*a.data.size),a.dataLen=t,r%t!==0&&r<16){const o=r%t%16;r+=o,i+=o}r+t>16?(i=Math.ceil(i/16)*16,a.offset=i,i+=t,r=t):(a.offset=i,r+=t,i+=t)}return i=Math.ceil(i/16)*16,{uboElements:e,size:i}}function rd(s,e){const t=[];for(const r in s)e[r]&&t.push(e[r]);return t.sort((r,i)=>r.index-i.index),t}function sd(s,e){if(!s.autoManage)return{size:0,syncFunc:Jc};const t=rd(s.uniforms,e),{uboElements:r,size:i}=td(t),n=[`
    var v = null;
    var v2 = null;
    var cv = null;
    var t = 0;
    var gl = renderer.gl
    var index = 0;
    var data = buffer.data;
    `];for(let a=0;a<r.length;a++){const o=r[a],h=s.uniforms[o.data.name],l=o.data.name;let u=!1;for(let c=0;c<Ut.length;c++){const d=Ut[c];if(d.codeUbo&&d.test(o.data,h)){n.push(`offset = ${o.offset/4};`,Ut[c].codeUbo(o.data.name,h)),u=!0;break}}if(!u)if(o.data.size>1){const c=Sa(o.data.type),d=Math.max(Za[o.data.type]/16,1),f=c/d,p=(4-f%4)%4;n.push(`
                cv = ud.${l}.value;
                v = uv.${l};
                offset = ${o.offset/4};

                t = 0;

                for(var i=0; i < ${o.data.size*d}; i++)
                {
                    for(var j = 0; j < ${f}; j++)
                    {
                        data[offset++] = v[t++];
                    }
                    offset += ${p};
                }

                `)}else{const c=ed[o.data.type];n.push(`
                cv = ud.${l}.value;
                v = uv.${l};
                offset = ${o.offset/4};
                ${c};
                `)}}return n.push(`
       renderer.buffer.update(buffer);
    `),{size:i,syncFunc:new Function("ud","uv","renderer","syncData","buffer",n.join(`
`))}}let id=0;const $r={textureCount:0,uboCount:0};class Qa{constructor(e){this.destroyed=!1,this.renderer=e,this.systemCheck(),this.gl=null,this.shader=null,this.program=null,this.cache={},this._uboCache={},this.id=id++}systemCheck(){if(!Mc())throw new Error("Current environment does not allow unsafe-eval, please use @pixi/unsafe-eval module to enable support.")}contextChange(e){this.gl=e,this.reset()}bind(e,t){e.disposeRunner.add(this),e.uniforms.globals=this.renderer.globalUniforms;const r=e.program,i=r.glPrograms[this.renderer.CONTEXT_UID]||this.generateProgram(e);return this.shader=e,this.program!==r&&(this.program=r,this.gl.useProgram(i.program)),t||($r.textureCount=0,$r.uboCount=0,this.syncUniformGroup(e.uniformGroup,$r)),i}setUniforms(e){const t=this.shader.program,r=t.glPrograms[this.renderer.CONTEXT_UID];t.syncUniforms(r.uniformData,e,this.renderer)}syncUniformGroup(e,t){const r=this.getGlProgram();(!e.static||e.dirtyId!==r.uniformDirtyGroups[e.id])&&(r.uniformDirtyGroups[e.id]=e.dirtyId,this.syncUniforms(e,r,t))}syncUniforms(e,t,r){(e.syncUniforms[this.shader.program.id]||this.createSyncGroups(e))(t.uniformData,e.uniforms,this.renderer,r)}createSyncGroups(e){const t=this.getSignature(e,this.shader.program.uniformData,"u");return this.cache[t]||(this.cache[t]=_c(e,this.shader.program.uniformData)),e.syncUniforms[this.shader.program.id]=this.cache[t],e.syncUniforms[this.shader.program.id]}syncUniformBufferGroup(e,t){const r=this.getGlProgram();if(!e.static||e.dirtyId!==0||!r.uniformGroups[e.id]){e.dirtyId=0;const i=r.uniformGroups[e.id]||this.createSyncBufferGroup(e,r,t);e.buffer.update(),i(r.uniformData,e.uniforms,this.renderer,$r,e.buffer)}this.renderer.buffer.bindBufferBase(e.buffer,r.uniformBufferBindings[t])}createSyncBufferGroup(e,t,r){const{gl:i}=this.renderer;this.renderer.buffer.bind(e.buffer);const n=this.gl.getUniformBlockIndex(t.program,r);t.uniformBufferBindings[r]=this.shader.uniformBindCount,i.uniformBlockBinding(t.program,n,this.shader.uniformBindCount),this.shader.uniformBindCount++;const a=this.getSignature(e,this.shader.program.uniformData,"ubo");let o=this._uboCache[a];if(o||(o=this._uboCache[a]=sd(e,this.shader.program.uniformData)),e.autoManage){const h=new Float32Array(o.size/4);e.buffer.update(h)}return t.uniformGroups[e.id]=o.syncFunc,t.uniformGroups[e.id]}getSignature(e,t,r){const i=e.uniforms,n=[`${r}-`];for(const a in i)n.push(a),t[a]&&n.push(t[a].type);return n.join("-")}getGlProgram(){return this.shader?this.shader.program.glPrograms[this.renderer.CONTEXT_UID]:null}generateProgram(e){const t=this.gl,r=e.program,i=Qc(t,r);return r.glPrograms[this.renderer.CONTEXT_UID]=i,i}reset(){this.program=null,this.shader=null}disposeShader(e){this.shader===e&&(this.shader=null)}destroy(){this.renderer=null,this.destroyed=!0}}Qa.extension={type:U.RendererSystem,name:"shader"},V.add(Qa);class qr{constructor(e){this.renderer=e}run(e){const{renderer:t}=this;t.runners.init.emit(t.options),e.hello&&console.log(`PixiJS 7.4.2 - ${t.rendererLogId} - https://pixijs.com`),t.resize(t.screen.width,t.screen.height)}destroy(){}}qr.defaultOptions={hello:!1},qr.extension={type:[U.RendererSystem,U.CanvasRendererSystem],name:"startup"},V.add(qr);function nd(s,e=[]){return e[O.NORMAL]=[s.ONE,s.ONE_MINUS_SRC_ALPHA],e[O.ADD]=[s.ONE,s.ONE],e[O.MULTIPLY]=[s.DST_COLOR,s.ONE_MINUS_SRC_ALPHA,s.ONE,s.ONE_MINUS_SRC_ALPHA],e[O.SCREEN]=[s.ONE,s.ONE_MINUS_SRC_COLOR,s.ONE,s.ONE_MINUS_SRC_ALPHA],e[O.OVERLAY]=[s.ONE,s.ONE_MINUS_SRC_ALPHA],e[O.DARKEN]=[s.ONE,s.ONE_MINUS_SRC_ALPHA],e[O.LIGHTEN]=[s.ONE,s.ONE_MINUS_SRC_ALPHA],e[O.COLOR_DODGE]=[s.ONE,s.ONE_MINUS_SRC_ALPHA],e[O.COLOR_BURN]=[s.ONE,s.ONE_MINUS_SRC_ALPHA],e[O.HARD_LIGHT]=[s.ONE,s.ONE_MINUS_SRC_ALPHA],e[O.SOFT_LIGHT]=[s.ONE,s.ONE_MINUS_SRC_ALPHA],e[O.DIFFERENCE]=[s.ONE,s.ONE_MINUS_SRC_ALPHA],e[O.EXCLUSION]=[s.ONE,s.ONE_MINUS_SRC_ALPHA],e[O.HUE]=[s.ONE,s.ONE_MINUS_SRC_ALPHA],e[O.SATURATION]=[s.ONE,s.ONE_MINUS_SRC_ALPHA],e[O.COLOR]=[s.ONE,s.ONE_MINUS_SRC_ALPHA],e[O.LUMINOSITY]=[s.ONE,s.ONE_MINUS_SRC_ALPHA],e[O.NONE]=[0,0],e[O.NORMAL_NPM]=[s.SRC_ALPHA,s.ONE_MINUS_SRC_ALPHA,s.ONE,s.ONE_MINUS_SRC_ALPHA],e[O.ADD_NPM]=[s.SRC_ALPHA,s.ONE,s.ONE,s.ONE],e[O.SCREEN_NPM]=[s.SRC_ALPHA,s.ONE_MINUS_SRC_COLOR,s.ONE,s.ONE_MINUS_SRC_ALPHA],e[O.SRC_IN]=[s.DST_ALPHA,s.ZERO],e[O.SRC_OUT]=[s.ONE_MINUS_DST_ALPHA,s.ZERO],e[O.SRC_ATOP]=[s.DST_ALPHA,s.ONE_MINUS_SRC_ALPHA],e[O.DST_OVER]=[s.ONE_MINUS_DST_ALPHA,s.ONE],e[O.DST_IN]=[s.ZERO,s.SRC_ALPHA],e[O.DST_OUT]=[s.ZERO,s.ONE_MINUS_SRC_ALPHA],e[O.DST_ATOP]=[s.ONE_MINUS_DST_ALPHA,s.SRC_ALPHA],e[O.XOR]=[s.ONE_MINUS_DST_ALPHA,s.ONE_MINUS_SRC_ALPHA],e[O.SUBTRACT]=[s.ONE,s.ONE,s.ONE,s.ONE,s.FUNC_REVERSE_SUBTRACT,s.FUNC_ADD],e}const ad=0,od=1,hd=2,ld=3,ud=4,cd=5,Ja=class Ci{constructor(){this.gl=null,this.stateId=0,this.polygonOffset=0,this.blendMode=O.NONE,this._blendEq=!1,this.map=[],this.map[ad]=this.setBlend,this.map[od]=this.setOffset,this.map[hd]=this.setCullFace,this.map[ld]=this.setDepthTest,this.map[ud]=this.setFrontFace,this.map[cd]=this.setDepthMask,this.checks=[],this.defaultState=new Vt,this.defaultState.blend=!0}contextChange(e){this.gl=e,this.blendModes=nd(e),this.set(this.defaultState),this.reset()}set(e){if(e=e||this.defaultState,this.stateId!==e.data){let t=this.stateId^e.data,r=0;for(;t;)t&1&&this.map[r].call(this,!!(e.data&1<<r)),t=t>>1,r++;this.stateId=e.data}for(let t=0;t<this.checks.length;t++)this.checks[t](this,e)}forceState(e){e=e||this.defaultState;for(let t=0;t<this.map.length;t++)this.map[t].call(this,!!(e.data&1<<t));for(let t=0;t<this.checks.length;t++)this.checks[t](this,e);this.stateId=e.data}setBlend(e){this.updateCheck(Ci.checkBlendMode,e),this.gl[e?"enable":"disable"](this.gl.BLEND)}setOffset(e){this.updateCheck(Ci.checkPolygonOffset,e),this.gl[e?"enable":"disable"](this.gl.POLYGON_OFFSET_FILL)}setDepthTest(e){this.gl[e?"enable":"disable"](this.gl.DEPTH_TEST)}setDepthMask(e){this.gl.depthMask(e)}setCullFace(e){this.gl[e?"enable":"disable"](this.gl.CULL_FACE)}setFrontFace(e){this.gl.frontFace(this.gl[e?"CW":"CCW"])}setBlendMode(e){if(e===this.blendMode)return;this.blendMode=e;const t=this.blendModes[e],r=this.gl;t.length===2?r.blendFunc(t[0],t[1]):r.blendFuncSeparate(t[0],t[1],t[2],t[3]),t.length===6?(this._blendEq=!0,r.blendEquationSeparate(t[4],t[5])):this._blendEq&&(this._blendEq=!1,r.blendEquationSeparate(r.FUNC_ADD,r.FUNC_ADD))}setPolygonOffset(e,t){this.gl.polygonOffset(e,t)}reset(){this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!1),this.forceState(this.defaultState),this._blendEq=!0,this.blendMode=-1,this.setBlendMode(0)}updateCheck(e,t){const r=this.checks.indexOf(e);t&&r===-1?this.checks.push(e):!t&&r!==-1&&this.checks.splice(r,1)}static checkBlendMode(e,t){e.setBlendMode(t.blendMode)}static checkPolygonOffset(e,t){e.setPolygonOffset(1,t.polygonOffset)}destroy(){this.gl=null}};Ja.extension={type:U.RendererSystem,name:"state"};let dd=Ja;V.add(dd);class fd extends xr{constructor(){super(...arguments),this.runners={},this._systemsHash={}}setup(e){this.addRunners(...e.runners);const t=(e.priority??[]).filter(i=>e.systems[i]),r=[...t,...Object.keys(e.systems).filter(i=>!t.includes(i))];for(const i of r)this.addSystem(e.systems[i],i)}addRunners(...e){e.forEach(t=>{this.runners[t]=new Ie(t)})}addSystem(e,t){const r=new e(this);if(this[t])throw new Error(`Whoops! The name "${t}" is already in use`);this[t]=r,this._systemsHash[t]=r;for(const i in this.runners)this.runners[i].add(r);return this}emitWithCustomOptions(e,t){const r=Object.keys(this._systemsHash);e.items.forEach(i=>{const n=r.find(a=>this._systemsHash[a]===i);i[e.name](t[n])})}destroy(){Object.values(this.runners).forEach(e=>{e.destroy()}),this._systemsHash={}}}const lr=class as{constructor(e){this.renderer=e,this.count=0,this.checkCount=0,this.maxIdle=as.defaultMaxIdle,this.checkCountMax=as.defaultCheckCountMax,this.mode=as.defaultMode}postrender(){this.renderer.objectRenderer.renderingToScreen&&(this.count++,this.mode!==ps.MANUAL&&(this.checkCount++,this.checkCount>this.checkCountMax&&(this.checkCount=0,this.run())))}run(){const e=this.renderer.texture,t=e.managedTextures;let r=!1;for(let i=0;i<t.length;i++){const n=t[i];n.resource&&this.count-n.touched>this.maxIdle&&(e.destroyTexture(n,!0),t[i]=null,r=!0)}if(r){let i=0;for(let n=0;n<t.length;n++)t[n]!==null&&(t[i++]=t[n]);t.length=i}}unload(e){const t=this.renderer.texture,r=e._texture;r&&!r.framebuffer&&t.destroyTexture(r);for(let i=e.children.length-1;i>=0;i--)this.unload(e.children[i])}destroy(){this.renderer=null}};lr.defaultMode=ps.AUTO,lr.defaultMaxIdle=60*60,lr.defaultCheckCountMax=60*10,lr.extension={type:U.RendererSystem,name:"textureGC"};let xt=lr;V.add(xt);class vi{constructor(e){this.texture=e,this.width=-1,this.height=-1,this.dirtyId=-1,this.dirtyStyleId=-1,this.mipmap=!1,this.wrapMode=33071,this.type=B.UNSIGNED_BYTE,this.internalFormat=M.RGBA,this.samplerType=0}}function pd(s){let e;return"WebGL2RenderingContext"in globalThis&&s instanceof globalThis.WebGL2RenderingContext?e={[s.RGB]:R.FLOAT,[s.RGBA]:R.FLOAT,[s.ALPHA]:R.FLOAT,[s.LUMINANCE]:R.FLOAT,[s.LUMINANCE_ALPHA]:R.FLOAT,[s.R8]:R.FLOAT,[s.R8_SNORM]:R.FLOAT,[s.RG8]:R.FLOAT,[s.RG8_SNORM]:R.FLOAT,[s.RGB8]:R.FLOAT,[s.RGB8_SNORM]:R.FLOAT,[s.RGB565]:R.FLOAT,[s.RGBA4]:R.FLOAT,[s.RGB5_A1]:R.FLOAT,[s.RGBA8]:R.FLOAT,[s.RGBA8_SNORM]:R.FLOAT,[s.RGB10_A2]:R.FLOAT,[s.RGB10_A2UI]:R.FLOAT,[s.SRGB8]:R.FLOAT,[s.SRGB8_ALPHA8]:R.FLOAT,[s.R16F]:R.FLOAT,[s.RG16F]:R.FLOAT,[s.RGB16F]:R.FLOAT,[s.RGBA16F]:R.FLOAT,[s.R32F]:R.FLOAT,[s.RG32F]:R.FLOAT,[s.RGB32F]:R.FLOAT,[s.RGBA32F]:R.FLOAT,[s.R11F_G11F_B10F]:R.FLOAT,[s.RGB9_E5]:R.FLOAT,[s.R8I]:R.INT,[s.R8UI]:R.UINT,[s.R16I]:R.INT,[s.R16UI]:R.UINT,[s.R32I]:R.INT,[s.R32UI]:R.UINT,[s.RG8I]:R.INT,[s.RG8UI]:R.UINT,[s.RG16I]:R.INT,[s.RG16UI]:R.UINT,[s.RG32I]:R.INT,[s.RG32UI]:R.UINT,[s.RGB8I]:R.INT,[s.RGB8UI]:R.UINT,[s.RGB16I]:R.INT,[s.RGB16UI]:R.UINT,[s.RGB32I]:R.INT,[s.RGB32UI]:R.UINT,[s.RGBA8I]:R.INT,[s.RGBA8UI]:R.UINT,[s.RGBA16I]:R.INT,[s.RGBA16UI]:R.UINT,[s.RGBA32I]:R.INT,[s.RGBA32UI]:R.UINT,[s.DEPTH_COMPONENT16]:R.FLOAT,[s.DEPTH_COMPONENT24]:R.FLOAT,[s.DEPTH_COMPONENT32F]:R.FLOAT,[s.DEPTH_STENCIL]:R.FLOAT,[s.DEPTH24_STENCIL8]:R.FLOAT,[s.DEPTH32F_STENCIL8]:R.FLOAT}:e={[s.RGB]:R.FLOAT,[s.RGBA]:R.FLOAT,[s.ALPHA]:R.FLOAT,[s.LUMINANCE]:R.FLOAT,[s.LUMINANCE_ALPHA]:R.FLOAT,[s.DEPTH_STENCIL]:R.FLOAT},e}function md(s){let e;return"WebGL2RenderingContext"in globalThis&&s instanceof globalThis.WebGL2RenderingContext?e={[B.UNSIGNED_BYTE]:{[M.RGBA]:s.RGBA8,[M.RGB]:s.RGB8,[M.RG]:s.RG8,[M.RED]:s.R8,[M.RGBA_INTEGER]:s.RGBA8UI,[M.RGB_INTEGER]:s.RGB8UI,[M.RG_INTEGER]:s.RG8UI,[M.RED_INTEGER]:s.R8UI,[M.ALPHA]:s.ALPHA,[M.LUMINANCE]:s.LUMINANCE,[M.LUMINANCE_ALPHA]:s.LUMINANCE_ALPHA},[B.BYTE]:{[M.RGBA]:s.RGBA8_SNORM,[M.RGB]:s.RGB8_SNORM,[M.RG]:s.RG8_SNORM,[M.RED]:s.R8_SNORM,[M.RGBA_INTEGER]:s.RGBA8I,[M.RGB_INTEGER]:s.RGB8I,[M.RG_INTEGER]:s.RG8I,[M.RED_INTEGER]:s.R8I},[B.UNSIGNED_SHORT]:{[M.RGBA_INTEGER]:s.RGBA16UI,[M.RGB_INTEGER]:s.RGB16UI,[M.RG_INTEGER]:s.RG16UI,[M.RED_INTEGER]:s.R16UI,[M.DEPTH_COMPONENT]:s.DEPTH_COMPONENT16},[B.SHORT]:{[M.RGBA_INTEGER]:s.RGBA16I,[M.RGB_INTEGER]:s.RGB16I,[M.RG_INTEGER]:s.RG16I,[M.RED_INTEGER]:s.R16I},[B.UNSIGNED_INT]:{[M.RGBA_INTEGER]:s.RGBA32UI,[M.RGB_INTEGER]:s.RGB32UI,[M.RG_INTEGER]:s.RG32UI,[M.RED_INTEGER]:s.R32UI,[M.DEPTH_COMPONENT]:s.DEPTH_COMPONENT24},[B.INT]:{[M.RGBA_INTEGER]:s.RGBA32I,[M.RGB_INTEGER]:s.RGB32I,[M.RG_INTEGER]:s.RG32I,[M.RED_INTEGER]:s.R32I},[B.FLOAT]:{[M.RGBA]:s.RGBA32F,[M.RGB]:s.RGB32F,[M.RG]:s.RG32F,[M.RED]:s.R32F,[M.DEPTH_COMPONENT]:s.DEPTH_COMPONENT32F},[B.HALF_FLOAT]:{[M.RGBA]:s.RGBA16F,[M.RGB]:s.RGB16F,[M.RG]:s.RG16F,[M.RED]:s.R16F},[B.UNSIGNED_SHORT_5_6_5]:{[M.RGB]:s.RGB565},[B.UNSIGNED_SHORT_4_4_4_4]:{[M.RGBA]:s.RGBA4},[B.UNSIGNED_SHORT_5_5_5_1]:{[M.RGBA]:s.RGB5_A1},[B.UNSIGNED_INT_2_10_10_10_REV]:{[M.RGBA]:s.RGB10_A2,[M.RGBA_INTEGER]:s.RGB10_A2UI},[B.UNSIGNED_INT_10F_11F_11F_REV]:{[M.RGB]:s.R11F_G11F_B10F},[B.UNSIGNED_INT_5_9_9_9_REV]:{[M.RGB]:s.RGB9_E5},[B.UNSIGNED_INT_24_8]:{[M.DEPTH_STENCIL]:s.DEPTH24_STENCIL8},[B.FLOAT_32_UNSIGNED_INT_24_8_REV]:{[M.DEPTH_STENCIL]:s.DEPTH32F_STENCIL8}}:e={[B.UNSIGNED_BYTE]:{[M.RGBA]:s.RGBA,[M.RGB]:s.RGB,[M.ALPHA]:s.ALPHA,[M.LUMINANCE]:s.LUMINANCE,[M.LUMINANCE_ALPHA]:s.LUMINANCE_ALPHA},[B.UNSIGNED_SHORT_5_6_5]:{[M.RGB]:s.RGB},[B.UNSIGNED_SHORT_4_4_4_4]:{[M.RGBA]:s.RGBA},[B.UNSIGNED_SHORT_5_5_5_1]:{[M.RGBA]:s.RGBA}},e}class eo{constructor(e){this.renderer=e,this.boundTextures=[],this.currentLocation=-1,this.managedTextures=[],this._unknownBoundTextures=!1,this.unknownTexture=new W,this.hasIntegerTextures=!1}contextChange(){const e=this.gl=this.renderer.gl;this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.webGLVersion=this.renderer.context.webGLVersion,this.internalFormats=md(e),this.samplerTypes=pd(e);const t=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS);this.boundTextures.length=t;for(let i=0;i<t;i++)this.boundTextures[i]=null;this.emptyTextures={};const r=new vi(e.createTexture());e.bindTexture(e.TEXTURE_2D,r.texture),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,new Uint8Array(4)),this.emptyTextures[e.TEXTURE_2D]=r,this.emptyTextures[e.TEXTURE_CUBE_MAP]=new vi(e.createTexture()),e.bindTexture(e.TEXTURE_CUBE_MAP,this.emptyTextures[e.TEXTURE_CUBE_MAP].texture);for(let i=0;i<6;i++)e.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+i,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,null);e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MIN_FILTER,e.LINEAR);for(let i=0;i<this.boundTextures.length;i++)this.bind(null,i)}bind(e,t=0){const{gl:r}=this;if(e=e==null?void 0:e.castToBaseTexture(),(e==null?void 0:e.valid)&&!e.parentTextureArray){e.touched=this.renderer.textureGC.count;const i=e._glTextures[this.CONTEXT_UID]||this.initTexture(e);this.boundTextures[t]!==e&&(this.currentLocation!==t&&(this.currentLocation=t,r.activeTexture(r.TEXTURE0+t)),r.bindTexture(e.target,i.texture)),i.dirtyId!==e.dirtyId?(this.currentLocation!==t&&(this.currentLocation=t,r.activeTexture(r.TEXTURE0+t)),this.updateTexture(e)):i.dirtyStyleId!==e.dirtyStyleId&&this.updateTextureStyle(e),this.boundTextures[t]=e}else this.currentLocation!==t&&(this.currentLocation=t,r.activeTexture(r.TEXTURE0+t)),r.bindTexture(r.TEXTURE_2D,this.emptyTextures[r.TEXTURE_2D].texture),this.boundTextures[t]=null}reset(){this._unknownBoundTextures=!0,this.hasIntegerTextures=!1,this.currentLocation=-1;for(let e=0;e<this.boundTextures.length;e++)this.boundTextures[e]=this.unknownTexture}unbind(e){const{gl:t,boundTextures:r}=this;if(this._unknownBoundTextures){this._unknownBoundTextures=!1;for(let i=0;i<r.length;i++)r[i]===this.unknownTexture&&this.bind(null,i)}for(let i=0;i<r.length;i++)r[i]===e&&(this.currentLocation!==i&&(t.activeTexture(t.TEXTURE0+i),this.currentLocation=i),t.bindTexture(e.target,this.emptyTextures[e.target].texture),r[i]=null)}ensureSamplerType(e){const{boundTextures:t,hasIntegerTextures:r,CONTEXT_UID:i}=this;if(r)for(let n=e-1;n>=0;--n){const a=t[n];a&&a._glTextures[i].samplerType!==R.FLOAT&&this.renderer.texture.unbind(a)}}initTexture(e){const t=new vi(this.gl.createTexture());return t.dirtyId=-1,e._glTextures[this.CONTEXT_UID]=t,this.managedTextures.push(e),e.on("dispose",this.destroyTexture,this),t}initTextureType(e,t){var r;t.internalFormat=((r=this.internalFormats[e.type])==null?void 0:r[e.format])??e.format,t.samplerType=this.samplerTypes[t.internalFormat]??R.FLOAT,this.webGLVersion===2&&e.type===B.HALF_FLOAT?t.type=this.gl.HALF_FLOAT:t.type=e.type}updateTexture(e){var i;const t=e._glTextures[this.CONTEXT_UID];if(!t)return;const r=this.renderer;if(this.initTextureType(e,t),(i=e.resource)==null?void 0:i.upload(r,e,t))t.samplerType!==R.FLOAT&&(this.hasIntegerTextures=!0);else{const n=e.realWidth,a=e.realHeight,o=r.gl;(t.width!==n||t.height!==a||t.dirtyId<0)&&(t.width=n,t.height=a,o.texImage2D(e.target,0,t.internalFormat,n,a,0,e.format,t.type,null))}e.dirtyStyleId!==t.dirtyStyleId&&this.updateTextureStyle(e),t.dirtyId=e.dirtyId}destroyTexture(e,t){const{gl:r}=this;if(e=e.castToBaseTexture(),e._glTextures[this.CONTEXT_UID]&&(this.unbind(e),r.deleteTexture(e._glTextures[this.CONTEXT_UID].texture),e.off("dispose",this.destroyTexture,this),delete e._glTextures[this.CONTEXT_UID],!t)){const i=this.managedTextures.indexOf(e);i!==-1&&Dr(this.managedTextures,i,1)}}updateTextureStyle(e){var r;const t=e._glTextures[this.CONTEXT_UID];t&&((e.mipmap===nt.POW2||this.webGLVersion!==2)&&!e.isPowerOfTwo?t.mipmap=!1:t.mipmap=e.mipmap>=1,this.webGLVersion!==2&&!e.isPowerOfTwo?t.wrapMode=fs.CLAMP:t.wrapMode=e.wrapMode,(r=e.resource)!=null&&r.style(this.renderer,e,t)||this.setStyle(e,t),t.dirtyStyleId=e.dirtyStyleId)}setStyle(e,t){const r=this.gl;if(t.mipmap&&e.mipmap!==nt.ON_MANUAL&&r.generateMipmap(e.target),r.texParameteri(e.target,r.TEXTURE_WRAP_S,t.wrapMode),r.texParameteri(e.target,r.TEXTURE_WRAP_T,t.wrapMode),t.mipmap){r.texParameteri(e.target,r.TEXTURE_MIN_FILTER,e.scaleMode===He.LINEAR?r.LINEAR_MIPMAP_LINEAR:r.NEAREST_MIPMAP_NEAREST);const i=this.renderer.context.extensions.anisotropicFiltering;if(i&&e.anisotropicLevel>0&&e.scaleMode===He.LINEAR){const n=Math.min(e.anisotropicLevel,r.getParameter(i.MAX_TEXTURE_MAX_ANISOTROPY_EXT));r.texParameterf(e.target,i.TEXTURE_MAX_ANISOTROPY_EXT,n)}}else r.texParameteri(e.target,r.TEXTURE_MIN_FILTER,e.scaleMode===He.LINEAR?r.LINEAR:r.NEAREST);r.texParameteri(e.target,r.TEXTURE_MAG_FILTER,e.scaleMode===He.LINEAR?r.LINEAR:r.NEAREST)}destroy(){this.renderer=null}}eo.extension={type:U.RendererSystem,name:"texture"},V.add(eo);class to{constructor(e){this.renderer=e}contextChange(){this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID}bind(e){const{gl:t,CONTEXT_UID:r}=this,i=e._glTransformFeedbacks[r]||this.createGLTransformFeedback(e);t.bindTransformFeedback(t.TRANSFORM_FEEDBACK,i)}unbind(){const{gl:e}=this;e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,null)}beginTransformFeedback(e,t){const{gl:r,renderer:i}=this;t&&i.shader.bind(t),r.beginTransformFeedback(e)}endTransformFeedback(){const{gl:e}=this;e.endTransformFeedback()}createGLTransformFeedback(e){const{gl:t,renderer:r,CONTEXT_UID:i}=this,n=t.createTransformFeedback();e._glTransformFeedbacks[i]=n,t.bindTransformFeedback(t.TRANSFORM_FEEDBACK,n);for(let a=0;a<e.buffers.length;a++){const o=e.buffers[a];o&&(r.buffer.update(o),o._glBuffers[i].refCount++,t.bindBufferBase(t.TRANSFORM_FEEDBACK_BUFFER,a,o._glBuffers[i].buffer||null))}return t.bindTransformFeedback(t.TRANSFORM_FEEDBACK,null),e.disposeRunner.add(this),n}disposeTransformFeedback(e,t){const r=e._glTransformFeedbacks[this.CONTEXT_UID],i=this.gl;e.disposeRunner.remove(this);const n=this.renderer.buffer;if(n)for(let a=0;a<e.buffers.length;a++){const o=e.buffers[a];if(!o)continue;const h=o._glBuffers[this.CONTEXT_UID];h&&(h.refCount--,h.refCount===0&&!t&&n.dispose(o,t))}r&&(t||i.deleteTransformFeedback(r),delete e._glTransformFeedbacks[this.CONTEXT_UID])}destroy(){this.renderer=null}}to.extension={type:U.RendererSystem,name:"transformFeedback"},V.add(to);class Wr{constructor(e){this.renderer=e}init(e){this.screen=new Q(0,0,e.width,e.height),this.element=e.view||H.ADAPTER.createCanvas(),this.resolution=e.resolution||H.RESOLUTION,this.autoDensity=!!e.autoDensity}resizeView(e,t){this.element.width=Math.round(e*this.resolution),this.element.height=Math.round(t*this.resolution);const r=this.element.width/this.resolution,i=this.element.height/this.resolution;this.screen.width=r,this.screen.height=i,this.autoDensity&&(this.element.style.width=`${r}px`,this.element.style.height=`${i}px`),this.renderer.emit("resize",r,i),this.renderer.runners.resize.emit(this.screen.width,this.screen.height)}destroy(e){var t;e&&((t=this.element.parentNode)==null||t.removeChild(this.element)),this.renderer=null,this.element=null,this.screen=null}}Wr.defaultOptions={width:800,height:600,resolution:void 0,autoDensity:!1},Wr.extension={type:[U.RendererSystem,U.CanvasRendererSystem],name:"_view"},V.add(Wr),H.PREFER_ENV=it.WEBGL2,H.STRICT_TEXTURE_CACHE=!1,H.RENDER_OPTIONS={...zr.defaultOptions,...Hr.defaultOptions,...Wr.defaultOptions,...qr.defaultOptions},Object.defineProperties(H,{WRAP_MODE:{get(){return W.defaultOptions.wrapMode},set(s){$("7.1.0","settings.WRAP_MODE is deprecated, use BaseTexture.defaultOptions.wrapMode"),W.defaultOptions.wrapMode=s}},SCALE_MODE:{get(){return W.defaultOptions.scaleMode},set(s){$("7.1.0","settings.SCALE_MODE is deprecated, use BaseTexture.defaultOptions.scaleMode"),W.defaultOptions.scaleMode=s}},MIPMAP_TEXTURES:{get(){return W.defaultOptions.mipmap},set(s){$("7.1.0","settings.MIPMAP_TEXTURES is deprecated, use BaseTexture.defaultOptions.mipmap"),W.defaultOptions.mipmap=s}},ANISOTROPIC_LEVEL:{get(){return W.defaultOptions.anisotropicLevel},set(s){$("7.1.0","settings.ANISOTROPIC_LEVEL is deprecated, use BaseTexture.defaultOptions.anisotropicLevel"),W.defaultOptions.anisotropicLevel=s}},FILTER_RESOLUTION:{get(){return $("7.1.0","settings.FILTER_RESOLUTION is deprecated, use Filter.defaultResolution"),Qe.defaultResolution},set(s){Qe.defaultResolution=s}},FILTER_MULTISAMPLE:{get(){return $("7.1.0","settings.FILTER_MULTISAMPLE is deprecated, use Filter.defaultMultisample"),Qe.defaultMultisample},set(s){Qe.defaultMultisample=s}},SPRITE_MAX_TEXTURES:{get(){return gt.defaultMaxTextures},set(s){$("7.1.0","settings.SPRITE_MAX_TEXTURES is deprecated, use BatchRenderer.defaultMaxTextures"),gt.defaultMaxTextures=s}},SPRITE_BATCH_SIZE:{get(){return gt.defaultBatchSize},set(s){$("7.1.0","settings.SPRITE_BATCH_SIZE is deprecated, use BatchRenderer.defaultBatchSize"),gt.defaultBatchSize=s}},CAN_UPLOAD_SAME_BUFFER:{get(){return gt.canUploadSameBuffer},set(s){$("7.1.0","settings.CAN_UPLOAD_SAME_BUFFER is deprecated, use BatchRenderer.canUploadSameBuffer"),gt.canUploadSameBuffer=s}},GC_MODE:{get(){return xt.defaultMode},set(s){$("7.1.0","settings.GC_MODE is deprecated, use TextureGCSystem.defaultMode"),xt.defaultMode=s}},GC_MAX_IDLE:{get(){return xt.defaultMaxIdle},set(s){$("7.1.0","settings.GC_MAX_IDLE is deprecated, use TextureGCSystem.defaultMaxIdle"),xt.defaultMaxIdle=s}},GC_MAX_CHECK_COUNT:{get(){return xt.defaultCheckCountMax},set(s){$("7.1.0","settings.GC_MAX_CHECK_COUNT is deprecated, use TextureGCSystem.defaultCheckCountMax"),xt.defaultCheckCountMax=s}},PRECISION_VERTEX:{get(){return yt.defaultVertexPrecision},set(s){$("7.1.0","settings.PRECISION_VERTEX is deprecated, use Program.defaultVertexPrecision"),yt.defaultVertexPrecision=s}},PRECISION_FRAGMENT:{get(){return yt.defaultFragmentPrecision},set(s){$("7.1.0","settings.PRECISION_FRAGMENT is deprecated, use Program.defaultFragmentPrecision"),yt.defaultFragmentPrecision=s}}});var Yr=(s=>(s[s.INTERACTION=50]="INTERACTION",s[s.HIGH=25]="HIGH",s[s.NORMAL=0]="NORMAL",s[s.LOW=-25]="LOW",s[s.UTILITY=-50]="UTILITY",s))(Yr||{});class _i{constructor(e,t=null,r=0,i=!1){this.next=null,this.previous=null,this._destroyed=!1,this.fn=e,this.context=t,this.priority=r,this.once=i}match(e,t=null){return this.fn===e&&this.context===t}emit(e){this.fn&&(this.context?this.fn.call(this.context,e):this.fn(e));const t=this.next;return this.once&&this.destroy(!0),this._destroyed&&(this.next=null),t}connect(e){this.previous=e,e.next&&(e.next.previous=this),this.next=e.next,e.next=this}destroy(e=!1){this._destroyed=!0,this.fn=null,this.context=null,this.previous&&(this.previous.next=this.next),this.next&&(this.next.previous=this.previous);const t=this.next;return this.next=e?null:t,this.previous=null,t}}const ro=class Te{constructor(){this.autoStart=!1,this.deltaTime=1,this.lastTime=-1,this.speed=1,this.started=!1,this._requestId=null,this._maxElapsedMS=100,this._minElapsedMS=0,this._protected=!1,this._lastFrame=-1,this._head=new _i(null,null,1/0),this.deltaMS=1/Te.targetFPMS,this.elapsedMS=1/Te.targetFPMS,this._tick=e=>{this._requestId=null,this.started&&(this.update(e),this.started&&this._requestId===null&&this._head.next&&(this._requestId=requestAnimationFrame(this._tick)))}}_requestIfNeeded(){this._requestId===null&&this._head.next&&(this.lastTime=performance.now(),this._lastFrame=this.lastTime,this._requestId=requestAnimationFrame(this._tick))}_cancelIfNeeded(){this._requestId!==null&&(cancelAnimationFrame(this._requestId),this._requestId=null)}_startIfPossible(){this.started?this._requestIfNeeded():this.autoStart&&this.start()}add(e,t,r=Yr.NORMAL){return this._addListener(new _i(e,t,r))}addOnce(e,t,r=Yr.NORMAL){return this._addListener(new _i(e,t,r,!0))}_addListener(e){let t=this._head.next,r=this._head;if(!t)e.connect(r);else{for(;t;){if(e.priority>t.priority){e.connect(r);break}r=t,t=t.next}e.previous||e.connect(r)}return this._startIfPossible(),this}remove(e,t){let r=this._head.next;for(;r;)r.match(e,t)?r=r.destroy():r=r.next;return this._head.next||this._cancelIfNeeded(),this}get count(){if(!this._head)return 0;let e=0,t=this._head;for(;t=t.next;)e++;return e}start(){this.started||(this.started=!0,this._requestIfNeeded())}stop(){this.started&&(this.started=!1,this._cancelIfNeeded())}destroy(){if(!this._protected){this.stop();let e=this._head.next;for(;e;)e=e.destroy(!0);this._head.destroy(),this._head=null}}update(e=performance.now()){let t;if(e>this.lastTime){if(t=this.elapsedMS=e-this.lastTime,t>this._maxElapsedMS&&(t=this._maxElapsedMS),t*=this.speed,this._minElapsedMS){const n=e-this._lastFrame|0;if(n<this._minElapsedMS)return;this._lastFrame=e-n%this._minElapsedMS}this.deltaMS=t,this.deltaTime=this.deltaMS*Te.targetFPMS;const r=this._head;let i=r.next;for(;i;)i=i.emit(this.deltaTime);r.next||this._cancelIfNeeded()}else this.deltaTime=this.deltaMS=this.elapsedMS=0;this.lastTime=e}get FPS(){return 1e3/this.elapsedMS}get minFPS(){return 1e3/this._maxElapsedMS}set minFPS(e){const t=Math.min(this.maxFPS,e),r=Math.min(Math.max(0,t)/1e3,Te.targetFPMS);this._maxElapsedMS=1/r}get maxFPS(){return this._minElapsedMS?Math.round(1e3/this._minElapsedMS):0}set maxFPS(e){if(e===0)this._minElapsedMS=0;else{const t=Math.max(this.minFPS,e);this._minElapsedMS=1/(t/1e3)}}static get shared(){if(!Te._shared){const e=Te._shared=new Te;e.autoStart=!0,e._protected=!0}return Te._shared}static get system(){if(!Te._system){const e=Te._system=new Te;e.autoStart=!0,e._protected=!0}return Te._system}};ro.targetFPMS=.06;let Je=ro;Object.defineProperties(H,{TARGET_FPMS:{get(){return Je.targetFPMS},set(s){$("7.1.0","settings.TARGET_FPMS is deprecated, use Ticker.targetFPMS"),Je.targetFPMS=s}}});class so{static init(e){e=Object.assign({autoStart:!0,sharedTicker:!1},e),Object.defineProperty(this,"ticker",{set(t){this._ticker&&this._ticker.remove(this.render,this),this._ticker=t,t&&t.add(this.render,this,Yr.LOW)},get(){return this._ticker}}),this.stop=()=>{this._ticker.stop()},this.start=()=>{this._ticker.start()},this._ticker=null,this.ticker=e.sharedTicker?Je.shared:new Je,e.autoStart&&this.start()}static destroy(){if(this._ticker){const e=this._ticker;this.ticker=null,e.destroy()}}}so.extension=U.Application,V.add(so);const io=[];V.handleByList(U.Renderer,io);function yd(s){for(const e of io)if(e.test(s))return new e(s);throw new Error("Unable to auto-detect a suitable renderer.")}var gd=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
}
`;const bd=gd;class no{constructor(e){this.renderer=e}contextChange(e){let t;if(this.renderer.context.webGLVersion===1){const r=e.getParameter(e.FRAMEBUFFER_BINDING);e.bindFramebuffer(e.FRAMEBUFFER,null),t=e.getParameter(e.SAMPLES),e.bindFramebuffer(e.FRAMEBUFFER,r)}else{const r=e.getParameter(e.DRAW_FRAMEBUFFER_BINDING);e.bindFramebuffer(e.DRAW_FRAMEBUFFER,null),t=e.getParameter(e.SAMPLES),e.bindFramebuffer(e.DRAW_FRAMEBUFFER,r)}t>=ae.HIGH?this.multisample=ae.HIGH:t>=ae.MEDIUM?this.multisample=ae.MEDIUM:t>=ae.LOW?this.multisample=ae.LOW:this.multisample=ae.NONE}destroy(){}}no.extension={type:U.RendererSystem,name:"_multisample"},V.add(no);class xd{constructor(e){this.buffer=e||null,this.updateID=-1,this.byteLength=-1,this.refCount=0}}class ao{constructor(e){this.renderer=e,this.managedBuffers={},this.boundBufferBases={}}destroy(){this.renderer=null}contextChange(){this.disposeAll(!0),this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID}bind(e){const{gl:t,CONTEXT_UID:r}=this,i=e._glBuffers[r]||this.createGLBuffer(e);t.bindBuffer(e.type,i.buffer)}unbind(e){const{gl:t}=this;t.bindBuffer(e,null)}bindBufferBase(e,t){const{gl:r,CONTEXT_UID:i}=this;if(this.boundBufferBases[t]!==e){const n=e._glBuffers[i]||this.createGLBuffer(e);this.boundBufferBases[t]=e,r.bindBufferBase(r.UNIFORM_BUFFER,t,n.buffer)}}bindBufferRange(e,t,r){const{gl:i,CONTEXT_UID:n}=this;r=r||0;const a=e._glBuffers[n]||this.createGLBuffer(e);i.bindBufferRange(i.UNIFORM_BUFFER,t||0,a.buffer,r*256,256)}update(e){const{gl:t,CONTEXT_UID:r}=this,i=e._glBuffers[r]||this.createGLBuffer(e);if(e._updateID!==i.updateID)if(i.updateID=e._updateID,t.bindBuffer(e.type,i.buffer),i.byteLength>=e.data.byteLength)t.bufferSubData(e.type,0,e.data);else{const n=e.static?t.STATIC_DRAW:t.DYNAMIC_DRAW;i.byteLength=e.data.byteLength,t.bufferData(e.type,e.data,n)}}dispose(e,t){if(!this.managedBuffers[e.id])return;delete this.managedBuffers[e.id];const r=e._glBuffers[this.CONTEXT_UID],i=this.gl;e.disposeRunner.remove(this),r&&(t||i.deleteBuffer(r.buffer),delete e._glBuffers[this.CONTEXT_UID])}disposeAll(e){const t=Object.keys(this.managedBuffers);for(let r=0;r<t.length;r++)this.dispose(this.managedBuffers[t[r]],e)}createGLBuffer(e){const{CONTEXT_UID:t,gl:r}=this;return e._glBuffers[t]=new xd(r.createBuffer()),this.managedBuffers[e.id]=e,e.disposeRunner.add(this),e._glBuffers[t]}}ao.extension={type:U.RendererSystem,name:"buffer"},V.add(ao);class oo{constructor(e){this.renderer=e}render(e,t){const r=this.renderer;let i,n,a,o;if(t&&(i=t.renderTexture,n=t.clear,a=t.transform,o=t.skipUpdateTransform),this.renderingToScreen=!i,r.runners.prerender.emit(),r.emit("prerender"),r.projection.transform=a,!r.context.isLost){if(i||(this.lastObjectRendered=e),!o){const h=e.enableTempParent();e.updateTransform(),e.disableTempParent(h)}r.renderTexture.bind(i),r.batch.currentRenderer.start(),(n??r.background.clearBeforeRender)&&r.renderTexture.clear(),e.render(r),r.batch.currentRenderer.flush(),i&&(t.blit&&r.framebuffer.blit(),i.baseTexture.update()),r.runners.postrender.emit(),r.projection.transform=null,r.emit("postrender")}}destroy(){this.renderer=null,this.lastObjectRendered=null}}oo.extension={type:U.RendererSystem,name:"objectRenderer"},V.add(oo);const Kr=class Oi extends fd{constructor(e){super(),this.type=ji.WEBGL,e=Object.assign({},H.RENDER_OPTIONS,e),this.gl=null,this.CONTEXT_UID=0,this.globalUniforms=new Ue({projectionMatrix:new ue},!0);const t={runners:["init","destroy","contextChange","resolutionChange","reset","update","postrender","prerender","resize"],systems:Oi.__systems,priority:["_view","textureGenerator","background","_plugin","startup","context","state","texture","buffer","geometry","framebuffer","transformFeedback","mask","scissor","stencil","projection","textureGC","filter","renderTexture","batch","objectRenderer","_multisample"]};this.setup(t),"useContextAlpha"in e&&($("7.0.0","options.useContextAlpha is deprecated, use options.premultipliedAlpha and options.backgroundAlpha instead"),e.premultipliedAlpha=e.useContextAlpha&&e.useContextAlpha!=="notMultiplied",e.backgroundAlpha=e.useContextAlpha===!1?1:e.backgroundAlpha),this._plugin.rendererPlugins=Oi.__plugins,this.options=e,this.startup.run(this.options)}static test(e){return e!=null&&e.forceCanvas?!1:ju()}render(e,t){this.objectRenderer.render(e,t)}resize(e,t){this._view.resizeView(e,t)}reset(){return this.runners.reset.emit(),this}clear(){this.renderTexture.bind(),this.renderTexture.clear()}destroy(e=!1){this.runners.destroy.items.reverse(),this.emitWithCustomOptions(this.runners.destroy,{_view:e}),super.destroy()}get plugins(){return this._plugin.plugins}get multisample(){return this._multisample.multisample}get width(){return this._view.element.width}get height(){return this._view.element.height}get resolution(){return this._view.resolution}set resolution(e){this._view.resolution=e,this.runners.resolutionChange.emit(e)}get autoDensity(){return this._view.autoDensity}get view(){return this._view.element}get screen(){return this._view.screen}get lastObjectRendered(){return this.objectRenderer.lastObjectRendered}get renderingToScreen(){return this.objectRenderer.renderingToScreen}get rendererLogId(){return`WebGL ${this.context.webGLVersion}`}get clearBeforeRender(){return $("7.0.0","renderer.clearBeforeRender has been deprecated, please use renderer.background.clearBeforeRender instead."),this.background.clearBeforeRender}get useContextAlpha(){return $("7.0.0","renderer.useContextAlpha has been deprecated, please use renderer.context.premultipliedAlpha instead."),this.context.useContextAlpha}get preserveDrawingBuffer(){return $("7.0.0","renderer.preserveDrawingBuffer has been deprecated, we cannot truly know this unless pixi created the context"),this.context.preserveDrawingBuffer}get backgroundColor(){return $("7.0.0","renderer.backgroundColor has been deprecated, use renderer.background.color instead."),this.background.color}set backgroundColor(e){$("7.0.0","renderer.backgroundColor has been deprecated, use renderer.background.color instead."),this.background.color=e}get backgroundAlpha(){return $("7.0.0","renderer.backgroundAlpha has been deprecated, use renderer.background.alpha instead."),this.background.alpha}set backgroundAlpha(e){$("7.0.0","renderer.backgroundAlpha has been deprecated, use renderer.background.alpha instead."),this.background.alpha=e}get powerPreference(){return $("7.0.0","renderer.powerPreference has been deprecated, we can only know this if pixi creates the context"),this.context.powerPreference}generateTexture(e,t){return this.textureGenerator.generateTexture(e,t)}};Kr.extension={type:U.Renderer,priority:1},Kr.__plugins={},Kr.__systems={};let Ti=Kr;V.handleByMap(U.RendererPlugin,Ti.__plugins),V.handleByMap(U.RendererSystem,Ti.__systems),V.add(Ti);class ho extends nr{constructor(e,t){const{width:r,height:i}=t||{};super(r,i),this.items=[],this.itemDirtyIds=[];for(let n=0;n<e;n++){const a=new W;this.items.push(a),this.itemDirtyIds.push(-2)}this.length=e,this._load=null,this.baseTexture=null}initFromArray(e,t){for(let r=0;r<this.length;r++)e[r]&&(e[r].castToBaseTexture?this.addBaseTextureAt(e[r].castToBaseTexture(),r):e[r]instanceof nr?this.addResourceAt(e[r],r):this.addResourceAt(ya(e[r],t),r))}dispose(){for(let e=0,t=this.length;e<t;e++)this.items[e].destroy();this.items=null,this.itemDirtyIds=null,this._load=null}addResourceAt(e,t){if(!this.items[t])throw new Error(`Index ${t} is out of bounds`);return e.valid&&!this.valid&&this.resize(e.width,e.height),this.items[t].setResource(e),this}bind(e){if(this.baseTexture!==null)throw new Error("Only one base texture per TextureArray is allowed");super.bind(e);for(let t=0;t<this.length;t++)this.items[t].parentTextureArray=e,this.items[t].on("update",e.update,e)}unbind(e){super.unbind(e);for(let t=0;t<this.length;t++)this.items[t].parentTextureArray=null,this.items[t].off("update",e.update,e)}load(){if(this._load)return this._load;const e=this.items.map(t=>t.resource).filter(t=>t).map(t=>t.load());return this._load=Promise.all(e).then(()=>{const{realWidth:t,realHeight:r}=this.items[0];return this.resize(t,r),this.update(),Promise.resolve(this)}),this._load}}class vd extends ho{constructor(e,t){const{width:r,height:i}=t||{};let n,a;Array.isArray(e)?(n=e,a=e.length):a=e,super(a,{width:r,height:i}),n&&this.initFromArray(n,t)}addBaseTextureAt(e,t){if(e.resource)this.addResourceAt(e.resource,t);else throw new Error("ArrayResource does not support RenderTexture");return this}bind(e){super.bind(e),e.target=Et.TEXTURE_2D_ARRAY}upload(e,t,r){const{length:i,itemDirtyIds:n,items:a}=this,{gl:o}=e;r.dirtyId<0&&o.texImage3D(o.TEXTURE_2D_ARRAY,0,r.internalFormat,this._width,this._height,i,0,t.format,r.type,null);for(let h=0;h<i;h++){const l=a[h];n[h]<l.dirtyId&&(n[h]=l.dirtyId,l.valid&&o.texSubImage3D(o.TEXTURE_2D_ARRAY,0,0,0,h,l.resource.width,l.resource.height,1,t.format,r.type,l.resource.source))}return!0}}class _d extends $e{constructor(e){super(e)}static test(e){const{OffscreenCanvas:t}=globalThis;return t&&e instanceof t?!0:globalThis.HTMLCanvasElement&&e instanceof HTMLCanvasElement}}const lo=class yr extends ho{constructor(e,t){const{width:r,height:i,autoLoad:n,linkBaseTexture:a}=t||{};if(e&&e.length!==yr.SIDES)throw new Error(`Invalid length. Got ${e.length}, expected 6`);super(6,{width:r,height:i});for(let o=0;o<yr.SIDES;o++)this.items[o].target=Et.TEXTURE_CUBE_MAP_POSITIVE_X+o;this.linkBaseTexture=a!==!1,e&&this.initFromArray(e,t),n!==!1&&this.load()}bind(e){super.bind(e),e.target=Et.TEXTURE_CUBE_MAP}addBaseTextureAt(e,t,r){if(r===void 0&&(r=this.linkBaseTexture),!this.items[t])throw new Error(`Index ${t} is out of bounds`);if(!this.linkBaseTexture||e.parentTextureArray||Object.keys(e._glTextures).length>0)if(e.resource)this.addResourceAt(e.resource,t);else throw new Error("CubeResource does not support copying of renderTexture.");else e.target=Et.TEXTURE_CUBE_MAP_POSITIVE_X+t,e.parentTextureArray=this.baseTexture,this.items[t]=e;return e.valid&&!this.valid&&this.resize(e.realWidth,e.realHeight),this.items[t]=e,this}upload(e,t,r){const i=this.itemDirtyIds;for(let n=0;n<yr.SIDES;n++){const a=this.items[n];(i[n]<a.dirtyId||r.dirtyId<t.dirtyId)&&(a.valid&&a.resource?(a.resource.upload(e,a,r),i[n]=a.dirtyId):i[n]<-1&&(e.gl.texImage2D(a.target,0,r.internalFormat,t.realWidth,t.realHeight,0,t.format,r.type,null),i[n]=-1))}return!0}static test(e){return Array.isArray(e)&&e.length===yr.SIDES}};lo.SIDES=6;let Td=lo;class Xt extends $e{constructor(e,t){t=t||{};let r,i,n;typeof e=="string"?(r=Xt.EMPTY,i=e,n=!0):(r=e,i=null,n=!1),super(r),this.url=i,this.crossOrigin=t.crossOrigin??!0,this.alphaMode=typeof t.alphaMode=="number"?t.alphaMode:null,this.ownsImageBitmap=t.ownsImageBitmap??n,this._load=null,t.autoLoad!==!1&&this.load()}load(){return this._load?this._load:(this._load=new Promise(async(e,t)=>{if(this.url===null){e(this);return}try{const r=await H.ADAPTER.fetch(this.url,{mode:this.crossOrigin?"cors":"no-cors"});if(this.destroyed)return;const i=await r.blob();if(this.destroyed)return;const n=await createImageBitmap(i,{premultiplyAlpha:this.alphaMode===null||this.alphaMode===at.UNPACK?"premultiply":"none"});if(this.destroyed){n.close();return}this.source=n,this.update(),e(this)}catch(r){if(this.destroyed)return;t(r),this.onError.emit(r)}}),this._load)}upload(e,t,r){return this.source instanceof ImageBitmap?(typeof this.alphaMode=="number"&&(t.alphaMode=this.alphaMode),super.upload(e,t,r)):(this.load(),!1)}dispose(){this.ownsImageBitmap&&this.source instanceof ImageBitmap&&this.source.close(),super.dispose(),this._load=null}static test(e){return!!globalThis.createImageBitmap&&typeof ImageBitmap<"u"&&(typeof e=="string"||e instanceof ImageBitmap)}static get EMPTY(){return Xt._EMPTY=Xt._EMPTY??H.ADAPTER.createCanvas(0,0),Xt._EMPTY}}const Ei=class os extends $e{constructor(e,t){t=t||{},super(H.ADAPTER.createCanvas()),this._width=0,this._height=0,this.svg=e,this.scale=t.scale||1,this._overrideWidth=t.width,this._overrideHeight=t.height,this._resolve=null,this._crossorigin=t.crossorigin,this._load=null,t.autoLoad!==!1&&this.load()}load(){return this._load?this._load:(this._load=new Promise(e=>{if(this._resolve=()=>{this.update(),e(this)},os.SVG_XML.test(this.svg.trim())){if(!btoa)throw new Error("Your browser doesn't support base64 conversions.");this.svg=`data:image/svg+xml;base64,${btoa(unescape(encodeURIComponent(this.svg)))}`}this._loadSvg()}),this._load)}_loadSvg(){const e=new Image;$e.crossOrigin(e,this.svg,this._crossorigin),e.src=this.svg,e.onerror=t=>{this._resolve&&(e.onerror=null,this.onError.emit(t))},e.onload=()=>{if(!this._resolve)return;const t=e.width,r=e.height;if(!t||!r)throw new Error("The SVG image must have width and height defined (in pixels), canvas API needs them.");let i=t*this.scale,n=r*this.scale;(this._overrideWidth||this._overrideHeight)&&(i=this._overrideWidth||this._overrideHeight/r*t,n=this._overrideHeight||this._overrideWidth/t*r),i=Math.round(i),n=Math.round(n);const a=this.source;a.width=i,a.height=n,a._pixiId=`canvas_${ir()}`,a.getContext("2d").drawImage(e,0,0,t,r,0,0,i,n),this._resolve(),this._resolve=null}}static getSize(e){const t=os.SVG_SIZE.exec(e),r={};return t&&(r[t[1]]=Math.round(parseFloat(t[3])),r[t[5]]=Math.round(parseFloat(t[7]))),r}dispose(){super.dispose(),this._resolve=null,this._crossorigin=null}static test(e,t){return t==="svg"||typeof e=="string"&&e.startsWith("data:image/svg+xml")||typeof e=="string"&&os.SVG_XML.test(e)}};Ei.SVG_XML=/^(<\?xml[^?]+\?>)?\s*(<!--[^(-->)]*-->)?\s*\<svg/m,Ei.SVG_SIZE=/<svg[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*>/i;let Ed=Ei;class Ad extends $e{constructor(e){super(e)}static test(e){return!!globalThis.VideoFrame&&e instanceof globalThis.VideoFrame}}const Ai=class Fi extends $e{constructor(e,t){if(t=t||{},!(e instanceof HTMLVideoElement)){const r=document.createElement("video");t.autoLoad!==!1&&r.setAttribute("preload","auto"),t.playsinline!==!1&&(r.setAttribute("webkit-playsinline",""),r.setAttribute("playsinline","")),t.muted===!0&&(r.setAttribute("muted",""),r.muted=!0),t.loop===!0&&r.setAttribute("loop",""),t.autoPlay!==!1&&r.setAttribute("autoplay",""),typeof e=="string"&&(e=[e]);const i=e[0].src||e[0];$e.crossOrigin(r,i,t.crossorigin);for(let n=0;n<e.length;++n){const a=document.createElement("source");let{src:o,mime:h}=e[n];if(o=o||e[n],o.startsWith("data:"))h=o.slice(5,o.indexOf(";"));else if(!o.startsWith("blob:")){const l=o.split("?").shift().toLowerCase(),u=l.slice(l.lastIndexOf(".")+1);h=h||Fi.MIME_TYPES[u]||`video/${u}`}a.src=o,h&&(a.type=h),r.appendChild(a)}e=r}super(e),this.noSubImage=!0,this._autoUpdate=!0,this._isConnectedToTicker=!1,this._updateFPS=t.updateFPS||0,this._msToNextUpdate=0,this.autoPlay=t.autoPlay!==!1,this._videoFrameRequestCallback=this._videoFrameRequestCallback.bind(this),this._videoFrameRequestCallbackHandle=null,this._load=null,this._resolve=null,this._reject=null,this._onCanPlay=this._onCanPlay.bind(this),this._onError=this._onError.bind(this),this._onPlayStart=this._onPlayStart.bind(this),this._onPlayStop=this._onPlayStop.bind(this),this._onSeeked=this._onSeeked.bind(this),t.autoLoad!==!1&&this.load()}update(e=0){if(!this.destroyed){if(this._updateFPS){const t=Je.shared.elapsedMS*this.source.playbackRate;this._msToNextUpdate=Math.floor(this._msToNextUpdate-t)}(!this._updateFPS||this._msToNextUpdate<=0)&&(super.update(),this._msToNextUpdate=this._updateFPS?Math.floor(1e3/this._updateFPS):0)}}_videoFrameRequestCallback(){this.update(),this.destroyed?this._videoFrameRequestCallbackHandle=null:this._videoFrameRequestCallbackHandle=this.source.requestVideoFrameCallback(this._videoFrameRequestCallback)}load(){if(this._load)return this._load;const e=this.source;return(e.readyState===e.HAVE_ENOUGH_DATA||e.readyState===e.HAVE_FUTURE_DATA)&&e.width&&e.height&&(e.complete=!0),e.addEventListener("play",this._onPlayStart),e.addEventListener("pause",this._onPlayStop),e.addEventListener("seeked",this._onSeeked),this._isSourceReady()?this._onCanPlay():(e.addEventListener("canplay",this._onCanPlay),e.addEventListener("canplaythrough",this._onCanPlay),e.addEventListener("error",this._onError,!0)),this._load=new Promise((t,r)=>{this.valid?t(this):(this._resolve=t,this._reject=r,e.load())}),this._load}_onError(e){this.source.removeEventListener("error",this._onError,!0),this.onError.emit(e),this._reject&&(this._reject(e),this._reject=null,this._resolve=null)}_isSourcePlaying(){const e=this.source;return!e.paused&&!e.ended}_isSourceReady(){return this.source.readyState>2}_onPlayStart(){this.valid||this._onCanPlay(),this._configureAutoUpdate()}_onPlayStop(){this._configureAutoUpdate()}_onSeeked(){this._autoUpdate&&!this._isSourcePlaying()&&(this._msToNextUpdate=0,this.update(),this._msToNextUpdate=0)}_onCanPlay(){const e=this.source;e.removeEventListener("canplay",this._onCanPlay),e.removeEventListener("canplaythrough",this._onCanPlay);const t=this.valid;this._msToNextUpdate=0,this.update(),this._msToNextUpdate=0,!t&&this._resolve&&(this._resolve(this),this._resolve=null,this._reject=null),this._isSourcePlaying()?this._onPlayStart():this.autoPlay&&e.play()}dispose(){this._configureAutoUpdate();const e=this.source;e&&(e.removeEventListener("play",this._onPlayStart),e.removeEventListener("pause",this._onPlayStop),e.removeEventListener("seeked",this._onSeeked),e.removeEventListener("canplay",this._onCanPlay),e.removeEventListener("canplaythrough",this._onCanPlay),e.removeEventListener("error",this._onError,!0),e.pause(),e.src="",e.load()),super.dispose()}get autoUpdate(){return this._autoUpdate}set autoUpdate(e){e!==this._autoUpdate&&(this._autoUpdate=e,this._configureAutoUpdate())}get updateFPS(){return this._updateFPS}set updateFPS(e){e!==this._updateFPS&&(this._updateFPS=e,this._configureAutoUpdate())}_configureAutoUpdate(){this._autoUpdate&&this._isSourcePlaying()?!this._updateFPS&&this.source.requestVideoFrameCallback?(this._isConnectedToTicker&&(Je.shared.remove(this.update,this),this._isConnectedToTicker=!1,this._msToNextUpdate=0),this._videoFrameRequestCallbackHandle===null&&(this._videoFrameRequestCallbackHandle=this.source.requestVideoFrameCallback(this._videoFrameRequestCallback))):(this._videoFrameRequestCallbackHandle!==null&&(this.source.cancelVideoFrameCallback(this._videoFrameRequestCallbackHandle),this._videoFrameRequestCallbackHandle=null),this._isConnectedToTicker||(Je.shared.add(this.update,this),this._isConnectedToTicker=!0,this._msToNextUpdate=0)):(this._videoFrameRequestCallbackHandle!==null&&(this.source.cancelVideoFrameCallback(this._videoFrameRequestCallbackHandle),this._videoFrameRequestCallbackHandle=null),this._isConnectedToTicker&&(Je.shared.remove(this.update,this),this._isConnectedToTicker=!1,this._msToNextUpdate=0))}static test(e,t){return globalThis.HTMLVideoElement&&e instanceof HTMLVideoElement||Fi.TYPES.includes(t)}};Ai.TYPES=["mp4","m4v","webm","ogg","ogv","h264","avi","mov"],Ai.MIME_TYPES={ogv:"video/ogg",mov:"video/quicktime",m4v:"video/mp4"};let Sd=Ai;hi.push(Xt,Ca,_d,Sd,Ad,Ed,ga,Td,vd);class uo{constructor(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this.rect=null,this.updateID=-1}isEmpty(){return this.minX>this.maxX||this.minY>this.maxY}clear(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0}getRectangle(e){return this.minX>this.maxX||this.minY>this.maxY?Q.EMPTY:(e=e||new Q(0,0,1,1),e.x=this.minX,e.y=this.minY,e.width=this.maxX-this.minX,e.height=this.maxY-this.minY,e)}addPoint(e){this.minX=Math.min(this.minX,e.x),this.maxX=Math.max(this.maxX,e.x),this.minY=Math.min(this.minY,e.y),this.maxY=Math.max(this.maxY,e.y)}addPointMatrix(e,t){const{a:r,b:i,c:n,d:a,tx:o,ty:h}=e,l=r*t.x+n*t.y+o,u=i*t.x+a*t.y+h;this.minX=Math.min(this.minX,l),this.maxX=Math.max(this.maxX,l),this.minY=Math.min(this.minY,u),this.maxY=Math.max(this.maxY,u)}addQuad(e){let t=this.minX,r=this.minY,i=this.maxX,n=this.maxY,a=e[0],o=e[1];t=a<t?a:t,r=o<r?o:r,i=a>i?a:i,n=o>n?o:n,a=e[2],o=e[3],t=a<t?a:t,r=o<r?o:r,i=a>i?a:i,n=o>n?o:n,a=e[4],o=e[5],t=a<t?a:t,r=o<r?o:r,i=a>i?a:i,n=o>n?o:n,a=e[6],o=e[7],t=a<t?a:t,r=o<r?o:r,i=a>i?a:i,n=o>n?o:n,this.minX=t,this.minY=r,this.maxX=i,this.maxY=n}addFrame(e,t,r,i,n){this.addFrameMatrix(e.worldTransform,t,r,i,n)}addFrameMatrix(e,t,r,i,n){const a=e.a,o=e.b,h=e.c,l=e.d,u=e.tx,c=e.ty;let d=this.minX,f=this.minY,p=this.maxX,m=this.maxY,y=a*t+h*r+u,x=o*t+l*r+c;d=y<d?y:d,f=x<f?x:f,p=y>p?y:p,m=x>m?x:m,y=a*i+h*r+u,x=o*i+l*r+c,d=y<d?y:d,f=x<f?x:f,p=y>p?y:p,m=x>m?x:m,y=a*t+h*n+u,x=o*t+l*n+c,d=y<d?y:d,f=x<f?x:f,p=y>p?y:p,m=x>m?x:m,y=a*i+h*n+u,x=o*i+l*n+c,d=y<d?y:d,f=x<f?x:f,p=y>p?y:p,m=x>m?x:m,this.minX=d,this.minY=f,this.maxX=p,this.maxY=m}addVertexData(e,t,r){let i=this.minX,n=this.minY,a=this.maxX,o=this.maxY;for(let h=t;h<r;h+=2){const l=e[h],u=e[h+1];i=l<i?l:i,n=u<n?u:n,a=l>a?l:a,o=u>o?u:o}this.minX=i,this.minY=n,this.maxX=a,this.maxY=o}addVertices(e,t,r,i){this.addVerticesMatrix(e.worldTransform,t,r,i)}addVerticesMatrix(e,t,r,i,n=0,a=n){const o=e.a,h=e.b,l=e.c,u=e.d,c=e.tx,d=e.ty;let f=this.minX,p=this.minY,m=this.maxX,y=this.maxY;for(let x=r;x<i;x+=2){const b=t[x],g=t[x+1],v=o*b+l*g+c,_=u*g+h*b+d;f=Math.min(f,v-n),m=Math.max(m,v+n),p=Math.min(p,_-a),y=Math.max(y,_+a)}this.minX=f,this.minY=p,this.maxX=m,this.maxY=y}addBounds(e){const t=this.minX,r=this.minY,i=this.maxX,n=this.maxY;this.minX=e.minX<t?e.minX:t,this.minY=e.minY<r?e.minY:r,this.maxX=e.maxX>i?e.maxX:i,this.maxY=e.maxY>n?e.maxY:n}addBoundsMask(e,t){const r=e.minX>t.minX?e.minX:t.minX,i=e.minY>t.minY?e.minY:t.minY,n=e.maxX<t.maxX?e.maxX:t.maxX,a=e.maxY<t.maxY?e.maxY:t.maxY;if(r<=n&&i<=a){const o=this.minX,h=this.minY,l=this.maxX,u=this.maxY;this.minX=r<o?r:o,this.minY=i<h?i:h,this.maxX=n>l?n:l,this.maxY=a>u?a:u}}addBoundsMatrix(e,t){this.addFrameMatrix(t,e.minX,e.minY,e.maxX,e.maxY)}addBoundsArea(e,t){const r=e.minX>t.x?e.minX:t.x,i=e.minY>t.y?e.minY:t.y,n=e.maxX<t.x+t.width?e.maxX:t.x+t.width,a=e.maxY<t.y+t.height?e.maxY:t.y+t.height;if(r<=n&&i<=a){const o=this.minX,h=this.minY,l=this.maxX,u=this.maxY;this.minX=r<o?r:o,this.minY=i<h?i:h,this.maxX=n>l?n:l,this.maxY=a>u?a:u}}pad(e=0,t=e){this.isEmpty()||(this.minX-=e,this.maxX+=e,this.minY-=t,this.maxY+=t)}addFramePad(e,t,r,i,n,a){e-=n,t-=a,r+=n,i+=a,this.minX=this.minX<e?this.minX:e,this.maxX=this.maxX>r?this.maxX:r,this.minY=this.minY<t?this.minY:t,this.maxY=this.maxY>i?this.maxY:i}}class $t extends xr{constructor(){super(),this.tempDisplayObjectParent=null,this.transform=new di,this.alpha=1,this.visible=!0,this.renderable=!0,this.cullable=!1,this.cullArea=null,this.parent=null,this.worldAlpha=1,this._lastSortedIndex=0,this._zIndex=0,this.filterArea=null,this.filters=null,this._enabledFilters=null,this._bounds=new uo,this._localBounds=null,this._boundsID=0,this._boundsRect=null,this._localBoundsRect=null,this._mask=null,this._maskRefCount=0,this._destroyed=!1,this.isSprite=!1,this.isMask=!1}static mixin(e){const t=Object.keys(e);for(let r=0;r<t.length;++r){const i=t[r];Object.defineProperty($t.prototype,i,Object.getOwnPropertyDescriptor(e,i))}}get destroyed(){return this._destroyed}_recursivePostUpdateTransform(){this.parent?(this.parent._recursivePostUpdateTransform(),this.transform.updateTransform(this.parent.transform)):this.transform.updateTransform(this._tempDisplayObjectParent.transform)}updateTransform(){this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha}getBounds(e,t){return e||(this.parent?(this._recursivePostUpdateTransform(),this.updateTransform()):(this.parent=this._tempDisplayObjectParent,this.updateTransform(),this.parent=null)),this._bounds.updateID!==this._boundsID&&(this.calculateBounds(),this._bounds.updateID=this._boundsID),t||(this._boundsRect||(this._boundsRect=new Q),t=this._boundsRect),this._bounds.getRectangle(t)}getLocalBounds(e){e||(this._localBoundsRect||(this._localBoundsRect=new Q),e=this._localBoundsRect),this._localBounds||(this._localBounds=new uo);const t=this.transform,r=this.parent;this.parent=null,this._tempDisplayObjectParent.worldAlpha=(r==null?void 0:r.worldAlpha)??1,this.transform=this._tempDisplayObjectParent.transform;const i=this._bounds,n=this._boundsID;this._bounds=this._localBounds;const a=this.getBounds(!1,e);return this.parent=r,this.transform=t,this._bounds=i,this._bounds.updateID+=this._boundsID-n,a}toGlobal(e,t,r=!1){return r||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.apply(e,t)}toLocal(e,t,r,i){return t&&(e=t.toGlobal(e,r,i)),i||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.applyInverse(e,r)}setParent(e){if(!e||!e.addChild)throw new Error("setParent: Argument must be a Container");return e.addChild(this),e}removeFromParent(){var e;(e=this.parent)==null||e.removeChild(this)}setTransform(e=0,t=0,r=1,i=1,n=0,a=0,o=0,h=0,l=0){return this.position.x=e,this.position.y=t,this.scale.x=r||1,this.scale.y=i||1,this.rotation=n,this.skew.x=a,this.skew.y=o,this.pivot.x=h,this.pivot.y=l,this}destroy(e){this.removeFromParent(),this._destroyed=!0,this.transform=null,this.parent=null,this._bounds=null,this.mask=null,this.cullArea=null,this.filters=null,this.filterArea=null,this.hitArea=null,this.eventMode="auto",this.interactiveChildren=!1,this.emit("destroyed"),this.removeAllListeners()}get _tempDisplayObjectParent(){return this.tempDisplayObjectParent===null&&(this.tempDisplayObjectParent=new Md),this.tempDisplayObjectParent}enableTempParent(){const e=this.parent;return this.parent=this._tempDisplayObjectParent,e}disableTempParent(e){this.parent=e}get x(){return this.position.x}set x(e){this.transform.position.x=e}get y(){return this.position.y}set y(e){this.transform.position.y=e}get worldTransform(){return this.transform.worldTransform}get localTransform(){return this.transform.localTransform}get position(){return this.transform.position}set position(e){this.transform.position.copyFrom(e)}get scale(){return this.transform.scale}set scale(e){this.transform.scale.copyFrom(e)}get pivot(){return this.transform.pivot}set pivot(e){this.transform.pivot.copyFrom(e)}get skew(){return this.transform.skew}set skew(e){this.transform.skew.copyFrom(e)}get rotation(){return this.transform.rotation}set rotation(e){this.transform.rotation=e}get angle(){return this.transform.rotation*pc}set angle(e){this.transform.rotation=e*mc}get zIndex(){return this._zIndex}set zIndex(e){this._zIndex!==e&&(this._zIndex=e,this.parent&&(this.parent.sortDirty=!0))}get worldVisible(){let e=this;do{if(!e.visible)return!1;e=e.parent}while(e);return!0}get mask(){return this._mask}set mask(e){if(this._mask!==e){if(this._mask){const t=this._mask.isMaskData?this._mask.maskObject:this._mask;t&&(t._maskRefCount--,t._maskRefCount===0&&(t.renderable=!0,t.isMask=!1))}if(this._mask=e,this._mask){const t=this._mask.isMaskData?this._mask.maskObject:this._mask;t&&(t._maskRefCount===0&&(t.renderable=!1,t.isMask=!0),t._maskRefCount++)}}}}class Md extends $t{constructor(){super(...arguments),this.sortDirty=null}}$t.prototype.displayObjectUpdateTransform=$t.prototype.updateTransform;const wd=new ue;function Id(s,e){return s.zIndex===e.zIndex?s._lastSortedIndex-e._lastSortedIndex:s.zIndex-e.zIndex}const co=class Di extends $t{constructor(){super(),this.children=[],this.sortableChildren=Di.defaultSortableChildren,this.sortDirty=!1}onChildrenChange(e){}addChild(...e){if(e.length>1)for(let t=0;t<e.length;t++)this.addChild(e[t]);else{const t=e[0];t.parent&&t.parent.removeChild(t),t.parent=this,this.sortDirty=!0,t.transform._parentID=-1,this.children.push(t),this._boundsID++,this.onChildrenChange(this.children.length-1),this.emit("childAdded",t,this,this.children.length-1),t.emit("added",this)}return e[0]}addChildAt(e,t){if(t<0||t>this.children.length)throw new Error(`${e}addChildAt: The index ${t} supplied is out of bounds ${this.children.length}`);return e.parent&&e.parent.removeChild(e),e.parent=this,this.sortDirty=!0,e.transform._parentID=-1,this.children.splice(t,0,e),this._boundsID++,this.onChildrenChange(t),e.emit("added",this),this.emit("childAdded",e,this,t),e}swapChildren(e,t){if(e===t)return;const r=this.getChildIndex(e),i=this.getChildIndex(t);this.children[r]=t,this.children[i]=e,this.onChildrenChange(r<i?r:i)}getChildIndex(e){const t=this.children.indexOf(e);if(t===-1)throw new Error("The supplied DisplayObject must be a child of the caller");return t}setChildIndex(e,t){if(t<0||t>=this.children.length)throw new Error(`The index ${t} supplied is out of bounds ${this.children.length}`);const r=this.getChildIndex(e);Dr(this.children,r,1),this.children.splice(t,0,e),this.onChildrenChange(t)}getChildAt(e){if(e<0||e>=this.children.length)throw new Error(`getChildAt: Index (${e}) does not exist.`);return this.children[e]}removeChild(...e){if(e.length>1)for(let t=0;t<e.length;t++)this.removeChild(e[t]);else{const t=e[0],r=this.children.indexOf(t);if(r===-1)return null;t.parent=null,t.transform._parentID=-1,Dr(this.children,r,1),this._boundsID++,this.onChildrenChange(r),t.emit("removed",this),this.emit("childRemoved",t,this,r)}return e[0]}removeChildAt(e){const t=this.getChildAt(e);return t.parent=null,t.transform._parentID=-1,Dr(this.children,e,1),this._boundsID++,this.onChildrenChange(e),t.emit("removed",this),this.emit("childRemoved",t,this,e),t}removeChildren(e=0,t=this.children.length){const r=e,i=t,n=i-r;let a;if(n>0&&n<=i){a=this.children.splice(r,n);for(let o=0;o<a.length;++o)a[o].parent=null,a[o].transform&&(a[o].transform._parentID=-1);this._boundsID++,this.onChildrenChange(e);for(let o=0;o<a.length;++o)a[o].emit("removed",this),this.emit("childRemoved",a[o],this,o);return a}else if(n===0&&this.children.length===0)return[];throw new RangeError("removeChildren: numeric values are outside the acceptable range.")}sortChildren(){let e=!1;for(let t=0,r=this.children.length;t<r;++t){const i=this.children[t];i._lastSortedIndex=t,!e&&i.zIndex!==0&&(e=!0)}e&&this.children.length>1&&this.children.sort(Id),this.sortDirty=!1}updateTransform(){this.sortableChildren&&this.sortDirty&&this.sortChildren(),this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha;for(let e=0,t=this.children.length;e<t;++e){const r=this.children[e];r.visible&&r.updateTransform()}}calculateBounds(){this._bounds.clear(),this._calculateBounds();for(let e=0;e<this.children.length;e++){const t=this.children[e];if(!(!t.visible||!t.renderable))if(t.calculateBounds(),t._mask){const r=t._mask.isMaskData?t._mask.maskObject:t._mask;r?(r.calculateBounds(),this._bounds.addBoundsMask(t._bounds,r._bounds)):this._bounds.addBounds(t._bounds)}else t.filterArea?this._bounds.addBoundsArea(t._bounds,t.filterArea):this._bounds.addBounds(t._bounds)}this._bounds.updateID=this._boundsID}getLocalBounds(e,t=!1){const r=super.getLocalBounds(e);if(!t)for(let i=0,n=this.children.length;i<n;++i){const a=this.children[i];a.visible&&a.updateTransform()}return r}_calculateBounds(){}_renderWithCulling(e){const t=e.renderTexture.sourceFrame;if(!(t.width>0&&t.height>0))return;let r,i;this.cullArea?(r=this.cullArea,i=this.worldTransform):this._render!==Di.prototype._render&&(r=this.getBounds(!0));const n=e.projection.transform;if(n&&(i?(i=wd.copyFrom(i),i.prepend(n)):i=n),r&&t.intersects(r,i))this._render(e);else if(this.cullArea)return;for(let a=0,o=this.children.length;a<o;++a){const h=this.children[a],l=h.cullable;h.cullable=l||!this.cullArea,h.render(e),h.cullable=l}}render(e){var t;if(!(!this.visible||this.worldAlpha<=0||!this.renderable))if(this._mask||(t=this.filters)!=null&&t.length)this.renderAdvanced(e);else if(this.cullable)this._renderWithCulling(e);else{this._render(e);for(let r=0,i=this.children.length;r<i;++r)this.children[r].render(e)}}renderAdvanced(e){var n,a,o;const t=this.filters,r=this._mask;if(t){this._enabledFilters||(this._enabledFilters=[]),this._enabledFilters.length=0;for(let h=0;h<t.length;h++)t[h].enabled&&this._enabledFilters.push(t[h])}const i=t&&((n=this._enabledFilters)==null?void 0:n.length)||r&&(!r.isMaskData||r.enabled&&(r.autoDetect||r.type!==oe.NONE));if(i&&e.batch.flush(),t&&((a=this._enabledFilters)!=null&&a.length)&&e.filter.push(this,this._enabledFilters),r&&e.mask.push(this,this._mask),this.cullable)this._renderWithCulling(e);else{this._render(e);for(let h=0,l=this.children.length;h<l;++h)this.children[h].render(e)}i&&e.batch.flush(),r&&e.mask.pop(this),t&&((o=this._enabledFilters)!=null&&o.length)&&e.filter.pop()}_render(e){}destroy(e){super.destroy(),this.sortDirty=!1;const t=typeof e=="boolean"?e:e==null?void 0:e.children,r=this.removeChildren(0,this.children.length);if(t)for(let i=0;i<r.length;++i)r[i].destroy(e)}get width(){return this.scale.x*this.getLocalBounds().width}set width(e){const t=this.getLocalBounds().width;t!==0?this.scale.x=e/t:this.scale.x=1,this._width=e}get height(){return this.scale.y*this.getLocalBounds().height}set height(e){const t=this.getLocalBounds().height;t!==0?this.scale.y=e/t:this.scale.y=1,this._height=e}};co.defaultSortableChildren=!1;let ur=co;ur.prototype.containerUpdateTransform=ur.prototype.updateTransform,Object.defineProperties(H,{SORTABLE_CHILDREN:{get(){return ur.defaultSortableChildren},set(s){$("7.1.0","settings.SORTABLE_CHILDREN is deprecated, use Container.defaultSortableChildren"),ur.defaultSortableChildren=s}}});const fo=class ki{constructor(e){this.stage=new ur,e=Object.assign({forceCanvas:!1},e),this.renderer=yd(e),ki._plugins.forEach(t=>{t.init.call(this,e)})}render(){this.renderer.render(this.stage)}get view(){var e;return(e=this.renderer)==null?void 0:e.view}get screen(){var e;return(e=this.renderer)==null?void 0:e.screen}destroy(e,t){const r=ki._plugins.slice(0);r.reverse(),r.forEach(i=>{i.destroy.call(this)}),this.stage.destroy(t),this.stage=null,this.renderer.destroy(e),this.renderer=null}};fo._plugins=[];let Rd=fo;V.handleByList(U.Application,Rd._plugins);class po{static init(e){Object.defineProperty(this,"resizeTo",{set(t){globalThis.removeEventListener("resize",this.queueResize),this._resizeTo=t,t&&(globalThis.addEventListener("resize",this.queueResize),this.resize())},get(){return this._resizeTo}}),this.queueResize=()=>{this._resizeTo&&(this.cancelResize(),this._resizeId=requestAnimationFrame(()=>this.resize()))},this.cancelResize=()=>{this._resizeId&&(cancelAnimationFrame(this._resizeId),this._resizeId=null)},this.resize=()=>{if(!this._resizeTo)return;this.cancelResize();let t,r;if(this._resizeTo===globalThis.window)t=globalThis.innerWidth,r=globalThis.innerHeight;else{const{clientWidth:i,clientHeight:n}=this._resizeTo;t=i,r=n}this.renderer.resize(t,r),this.render()},this._resizeId=null,this._resizeTo=null,this.resizeTo=e.resizeTo||null}static destroy(){globalThis.removeEventListener("resize",this.queueResize),this.cancelResize(),this.cancelResize=null,this.queueResize=null,this.resizeTo=null,this.resize=null}}po.extension=U.Application,V.add(po);var Pd=`varying vec2 vTextureCoord;
uniform sampler2D uSampler;
uniform float m[20];
uniform float uAlpha;

void main(void)
{
    vec4 c = texture2D(uSampler, vTextureCoord);

    if (uAlpha == 0.0) {
        gl_FragColor = c;
        return;
    }

    // Un-premultiply alpha before applying the color matrix. See issue #3539.
    if (c.a > 0.0) {
      c.rgb /= c.a;
    }

    vec4 result;

    result.r = (m[0] * c.r);
        result.r += (m[1] * c.g);
        result.r += (m[2] * c.b);
        result.r += (m[3] * c.a);
        result.r += m[4];

    result.g = (m[5] * c.r);
        result.g += (m[6] * c.g);
        result.g += (m[7] * c.b);
        result.g += (m[8] * c.a);
        result.g += m[9];

    result.b = (m[10] * c.r);
       result.b += (m[11] * c.g);
       result.b += (m[12] * c.b);
       result.b += (m[13] * c.a);
       result.b += m[14];

    result.a = (m[15] * c.r);
       result.a += (m[16] * c.g);
       result.a += (m[17] * c.b);
       result.a += (m[18] * c.a);
       result.a += m[19];

    vec3 rgb = mix(c.rgb, result.rgb, uAlpha);

    // Premultiply alpha again.
    rgb *= result.a;

    gl_FragColor = vec4(rgb, result.a);
}
`;class mo extends Qe{constructor(){const e={m:new Float32Array([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0]),uAlpha:1};super(bd,Pd,e),this.alpha=1}_loadMatrix(e,t=!1){let r=e;t&&(this._multiply(r,this.uniforms.m,e),r=this._colorMatrix(r)),this.uniforms.m=r}_multiply(e,t,r){return e[0]=t[0]*r[0]+t[1]*r[5]+t[2]*r[10]+t[3]*r[15],e[1]=t[0]*r[1]+t[1]*r[6]+t[2]*r[11]+t[3]*r[16],e[2]=t[0]*r[2]+t[1]*r[7]+t[2]*r[12]+t[3]*r[17],e[3]=t[0]*r[3]+t[1]*r[8]+t[2]*r[13]+t[3]*r[18],e[4]=t[0]*r[4]+t[1]*r[9]+t[2]*r[14]+t[3]*r[19]+t[4],e[5]=t[5]*r[0]+t[6]*r[5]+t[7]*r[10]+t[8]*r[15],e[6]=t[5]*r[1]+t[6]*r[6]+t[7]*r[11]+t[8]*r[16],e[7]=t[5]*r[2]+t[6]*r[7]+t[7]*r[12]+t[8]*r[17],e[8]=t[5]*r[3]+t[6]*r[8]+t[7]*r[13]+t[8]*r[18],e[9]=t[5]*r[4]+t[6]*r[9]+t[7]*r[14]+t[8]*r[19]+t[9],e[10]=t[10]*r[0]+t[11]*r[5]+t[12]*r[10]+t[13]*r[15],e[11]=t[10]*r[1]+t[11]*r[6]+t[12]*r[11]+t[13]*r[16],e[12]=t[10]*r[2]+t[11]*r[7]+t[12]*r[12]+t[13]*r[17],e[13]=t[10]*r[3]+t[11]*r[8]+t[12]*r[13]+t[13]*r[18],e[14]=t[10]*r[4]+t[11]*r[9]+t[12]*r[14]+t[13]*r[19]+t[14],e[15]=t[15]*r[0]+t[16]*r[5]+t[17]*r[10]+t[18]*r[15],e[16]=t[15]*r[1]+t[16]*r[6]+t[17]*r[11]+t[18]*r[16],e[17]=t[15]*r[2]+t[16]*r[7]+t[17]*r[12]+t[18]*r[17],e[18]=t[15]*r[3]+t[16]*r[8]+t[17]*r[13]+t[18]*r[18],e[19]=t[15]*r[4]+t[16]*r[9]+t[17]*r[14]+t[18]*r[19]+t[19],e}_colorMatrix(e){const t=new Float32Array(e);return t[4]/=255,t[9]/=255,t[14]/=255,t[19]/=255,t}brightness(e,t){const r=[e,0,0,0,0,0,e,0,0,0,0,0,e,0,0,0,0,0,1,0];this._loadMatrix(r,t)}tint(e,t){const[r,i,n]=Bt.shared.setValue(e).toArray(),a=[r,0,0,0,0,0,i,0,0,0,0,0,n,0,0,0,0,0,1,0];this._loadMatrix(a,t)}greyscale(e,t){const r=[e,e,e,0,0,e,e,e,0,0,e,e,e,0,0,0,0,0,1,0];this._loadMatrix(r,t)}blackAndWhite(e){const t=[.3,.6,.1,0,0,.3,.6,.1,0,0,.3,.6,.1,0,0,0,0,0,1,0];this._loadMatrix(t,e)}hue(e,t){e=(e||0)/180*Math.PI;const r=Math.cos(e),i=Math.sin(e),n=Math.sqrt,a=1/3,o=n(a),h=r+(1-r)*a,l=a*(1-r)-o*i,u=a*(1-r)+o*i,c=a*(1-r)+o*i,d=r+a*(1-r),f=a*(1-r)-o*i,p=a*(1-r)-o*i,m=a*(1-r)+o*i,y=r+a*(1-r),x=[h,l,u,0,0,c,d,f,0,0,p,m,y,0,0,0,0,0,1,0];this._loadMatrix(x,t)}contrast(e,t){const r=(e||0)+1,i=-.5*(r-1),n=[r,0,0,0,i,0,r,0,0,i,0,0,r,0,i,0,0,0,1,0];this._loadMatrix(n,t)}saturate(e=0,t){const r=e*2/3+1,i=(r-1)*-.5,n=[r,i,i,0,0,i,r,i,0,0,i,i,r,0,0,0,0,0,1,0];this._loadMatrix(n,t)}desaturate(){this.saturate(-1)}negative(e){const t=[-1,0,0,1,0,0,-1,0,1,0,0,0,-1,1,0,0,0,0,1,0];this._loadMatrix(t,e)}sepia(e){const t=[.393,.7689999,.18899999,0,0,.349,.6859999,.16799999,0,0,.272,.5339999,.13099999,0,0,0,0,0,1,0];this._loadMatrix(t,e)}technicolor(e){const t=[1.9125277891456083,-.8545344976951645,-.09155508482755585,0,11.793603434377337,-.3087833385928097,1.7658908555458428,-.10601743074722245,0,-70.35205161461398,-.231103377548616,-.7501899197440212,1.847597816108189,0,30.950940869491138,0,0,0,1,0];this._loadMatrix(t,e)}polaroid(e){const t=[1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0];this._loadMatrix(t,e)}toBGR(e){const t=[0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0];this._loadMatrix(t,e)}kodachrome(e){const t=[1.1285582396593525,-.3967382283601348,-.03992559172921793,0,63.72958762196502,-.16404339962244616,1.0835251566291304,-.05498805115633132,0,24.732407896706203,-.16786010706155763,-.5603416277695248,1.6014850761964943,0,35.62982807460946,0,0,0,1,0];this._loadMatrix(t,e)}browni(e){const t=[.5997023498159715,.34553243048391263,-.2708298674538042,0,47.43192855600873,-.037703249837783157,.8609577587992641,.15059552388459913,0,-36.96841498319127,.24113635128153335,-.07441037908422492,.44972182064877153,0,-7.562075277591283,0,0,0,1,0];this._loadMatrix(t,e)}vintage(e){const t=[.6279345635605994,.3202183420819367,-.03965408211312453,0,9.651285835294123,.02578397704808868,.6441188644374771,.03259127616149294,0,7.462829176470591,.0466055556782719,-.0851232987247891,.5241648018700465,0,5.159190588235296,0,0,0,1,0];this._loadMatrix(t,e)}colorTone(e,t,r,i,n){e=e||.2,t=t||.15,r=r||16770432,i=i||3375104;const a=Bt.shared,[o,h,l]=a.setValue(r).toArray(),[u,c,d]=a.setValue(i).toArray(),f=[.3,.59,.11,0,0,o,h,l,e,0,u,c,d,t,0,o-u,h-c,l-d,0,0];this._loadMatrix(f,n)}night(e,t){e=e||.1;const r=[e*-2,-e,0,0,0,-e,0,e,0,0,0,e,e*2,0,0,0,0,0,1,0];this._loadMatrix(r,t)}predator(e,t){const r=[11.224130630493164*e,-4.794486999511719*e,-2.8746118545532227*e,0*e,.40342438220977783*e,-3.6330697536468506*e,9.193157196044922*e,-2.951810836791992*e,0*e,-1.316135048866272*e,-3.2184197902679443*e,-4.2375030517578125*e,7.476448059082031*e,0*e,.8044459223747253*e,0,0,0,1,0];this._loadMatrix(r,t)}lsd(e){const t=[2,-.4,.5,0,0,-.5,2,-.4,0,0,-.4,-.5,3,0,0,0,0,0,1,0];this._loadMatrix(t,e)}reset(){const e=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0];this._loadMatrix(e,!1)}get matrix(){return this.uniforms.m}set matrix(e){this.uniforms.m=e}get alpha(){return this.uniforms.uAlpha}set alpha(e){this.uniforms.uAlpha=e}}mo.prototype.grayscale=mo.prototype.greyscale;var Ld=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
    vTextureCoord = aTextureCoord;
}`,Nd=`uniform float radius;
uniform float strength;
uniform vec2 center;
uniform sampler2D uSampler;
varying vec2 vTextureCoord;

uniform vec4 filterArea;
uniform vec4 filterClamp;
uniform vec2 dimensions;

void main()
{
    vec2 coord = vTextureCoord * filterArea.xy;
    coord -= center * dimensions.xy;
    float distance = length(coord);
    if (distance < radius) {
        float percent = distance / radius;
        if (strength > 0.0) {
            coord *= mix(1.0, smoothstep(0.0, radius / distance, percent), strength * 0.75);
        } else {
            coord *= mix(1.0, pow(percent, 1.0 + strength * 0.75) * radius / distance, 1.0 - percent);
        }
    }
    coord += center * dimensions.xy;
    coord /= filterArea.xy;
    vec2 clampedCoord = clamp(coord, filterClamp.xy, filterClamp.zw);
    vec4 color = texture2D(uSampler, clampedCoord);
    if (coord != clampedCoord) {
        color *= max(0.0, 1.0 - length(coord - clampedCoord));
    }

    gl_FragColor = color;
}
`;const yo=class extends Qe{constructor(s){super(Ld,Nd),this.uniforms.dimensions=new Float32Array(2),Object.assign(this,yo.defaults,s)}apply(s,e,t,r){const{width:i,height:n}=e.filterFrame;this.uniforms.dimensions[0]=i,this.uniforms.dimensions[1]=n,s.applyFilter(this,e,t,r)}get radius(){return this.uniforms.radius}set radius(s){this.uniforms.radius=s}get strength(){return this.uniforms.strength}set strength(s){this.uniforms.strength=s}get center(){return this.uniforms.center}set center(s){this.uniforms.center=s}};let Cd=yo;Cd.defaults={center:[.5,.5],radius:100,strength:1};var Od=Object.defineProperty,Fd=(s,e,t)=>e in s?Od(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,A=(s,e,t)=>Fd(s,typeof e!="symbol"?e+"":e,t);const X=1e-6,go=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),bo=class ne extends Float32Array{constructor(...e){switch(e.length){case 16:super(e);break;case 2:super(e[0],e[1],16);break;case 1:const t=e[0];typeof t=="number"?super([t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t]):super(t,0,16);break;default:super(go);break}}get str(){return ne.str(this)}copy(e){return this.set(e),this}identity(){return this.set(go),this}multiply(e){return ne.multiply(this,this,e)}mul(e){return this}transpose(){return ne.transpose(this,this)}invert(){return ne.invert(this,this)}translate(e){return ne.translate(this,this,e)}rotate(e,t){return ne.rotate(this,this,e,t)}scale(e){return ne.scale(this,this,e)}rotateX(e){return ne.rotateX(this,this,e)}rotateY(e){return ne.rotateY(this,this,e)}rotateZ(e){return ne.rotateZ(this,this,e)}perspectiveNO(e,t,r,i){return ne.perspectiveNO(this,e,t,r,i)}perspectiveZO(e,t,r,i){return ne.perspectiveZO(this,e,t,r,i)}orthoNO(e,t,r,i,n,a){return ne.orthoNO(this,e,t,r,i,n,a)}orthoZO(e,t,r,i,n,a){return ne.orthoZO(this,e,t,r,i,n,a)}static create(){return new ne}static clone(e){return new ne(e)}static copy(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}static fromValues(...e){return new ne(...e)}static set(e,...t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}static identity(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}static transpose(e,t){if(e===t){const r=t[1],i=t[2],n=t[3],a=t[6],o=t[7],h=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=r,e[6]=t[9],e[7]=t[13],e[8]=i,e[9]=a,e[11]=t[14],e[12]=n,e[13]=o,e[14]=h}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e}static invert(e,t){const r=t[0],i=t[1],n=t[2],a=t[3],o=t[4],h=t[5],l=t[6],u=t[7],c=t[8],d=t[9],f=t[10],p=t[11],m=t[12],y=t[13],x=t[14],b=t[15],g=r*h-i*o,v=r*l-n*o,_=r*u-a*o,T=i*l-n*h,E=i*u-a*h,w=n*u-a*l,S=c*y-d*m,L=c*x-f*m,I=c*b-p*m,k=d*x-f*y,C=d*b-p*y,F=f*b-p*x;let N=g*F-v*C+_*k+T*I-E*L+w*S;return N?(N=1/N,e[0]=(h*F-l*C+u*k)*N,e[1]=(n*C-i*F-a*k)*N,e[2]=(y*w-x*E+b*T)*N,e[3]=(f*E-d*w-p*T)*N,e[4]=(l*I-o*F-u*L)*N,e[5]=(r*F-n*I+a*L)*N,e[6]=(x*_-m*w-b*v)*N,e[7]=(c*w-f*_+p*v)*N,e[8]=(o*C-h*I+u*S)*N,e[9]=(i*I-r*C-a*S)*N,e[10]=(m*E-y*_+b*g)*N,e[11]=(d*_-c*E-p*g)*N,e[12]=(h*L-o*k-l*S)*N,e[13]=(r*k-i*L+n*S)*N,e[14]=(y*v-m*T-x*g)*N,e[15]=(c*T-d*v+f*g)*N,e):null}static adjoint(e,t){const r=t[0],i=t[1],n=t[2],a=t[3],o=t[4],h=t[5],l=t[6],u=t[7],c=t[8],d=t[9],f=t[10],p=t[11],m=t[12],y=t[13],x=t[14],b=t[15],g=r*h-i*o,v=r*l-n*o,_=r*u-a*o,T=i*l-n*h,E=i*u-a*h,w=n*u-a*l,S=c*y-d*m,L=c*x-f*m,I=c*b-p*m,k=d*x-f*y,C=d*b-p*y,F=f*b-p*x;return e[0]=h*F-l*C+u*k,e[1]=n*C-i*F-a*k,e[2]=y*w-x*E+b*T,e[3]=f*E-d*w-p*T,e[4]=l*I-o*F-u*L,e[5]=r*F-n*I+a*L,e[6]=x*_-m*w-b*v,e[7]=c*w-f*_+p*v,e[8]=o*C-h*I+u*S,e[9]=i*I-r*C-a*S,e[10]=m*E-y*_+b*g,e[11]=d*_-c*E-p*g,e[12]=h*L-o*k-l*S,e[13]=r*k-i*L+n*S,e[14]=y*v-m*T-x*g,e[15]=c*T-d*v+f*g,e}static determinant(e){const t=e[0],r=e[1],i=e[2],n=e[3],a=e[4],o=e[5],h=e[6],l=e[7],u=e[8],c=e[9],d=e[10],f=e[11],p=e[12],m=e[13],y=e[14],x=e[15],b=t*o-r*a,g=t*h-i*a,v=r*h-i*o,_=u*m-c*p,T=u*y-d*p,E=c*y-d*m,w=t*E-r*T+i*_,S=a*E-o*T+h*_,L=u*v-c*g+d*b,I=p*v-m*g+y*b;return l*w-n*S+x*L-f*I}static multiply(e,t,r){const i=t[0],n=t[1],a=t[2],o=t[3],h=t[4],l=t[5],u=t[6],c=t[7],d=t[8],f=t[9],p=t[10],m=t[11],y=t[12],x=t[13],b=t[14],g=t[15];let v=r[0],_=r[1],T=r[2],E=r[3];return e[0]=v*i+_*h+T*d+E*y,e[1]=v*n+_*l+T*f+E*x,e[2]=v*a+_*u+T*p+E*b,e[3]=v*o+_*c+T*m+E*g,v=r[4],_=r[5],T=r[6],E=r[7],e[4]=v*i+_*h+T*d+E*y,e[5]=v*n+_*l+T*f+E*x,e[6]=v*a+_*u+T*p+E*b,e[7]=v*o+_*c+T*m+E*g,v=r[8],_=r[9],T=r[10],E=r[11],e[8]=v*i+_*h+T*d+E*y,e[9]=v*n+_*l+T*f+E*x,e[10]=v*a+_*u+T*p+E*b,e[11]=v*o+_*c+T*m+E*g,v=r[12],_=r[13],T=r[14],E=r[15],e[12]=v*i+_*h+T*d+E*y,e[13]=v*n+_*l+T*f+E*x,e[14]=v*a+_*u+T*p+E*b,e[15]=v*o+_*c+T*m+E*g,e}static mul(e,t,r){return e}static translate(e,t,r){const i=r[0],n=r[1],a=r[2];if(t===e)e[12]=t[0]*i+t[4]*n+t[8]*a+t[12],e[13]=t[1]*i+t[5]*n+t[9]*a+t[13],e[14]=t[2]*i+t[6]*n+t[10]*a+t[14],e[15]=t[3]*i+t[7]*n+t[11]*a+t[15];else{const o=t[0],h=t[1],l=t[2],u=t[3],c=t[4],d=t[5],f=t[6],p=t[7],m=t[8],y=t[9],x=t[10],b=t[11];e[0]=o,e[1]=h,e[2]=l,e[3]=u,e[4]=c,e[5]=d,e[6]=f,e[7]=p,e[8]=m,e[9]=y,e[10]=x,e[11]=b,e[12]=o*i+c*n+m*a+t[12],e[13]=h*i+d*n+y*a+t[13],e[14]=l*i+f*n+x*a+t[14],e[15]=u*i+p*n+b*a+t[15]}return e}static scale(e,t,r){const i=r[0],n=r[1],a=r[2];return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*n,e[5]=t[5]*n,e[6]=t[6]*n,e[7]=t[7]*n,e[8]=t[8]*a,e[9]=t[9]*a,e[10]=t[10]*a,e[11]=t[11]*a,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}static rotate(e,t,r,i){let n=i[0],a=i[1],o=i[2],h=Math.sqrt(n*n+a*a+o*o);if(h<X)return null;h=1/h,n*=h,a*=h,o*=h;const l=Math.sin(r),u=Math.cos(r),c=1-u,d=t[0],f=t[1],p=t[2],m=t[3],y=t[4],x=t[5],b=t[6],g=t[7],v=t[8],_=t[9],T=t[10],E=t[11],w=n*n*c+u,S=a*n*c+o*l,L=o*n*c-a*l,I=n*a*c-o*l,k=a*a*c+u,C=o*a*c+n*l,F=n*o*c+a*l,N=a*o*c-n*l,J=o*o*c+u;return e[0]=d*w+y*S+v*L,e[1]=f*w+x*S+_*L,e[2]=p*w+b*S+T*L,e[3]=m*w+g*S+E*L,e[4]=d*I+y*k+v*C,e[5]=f*I+x*k+_*C,e[6]=p*I+b*k+T*C,e[7]=m*I+g*k+E*C,e[8]=d*F+y*N+v*J,e[9]=f*F+x*N+_*J,e[10]=p*F+b*N+T*J,e[11]=m*F+g*N+E*J,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e}static rotateX(e,t,r){let i=Math.sin(r),n=Math.cos(r),a=t[4],o=t[5],h=t[6],l=t[7],u=t[8],c=t[9],d=t[10],f=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=a*n+u*i,e[5]=o*n+c*i,e[6]=h*n+d*i,e[7]=l*n+f*i,e[8]=u*n-a*i,e[9]=c*n-o*i,e[10]=d*n-h*i,e[11]=f*n-l*i,e}static rotateY(e,t,r){let i=Math.sin(r),n=Math.cos(r),a=t[0],o=t[1],h=t[2],l=t[3],u=t[8],c=t[9],d=t[10],f=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=a*n-u*i,e[1]=o*n-c*i,e[2]=h*n-d*i,e[3]=l*n-f*i,e[8]=a*i+u*n,e[9]=o*i+c*n,e[10]=h*i+d*n,e[11]=l*i+f*n,e}static rotateZ(e,t,r){let i=Math.sin(r),n=Math.cos(r),a=t[0],o=t[1],h=t[2],l=t[3],u=t[4],c=t[5],d=t[6],f=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=a*n+u*i,e[1]=o*n+c*i,e[2]=h*n+d*i,e[3]=l*n+f*i,e[4]=u*n-a*i,e[5]=c*n-o*i,e[6]=d*n-h*i,e[7]=f*n-l*i,e}static fromTranslation(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e}static fromScaling(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}static fromRotation(e,t,r){let i=r[0],n=r[1],a=r[2],o=Math.sqrt(i*i+n*n+a*a);if(o<X)return null;o=1/o,i*=o,n*=o,a*=o;const h=Math.sin(t),l=Math.cos(t),u=1-l;return e[0]=i*i*u+l,e[1]=n*i*u+a*h,e[2]=a*i*u-n*h,e[3]=0,e[4]=i*n*u-a*h,e[5]=n*n*u+l,e[6]=a*n*u+i*h,e[7]=0,e[8]=i*a*u+n*h,e[9]=n*a*u-i*h,e[10]=a*a*u+l,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}static fromXRotation(e,t){let r=Math.sin(t),i=Math.cos(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=i,e[6]=r,e[7]=0,e[8]=0,e[9]=-r,e[10]=i,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}static fromYRotation(e,t){let r=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=0,e[2]=-r,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=r,e[9]=0,e[10]=i,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}static fromZRotation(e,t){const r=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=r,e[2]=0,e[3]=0,e[4]=-r,e[5]=i,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}static fromRotationTranslation(e,t,r){const i=t[0],n=t[1],a=t[2],o=t[3],h=i+i,l=n+n,u=a+a,c=i*h,d=i*l,f=i*u,p=n*l,m=n*u,y=a*u,x=o*h,b=o*l,g=o*u;return e[0]=1-(p+y),e[1]=d+g,e[2]=f-b,e[3]=0,e[4]=d-g,e[5]=1-(c+y),e[6]=m+x,e[7]=0,e[8]=f+b,e[9]=m-x,e[10]=1-(c+p),e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}static fromQuat2(e,t){const r=-t[0],i=-t[1],n=-t[2],a=t[3],o=t[4],h=t[5],l=t[6],u=t[7];let c=r*r+i*i+n*n+a*a;return c>0?(Re[0]=(o*a+u*r+h*n-l*i)*2/c,Re[1]=(h*a+u*i+l*r-o*n)*2/c,Re[2]=(l*a+u*n+o*i-h*r)*2/c):(Re[0]=(o*a+u*r+h*n-l*i)*2,Re[1]=(h*a+u*i+l*r-o*n)*2,Re[2]=(l*a+u*n+o*i-h*r)*2),ne.fromRotationTranslation(e,t,Re),e}static normalFromMat4(e,t){const r=t[0],i=t[1],n=t[2],a=t[3],o=t[4],h=t[5],l=t[6],u=t[7],c=t[8],d=t[9],f=t[10],p=t[11],m=t[12],y=t[13],x=t[14],b=t[15],g=r*h-i*o,v=r*l-n*o,_=r*u-a*o,T=i*l-n*h,E=i*u-a*h,w=n*u-a*l,S=c*y-d*m,L=c*x-f*m,I=c*b-p*m,k=d*x-f*y,C=d*b-p*y,F=f*b-p*x;let N=g*F-v*C+_*k+T*I-E*L+w*S;return N?(N=1/N,e[0]=(h*F-l*C+u*k)*N,e[1]=(l*I-o*F-u*L)*N,e[2]=(o*C-h*I+u*S)*N,e[3]=0,e[4]=(n*C-i*F-a*k)*N,e[5]=(r*F-n*I+a*L)*N,e[6]=(i*I-r*C-a*S)*N,e[7]=0,e[8]=(y*w-x*E+b*T)*N,e[9]=(x*_-m*w-b*v)*N,e[10]=(m*E-y*_+b*g)*N,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e):null}static normalFromMat4Fast(e,t){const r=t[0],i=t[1],n=t[2],a=t[4],o=t[5],h=t[6],l=t[8],u=t[9],c=t[10];return e[0]=o*c-c*u,e[1]=h*l-l*c,e[2]=a*u-u*l,e[3]=0,e[4]=u*n-c*i,e[5]=c*r-l*n,e[6]=l*i-u*r,e[7]=0,e[8]=i*h-n*o,e[9]=n*a-r*h,e[10]=r*o-i*a,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}static getTranslation(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e}static getScaling(e,t){const r=t[0],i=t[1],n=t[2],a=t[4],o=t[5],h=t[6],l=t[8],u=t[9],c=t[10];return e[0]=Math.sqrt(r*r+i*i+n*n),e[1]=Math.sqrt(a*a+o*o+h*h),e[2]=Math.sqrt(l*l+u*u+c*c),e}static getRotation(e,t){ne.getScaling(Re,t);const r=1/Re[0],i=1/Re[1],n=1/Re[2],a=t[0]*r,o=t[1]*i,h=t[2]*n,l=t[4]*r,u=t[5]*i,c=t[6]*n,d=t[8]*r,f=t[9]*i,p=t[10]*n,m=a+u+p;let y=0;return m>0?(y=Math.sqrt(m+1)*2,e[3]=.25*y,e[0]=(c-f)/y,e[1]=(d-h)/y,e[2]=(o-l)/y):a>u&&a>p?(y=Math.sqrt(1+a-u-p)*2,e[3]=(c-f)/y,e[0]=.25*y,e[1]=(o+l)/y,e[2]=(d+h)/y):u>p?(y=Math.sqrt(1+u-a-p)*2,e[3]=(d-h)/y,e[0]=(o+l)/y,e[1]=.25*y,e[2]=(c+f)/y):(y=Math.sqrt(1+p-a-u)*2,e[3]=(o-l)/y,e[0]=(d+h)/y,e[1]=(c+f)/y,e[2]=.25*y),e}static decompose(e,t,r,i){t[0]=i[12],t[1]=i[13],t[2]=i[14];const n=i[0],a=i[1],o=i[2],h=i[4],l=i[5],u=i[6],c=i[8],d=i[9],f=i[10];r[0]=Math.sqrt(n*n+a*a+o*o),r[1]=Math.sqrt(h*h+l*l+u*u),r[2]=Math.sqrt(c*c+d*d+f*f);const p=1/r[0],m=1/r[1],y=1/r[2],x=n*p,b=a*m,g=o*y,v=h*p,_=l*m,T=u*y,E=c*p,w=d*m,S=f*y,L=x+_+S;let I=0;return L>0?(I=Math.sqrt(L+1)*2,e[3]=.25*I,e[0]=(T-w)/I,e[1]=(E-g)/I,e[2]=(b-v)/I):x>_&&x>S?(I=Math.sqrt(1+x-_-S)*2,e[3]=(T-w)/I,e[0]=.25*I,e[1]=(b+v)/I,e[2]=(E+g)/I):_>S?(I=Math.sqrt(1+_-x-S)*2,e[3]=(E-g)/I,e[0]=(b+v)/I,e[1]=.25*I,e[2]=(T+w)/I):(I=Math.sqrt(1+S-x-_)*2,e[3]=(b-v)/I,e[0]=(E+g)/I,e[1]=(T+w)/I,e[2]=.25*I),e}static fromRotationTranslationScale(e,t,r,i){const n=t[0],a=t[1],o=t[2],h=t[3],l=n+n,u=a+a,c=o+o,d=n*l,f=n*u,p=n*c,m=a*u,y=a*c,x=o*c,b=h*l,g=h*u,v=h*c,_=i[0],T=i[1],E=i[2];return e[0]=(1-(m+x))*_,e[1]=(f+v)*_,e[2]=(p-g)*_,e[3]=0,e[4]=(f-v)*T,e[5]=(1-(d+x))*T,e[6]=(y+b)*T,e[7]=0,e[8]=(p+g)*E,e[9]=(y-b)*E,e[10]=(1-(d+m))*E,e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}static fromRotationTranslationScaleOrigin(e,t,r,i,n){const a=t[0],o=t[1],h=t[2],l=t[3],u=a+a,c=o+o,d=h+h,f=a*u,p=a*c,m=a*d,y=o*c,x=o*d,b=h*d,g=l*u,v=l*c,_=l*d,T=i[0],E=i[1],w=i[2],S=n[0],L=n[1],I=n[2],k=(1-(y+b))*T,C=(p+_)*T,F=(m-v)*T,N=(p-_)*E,J=(1-(f+b))*E,xe=(x+g)*E,Ge=(m+v)*w,rt=(x-g)*w,P=(1-(f+y))*w;return e[0]=k,e[1]=C,e[2]=F,e[3]=0,e[4]=N,e[5]=J,e[6]=xe,e[7]=0,e[8]=Ge,e[9]=rt,e[10]=P,e[11]=0,e[12]=r[0]+S-(k*S+N*L+Ge*I),e[13]=r[1]+L-(C*S+J*L+rt*I),e[14]=r[2]+I-(F*S+xe*L+P*I),e[15]=1,e}static fromQuat(e,t){const r=t[0],i=t[1],n=t[2],a=t[3],o=r+r,h=i+i,l=n+n,u=r*o,c=i*o,d=i*h,f=n*o,p=n*h,m=n*l,y=a*o,x=a*h,b=a*l;return e[0]=1-d-m,e[1]=c+b,e[2]=f-x,e[3]=0,e[4]=c-b,e[5]=1-u-m,e[6]=p+y,e[7]=0,e[8]=f+x,e[9]=p-y,e[10]=1-u-d,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}static frustumNO(e,t,r,i,n,a,o=1/0){const h=1/(r-t),l=1/(n-i);if(e[0]=a*2*h,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a*2*l,e[6]=0,e[7]=0,e[8]=(r+t)*h,e[9]=(n+i)*l,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,o!=null&&o!==1/0){const u=1/(a-o);e[10]=(o+a)*u,e[14]=2*o*a*u}else e[10]=-1,e[14]=-2*a;return e}static frustum(e,t,r,i,n,a,o=1/0){return e}static frustumZO(e,t,r,i,n,a,o=1/0){const h=1/(r-t),l=1/(n-i);if(e[0]=a*2*h,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a*2*l,e[6]=0,e[7]=0,e[8]=(r+t)*h,e[9]=(n+i)*l,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,o!=null&&o!==1/0){const u=1/(a-o);e[10]=o*u,e[14]=o*a*u}else e[10]=-1,e[14]=-a;return e}static perspectiveNO(e,t,r,i,n=1/0){const a=1/Math.tan(t/2);if(e[0]=a/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,n!=null&&n!==1/0){const o=1/(i-n);e[10]=(n+i)*o,e[14]=2*n*i*o}else e[10]=-1,e[14]=-2*i;return e}static perspective(e,t,r,i,n=1/0){return e}static perspectiveZO(e,t,r,i,n=1/0){const a=1/Math.tan(t/2);if(e[0]=a/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,n!=null&&n!==1/0){const o=1/(i-n);e[10]=n*o,e[14]=n*i*o}else e[10]=-1,e[14]=-i;return e}static perspectiveFromFieldOfView(e,t,r,i){const n=Math.tan(t.upDegrees*Math.PI/180),a=Math.tan(t.downDegrees*Math.PI/180),o=Math.tan(t.leftDegrees*Math.PI/180),h=Math.tan(t.rightDegrees*Math.PI/180),l=2/(o+h),u=2/(n+a);return e[0]=l,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=u,e[6]=0,e[7]=0,e[8]=-((o-h)*l*.5),e[9]=(n-a)*u*.5,e[10]=i/(r-i),e[11]=-1,e[12]=0,e[13]=0,e[14]=i*r/(r-i),e[15]=0,e}static orthoNO(e,t,r,i,n,a,o){const h=1/(t-r),l=1/(i-n),u=1/(a-o);return e[0]=-2*h,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*u,e[11]=0,e[12]=(t+r)*h,e[13]=(n+i)*l,e[14]=(o+a)*u,e[15]=1,e}static ortho(e,t,r,i,n,a,o){return e}static orthoZO(e,t,r,i,n,a,o){const h=1/(t-r),l=1/(i-n),u=1/(a-o);return e[0]=-2*h,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=u,e[11]=0,e[12]=(t+r)*h,e[13]=(n+i)*l,e[14]=a*u,e[15]=1,e}static lookAt(e,t,r,i){const n=t[0],a=t[1],o=t[2],h=i[0],l=i[1],u=i[2],c=r[0],d=r[1],f=r[2];if(Math.abs(n-c)<X&&Math.abs(a-d)<X&&Math.abs(o-f)<X)return ne.identity(e);let p=n-c,m=a-d,y=o-f,x=1/Math.sqrt(p*p+m*m+y*y);p*=x,m*=x,y*=x;let b=l*y-u*m,g=u*p-h*y,v=h*m-l*p;x=Math.sqrt(b*b+g*g+v*v),x?(x=1/x,b*=x,g*=x,v*=x):(b=0,g=0,v=0);let _=m*v-y*g,T=y*b-p*v,E=p*g-m*b;return x=Math.sqrt(_*_+T*T+E*E),x?(x=1/x,_*=x,T*=x,E*=x):(_=0,T=0,E=0),e[0]=b,e[1]=_,e[2]=p,e[3]=0,e[4]=g,e[5]=T,e[6]=m,e[7]=0,e[8]=v,e[9]=E,e[10]=y,e[11]=0,e[12]=-(b*n+g*a+v*o),e[13]=-(_*n+T*a+E*o),e[14]=-(p*n+m*a+y*o),e[15]=1,e}static targetTo(e,t,r,i){const n=t[0],a=t[1],o=t[2],h=i[0],l=i[1],u=i[2];let c=n-r[0],d=a-r[1],f=o-r[2],p=c*c+d*d+f*f;p>0&&(p=1/Math.sqrt(p),c*=p,d*=p,f*=p);let m=l*f-u*d,y=u*c-h*f,x=h*d-l*c;return p=m*m+y*y+x*x,p>0&&(p=1/Math.sqrt(p),m*=p,y*=p,x*=p),e[0]=m,e[1]=y,e[2]=x,e[3]=0,e[4]=d*x-f*y,e[5]=f*m-c*x,e[6]=c*y-d*m,e[7]=0,e[8]=c,e[9]=d,e[10]=f,e[11]=0,e[12]=n,e[13]=a,e[14]=o,e[15]=1,e}static frob(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]+e[3]*e[3]+e[4]*e[4]+e[5]*e[5]+e[6]*e[6]+e[7]*e[7]+e[8]*e[8]+e[9]*e[9]+e[10]*e[10]+e[11]*e[11]+e[12]*e[12]+e[13]*e[13]+e[14]*e[14]+e[15]*e[15])}static add(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e[6]=t[6]+r[6],e[7]=t[7]+r[7],e[8]=t[8]+r[8],e[9]=t[9]+r[9],e[10]=t[10]+r[10],e[11]=t[11]+r[11],e[12]=t[12]+r[12],e[13]=t[13]+r[13],e[14]=t[14]+r[14],e[15]=t[15]+r[15],e}static subtract(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e[4]=t[4]-r[4],e[5]=t[5]-r[5],e[6]=t[6]-r[6],e[7]=t[7]-r[7],e[8]=t[8]-r[8],e[9]=t[9]-r[9],e[10]=t[10]-r[10],e[11]=t[11]-r[11],e[12]=t[12]-r[12],e[13]=t[13]-r[13],e[14]=t[14]-r[14],e[15]=t[15]-r[15],e}static sub(e,t,r){return e}static multiplyScalar(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*r,e[9]=t[9]*r,e[10]=t[10]*r,e[11]=t[11]*r,e[12]=t[12]*r,e[13]=t[13]*r,e[14]=t[14]*r,e[15]=t[15]*r,e}static multiplyScalarAndAdd(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e[3]=t[3]+r[3]*i,e[4]=t[4]+r[4]*i,e[5]=t[5]+r[5]*i,e[6]=t[6]+r[6]*i,e[7]=t[7]+r[7]*i,e[8]=t[8]+r[8]*i,e[9]=t[9]+r[9]*i,e[10]=t[10]+r[10]*i,e[11]=t[11]+r[11]*i,e[12]=t[12]+r[12]*i,e[13]=t[13]+r[13]*i,e[14]=t[14]+r[14]*i,e[15]=t[15]+r[15]*i,e}static exactEquals(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]}static equals(e,t){const r=e[0],i=e[1],n=e[2],a=e[3],o=e[4],h=e[5],l=e[6],u=e[7],c=e[8],d=e[9],f=e[10],p=e[11],m=e[12],y=e[13],x=e[14],b=e[15],g=t[0],v=t[1],_=t[2],T=t[3],E=t[4],w=t[5],S=t[6],L=t[7],I=t[8],k=t[9],C=t[10],F=t[11],N=t[12],J=t[13],xe=t[14],Ge=t[15];return Math.abs(r-g)<=X*Math.max(1,Math.abs(r),Math.abs(g))&&Math.abs(i-v)<=X*Math.max(1,Math.abs(i),Math.abs(v))&&Math.abs(n-_)<=X*Math.max(1,Math.abs(n),Math.abs(_))&&Math.abs(a-T)<=X*Math.max(1,Math.abs(a),Math.abs(T))&&Math.abs(o-E)<=X*Math.max(1,Math.abs(o),Math.abs(E))&&Math.abs(h-w)<=X*Math.max(1,Math.abs(h),Math.abs(w))&&Math.abs(l-S)<=X*Math.max(1,Math.abs(l),Math.abs(S))&&Math.abs(u-L)<=X*Math.max(1,Math.abs(u),Math.abs(L))&&Math.abs(c-I)<=X*Math.max(1,Math.abs(c),Math.abs(I))&&Math.abs(d-k)<=X*Math.max(1,Math.abs(d),Math.abs(k))&&Math.abs(f-C)<=X*Math.max(1,Math.abs(f),Math.abs(C))&&Math.abs(p-F)<=X*Math.max(1,Math.abs(p),Math.abs(F))&&Math.abs(m-N)<=X*Math.max(1,Math.abs(m),Math.abs(N))&&Math.abs(y-J)<=X*Math.max(1,Math.abs(y),Math.abs(J))&&Math.abs(x-xe)<=X*Math.max(1,Math.abs(x),Math.abs(xe))&&Math.abs(b-Ge)<=X*Math.max(1,Math.abs(b),Math.abs(Ge))}static str(e){return`Mat4(${e.join(", ")})`}};A(bo,"BYTE_LENGTH",16*Float32Array.BYTES_PER_ELEMENT);let le=bo;const Re=new Float32Array(3);le.prototype.mul=le.prototype.multiply,le.sub=le.subtract,le.mul=le.multiply,le.frustum=le.frustumNO,le.perspective=le.perspectiveNO,le.ortho=le.orthoNO;const xo=class Be extends Float32Array{constructor(...e){switch(e.length){case 3:super(e);break;case 2:super(e[0],e[1],3);break;case 1:{const t=e[0];typeof t=="number"?super([t,t,t]):super(t,0,3);break}default:super(3);break}}get x(){return this[0]}set x(e){this[0]=e}get y(){return this[1]}set y(e){this[1]=e}get z(){return this[2]}set z(e){this[2]=e}get r(){return this[0]}set r(e){this[0]=e}get g(){return this[1]}set g(e){this[1]=e}get b(){return this[2]}set b(e){this[2]=e}get magnitude(){const e=this[0],t=this[1],r=this[2];return Math.sqrt(e*e+t*t+r*r)}get mag(){return this.magnitude}get squaredMagnitude(){const e=this[0],t=this[1],r=this[2];return e*e+t*t+r*r}get sqrMag(){return this.squaredMagnitude}get str(){return Be.str(this)}copy(e){return this.set(e),this}add(e){return this[0]+=e[0],this[1]+=e[1],this[2]+=e[2],this}subtract(e){return this[0]-=e[0],this[1]-=e[1],this[2]-=e[2],this}sub(e){return this}multiply(e){return this[0]*=e[0],this[1]*=e[1],this[2]*=e[2],this}mul(e){return this}divide(e){return this[0]/=e[0],this[1]/=e[1],this[2]/=e[2],this}div(e){return this}scale(e){return this[0]*=e,this[1]*=e,this[2]*=e,this}scaleAndAdd(e,t){return this[0]+=e[0]*t,this[1]+=e[1]*t,this[2]+=e[2]*t,this}distance(e){return Be.distance(this,e)}dist(e){return 0}squaredDistance(e){return Be.squaredDistance(this,e)}sqrDist(e){return 0}negate(){return this[0]*=-1,this[1]*=-1,this[2]*=-1,this}invert(){return this[0]=1/this[0],this[1]=1/this[1],this[2]=1/this[2],this}abs(){return this[0]=Math.abs(this[0]),this[1]=Math.abs(this[1]),this[2]=Math.abs(this[2]),this}dot(e){return this[0]*e[0]+this[1]*e[1]+this[2]*e[2]}normalize(){return Be.normalize(this,this)}static create(){return new Be}static clone(e){return new Be(e)}static magnitude(e){let t=e[0],r=e[1],i=e[2];return Math.sqrt(t*t+r*r+i*i)}static mag(e){return 0}static length(e){return 0}static len(e){return 0}static fromValues(e,t,r){return new Be(e,t,r)}static copy(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}static set(e,t,r,i){return e[0]=t,e[1]=r,e[2]=i,e}static add(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e}static subtract(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e}static sub(e,t,r){return[0,0,0]}static multiply(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e[2]=t[2]*r[2],e}static mul(e,t,r){return[0,0,0]}static divide(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e[2]=t[2]/r[2],e}static div(e,t,r){return[0,0,0]}static ceil(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e}static floor(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e}static min(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e[2]=Math.min(t[2],r[2]),e}static max(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e[2]=Math.max(t[2],r[2]),e}static scale(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e}static scaleAndAdd(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e}static distance(e,t){const r=t[0]-e[0],i=t[1]-e[1],n=t[2]-e[2];return Math.sqrt(r*r+i*i+n*n)}static dist(e,t){return 0}static squaredDistance(e,t){const r=t[0]-e[0],i=t[1]-e[1],n=t[2]-e[2];return r*r+i*i+n*n}static sqrDist(e,t){return 0}static squaredLength(e){const t=e[0],r=e[1],i=e[2];return t*t+r*r+i*i}static sqrLen(e,t){return 0}static negate(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e}static inverse(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e}static abs(e,t){return e[0]=Math.abs(t[0]),e[1]=Math.abs(t[1]),e[2]=Math.abs(t[2]),e}static normalize(e,t){const r=t[0],i=t[1],n=t[2];let a=r*r+i*i+n*n;return a>0&&(a=1/Math.sqrt(a)),e[0]=t[0]*a,e[1]=t[1]*a,e[2]=t[2]*a,e}static dot(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}static cross(e,t,r){const i=t[0],n=t[1],a=t[2],o=r[0],h=r[1],l=r[2];return e[0]=n*l-a*h,e[1]=a*o-i*l,e[2]=i*h-n*o,e}static lerp(e,t,r,i){const n=t[0],a=t[1],o=t[2];return e[0]=n+i*(r[0]-n),e[1]=a+i*(r[1]-a),e[2]=o+i*(r[2]-o),e}static slerp(e,t,r,i){const n=Math.acos(Math.min(Math.max(Be.dot(t,r),-1),1)),a=Math.sin(n),o=Math.sin((1-i)*n)/a,h=Math.sin(i*n)/a;return e[0]=o*t[0]+h*r[0],e[1]=o*t[1]+h*r[1],e[2]=o*t[2]+h*r[2],e}static hermite(e,t,r,i,n,a){const o=a*a,h=o*(2*a-3)+1,l=o*(a-2)+a,u=o*(a-1),c=o*(3-2*a);return e[0]=t[0]*h+r[0]*l+i[0]*u+n[0]*c,e[1]=t[1]*h+r[1]*l+i[1]*u+n[1]*c,e[2]=t[2]*h+r[2]*l+i[2]*u+n[2]*c,e}static bezier(e,t,r,i,n,a){const o=1-a,h=o*o,l=a*a,u=h*o,c=3*a*h,d=3*l*o,f=l*a;return e[0]=t[0]*u+r[0]*c+i[0]*d+n[0]*f,e[1]=t[1]*u+r[1]*c+i[1]*d+n[1]*f,e[2]=t[2]*u+r[2]*c+i[2]*d+n[2]*f,e}static transformMat4(e,t,r){const i=t[0],n=t[1],a=t[2],o=r[3]*i+r[7]*n+r[11]*a+r[15]||1;return e[0]=(r[0]*i+r[4]*n+r[8]*a+r[12])/o,e[1]=(r[1]*i+r[5]*n+r[9]*a+r[13])/o,e[2]=(r[2]*i+r[6]*n+r[10]*a+r[14])/o,e}static transformMat3(e,t,r){let i=t[0],n=t[1],a=t[2];return e[0]=i*r[0]+n*r[3]+a*r[6],e[1]=i*r[1]+n*r[4]+a*r[7],e[2]=i*r[2]+n*r[5]+a*r[8],e}static transformQuat(e,t,r){const i=r[0],n=r[1],a=r[2],o=r[3]*2,h=t[0],l=t[1],u=t[2],c=n*u-a*l,d=a*h-i*u,f=i*l-n*h,p=(n*f-a*d)*2,m=(a*c-i*f)*2,y=(i*d-n*c)*2;return e[0]=h+c*o+p,e[1]=l+d*o+m,e[2]=u+f*o+y,e}static rotateX(e,t,r,i){const n=r[1],a=r[2],o=t[1]-n,h=t[2]-a;return e[0]=t[0],e[1]=o*Math.cos(i)-h*Math.sin(i)+n,e[2]=o*Math.sin(i)+h*Math.cos(i)+a,e}static rotateY(e,t,r,i){const n=r[0],a=r[2],o=t[0]-n,h=t[2]-a;return e[0]=h*Math.sin(i)+o*Math.cos(i)+n,e[1]=t[1],e[2]=h*Math.cos(i)-o*Math.sin(i)+a,e}static rotateZ(e,t,r,i){const n=r[0],a=r[1],o=t[0]-n,h=t[1]-a;return e[0]=o*Math.cos(i)-h*Math.sin(i)+n,e[1]=o*Math.sin(i)+h*Math.cos(i)+a,e[2]=r[2],e}static angle(e,t){const r=e[0],i=e[1],n=e[2],a=t[0],o=t[1],h=t[2],l=Math.sqrt((r*r+i*i+n*n)*(a*a+o*o+h*h)),u=l&&Be.dot(e,t)/l;return Math.acos(Math.min(Math.max(u,-1),1))}static zero(e){return e[0]=0,e[1]=0,e[2]=0,e}static str(e){return`Vec3(${e.join(", ")})`}static exactEquals(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}static equals(e,t){const r=e[0],i=e[1],n=e[2],a=t[0],o=t[1],h=t[2];return Math.abs(r-a)<=X*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(i-o)<=X*Math.max(1,Math.abs(i),Math.abs(o))&&Math.abs(n-h)<=X*Math.max(1,Math.abs(n),Math.abs(h))}};A(xo,"BYTE_LENGTH",3*Float32Array.BYTES_PER_ELEMENT);let q=xo;q.prototype.sub=q.prototype.subtract,q.prototype.mul=q.prototype.multiply,q.prototype.div=q.prototype.divide,q.prototype.dist=q.prototype.distance,q.prototype.sqrDist=q.prototype.squaredDistance,q.sub=q.subtract,q.mul=q.multiply,q.div=q.divide,q.dist=q.distance,q.sqrDist=q.squaredDistance,q.sqrLen=q.squaredLength,q.mag=q.magnitude,q.length=q.magnitude,q.len=q.magnitude;const vo=class et extends Float32Array{constructor(...e){switch(e.length){case 4:super(e);break;case 2:super(e[0],e[1],4);break;case 1:{const t=e[0];typeof t=="number"?super([t,t,t,t]):super(t,0,4);break}default:super(4);break}}get x(){return this[0]}set x(e){this[0]=e}get y(){return this[1]}set y(e){this[1]=e}get z(){return this[2]}set z(e){this[2]=e}get w(){return this[3]}set w(e){this[3]=e}get r(){return this[0]}set r(e){this[0]=e}get g(){return this[1]}set g(e){this[1]=e}get b(){return this[2]}set b(e){this[2]=e}get a(){return this[3]}set a(e){this[3]=e}get magnitude(){const e=this[0],t=this[1],r=this[2],i=this[3];return Math.sqrt(e*e+t*t+r*r+i*i)}get mag(){return this.magnitude}get str(){return et.str(this)}copy(e){return super.set(e),this}add(e){return this[0]+=e[0],this[1]+=e[1],this[2]+=e[2],this[3]+=e[3],this}subtract(e){return this[0]-=e[0],this[1]-=e[1],this[2]-=e[2],this[3]-=e[3],this}sub(e){return this}multiply(e){return this[0]*=e[0],this[1]*=e[1],this[2]*=e[2],this[3]*=e[3],this}mul(e){return this}divide(e){return this[0]/=e[0],this[1]/=e[1],this[2]/=e[2],this[3]/=e[3],this}div(e){return this}scale(e){return this[0]*=e,this[1]*=e,this[2]*=e,this[3]*=e,this}scaleAndAdd(e,t){return this[0]+=e[0]*t,this[1]+=e[1]*t,this[2]+=e[2]*t,this[3]+=e[3]*t,this}distance(e){return et.distance(this,e)}dist(e){return 0}squaredDistance(e){return et.squaredDistance(this,e)}sqrDist(e){return 0}negate(){return this[0]*=-1,this[1]*=-1,this[2]*=-1,this[3]*=-1,this}invert(){return this[0]=1/this[0],this[1]=1/this[1],this[2]=1/this[2],this[3]=1/this[3],this}abs(){return this[0]=Math.abs(this[0]),this[1]=Math.abs(this[1]),this[2]=Math.abs(this[2]),this[3]=Math.abs(this[3]),this}dot(e){return this[0]*e[0]+this[1]*e[1]+this[2]*e[2]+this[3]*e[3]}normalize(){return et.normalize(this,this)}static create(){return new et}static clone(e){return new et(e)}static fromValues(e,t,r,i){return new et(e,t,r,i)}static copy(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}static set(e,t,r,i,n){return e[0]=t,e[1]=r,e[2]=i,e[3]=n,e}static add(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e}static subtract(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e}static sub(e,t,r){return e}static multiply(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e[2]=t[2]*r[2],e[3]=t[3]*r[3],e}static mul(e,t,r){return e}static divide(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e[2]=t[2]/r[2],e[3]=t[3]/r[3],e}static div(e,t,r){return e}static ceil(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e[3]=Math.ceil(t[3]),e}static floor(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e[3]=Math.floor(t[3]),e}static min(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e[2]=Math.min(t[2],r[2]),e[3]=Math.min(t[3],r[3]),e}static max(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e[2]=Math.max(t[2],r[2]),e[3]=Math.max(t[3],r[3]),e}static round(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e[3]=Math.round(t[3]),e}static scale(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e}static scaleAndAdd(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e[3]=t[3]+r[3]*i,e}static distance(e,t){const r=t[0]-e[0],i=t[1]-e[1],n=t[2]-e[2],a=t[3]-e[3];return Math.hypot(r,i,n,a)}static dist(e,t){return 0}static squaredDistance(e,t){const r=t[0]-e[0],i=t[1]-e[1],n=t[2]-e[2],a=t[3]-e[3];return r*r+i*i+n*n+a*a}static sqrDist(e,t){return 0}static magnitude(e){const t=e[0],r=e[1],i=e[2],n=e[3];return Math.sqrt(t*t+r*r+i*i+n*n)}static mag(e){return 0}static length(e){return 0}static len(e){return 0}static squaredLength(e){const t=e[0],r=e[1],i=e[2],n=e[3];return t*t+r*r+i*i+n*n}static sqrLen(e){return 0}static negate(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e}static inverse(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e[3]=1/t[3],e}static abs(e,t){return e[0]=Math.abs(t[0]),e[1]=Math.abs(t[1]),e[2]=Math.abs(t[2]),e[3]=Math.abs(t[3]),e}static normalize(e,t){const r=t[0],i=t[1],n=t[2],a=t[3];let o=r*r+i*i+n*n+a*a;return o>0&&(o=1/Math.sqrt(o)),e[0]=r*o,e[1]=i*o,e[2]=n*o,e[3]=a*o,e}static dot(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]}static cross(e,t,r,i){const n=r[0]*i[1]-r[1]*i[0],a=r[0]*i[2]-r[2]*i[0],o=r[0]*i[3]-r[3]*i[0],h=r[1]*i[2]-r[2]*i[1],l=r[1]*i[3]-r[3]*i[1],u=r[2]*i[3]-r[3]*i[2],c=t[0],d=t[1],f=t[2],p=t[3];return e[0]=d*u-f*l+p*h,e[1]=-(c*u)+f*o-p*a,e[2]=c*l-d*o+p*n,e[3]=-(c*h)+d*a-f*n,e}static lerp(e,t,r,i){const n=t[0],a=t[1],o=t[2],h=t[3];return e[0]=n+i*(r[0]-n),e[1]=a+i*(r[1]-a),e[2]=o+i*(r[2]-o),e[3]=h+i*(r[3]-h),e}static transformMat4(e,t,r){const i=t[0],n=t[1],a=t[2],o=t[3];return e[0]=r[0]*i+r[4]*n+r[8]*a+r[12]*o,e[1]=r[1]*i+r[5]*n+r[9]*a+r[13]*o,e[2]=r[2]*i+r[6]*n+r[10]*a+r[14]*o,e[3]=r[3]*i+r[7]*n+r[11]*a+r[15]*o,e}static transformQuat(e,t,r){const i=t[0],n=t[1],a=t[2],o=r[0],h=r[1],l=r[2],u=r[3],c=u*i+h*a-l*n,d=u*n+l*i-o*a,f=u*a+o*n-h*i,p=-o*i-h*n-l*a;return e[0]=c*u+p*-o+d*-l-f*-h,e[1]=d*u+p*-h+f*-o-c*-l,e[2]=f*u+p*-l+c*-h-d*-o,e[3]=t[3],e}static zero(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e}static str(e){return`Vec4(${e.join(", ")})`}static exactEquals(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]}static equals(e,t){const r=e[0],i=e[1],n=e[2],a=e[3],o=t[0],h=t[1],l=t[2],u=t[3];return Math.abs(r-o)<=X*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(i-h)<=X*Math.max(1,Math.abs(i),Math.abs(h))&&Math.abs(n-l)<=X*Math.max(1,Math.abs(n),Math.abs(l))&&Math.abs(a-u)<=X*Math.max(1,Math.abs(a),Math.abs(u))}};A(vo,"BYTE_LENGTH",4*Float32Array.BYTES_PER_ELEMENT);let j=vo;j.prototype.sub=j.prototype.subtract,j.prototype.mul=j.prototype.multiply,j.prototype.div=j.prototype.divide,j.prototype.dist=j.prototype.distance,j.prototype.sqrDist=j.prototype.squaredDistance,j.sub=j.subtract,j.mul=j.multiply,j.div=j.divide,j.dist=j.distance,j.sqrDist=j.squaredDistance,j.sqrLen=j.squaredLength,j.mag=j.magnitude,j.length=j.magnitude,j.len=j.magnitude;const _o=class tt extends Float32Array{constructor(...e){switch(e.length){case 2:{const t=e[0];typeof t=="number"?super([t,e[1]]):super(t,e[1],2);break}case 1:{const t=e[0];typeof t=="number"?super([t,t]):super(t,0,2);break}default:super(2);break}}get x(){return this[0]}set x(e){this[0]=e}get y(){return this[1]}set y(e){this[1]=e}get r(){return this[0]}set r(e){this[0]=e}get g(){return this[1]}set g(e){this[1]=e}get magnitude(){return Math.hypot(this[0],this[1])}get mag(){return this.magnitude}get squaredMagnitude(){const e=this[0],t=this[1];return e*e+t*t}get sqrMag(){return this.squaredMagnitude}get str(){return tt.str(this)}copy(e){return this.set(e),this}add(e){return this[0]+=e[0],this[1]+=e[1],this}subtract(e){return this[0]-=e[0],this[1]-=e[1],this}sub(e){return this}multiply(e){return this[0]*=e[0],this[1]*=e[1],this}mul(e){return this}divide(e){return this[0]/=e[0],this[1]/=e[1],this}div(e){return this}scale(e){return this[0]*=e,this[1]*=e,this}scaleAndAdd(e,t){return this[0]+=e[0]*t,this[1]+=e[1]*t,this}distance(e){return tt.distance(this,e)}dist(e){return 0}squaredDistance(e){return tt.squaredDistance(this,e)}sqrDist(e){return 0}negate(){return this[0]*=-1,this[1]*=-1,this}invert(){return this[0]=1/this[0],this[1]=1/this[1],this}abs(){return this[0]=Math.abs(this[0]),this[1]=Math.abs(this[1]),this}dot(e){return this[0]*e[0]+this[1]*e[1]}normalize(){return tt.normalize(this,this)}static create(){return new tt}static clone(e){return new tt(e)}static fromValues(e,t){return new tt(e,t)}static copy(e,t){return e[0]=t[0],e[1]=t[1],e}static set(e,t,r){return e[0]=t,e[1]=r,e}static add(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e}static subtract(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e}static sub(e,t,r){return[0,0]}static multiply(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e}static mul(e,t,r){return[0,0]}static divide(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e}static div(e,t,r){return[0,0]}static ceil(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e}static floor(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e}static min(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e}static max(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e}static round(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e}static scale(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e}static scaleAndAdd(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e}static distance(e,t){return Math.hypot(t[0]-e[0],t[1]-e[1])}static dist(e,t){return 0}static squaredDistance(e,t){const r=t[0]-e[0],i=t[1]-e[1];return r*r+i*i}static sqrDist(e,t){return 0}static magnitude(e){let t=e[0],r=e[1];return Math.sqrt(t*t+r*r)}static mag(e){return 0}static length(e){return 0}static len(e){return 0}static squaredLength(e){const t=e[0],r=e[1];return t*t+r*r}static sqrLen(e,t){return 0}static negate(e,t){return e[0]=-t[0],e[1]=-t[1],e}static inverse(e,t){return e[0]=1/t[0],e[1]=1/t[1],e}static abs(e,t){return e[0]=Math.abs(t[0]),e[1]=Math.abs(t[1]),e}static normalize(e,t){const r=t[0],i=t[1];let n=r*r+i*i;return n>0&&(n=1/Math.sqrt(n)),e[0]=t[0]*n,e[1]=t[1]*n,e}static dot(e,t){return e[0]*t[0]+e[1]*t[1]}static cross(e,t,r){const i=t[0]*r[1]-t[1]*r[0];return e[0]=e[1]=0,e[2]=i,e}static lerp(e,t,r,i){const n=t[0],a=t[1];return e[0]=n+i*(r[0]-n),e[1]=a+i*(r[1]-a),e}static transformMat2(e,t,r){const i=t[0],n=t[1];return e[0]=r[0]*i+r[2]*n,e[1]=r[1]*i+r[3]*n,e}static transformMat2d(e,t,r){const i=t[0],n=t[1];return e[0]=r[0]*i+r[2]*n+r[4],e[1]=r[1]*i+r[3]*n+r[5],e}static transformMat3(e,t,r){const i=t[0],n=t[1];return e[0]=r[0]*i+r[3]*n+r[6],e[1]=r[1]*i+r[4]*n+r[7],e}static transformMat4(e,t,r){const i=t[0],n=t[1];return e[0]=r[0]*i+r[4]*n+r[12],e[1]=r[1]*i+r[5]*n+r[13],e}static rotate(e,t,r,i){const n=t[0]-r[0],a=t[1]-r[1],o=Math.sin(i),h=Math.cos(i);return e[0]=n*h-a*o+r[0],e[1]=n*o+a*h+r[1],e}static angle(e,t){const r=e[0],i=e[1],n=t[0],a=t[1],o=Math.sqrt(r*r+i*i)*Math.sqrt(n*n+a*a),h=o&&(r*n+i*a)/o;return Math.acos(Math.min(Math.max(h,-1),1))}static zero(e){return e[0]=0,e[1]=0,e}static exactEquals(e,t){return e[0]===t[0]&&e[1]===t[1]}static equals(e,t){const r=e[0],i=e[1],n=t[0],a=t[1];return Math.abs(r-n)<=X*Math.max(1,Math.abs(r),Math.abs(n))&&Math.abs(i-a)<=X*Math.max(1,Math.abs(i),Math.abs(a))}static str(e){return`Vec2(${e.join(", ")})`}};A(_o,"BYTE_LENGTH",2*Float32Array.BYTES_PER_ELEMENT);let Y=_o;Y.prototype.sub=Y.prototype.subtract,Y.prototype.mul=Y.prototype.multiply,Y.prototype.div=Y.prototype.divide,Y.prototype.dist=Y.prototype.distance,Y.prototype.sqrDist=Y.prototype.squaredDistance,Y.sub=Y.subtract,Y.mul=Y.multiply,Y.div=Y.divide,Y.dist=Y.distance,Y.sqrDist=Y.squaredDistance,Y.sqrLen=Y.squaredLength,Y.mag=Y.magnitude,Y.length=Y.magnitude,Y.len=Y.magnitude;const Dd=le.fromValues(2,-2,1,1,-3,3,-2,-1,0,0,1,0,1,0,0,0);le.clone(Dd).transpose(),j.create(),j.create(),j.create(),le.create(),le.create(),j.create(),j.create(),j.create(),j.create(),le.create(),le.create(),le.create(),q.create();const kd="_lyricLine_kocao_6",Bd="_lyricBgLine_kocao_31",Ud="_active_kocao_40",Gd="_lyricDuetLine_kocao_47",jd="_lyricMainLine_kocao_52",Hd="_emphasizeWrapper_kocao_62",zd="_emphasize_kocao_62",Vd="_lyricSubLine_kocao_84",Xd="_disableSpring_kocao_91",$d="_interludeDots_kocao_96",qd="_duet_kocao_115",Wd="_tmpDisableTransition_kocao_127",Z={lyricLine:kd,lyricBgLine:Bd,active:Ud,lyricDuetLine:Gd,lyricMainLine:jd,emphasizeWrapper:Hd,emphasize:zd,lyricSubLine:Vd,disableSpring:Xd,interludeDots:$d,duet:qd,tmpDisableTransition:Wd},To=-1,Zr=0,Qr=1,Jr=2,Si=3,Mi=4,wi=5,Ii=6,Eo=7,Ao=8,So=typeof self=="object"?self:globalThis,Yd=(s,e)=>{const t=(i,n)=>(s.set(n,i),i),r=i=>{if(s.has(i))return s.get(i);const[n,a]=e[i];switch(n){case Zr:case To:return t(a,i);case Qr:{const o=t([],i);for(const h of a)o.push(r(h));return o}case Jr:{const o=t({},i);for(const[h,l]of a)o[r(h)]=r(l);return o}case Si:return t(new Date(a),i);case Mi:{const{source:o,flags:h}=a;return t(new RegExp(o,h),i)}case wi:{const o=t(new Map,i);for(const[h,l]of a)o.set(r(h),r(l));return o}case Ii:{const o=t(new Set,i);for(const h of a)o.add(r(h));return o}case Eo:{const{name:o,message:h}=a;return t(new So[o](h),i)}case Ao:return t(BigInt(a),i);case"BigInt":return t(Object(BigInt(a)),i)}return t(new So[n](a),i)};return r},Mo=s=>Yd(new Map,s)(0),jt="",{toString:Kd}={},{keys:Zd}=Object,cr=s=>{const e=typeof s;if(e!=="object"||!s)return[Zr,e];const t=Kd.call(s).slice(8,-1);switch(t){case"Array":return[Qr,jt];case"Object":return[Jr,jt];case"Date":return[Si,jt];case"RegExp":return[Mi,jt];case"Map":return[wi,jt];case"Set":return[Ii,jt]}return t.includes("Array")?[Qr,t]:t.includes("Error")?[Eo,t]:[Jr,t]},es=([s,e])=>s===Zr&&(e==="function"||e==="symbol"),Qd=(s,e,t,r)=>{const i=(a,o)=>{const h=r.push(a)-1;return t.set(o,h),h},n=a=>{if(t.has(a))return t.get(a);let[o,h]=cr(a);switch(o){case Zr:{let u=a;switch(h){case"bigint":o=Ao,u=a.toString();break;case"function":case"symbol":if(s)throw new TypeError("unable to serialize "+h);u=null;break;case"undefined":return i([To],a)}return i([o,u],a)}case Qr:{if(h)return i([h,[...a]],a);const u=[],c=i([o,u],a);for(const d of a)u.push(n(d));return c}case Jr:{if(h)switch(h){case"BigInt":return i([h,a.toString()],a);case"Boolean":case"Number":case"String":return i([h,a.valueOf()],a)}if(e&&"toJSON"in a)return n(a.toJSON());const u=[],c=i([o,u],a);for(const d of Zd(a))(s||!es(cr(a[d])))&&u.push([n(d),n(a[d])]);return c}case Si:return i([o,a.toISOString()],a);case Mi:{const{source:u,flags:c}=a;return i([o,{source:u,flags:c}],a)}case wi:{const u=[],c=i([o,u],a);for(const[d,f]of a)(s||!(es(cr(d))||es(cr(f))))&&u.push([n(d),n(f)]);return c}case Ii:{const u=[],c=i([o,u],a);for(const d of a)(s||!es(cr(d)))&&u.push(n(d));return c}}const{message:l}=a;return i([o,{name:h,message:l}],a)};return n},wo=(s,{json:e,lossy:t}={})=>{const r=[];return Qd(!(e||t),!!e,new Map,r)(s),r},Jd=typeof structuredClone=="function"?(s,e)=>e&&("json"in e||"lossy"in e)?Mo(wo(s,e)):structuredClone(s):(s,e)=>Mo(wo(s,e));function Io(s,e=1){let t=0,r=e;return(...i)=>{r=e,cancelAnimationFrame(t);const n=()=>{--r<=0?s(...i):t=requestAnimationFrame(n)};t=requestAnimationFrame(n)}}const ef=(s,e)=>s.size===e.size&&[...s].every(t=>e.has(t));function tf(s){return e=>(s(e+.001)-s(e-.001))/(2*.001)}function Ro(s){return tf(s)}class dr{constructor(e=0){A(this,"currentPosition",0),A(this,"targetPosition",0),A(this,"currentTime",0),A(this,"params",{}),A(this,"currentSolver"),A(this,"getV"),A(this,"getV2"),A(this,"queueParams"),A(this,"queuePosition"),this.targetPosition=e,this.currentPosition=this.targetPosition,this.currentSolver=()=>this.targetPosition,this.getV=()=>0,this.getV2=()=>0}resetSolver(){const e=this.getV(this.currentTime);this.currentTime=0,this.currentSolver=rf(this.currentPosition,e,this.targetPosition,0,this.params),this.getV=Ro(this.currentSolver),this.getV2=Ro(this.getV)}arrived(){return Math.abs(this.targetPosition-this.currentPosition)<.01&&this.getV(this.currentTime)<.01&&this.getV2(this.currentTime)<.01&&this.queueParams===void 0&&this.queuePosition===void 0}setPosition(e){this.targetPosition=e,this.currentPosition=e,this.currentSolver=()=>this.targetPosition,this.getV=()=>0,this.getV2=()=>0}update(e=0){this.currentTime+=e,this.currentPosition=this.currentSolver(this.currentTime),this.queueParams&&(this.queueParams.time-=e,this.queueParams.time<=0&&this.updateParams({...this.queueParams})),this.queuePosition&&(this.queuePosition.time-=e,this.queuePosition.time<=0&&this.setTargetPosition(this.queuePosition.position)),this.arrived()&&this.setPosition(this.targetPosition)}updateParams(e,t=0){t>0?this.queueParams={...this.queuePosition??{},...e,time:t}:(this.queuePosition=void 0,this.params={...this.params,...e},this.resetSolver())}setTargetPosition(e,t=0){t>0?this.queuePosition={...this.queuePosition??{},position:e,time:t}:(this.queuePosition=void 0,this.targetPosition=e,this.resetSolver())}getCurrentPosition(){return this.currentPosition}}function rf(s,e,t,r=0,i){const n=(i==null?void 0:i.soft)??!1,a=(i==null?void 0:i.stiffness)??100,o=(i==null?void 0:i.damping)??10,h=(i==null?void 0:i.mass)??1,l=t-s;if(n||1<=o/(2*Math.sqrt(a*h))){const p=-Math.sqrt(a/h),m=-p*l-e;return y=>(y-=r,y<0?s:t-(l+y*m)*Math.E**(y*p))}const u=Math.sqrt(4*h*a-o**2),c=(o*l-2*h*e)/u,d=.5*u/h,f=-(.5*o)/h;return p=>(p-=r,p<0?s:t-(Math.cos(p*d)*l+Math.sin(p*d)*c)*Math.E**(p*f))}class sf{constructor(e){A(this,"element",document.createElement("div")),A(this,"left",0),A(this,"top",0),A(this,"delay",0),A(this,"lineSize",[0,0]),A(this,"lineTransforms",{posX:new dr(0),posY:new dr(0)}),A(this,"lastStyle",""),this.lyricPlayer=e,this.element.setAttribute("class",Z.lyricLine),this.rebuildStyle()}measureSize(){return[this.element.clientWidth,this.element.clientHeight]}show(){this.rebuildStyle()}hide(){this.rebuildStyle()}rebuildStyle(){let e=`transform:translate(${this.lineTransforms.posX.getCurrentPosition().toFixed(2)}px,${this.lineTransforms.posY.getCurrentPosition().toFixed(2)}px);`;!this.lyricPlayer.getEnableSpring()&&this.isInSight&&(e+=`transition-delay:${this.delay}ms;`),e!==this.lastStyle&&(this.lastStyle=e,this.element.setAttribute("style",e))}getElement(){return this.element}setTransform(e=this.left,t=this.top,r=!1,i=0){this.left=e,this.top=t,this.delay=i*1e3|0,r||!this.lyricPlayer.getEnableSpring()?(r&&this.element.classList.add(Z.tmpDisableTransition),this.lineTransforms.posX.setPosition(e),this.lineTransforms.posY.setPosition(t),this.lyricPlayer.getEnableSpring()?this.rebuildStyle():this.show(),r&&requestAnimationFrame(()=>{this.element.classList.remove(Z.tmpDisableTransition)})):(this.lineTransforms.posX.setTargetPosition(e,i),this.lineTransforms.posY.setTargetPosition(t,i))}update(e=0){this.lyricPlayer.getEnableSpring()&&(this.lineTransforms.posX.update(e),this.lineTransforms.posY.update(e),this.isInSight?this.show():this.hide())}get isInSight(){const e=this.lineTransforms.posX.getCurrentPosition(),t=this.lineTransforms.posY.getCurrentPosition(),r=e+this.lineSize[0],i=t+this.lineSize[1],n=this.lyricPlayer.size[0],a=this.lyricPlayer.size[1];return!(e>n||t>a||r<0||i<0)}dispose(){this.element.remove()}}function nf(s){const e=2.5949095;return s<.5?(2*s)**2*((e+1)*2*s-e)/2:((2*s-2)**2*((e+1)*(s*2-2)+e)+2)/2}function af(s){return s===1?1:1-2**(-10*s)}const vt=(s,e,t)=>Math.max(s,Math.min(e,t));class of{constructor(){A(this,"element",document.createElement("div")),A(this,"dot0",document.createElement("span")),A(this,"dot1",document.createElement("span")),A(this,"dot2",document.createElement("span")),A(this,"left",0),A(this,"top",0),A(this,"playing",!0),A(this,"lastStyle",""),A(this,"currentInterlude"),A(this,"currentTime",0),A(this,"targetBreatheDuration",1500),this.element.className=Z.interludeDots,this.element.appendChild(this.dot0),this.element.appendChild(this.dot1),this.element.appendChild(this.dot2)}getElement(){return this.element}setTransform(e=this.left,t=this.top){this.left=e,this.top=t,this.update()}setInterlude(e){this.currentInterlude=e,this.currentTime=(e==null?void 0:e[0])??0}pause(){this.playing=!1}resume(){this.playing=!0}update(e=0){if(!this.playing)return;this.currentTime+=e;let t="";if(t+=`transform:translate(${this.left.toFixed(2)}px, ${this.top.toFixed(2)}px)`,this.currentInterlude){const r=this.currentInterlude[1]-this.currentInterlude[0],i=this.currentTime-this.currentInterlude[0];if(i<=r){const n=r/Math.ceil(r/this.targetBreatheDuration);let a=1,o=1;a*=Math.sin(1.5*Math.PI-i/n*2)/20+1,i<2e3&&(a*=af(i/2e3)),i<500?o=0:i<1e3&&(o*=(i-500)/500),r-i<750&&(a*=1-nf((750-(r-i))/750/2)),r-i<375&&(o*=vt(0,(r-i)/375,1));const h=Math.max(0,r-750);a=Math.max(0,a)*.7,t+=` scale(${a})`;const l=vt(.25,i*3/h*.75,1),u=vt(.25,(i-h/3)*3/h*.75,1),c=vt(.25,(i-h/3*2)*3/h*.75,1);this.dot0.style.opacity=`${vt(0,Math.max(0,o*l),1)}`,this.dot1.style.opacity=`${vt(0,Math.max(0,o*u),1)}`,this.dot2.style.opacity=`${vt(0,Math.max(0,o*c),1)}`}else t+=" scale(0)",this.dot0.style.opacity="0",this.dot1.style.opacity="0",this.dot2.style.opacity="0"}else t+=" scale(0)",this.dot0.style.opacity="0",this.dot1.style.opacity="0",this.dot2.style.opacity="0";t+=";",this.lastStyle!==t&&(this.element.setAttribute("style",t),this.lastStyle=t)}dispose(){this.element.remove()}}function hf(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}var lf=4,uf=.001,cf=1e-7,df=10,fr=11,ts=1/(fr-1),ff=typeof Float32Array=="function";function Po(s,e){return 1-3*e+3*s}function Lo(s,e){return 3*e-6*s}function No(s){return 3*s}function rs(s,e,t){return((Po(e,t)*s+Lo(e,t))*s+No(e))*s}function Co(s,e,t){return 3*Po(e,t)*s*s+2*Lo(e,t)*s+No(e)}function pf(s,e,t,r,i){var n,a,o=0;do a=e+(t-e)/2,n=rs(a,r,i)-s,n>0?t=a:e=a;while(Math.abs(n)>cf&&++o<df);return a}function mf(s,e,t,r){for(var i=0;i<lf;++i){var n=Co(e,t,r);if(n===0)return e;var a=rs(e,t,r)-s;e-=a/n}return e}function yf(s){return s}var gf=function(s,e,t,r){if(!(0<=s&&s<=1&&0<=t&&t<=1))throw new Error("bezier x values must be in [0, 1] range");if(s===e&&t===r)return yf;for(var i=ff?new Float32Array(fr):new Array(fr),n=0;n<fr;++n)i[n]=rs(n*ts,s,t);function a(o){for(var h=0,l=1,u=fr-1;l!==u&&i[l]<=o;++l)h+=ts;--l;var c=(o-i[l])/(i[l+1]-i[l]),d=h+c*ts,f=Co(d,s,t);return f>=uf?mf(o,d,s,t):f===0?d:pf(o,h,h+ts,s,t)}return function(o){return o===0?0:o===1?1:rs(a(o),e,r)}};const Oo=hf(gf);function bf(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function xf(s,e=1,t={x:0,y:0}){const[r,i]=[t.x,t.y];return[s[0]*e,s[1]*e,s[2]*e,s[3],s[4]*e,s[5]*e,s[6]*e,s[7],s[8]*e,s[9]*e,s[10]*e,s[11],s[12]-r*e+r,s[13]-i*e+i,s[14],s[15]]}function vf(s,e=4){const t=(r,i)=>r.toFixed(e);return`matrix3d(${s.map(t).join(", ")})`}const Ri=[],Pi=[];let Li=!1;function _f(){let s=Pi.shift();for(;s;){try{s.resolve(s.task())}catch(e){s.reject(e)}s=Pi.shift()}for(s=Ri.shift();s;){try{s.resolve(s.task())}catch(e){s.reject(e)}s=Ri.shift()}Li=!1}function Fo(){Li||(Li=!0,requestAnimationFrame(_f))}function Tf(s){const e={task:s,resolve:()=>{},reject:()=>{}},t=new Promise((r,i)=>{e.resolve=r,e.reject=i});return Ri.push(e),Fo(),t}function Do(s){const e={task:s,resolve:()=>{},reject:()=>{}},t=new Promise((r,i)=>{e.resolve=r,e.reject=i});return Pi.push(e),Fo(),t}const Ef=/^[\p{Unified_Ideograph}\u0800-\u9FFC]+$/u,ss=32,ko=(s,e)=>t=>Math.min(1,Math.max(0,(t-s)/(e-s))),Ni=.5,Af=ko(0,Ni),Sf=ko(Ni,1),Mf=Oo(.2,.4,.58,1),wf=Oo(.3,0,.58,1),If=s=>e=>e<s?Mf(Af(e)):1-wf(Sf(e));function Bo(s,e=0,t="rgba(0,0,0,var(--bright-mask-alpha, 1.0))",r="rgba(0,0,0,var(--dark-mask-alpha, 1.0))"){const i=2+s+e,n=s/i,a=(1-n)/2;return[`linear-gradient(to right,${t} ${a*100}%,${r} ${(a+n)*100}%)`,i]}function Rf(s){const e=[];for(const n of s){const a=n.word.replace(/\s/g,"").length,o=n.word.split(" ").filter(h=>h.trim().length>0);if(o.length>1){n.word.startsWith(" ")&&e.push({word:" ",startTime:0,endTime:0});let h=0;for(const l of o){const u={word:l,startTime:n.startTime+h/a*(n.endTime-n.startTime),endTime:n.startTime+(h+l.length)/a*(n.endTime-n.startTime)};e.push(u),e.push({word:" ",startTime:0,endTime:0}),h+=l.length}n.word.endsWith(" ")||e.pop()}else e.push({...n})}let t=[],r=[];const i=[];for(const n of e){const a=n.word;t.push(a),r.push(n),a.length>0&&a.trim().length===0?(t.pop(),r.pop(),r.length===1?i.push(r[0]):r.length>1&&i.push(r),i.push(n),t=[],r=[]):(!/^\s*[^\s]*\s*$/.test(t.join(""))||Ef.test(a))&&(t.pop(),r.pop(),r.length===1?i.push(r[0]):r.length>1&&i.push(r),t=[a],r=[n])}return r.length===1?i.push(r[0]):i.push(r),i}function pr(s){return s.endTime-s.startTime>=1e3&&s.word.trim().length<=7&&s.word.trim().length>1}class Pf extends MouseEvent{constructor(e,t){super(t.type,t),this.line=e}}function Lf(s){const e=s.match(/matrix\(([^)]+)\)/);if(e){const t=e[1].split(", "),r=Number.parseFloat(t[0]),i=Number.parseFloat(t[3]);return(r+i)/2}return 1}class Nf extends EventTarget{constructor(e,t={words:[],translatedLyric:"",romanLyric:"",startTime:0,endTime:0,isBG:!1,isDuet:!1}){super(),A(this,"element",document.createElement("div")),A(this,"left",0),A(this,"top",0),A(this,"scale",1),A(this,"blur",0),A(this,"delay",0),A(this,"splittedWords",[]),A(this,"lineSize",[0,0]),A(this,"lineTransforms",{posX:new dr(0),posY:new dr(0),scale:new dr(100)}),A(this,"listenersMap",new Map),A(this,"onMouseEvent",a=>{const o=new Pf(this,a);for(const h of this.listenersMap.get(a.type)??[])h.call(this,o);if(!this.dispatchEvent(o)||o.defaultPrevented)return a.preventDefault(),a.stopPropagation(),a.stopImmediatePropagation(),!1}),A(this,"isEnabled",!1),A(this,"hasFaded",!1),A(this,"lastWord"),A(this,"_hide",!0),A(this,"_prevParentEl",null),A(this,"lastStyle",""),A(this,"maskImageDirty",!1),A(this,"markImageDirtyPromises",[]),this.lyricPlayer=e,this.lyricLine=t,this._prevParentEl=e.getElement(),this.element.setAttribute("class",Z.lyricLine),this.lyricLine.isBG&&this.element.classList.add(Z.lyricBgLine),this.lyricLine.isDuet&&this.element.classList.add(Z.lyricDuetLine),this.element.appendChild(document.createElement("div")),this.element.appendChild(document.createElement("div")),this.element.appendChild(document.createElement("div"));const r=this.element.children[0],i=this.element.children[1],n=this.element.children[2];r.setAttribute("class",Z.lyricMainLine),i.setAttribute("class",Z.lyricSubLine),n.setAttribute("class",Z.lyricSubLine),this.rebuildElement(),this.rebuildStyle()}addMouseEventListener(e,t,r){if(t){const i=this.listenersMap.get(e)??new Set;i.size===0&&this.element.addEventListener(e,this.onMouseEvent,r),i.add(t),this.listenersMap.set(e,i)}}removeMouseEventListener(e,t,r){if(t){const i=this.listenersMap.get(e);i&&(i.delete(t),i.size===0&&this.element.removeEventListener(e,this.onMouseEvent,r))}}areWordsOnSameLine(e,t){if(e!=null&&e.mainElement&&t!=null&&t.mainElement){const r=e.mainElement,i=t.mainElement,n=r.getBoundingClientRect(),a=i.getBoundingClientRect();return Math.abs(n.top-a.top)<10}return!0}async enable(e=this.lyricLine.startTime){this.isEnabled=!0,this.hasFaded=!1,this.element.classList.add(Z.active),await this.waitMaskImageUpdated();const t=this.element.children[0];for(const r of this.splittedWords){for(const i of r.elementAnimations)i.currentTime=0,i.playbackRate=1,i.play();for(const i of r.maskAnimations)i.currentTime=Math.min(this.totalDuration,Math.max(0,e-this.lyricLine.startTime)),i.playbackRate=1,i.play()}t.classList.add(Z.active)}disable(e=0){this.isEnabled=!1,this.hasFaded=!0,this.element.classList.remove(Z.active);const t=this.element.children[0];for(const r of this.splittedWords)for(const i of r.elementAnimations)(i.id==="float-word"||i.id.includes("emphasize-word-float-only"))&&(i.playbackRate=-1,i.play());t.classList.remove(Z.active)}resume(e=0){if(this.isEnabled)for(const t of this.splittedWords){for(const r of t.elementAnimations)(!this.lastWord||this.splittedWords.indexOf(this.lastWord)<this.splittedWords.indexOf(t))&&r.play();for(const r of t.maskAnimations)(!this.lastWord||this.splittedWords.indexOf(this.lastWord)<this.splittedWords.indexOf(t))&&r.play()}}pause(e=0){if(this.isEnabled)for(const t of this.splittedWords){for(const r of t.elementAnimations)t.startTime>=e?r.pause():this.lastWord=t;for(const r of t.maskAnimations)t.startTime>=e?r.pause():this.lastWord=t}}setMaskAnimationState(e=0){const t=e-this.lyricLine.startTime;for(const r of this.splittedWords)for(const i of r.maskAnimations)i.currentTime=Math.min(this.totalDuration,Math.max(0,t)),i.playbackRate=1,t>=0&&t<this.totalDuration?i.play():i.pause()}measureSize(){this.hasFaded=!1,this._hide&&(this._prevParentEl&&this._prevParentEl.appendChild(this.element),this.element.style.display="",this.element.style.visibility="hidden");const e=[this.element.clientWidth,this.element.clientHeight];return this._hide&&(this._prevParentEl&&this.element.remove(),this.element.style.display="none",this.element.style.visibility=""),e}setLine(e){this.lyricLine=e,this.lyricLine.isBG?this.element.classList.add(Z.lyricBgLine):this.element.classList.remove(Z.lyricBgLine),this.lyricLine.isDuet?this.element.classList.add(Z.lyricDuetLine):this.element.classList.remove(Z.lyricDuetLine),this.rebuildElement(),this.rebuildStyle()}getLine(){return this.lyricLine}show(){this._hide=!1,this._prevParentEl&&(this._prevParentEl.appendChild(this.element),this._prevParentEl=null),this.rebuildStyle()}hide(){this._hide=!0,this.element.parentElement&&(this._prevParentEl=this.element.parentElement,this.element.remove()),this.rebuildStyle()}rebuildStyle(){if(this._hide){this.lastStyle!=="display:none;transform:translate(0,-10000px);"&&(this.lastStyle="display:none;transform:translate(0,-10000px);",this.element.setAttribute("style","display:none;transform:translate(0,-10000px);"));return}let e="";e+=`transform:translate(${this.lineTransforms.posX.getCurrentPosition().toFixed(1)}px,${this.lineTransforms.posY.getCurrentPosition().toFixed(1)}px) scale(${(this.lineTransforms.scale.getCurrentPosition()/100).toFixed(4)});`,!this.lyricPlayer.getEnableSpring()&&this.isInSight&&(e+=`transition-delay:${this.delay}ms;`),e+=`filter:blur(${Math.min(32,this.blur)}px);`,e!==this.lastStyle&&(this.lastStyle=e,this.element.setAttribute("style",e))}rebuildElement(){this.disposeElements();const e=this.element.children[0],t=this.element.children[1],r=this.element.children[2];if(this.lyricPlayer._getIsNonDynamic()){e.innerText=this.lyricLine.words.map(n=>n.word).join(""),t.innerText=this.lyricLine.translatedLyric,r.innerText=this.lyricLine.romanLyric;return}const i=Rf(this.lyricLine.words);e.innerHTML="";for(const n of i)if(Array.isArray(n)){if(n.length===0)continue;const a=n.reduce((u,c)=>(u.endTime=Math.max(u.endTime,c.endTime),u.startTime=Math.min(u.startTime,c.startTime),u.word+=c.word,u),{word:"",startTime:Number.POSITIVE_INFINITY,endTime:Number.NEGATIVE_INFINITY}),o=n.map(u=>pr(u)).reduce((u,c)=>u||c,pr(a)),h=document.createElement("span");h.classList.add(Z.emphasizeWrapper);const l=[];for(const u of n){const c=document.createElement("span");if(o){c.classList.add(Z.emphasize);const d=[];for(const p of u.word.trim().split("")){const m=document.createElement("span");m.innerText=p,d.push(m),l.push(m),c.appendChild(m)}const f={...u,mainElement:c,subElements:d,elementAnimations:[this.initFloatAnimation(u,c)],maskAnimations:[],width:0,height:0,padding:0,shouldEmphasize:o};this.splittedWords.push(f)}else c.innerText=u.word,this.splittedWords.push({...u,mainElement:c,subElements:[],elementAnimations:[this.initFloatAnimation(u,c)],maskAnimations:[],width:0,height:0,padding:0,shouldEmphasize:o});h.appendChild(c)}o&&this.splittedWords[this.splittedWords.length-1].elementAnimations.push(...this.initEmphasizeAnimation(a,l,a.endTime-a.startTime,a.startTime-this.lyricLine.startTime)),a.word.trimStart()!==a.word&&e.appendChild(document.createTextNode(" ")),e.appendChild(h),a.word.trimEnd()!==a.word&&pr(a)&&e.appendChild(document.createTextNode(" "))}else if(n.word.trim().length===0)e.appendChild(document.createTextNode(" "));else{const a=pr(n),o=document.createElement("span"),h={...n,mainElement:o,subElements:[],elementAnimations:[this.initFloatAnimation(n,o)],maskAnimations:[],width:0,height:0,padding:0,shouldEmphasize:a};if(pr(n)){o.classList.add(Z.emphasize);const l=[];for(const c of n.word.trim().split("")){const d=document.createElement("span");d.innerText=c,l.push(d),o.appendChild(d)}h.subElements=l;const u=Math.abs(h.endTime-h.startTime);h.elementAnimations.push(...this.initEmphasizeAnimation(n,l,u,h.startTime-this.lyricLine.startTime))}else o.innerText=n.word.trim();n.word.trimStart()!==n.word&&e.appendChild(document.createTextNode(" ")),e.appendChild(o),n.word.trimEnd()!==n.word&&e.appendChild(document.createTextNode(" ")),this.splittedWords.push(h)}t.innerText=this.lyricLine.translatedLyric,r.innerText=this.lyricLine.romanLyric}initFloatAnimation(e,t){const r=e.startTime-this.lyricLine.startTime,i=Math.max(1e3,e.endTime-e.startTime);let n=.05;this.lyricLine.isBG&&(n*=2);const a=t.animate([{transform:"translateY(0px)"},{transform:`translateY(${-n}em)`}],{duration:Number.isFinite(i)?i:0,delay:Number.isFinite(r)?r:0,id:"float-word",composite:"add",fill:"both",easing:"ease-out"});return a.pause(),a}initEmphasizeAnimation(e,t,r,i){const n=Math.max(0,i);let a=Math.max(1e3,r),o=[],h=a/2e3;h=h>1?Math.sqrt(h):h**3;let l=a/3e3;l=l>1?Math.sqrt(l):l**3,h*=.6,l*=.5,this.lyricLine.words.length>0&&e.word.includes(this.lyricLine.words[this.lyricLine.words.length-1].word)&&(h*=1.6,l*=1.5,a*=1.2),h=Math.min(1.2,h),l=Math.min(.8,l);const u=Number.isFinite(a)?a:0,c=If(Ni);return o=t.flatMap((d,f,p)=>{const m=n+a/2.5/p.length*f,y=[],x=new Array(ss).fill(0).map((_,T)=>{const E=(T+1)/ss,w=c(E),S=c(E)*l,L=xf(bf(),1+w*.1*h),I=-w*.03*h*(p.length/2-f),k=-w*.025*h;return{offset:E,transform:`${vf(L,4)} translate(${I}em, ${k}em)`,textShadow:`0 0 ${Math.min(.3,l*.3)}em rgba(255, 255, 255, ${S})`}}),b=d.animate(x,{duration:u,delay:Number.isFinite(m)?m:0,id:`emphasize-word-${d.innerText}-${f}`,iterations:1,composite:"replace",fill:"both"});b.onfinish=()=>{b.pause()},b.pause(),y.push(b);const g=new Array(ss).fill(0).map((_,T)=>{const E=(T+1)/ss;let w=Math.sin(E*Math.PI);return this.lyricLine.isBG&&(w*=2),{offset:E,transform:`translateY(${-w*.05}em)`}}),v=d.animate(g,{duration:u*1.4,delay:Number.isFinite(m)?m-400:0,id:"emphasize-word-float",iterations:1,composite:"add",fill:"both"});return v.onfinish=()=>{v.pause()},v.pause(),y.push(v),y}),o}get totalDuration(){return this.lyricLine.endTime-this.lyricLine.startTime}markMaskImageDirty(){return this.maskImageDirty=!0,new Promise(e=>{this.markImageDirtyPromises.push(e)})}waitMaskImageUpdated(){return this.maskImageDirty?new Promise(e=>{this.markImageDirtyPromises.push(e)}):Promise.resolve()}async updateMaskImage(){const e=this.markImageDirtyPromises;this.markImageDirtyPromises=[],this.maskImageDirty=!1,this._hide&&await Do(()=>{this._prevParentEl&&this._prevParentEl.appendChild(this.element),this.element.style.display="",this.element.style.visibility="hidden"});for(const t of this.splittedWords){const r=t.mainElement;r?await Tf(()=>{t.padding=Number.parseFloat(getComputedStyle(r).paddingLeft),t.width=r.clientWidth-t.padding*2,t.height=r.clientHeight-t.padding*2}):(t.width=0,t.height=0,t.padding=0)}this.lyricPlayer.supportMaskImage?this.generateWebAnimationBasedMaskImage():this.generateCalcBasedMaskImage(),this._hide&&await Do(()=>{this._prevParentEl&&this.element.remove(),this.element.style.display="none",this.element.style.visibility=""});for(const t of e)t()}generateCalcBasedMaskImage(){for(const e of this.splittedWords){const t=e.mainElement;if(t){e.width=t.clientWidth,e.height=t.clientHeight;const r=e.height*this.lyricPlayer.wordFadeWidth,[i,n]=Bo(r/e.width),a=`${n*100}% 100%`;this.lyricPlayer.supportMaskImage?(t.style.maskImage=i,t.style.maskRepeat="no-repeat",t.style.maskOrigin="left",t.style.maskSize=a):(t.style.webkitMaskImage=i,t.style.webkitMaskRepeat="no-repeat",t.style.webkitMaskOrigin="left",t.style.webkitMaskSize=a);const o=e.width+r,h=`clamp(${-o}px,calc(${-o}px + (var(--amll-player-time) - ${e.startTime})*${o/Math.abs(e.endTime-e.startTime)}px),0px) 0px, left top`;t.style.maskPosition=h,t.style.webkitMaskPosition=h}}}generateWebAnimationBasedMaskImage(){const e=Math.max(this.splittedWords.reduce((t,r)=>Math.max(r.endTime,t),0),this.lyricLine.endTime)-this.lyricLine.startTime;this.splittedWords.forEach((t,r)=>{const i=t.mainElement;if(i){const n=t.height*this.lyricPlayer.wordFadeWidth,[a,o]=Bo(n/(t.width+t.padding*2)),h=`${o*100}% 100%`;this.lyricPlayer.supportMaskImage?(i.style.maskImage=a,i.style.maskRepeat="no-repeat",i.style.maskOrigin="left",i.style.maskSize=h):(i.style.webkitMaskImage=a,i.style.webkitMaskRepeat="no-repeat",i.style.webkitMaskOrigin="left",i.style.webkitMaskSize=h);const l=this.splittedWords.slice(0,r).reduce((g,v)=>g+v.width,0)+(this.splittedWords[0]?n:0),u=-(t.width+t.padding*2+n),c=g=>Math.max(u,Math.min(0,g));let d=-l-t.width-t.padding-n,f=0;const p=[];let m=d,y=0;const x=()=>{const g=d-m,v=Math.max(0,Math.min(1,f)),_=v-y,T=Math.abs(_/g);if(d>u&&m<u){const S=Math.abs(m-u)*T,L=`${c(m)}px 0`,I={offset:y+S,maskPosition:L};p.push(I)}if(d>0&&m<0){const S=Math.abs(m)*T,L=`${c(d)}px 0`,I={offset:y+S,maskPosition:L};p.push(I)}const E=`${c(d)}px 0`,w={offset:v,maskPosition:E};p.push(w),m=d,y=v};x();let b=0;this.splittedWords.forEach((g,v)=>{{const _=g.startTime-this.lyricLine.startTime,T=_-b;f+=T/e,T>0&&x(),b=_}{const _=g.endTime-g.startTime;f+=_/e,d+=g.width,v===0&&(d+=n*1.5),v===this.splittedWords.length-1&&(d+=n*.5),_>0&&x(),b+=_}});for(const g of t.maskAnimations)g.cancel();try{const g=i.animate(p,{duration:e||1,id:`fade-word-${t.word}-${r}`,fill:"both"});g.pause(),t.maskAnimations=[g]}catch(g){console.warn("\u5E94\u7528\u6E10\u53D8\u52A8\u753B\u53D1\u751F\u9519\u8BEF",p,e,g)}}})}getElement(){return this.element}setTransform(e=this.left,t=this.top,r=this.scale,i=1,n=.4,a=0,o=!1,h=0){const l=this.isInSight,u=this.lyricPlayer.getEnableSpring();this.left=e,this.top=t,this.scale=r,this.delay=h*1e3|0;const c=this.element.children[0],d=this.element.children[1],f=this.element.children[2];if(c.style.opacity=`${i}`,d.style.opacity=`${n}`,f.style.opacity=`${n}`,o||!u){if(this.blur=Math.min(32,a),o&&this.element.classList.add(Z.tmpDisableTransition),this.lineTransforms.posX.setPosition(e),this.lineTransforms.posY.setPosition(t),this.lineTransforms.scale.setPosition(r),u)this.rebuildStyle();else{const p=this.isInSight;l||p?this.show():this.hide()}o&&requestAnimationFrame(()=>{this.element.classList.remove(Z.tmpDisableTransition)})}else if(this.lineTransforms.posX.setTargetPosition(e,h),this.lineTransforms.posY.setTargetPosition(t,h),this.lineTransforms.scale.setTargetPosition(r),this.blur!==Math.min(32,a)){this.blur=Math.min(32,a);const p=a.toFixed(3);this.element.style.filter=`blur(${p}px)`}}update(e=0){if(this.lyricPlayer.getEnableSpring())if(this.lineTransforms.posX.update(e),this.lineTransforms.posY.update(e),this.lineTransforms.scale.update(e),this.isInSight?(this.show(),this.maskImageDirty&&this.updateMaskImage()):this.hide(),this.lyricPlayer.getEnableSpring())this.element.style.setProperty("--bright-mask-alpha",`${Math.max(0,Math.min(1,this.lineTransforms.scale.getCurrentPosition()/100-.97)/.03)*.8+.2}`),this.element.style.setProperty("--dark-mask-alpha",`${Math.max(0,Math.min(1,this.lineTransforms.scale.getCurrentPosition()/100-.97)/.03)*.2+.2}`);else{const t=window.getComputedStyle(this.element).transform,r=Lf(t);this.element.style.setProperty("--bright-mask-alpha",`${Math.max(0,Math.min(1,(r-.97)/.03))*.8+.2}`),this.element.style.setProperty("--dark-mask-alpha",`${Math.max(0,Math.min(1,(r-.97)/.03))*.2+.2}`)}}_getDebugTargetPos(){return`[\u4F4D\u79FB: ${this.left}, ${this.top}; \u7F29\u653E: ${this.scale}; \u5EF6\u65F6: ${this.delay}]`}get isInSight(){const e=this.lineTransforms.posX.getCurrentPosition(),t=this.lineTransforms.posY.getCurrentPosition(),r=this.lineSize[0],i=this.lineSize[1],n=e+r,a=t+i,o=this.lyricPlayer.size[0],h=this.lyricPlayer.size[1];return!(e>o+r||n<-r||t>h+i||a<-i)}disposeElements(){var e,t;for(const r of this.splittedWords){for(const i of r.elementAnimations)i.cancel();for(const i of r.maskAnimations)i.cancel();for(const i of r.subElements)i.remove(),(e=i.parentNode)==null||e.removeChild(i);r.elementAnimations=[],r.maskAnimations=[],r.subElements=[],r.mainElement.remove(),(t=r.mainElement.parentNode)==null||t.removeChild(r.mainElement)}this.splittedWords=[]}dispose(){this.disposeElements(),this.element.remove()}}class Cf extends MouseEvent{constructor(e,t,r){super(`line-${r.type}`,r),this.lineIndex=e,this.line=t}}class Of extends EventTarget{constructor(){super(),A(this,"element",document.createElement("div")),A(this,"currentTime",0),A(this,"lastCurrentTime",0),A(this,"lyricLines",[]),A(this,"processedLines",[]),A(this,"lyricLinesEl",[]),A(this,"lyricLinesSize",new WeakMap),A(this,"lyricLinesIndexes",new WeakMap),A(this,"hotLines",new Set),A(this,"bufferedLines",new Set),A(this,"scrollToIndex",0),A(this,"_wordFadeWidth",.5),A(this,"allowScroll",!0),A(this,"scrolledHandler",0),A(this,"isScrolled",!1),A(this,"isSeeking",!1),A(this,"initializeSeeking",!1),A(this,"invokedByScrollEvent",!1),A(this,"scrollOffset",0),A(this,"hidePassedLines",!1),A(this,"debounceCalcLayout",Io(async()=>{this.calcLayout(!0,!0),this.lyricLinesEl.forEach((l,u)=>{l.markMaskImageDirty().then(()=>{this.hotLines.has(u)&&l.enable(this.currentTime)})})},5)),A(this,"resizeObserver",new ResizeObserver(Io(l=>{const u=l[0].contentRect;this.size[0]=u.width,this.size[1]=u.height;const c=getComputedStyle(l[0].target),d=this.element.clientWidth-Number.parseFloat(c.paddingLeft)-Number.parseFloat(c.paddingRight),f=this.element.clientHeight-Number.parseFloat(c.paddingTop)-Number.parseFloat(c.paddingBottom);this.innerSize[0]=d,this.innerSize[1]=f,this.rebuildStyle(),this.lyricLinesEl.forEach((p,m)=>{p.markMaskImageDirty().then(()=>{this.hotLines.has(m)&&p.enable(this.currentTime)})});for(const p of this.lyricLinesEl)p.markMaskImageDirty();this.debounceCalcLayout()},5))),A(this,"posXSpringParams",{mass:1,damping:10,stiffness:100}),A(this,"posYSpringParams",{mass:.9,damping:15,stiffness:90}),A(this,"scaleSpringParams",{mass:2,damping:25,stiffness:100}),A(this,"scaleForBGSpringParams",{mass:1,damping:20,stiffness:50}),A(this,"enableBlur",!0),A(this,"enableScale",!0),A(this,"interludeDots"),A(this,"interludeDotsSize",[0,0]),A(this,"bottomLine"),A(this,"supportPlusLighter",CSS.supports("mix-blend-mode","plus-lighter")),A(this,"supportMaskImage",CSS.supports("mask-image","none")),A(this,"disableSpring",!1),A(this,"alignAnchor","center"),A(this,"alignPosition",.35),A(this,"isNonDynamic",!1),A(this,"isNonDuet",!1),A(this,"scrollBoundary",[0,0]),A(this,"size",[0,0]),A(this,"innerSize",[0,0]),A(this,"onLineClickedHandler",l=>{const u=new Cf(this.lyricLinesIndexes.get(l.line)??-1,l.line,l);this.dispatchEvent(u)||(l.preventDefault(),l.stopPropagation(),l.stopImmediatePropagation())}),A(this,"_baseFontSize",Number.parseFloat(getComputedStyle(this.element).fontSize)),A(this,"isPageVisible",!0),A(this,"onPageShow",()=>{this.isPageVisible=!0,this.setCurrentTime(this.currentTime,!0)}),A(this,"onPageHide",()=>{this.isPageVisible=!1}),this.interludeDots=new of,this.bottomLine=new sf(this),this.element.classList.add("amll-lyric-player","dom"),this.disableSpring&&this.element.classList.add(Z.disableSpring),this.rebuildStyle(),this.resizeObserver.observe(this.element),this.element.appendChild(this.interludeDots.getElement()),this.element.appendChild(this.bottomLine.getElement()),this.interludeDots.setTransform(0,200),window.addEventListener("pageshow",this.onPageShow),window.addEventListener("pagehide",this.onPageHide);let e=0,t="none",r=0,i=0,n=0,a=Symbol("amll-scroll"),o=0,h=0;this.element.addEventListener("touchstart",l=>{this.beginScrollHandler()&&(l.preventDefault(),e=this.scrollOffset,r=l.touches[0].screenY,o=r,i=Date.now(),n=0)}),this.element.addEventListener("touchmove",l=>{if(this.beginScrollHandler()){l.preventDefault();const u=l.touches[0].screenY,c=u-r,d=u-o,f=d>0?"down":d<0?"up":"none";t!==f?(t=f,e=this.scrollOffset,r=u,i=Date.now()):this.scrollOffset=e-c,o=u,h=Date.now(),this.limitScrollOffset(),this.calcLayout(!0)}}),this.element.addEventListener("touchend",l=>{if(this.beginScrollHandler()){l.preventDefault(),r=0;const u=Date.now();if(u-h>100)return this.endScrollHandler();const c=u-i;n=(this.scrollOffset-e)/c*1e3;let d=0;const f=Symbol("amll-scroll");a=f;const p=m=>{d||(d=m),a===f&&this.beginScrollHandler()&&(this.scrollOffset+=n*(m-d)/1e3,n*=.99,this.limitScrollOffset(),this.calcLayout(!0),Math.abs(n)>1&&!this.scrollBoundary.includes(this.scrollOffset)&&requestAnimationFrame(p),this.endScrollHandler(),d=m)};requestAnimationFrame(p),this.endScrollHandler()}}),this.element.addEventListener("wheel",l=>{this.beginScrollHandler()&&(l.deltaMode===l.DOM_DELTA_PIXEL?(this.scrollOffset+=l.deltaY,this.limitScrollOffset(),this.calcLayout(!0)):(this.scrollOffset+=l.deltaY*50,this.limitScrollOffset(),this.calcLayout(!1)),this.endScrollHandler())})}_getIsNonDynamic(){return this.isNonDynamic}setIsSeeking(e){this.isSeeking=e}setEnableSpring(e=!0){this.disableSpring=!e,e?this.element.classList.remove(Z.disableSpring):this.element.classList.add(Z.disableSpring),this.calcLayout(!0)}getEnableSpring(){return!this.disableSpring}setEnableScale(e=!0){this.enableScale=e,this.calcLayout()}getEnableScale(){return this.enableScale}get baseFontSize(){return this._baseFontSize}beginScrollHandler(){const e=this.allowScroll;return e&&(this.isScrolled=!0,this.invokedByScrollEvent=!0,clearTimeout(this.scrolledHandler),this.scrolledHandler=setTimeout(()=>{this.isScrolled=!1,this.scrollOffset=0},5e3)),e}endScrollHandler(){this.invokedByScrollEvent=!1}limitScrollOffset(){this.scrollOffset=Math.max(Math.min(this.scrollBoundary[1],this.scrollOffset),this.scrollBoundary[0])}getCurrentInterlude(){var e,t,r,i;if(this.bufferedLines.size>0)return;const n=this.currentTime+20,a=this.scrollToIndex;if(a===0){if((e=this.processedLines[0])!=null&&e.startTime){if(this.processedLines[0].startTime>n)return[n,Math.max(n,this.processedLines[0].startTime-250),-2,this.processedLines[0].isDuet];if(this.processedLines[1].startTime>n&&this.processedLines[0].endTime<n)return[Math.max(this.processedLines[0].endTime,n),this.processedLines[1].startTime,0,this.processedLines[1].isDuet]}}else if((t=this.processedLines[a])!=null&&t.endTime&&(r=this.processedLines[a+1])!=null&&r.startTime){if(this.processedLines[a+1].startTime>n&&this.processedLines[a].endTime<n)return[Math.max(this.processedLines[a].endTime,n),this.processedLines[a+1].startTime,a,this.processedLines[a+1].isDuet];if((i=this.processedLines[a+2])!=null&&i.startTime&&this.processedLines[a+2].startTime>n&&this.processedLines[a+1].endTime<n)return[Math.max(this.processedLines[a+1].endTime,n),this.processedLines[a+2].startTime,a+1,this.processedLines[a+2].isDuet]}}rebuildStyle(){this._baseFontSize=Number.parseFloat(getComputedStyle(this.element).fontSize);let e="";e+="--amll-lp-width:";const t=this.innerSize[0]-this._baseFontSize*2;e+=`${t.toFixed(4)}px;`,e+="--amll-lp-height:",e+=`${(this.innerSize[1]-this._baseFontSize*2).toFixed(4)}px;`,e+="--amll-lp-line-width:",this.innerSize[0]<768?e+=`${t.toFixed(4)}px;`:e+=`${(t*.8).toFixed(4)}px;`,this.element.setAttribute("style",e)}setHidePassedLines(e){this.hidePassedLines=e,this.calcLayout()}setEnableBlur(e){this.enableBlur!==e&&(this.enableBlur=e,this.calcLayout())}get wordFadeWidth(){return this._wordFadeWidth}setWordFadeWidth(e=.5){this._wordFadeWidth=Math.max(1e-4,e);for(const t of this.lyricLinesEl)t.markMaskImageDirty()}setLyricLines(e,t=0){for(const r of e)for(const i of r.words)i.word=i.word.replace(/\s+/g," ");this.lastCurrentTime=t,this.currentTime=t,this.lyricLines=e,this.processedLines=Jd(e),this.isNonDynamic=!0,this.isNonDuet=!0;for(const r of this.processedLines)if(r.words.length>1){this.isNonDynamic=!1;break}for(const r of this.processedLines)if(r.isDuet){this.isNonDuet=!1;break}this.rebuildStyle(),this.processedLines.forEach((r,i,n)=>{const a=n[i+1];r.words[r.words.length-1]&&(a?a.startTime>r.endTime&&(r.endTime=Math.min(r.endTime+1500,a.startTime)):r.endTime=r.endTime+1500)}),this.processedLines.forEach((r,i,n)=>{if(r.isBG)return;const a=n[i+1];a!=null&&a.isBG&&(a.startTime=Math.min(a.startTime,r.startTime))});for(const r of this.lyricLinesEl)r.removeMouseEventListener("click",this.onLineClickedHandler),r.removeMouseEventListener("contextmenu",this.onLineClickedHandler),r.dispose();this.lyricLinesEl=this.processedLines.map(r=>{const i=new Nf(this,r);return i.addMouseEventListener("click",this.onLineClickedHandler),i.addMouseEventListener("contextmenu",this.onLineClickedHandler),i}),this.lyricLinesEl.forEach((r,i)=>{this.element.appendChild(r.getElement()),this.lyricLinesIndexes.set(r,i),r.markMaskImageDirty()}),this.interludeDots.setInterlude(void 0),this.hotLines.clear(),this.bufferedLines.clear(),this.setLinePosXSpringParams({}),this.setLinePosYSpringParams({}),this.setLineScaleSpringParams({}),this.resetScroll(),this.setCurrentTime(0,!0),this.calcLayout(!0,!0)}resetScroll(){this.isScrolled=!1,this.scrollOffset=0,this.invokedByScrollEvent=!1,clearTimeout(this.scrolledHandler),this.scrolledHandler=0}calcLayout(e=!1,t=!1){var r;if(t){for(const p of this.lyricLinesEl){const m=p.measureSize();this.lyricLinesSize.set(p,m),p.lineSize=m}this.interludeDotsSize[0]=this.interludeDots.getElement().clientWidth,this.interludeDotsSize[1]=this.interludeDots.getElement().clientHeight,this.bottomLine.lineSize=this.bottomLine.measureSize()}const i=this.getCurrentInterlude();let n=-this.scrollOffset,a=this.scrollToIndex,o=0;i?(o=i[1]-i[0],o>=4e3&&this.lyricLinesEl[i[2]+1]&&(a=i[2]+1)):this.interludeDots.setInterlude(void 0);const h=this.lyricLinesEl.slice(0,a).reduce((p,m)=>{var y;return p+(m.getLine().isBG?0:((y=this.lyricLinesSize.get(m))==null?void 0:y[1])??0)},0);this.scrollBoundary[0]=-h,n-=h,n+=this.size[1]*this.alignPosition;const l=this.lyricLinesEl[a];if(l){const p=((r=this.lyricLinesSize.get(l))==null?void 0:r[1])??0;switch(this.alignAnchor){case"bottom":n-=p;break;case"center":n-=p/2;break}}const u=Math.max(...this.bufferedLines);let c=0,d=.05,f=!1;this.lyricLinesEl.forEach((p,m)=>{var y,x,b;const g=this.bufferedLines.has(m),v=g||m>=this.scrollToIndex&&m<u,_=p.getLine();let T=24;_.isDuet&&(T=this.size[0]-(((y=this.lyricLinesSize.get(p))==null?void 0:y[0])??0)),!f&&o>=4e3&&(m===this.scrollToIndex&&(i==null?void 0:i[2])===-2||m===this.scrollToIndex+1)&&(f=!0,this.interludeDots.setTransform(24,n+10),i&&this.interludeDots.setInterlude([i[0],i[1]]),n+=this.interludeDotsSize[1]+40);let E,w;this.hidePassedLines?m<(i?i[2]+1:this.scrollToIndex)?(E=0,w=0):g?(E=.85,w=.4):(E=this.isNonDynamic?.2:1,w=.2):g?(E=.85,w=.4):(E=this.isNonDynamic?.2:1,w=.2);let S=0;this.enableBlur&&(v?S=0:(S=1,m<this.scrollToIndex?S+=Math.abs(this.scrollToIndex-m)+1:S+=Math.abs(m-Math.max(this.scrollToIndex,u)))),this.invokedByScrollEvent&&(S=0);const L=this.enableScale?97:100;p.setTransform(T,n,v?100:_.isBG?75:L,E,w,window.innerWidth<=1024?S*.8:S,e,c),_.isBG&&v?n+=((x=this.lyricLinesSize.get(p))==null?void 0:x[1])??0:_.isBG||(n+=((b=this.lyricLinesSize.get(p))==null?void 0:b[1])??0),n>=0&&!this.isSeeking&&(_.isBG||(c+=d),m>=this.scrollToIndex&&(d/=1.05))}),this.scrollBoundary[1]=n+this.scrollOffset-this.size[1]/2,this.bottomLine.setTransform(24,n,e,c)}getCurrentTime(){return this.currentTime}getLyricLines(){return this.lyricLines}getElement(){return this.element}getBottomLineElement(){return this.bottomLine.getElement()}setAlignAnchor(e){this.alignAnchor=e}setAlignPosition(e){this.alignPosition=e}setCurrentTime(e,t=!1){if(this.initializeSeeking=t,this.currentTime=e,Math.abs(this.currentTime-this.lastCurrentTime)>=100?this.initializeSeeking=!0:this.initializeSeeking=!1,!this.isPageVisible||(!this._getIsNonDynamic()&&!this.supportMaskImage&&this.element.style.setProperty("--amll-player-time",`${e}`),this.isScrolled))return;const r=new Set,i=new Set,n=new Set;if(t)for(const a of this.lyricLinesEl)a.setMaskAnimationState(e);for(const a of this.hotLines){const o=this.processedLines[a];if(o){if(o.isBG)return;const h=this.processedLines[a+1];if(h!=null&&h.isBG){const l=this.processedLines[a+2],u=Math.min(o.startTime,h==null?void 0:h.startTime),c=Math.min(Math.max(o.endTime,(l==null?void 0:l.startTime)??Number.MAX_VALUE),Math.max(o.endTime,h==null?void 0:h.endTime));(u>e||c<=e)&&(this.hotLines.delete(a),r.add(a),this.hotLines.delete(a+1),r.add(a+1),t&&(this.lyricLinesEl[a].disable(e),this.lyricLinesEl[a+1].disable(e)))}else(o.startTime>e||o.endTime<=e)&&(this.hotLines.delete(a),r.add(a),t&&this.lyricLinesEl[a].disable(e))}else this.hotLines.delete(a),r.add(a),t&&this.lyricLinesEl[a].disable(e)}this.processedLines.forEach((a,o,h)=>{var l;!a.isBG&&a.startTime<=e&&a.endTime>e&&(this.hotLines.has(o)||(this.hotLines.add(o),n.add(o),t&&this.lyricLinesEl[o].enable(e),(l=h[o+1])!=null&&l.isBG&&(this.hotLines.add(o+1),n.add(o+1),t&&this.lyricLinesEl[o+1].enable(e))))});for(const a of this.bufferedLines)this.hotLines.has(a)||(i.add(a),t&&this.lyricLinesEl[a].disable(e));if(t){this.bufferedLines.size>0?this.scrollToIndex=Math.min(...this.bufferedLines):this.scrollToIndex=this.processedLines.findIndex(a=>a.startTime>=e),this.bufferedLines.clear();for(const a of this.hotLines)this.bufferedLines.add(a);this.calcLayout(!0)}else if(i.size>0||n.size>0)if(i.size===0&&n.size>0){for(const a of n)this.bufferedLines.add(a),this.lyricLinesEl[a].enable(e);this.scrollToIndex=Math.min(...this.bufferedLines),this.calcLayout()}else if(n.size===0&&i.size>0){if(ef(i,this.bufferedLines)){for(const a of this.bufferedLines)this.hotLines.has(a)||(this.bufferedLines.delete(a),this.lyricLinesEl[a].disable(e));this.calcLayout()}}else{for(const a of n)this.bufferedLines.add(a),this.lyricLinesEl[a].enable(e);for(const a of i)this.bufferedLines.delete(a),this.lyricLinesEl[a].disable(e);this.bufferedLines.size>0&&(this.scrollToIndex=Math.min(...this.bufferedLines)),this.calcLayout()}this.lastCurrentTime=e}pause(){this.interludeDots.pause();for(const e of this.lyricLinesEl)e.pause(this.currentTime)}resume(){this.interludeDots.resume();for(const e of this.lyricLinesEl)e.resume(this.currentTime)}update(e=0){if(!this.isPageVisible)return;const t=e/1e3;this.interludeDots.update(e),this.bottomLine.update(t);for(const r of this.lyricLinesEl)r.update(t)}setLinePosXSpringParams(e){this.posXSpringParams={...this.posXSpringParams,...e},this.bottomLine.lineTransforms.posX.updateParams(this.posXSpringParams);for(const t of this.lyricLinesEl)t.lineTransforms.posX.updateParams(this.posXSpringParams)}setLinePosYSpringParams(e){this.posYSpringParams={...this.posYSpringParams,...e},this.bottomLine.lineTransforms.posY.updateParams(this.posYSpringParams);for(const t of this.lyricLinesEl)t.lineTransforms.posY.updateParams(this.posYSpringParams)}setLineScaleSpringParams(e){this.scaleSpringParams={...this.scaleSpringParams,...e},this.scaleForBGSpringParams={...this.scaleForBGSpringParams,...e};for(const t of this.lyricLinesEl)t.getLine().isBG?t.lineTransforms.scale.updateParams(this.scaleForBGSpringParams):t.lineTransforms.scale.updateParams(this.scaleSpringParams)}dispose(){this.element.remove(),this.resizeObserver.disconnect();for(const e of this.lyricLinesEl)e.dispose();window.removeEventListener("pageshow",this.onPageShow),this.bottomLine.dispose(),this.interludeDots.dispose()}}const Ff={disabled:{type:Boolean,default:!1},playing:{type:Boolean,default:!0},alignAnchor:{type:String,default:"center"},alignPosition:{type:Number,default:.5},enableSpring:{type:Boolean,default:!0},enableBlur:{type:Boolean,default:!0},enableScale:{type:Boolean,default:!0},hidePassedLines:{type:Boolean,default:!1},lyricLines:{type:Object,required:!1},currentTime:{type:Number,default:0},wordFadeWidth:{type:Number,default:.5},linePosXSpringParams:{type:Object,required:!1},linePosYSpringParams:{type:Object,required:!1},lineScaleSpringParams:{type:Object,required:!1}},Df={lineClick:s=>!0,lineContextmenu:s=>!0},kf=Uo({name:"LyricPlayer",props:Ff,emits:Df,slots:Object,setup(s,{expose:e,emit:t,attrs:r,slots:i}){const n=Go("wrapper-ref"),a=jo(),o=u=>t("lineClick",u),h=u=>t("lineContextmenu",u);Ho(()=>{const u=n.value;u&&(a.value=new Of,u.appendChild(a.value.getElement()),a.value.addEventListener("line-click",o),a.value.addEventListener("line-contextmenu",h))}),zo(()=>{a.value&&(a.value.removeEventListener("line-click",o),a.value.removeEventListener("line-contextmenu",h),a.value.dispose())}),ve(u=>{if(!s.disabled){let c=!1,d=-1;const f=p=>{var m;c||(d===-1&&(d=p),(m=a.value)==null||m.update(p-d),d=p,requestAnimationFrame(f))};requestAnimationFrame(f),u(()=>{c=!0})}}),ve(()=>{var u,c,d;s.playing!==void 0?s.playing?(u=a.value)==null||u.resume():(c=a.value)==null||c.pause():(d=a.value)==null||d.resume()}),ve(()=>{var u;s.alignAnchor!==void 0&&((u=a.value)==null||u.setAlignAnchor(s.alignAnchor))}),ve(()=>{var u;s.hidePassedLines!==void 0&&((u=a.value)==null||u.setHidePassedLines(s.hidePassedLines))}),ve(()=>{var u;s.alignPosition!==void 0&&((u=a.value)==null||u.setAlignPosition(s.alignPosition))}),ve(()=>{var u,c;s.enableSpring!==void 0?(u=a.value)==null||u.setEnableSpring(s.enableSpring):(c=a.value)==null||c.setEnableSpring(!0)}),ve(()=>{var u,c;s.enableBlur!==void 0?(u=a.value)==null||u.setEnableBlur(s.enableBlur):(c=a.value)==null||c.setEnableBlur(!0)}),ve(()=>{var u,c;s.enableScale!==void 0?(u=a.value)==null||u.setEnableScale(s.enableScale):(c=a.value)==null||c.setEnableScale(!0)}),ve(()=>{var u;s.lyricLines!==void 0&&((u=a.value)==null||u.setLyricLines(s.lyricLines))}),ve(()=>{var u;s.currentTime!==void 0&&((u=a.value)==null||u.setCurrentTime(s.currentTime))}),ve(()=>{var u;s.wordFadeWidth!==void 0&&((u=a.value)==null||u.setWordFadeWidth(s.wordFadeWidth))}),ve(()=>{var u;s.linePosXSpringParams!==void 0&&((u=a.value)==null||u.setLinePosXSpringParams(s.linePosXSpringParams))}),ve(()=>{var u;s.linePosYSpringParams!==void 0&&((u=a.value)==null||u.setLinePosYSpringParams(s.linePosYSpringParams))}),ve(()=>{var u;s.lineScaleSpringParams!==void 0&&((u=a.value)==null||u.setLineScaleSpringParams(s.lineScaleSpringParams))});const l=Vo(()=>{var u;return(u=a.value)==null?void 0:u.getBottomLineElement()});return e({lyricPlayer:a,wrapperEl:n}),()=>Bi("div",$o({ref:"wrapper-ref"},r),[l.value&&Bi(Xo,{to:l.value},{default:()=>{var u;return[(u=i["bottom-line"])==null?void 0:u.call(i)]}})])}});export{kf as T,Gi as a,Tt as c,Ui as g};
